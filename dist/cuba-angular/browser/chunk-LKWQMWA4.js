import{a as z}from"./chunk-SRQ7ALFT.js";import{a as K}from"./chunk-4DCX2U46.js";import{a as ee}from"./chunk-POMG26IM.js";import{a as N}from"./chunk-JETGV2KU.js";import"./chunk-3EDIKQYL.js";import{B as W,D as fe,H as ge,I as _e,J as he,K as ke,L as ve,O as V,l as q,s as Be,t as G,w as $}from"./chunk-4QEBWWP4.js";import{k as oe,l as B,m as U,p as L,r as Me,u as k}from"./chunk-3BZESKLL.js";import{$a as ue,Ab as re,Cb as u,Eb as me,Fc as j,Mb as i,Nb as a,Ob as s,Sb as y,Yb as C,Zb as m,a as P,b as R,bc as Oe,db as o,e as Z,hc as n,ic as _,jb as I,jc as p,kc as ce,mc as E,nc as S,oc as A,pb as M,qa as h,ra as v,rc as pe,sc as De,tc as Pe,ub as f,uc as Re,vc as w,xc as O}from"./chunk-NIELWWGW.js";var X=Z(ee());function Ve(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),s(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),s(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),s(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),s(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),s(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),s(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),s(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),w(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),s(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),s(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),s(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),s(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),s(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=m(2);o(23),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Numero),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),p(" ",e.facturaActual.Ciudad," "),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function Ne(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function Ue(r,t){r&1&&(i(0,"span",90),s(1,"i",91),n(2,"Requerido "),a())}function Le(r,t){r&1&&(i(0,"span",92),s(1,"i",93),n(2,"N/A "),a())}function Ge(r,t){r&1&&(i(0,"span",94),s(1,"i",95),n(2,"Validado "),a())}function $e(r,t){r&1&&(i(0,"span",96),s(1,"i",97),n(2,"Pendiente "),a())}function We(r,t){r&1&&(i(0,"span",45),s(1,"i",95),n(2,"OK "),a())}function ze(r,t){if(r&1){let e=y();i(0,"div",98)(1,"span",99),s(2,"i",100),a(),i(3,"input",101),A("ngModelChange",function(l){h(e);let d=m().$implicit,g=m(3);return S(g.inputValues[d.input_field],l)||(g.inputValues[d.input_field]=l),v(l)}),C("keypress",function(l){h(e);let d=m().$implicit,g=m(3);return v(g.onInputKeyPress(l,d,d.input_field))}),a()()}if(r&2){let e=m().$implicit,c=m(3);o(3),E("ngModel",c.inputValues[e.input_field]),u("disabled",e.validado),re("data-product",e.CopProducto)}}function Xe(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function Je(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),f(10,Ne,3,1,"div",79),a()(),i(11,"td",80),f(12,Ue,3,0,"span",81)(13,Le,3,0,"span",82),a(),i(14,"td",80),f(15,Ge,3,0,"span",83)(16,$e,3,0,"span",84)(17,We,3,0,"span",85),a(),i(18,"td",37),f(19,ze,4,3,"div",86)(20,Xe,2,0,"div",87),a()()),r&2){let e=t.$implicit;o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function He(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),s(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),f(32,Je,21,12,"tr",73),a()()()()()()),r&2){let e=m(2);o(5),p("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function je(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function qe(r,t){r&1&&(i(0,"span",113),s(1,"i",95),n(2,"Validado "),a())}function Ke(r,t){r&1&&(i(0,"span",114),s(1,"i",97),n(2,"Pendiente "),a())}function Ye(r,t){if(r&1){let e=y();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",107)(8,"div"),n(9),f(10,je,3,1,"div",79),a()(),i(11,"td",80)(12,"span",108),s(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),f(16,qe,3,0,"span",109)(17,Ke,3,0,"span",110),a(),i(18,"td",37)(19,"div",98)(20,"span",111),s(21,"i",112),a(),i(22,"input",101),A("ngModelChange",function(l){let d=h(e).$implicit,g=m(3);return S(g.inputValues[d.input_field],l)||(g.inputValues[d.input_field]=l),v(l)}),C("keypress",function(l){let d=h(e).$implicit,g=m(3);return v(g.onInputKeyPress(l,d,d.input_field))}),a()()()()}if(r&2){let e=t.$implicit,c=m(3);o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),E("ngModel",c.inputValues[e.input_field]),u("disabled",e.validado),re("data-product",e.CopProducto)}}function Qe(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),s(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),f(32,Ye,23,10,"tr",73),a()()()()()()),r&2){let e=m(2);o(5),p("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function Ze(r,t){r&1&&(i(0,"div",2)(1,"div",115),s(2,"i",116),n(3," No hay productos en el detalle "),a()())}function et(r,t){if(r&1){let e=y();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",15),f(8,Ve,87,12,"div",16),i(9,"div",1),f(10,He,33,2,"div",17)(11,Qe,33,2,"div",17)(12,Ze,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){h(e);let l=m();return v(l.guardarPreparacion())}),s(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=m();o(5),p("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var be=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Sucursal",field_value:"departamento_nombre",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):X.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`,t.departamento_nombre=`<span class="fw-bold">${t.departamento_nombre}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:c=>{console.log("response: ",c),c.success&&c.cabecera?c.cabecera.length>0?(this.facturaSeleccionada=c,this.facturaActual=c.cabecera[0],this.detalleFactura=c.detalle||[],this.detalleFactura=this.detalleFactura.map((l,d)=>{let g=`${l.ProductoId}_${d}`;return this.inputValues[g]="",R(P({},l),{codigoBarras:"",input_field:g,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,X.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):X.default.fire("Error!",c.message,"error"),this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})}onInputKeyPress(t,e,c){if(t.key==="Enter"){let l=t.target,d=l.value.trim();if(console.log("Input value for row:",e,"Value:",d),e&&d){let g=e.Codigo_barras?e.Codigo_barras.split(",").map(x=>x.trim()):[],T=g.includes(d)||d===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...g,e.CopProducto]),console.log("C\xF3digo ingresado:",d),console.log("Es v\xE1lido:",T),T?(e.validado=!0,e.codigoBarras=d,l.classList.remove("is-invalid"),l.classList.add("is-valid"),X.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${d}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${d}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),X.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${g.map(x=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${x}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${d}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${d}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(d=>`\u2022 ${d.CopProducto} - ${d.Detalle.substring(0,50)}...`).join(`
`);X.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(d=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${d.CopProducto}</strong><br>
                  <small class="text-muted">${d.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let c=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);X.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${c.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:d=>{if(console.log("response: ",d),d.success)if(d.data&&d.data.length>0){let g=d.data.some(x=>x.data&&x.data.length>0&&x.data.some(b=>b.success==="true"));d.data.some(x=>x.data&&x.data.length>0&&x.data.some(b=>b.menssage==="ya existe registro"))?X.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p><strong>Bodega(s):</strong> ${d.bodegas?d.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):g?X.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p><strong>Bodega(s):</strong> ${d.bodegas?d.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${d.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):X.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else X.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${d.factura}</p>
                    <p class="text-success">${d.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else X.default.fire({title:"Error!",text:d.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-preparar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(d){return c.onTableAction(d)})("customAction",function(d){return c.onCustomAction(d)}),a()()()()()(),f(8,et,19,5,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",c.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",c.Buttons_Export)("customButtons",c.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",c.showPrepararModal))},dependencies:[k,B,U,L,V,G,$,W,N,K],encapsulation:2})};var J=Z(ee());function tt(r,t){if(r&1&&(i(0,"div",1)(1,"div",23)(2,"h5",24),n(3,"No cerrar esta ventana si esta realizando el proceso de ingreso de datos"),a(),i(4,"div",25),s(5,"i",26),i(6,"h6",27),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",28)(9,"div",29)(10,"div",30)(11,"small",31),s(12,"i",32),n(13,"Datos Principales "),a()(),i(14,"div",33)(15,"table",34)(16,"tbody")(17,"tr",35)(18,"td",36),s(19,"i",37),n(20,"Bodega: "),a(),i(21,"td",38)(22,"span",39),n(23),a()()(),i(24,"tr",35)(25,"td",40),s(26,"i",41),n(27,"Secuencia: "),a(),i(28,"td",38)(29,"span",42),n(30),a()()(),i(31,"tr",35)(32,"td",40),s(33,"i",43),n(34,"ID: "),a(),i(35,"td",38),n(36),a()(),i(37,"tr",35)(38,"td",40),s(39,"i",44),n(40,"Cliente: "),a(),i(41,"td",38),n(42),a()(),i(43,"tr",35)(44,"td",40),s(45,"i",45),n(46,"Fecha: "),a(),i(47,"td",38)(48,"span",46),n(49),w(50,"date"),a()()()()()()()(),i(51,"div",28)(52,"div",29)(53,"div",30)(54,"small",31),s(55,"i",47),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",33)(58,"table",34)(59,"tbody")(60,"tr",35)(61,"td",40),s(62,"i",48),n(63,"Ciudad: "),a(),i(64,"td",38)(65,"span",49),n(66),a()()(),i(67,"tr",35)(68,"td",40),s(69,"i",50),n(70,"Vendedor: "),a(),i(71,"td",38),n(72),a()(),i(73,"tr",35)(74,"td",40),s(75,"i",51),n(76,"Tipo Pedido: "),a(),i(77,"td",38)(78,"span",52),n(79),a()()(),i(80,"tr",35)(81,"td",40),s(82,"i",53),n(83,"Forma Pago: "),a(),i(84,"td",38)(85,"span",54),n(86),a()()()()()()()()()),r&2){let e=m(2);o(23),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Id),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),p(" ",e.facturaActual.Ciudad," "),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function it(r,t){if(r&1&&(i(0,"div",76)(1,"small",77),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function at(r,t){if(r&1&&(i(0,"tr",70)(1,"td",71),n(2),a(),i(3,"td",72),n(4),a(),i(5,"td",73),n(6),a(),i(7,"td",74)(8,"div"),n(9),f(10,it,3,1,"div",75),a()()()),r&2){let e=t.$implicit;o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A")}}function nt(r,t){if(r&1&&(i(0,"div",2)(1,"div",55)(2,"div",56)(3,"h6",57),s(4,"i",58),n(5),a()(),i(6,"div",59)(7,"div",60)(8,"table",61)(9,"thead",62)(10,"tr")(11,"th",63),s(12,"i",64),n(13,"C\xF3digo "),a(),i(14,"th",65),n(15," Cant. "),a(),i(16,"th",66),s(17,"i",32),n(18,"Descripci\xF3n "),a(),i(19,"th",67),s(20,"i",68),n(21,"Ubicaci\xF3n "),a()()(),i(22,"tbody"),f(23,at,11,5,"tr",69),a()()()()()()),r&2){let e=m(2);o(5),p("Productos Libres (",e.productosNoJaula.length,") "),o(18),u("ngForOf",e.productosNoJaula)}}function rt(r,t){if(r&1&&(i(0,"div",76)(1,"small",77),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function ot(r,t){if(r&1&&(i(0,"tr",70)(1,"td",71),n(2),a(),i(3,"td",72),n(4),a(),i(5,"td",73),n(6),a(),i(7,"td",82)(8,"div"),n(9),f(10,rt,3,1,"div",75),a()()()),r&2){let e=t.$implicit;o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A")}}function lt(r,t){if(r&1&&(i(0,"div",2)(1,"div",78)(2,"div",56)(3,"h6",79),s(4,"i",80),n(5),a()(),i(6,"div",59)(7,"div",60)(8,"table",61)(9,"thead",81)(10,"tr")(11,"th",63),s(12,"i",64),n(13,"C\xF3digo "),a(),i(14,"th",65),n(15," Cant. "),a(),i(16,"th",66),s(17,"i",32),n(18,"Descripci\xF3n "),a(),i(19,"th",67),s(20,"i",68),n(21,"Ubicaci\xF3n "),a()()(),i(22,"tbody"),f(23,ot,11,5,"tr",69),a()()()()()()),r&2){let e=m(2);o(5),p("Productos en JAULA (",e.productosJaula.length,") "),o(18),u("ngForOf",e.productosJaula)}}function st(r,t){r&1&&(i(0,"div",2)(1,"div",83),s(2,"i",84),n(3," No hay productos en el detalle "),a()())}function ct(r,t){if(r&1&&(i(0,"option",101),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),o(),p(" ",e.nombre," ")}}function dt(r,t){if(r&1&&(i(0,"option",101),n(1),a()),r&2){let e=t.$implicit;u("value",e.ID),o(),ce(" ",e.codigo," - ",e.Nombre," ")}}function ut(r,t){if(r&1){let e=y();i(0,"div",90)(1,"label",102),s(2,"i",103),n(3,"Seleccionar Tienda "),a(),i(4,"select",104),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.tiendaDestino,l)||(d.tiendaDestino=l),v(l)}),i(5,"option",94),n(6,"-- Seleccione una tienda --"),a(),f(7,dt,2,3,"option",95),a()()}if(r&2){let e=m(3);o(4),E("ngModel",e.tiendaDestino),o(3),u("ngForOf",e.tiendas)}}function mt(r,t){if(r&1){let e=y();i(0,"div",1)(1,"div",90)(2,"label",105),s(3,"i",68),n(4,"Direcci\xF3n "),a(),i(5,"input",106),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.direccionEnvio,l)||(d.direccionEnvio=l),v(l)}),a()(),i(6,"div",90)(7,"label",107),s(8,"i",32),n(9,"Referencia "),a(),i(10,"input",108),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.referenciaEnvio,l)||(d.referenciaEnvio=l),v(l)}),a()(),i(11,"div",90)(12,"label",109),s(13,"i",110),n(14,"Tel\xE9fono "),a(),i(15,"input",111),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.telefonoEnvio,l)||(d.telefonoEnvio=l),v(l)}),a()(),i(16,"div",90)(17,"label",112),s(18,"i",113),n(19,"Email "),a(),i(20,"input",114),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.emailEnvio,l)||(d.emailEnvio=l),v(l)}),a()()()}if(r&2){let e=m(3);o(5),E("ngModel",e.direccionEnvio),o(5),E("ngModel",e.referenciaEnvio),o(5),E("ngModel",e.telefonoEnvio),o(5),E("ngModel",e.emailEnvio)}}function pt(r,t){if(r&1){let e=y();i(0,"div",85)(1,"div",86)(2,"div",56)(3,"h6",87),s(4,"i",88),n(5,"Informaci\xF3n de Despacho "),a()(),i(6,"div",89)(7,"div",1)(8,"div",90)(9,"label",91),s(10,"i",92),n(11,"Tipo de Entrega "),a(),i(12,"select",93),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.tipoDespacho,l)||(d.tipoDespacho=l),v(l)}),i(13,"option",94),n(14,"-- Seleccione una opci\xF3n --"),a(),f(15,ct,2,2,"option",95),a()(),f(16,ut,8,2,"div",96),a(),i(17,"div",1)(18,"div",97)(19,"label",98),s(20,"i",99),n(21,"Comentarios (Opcional) "),a(),i(22,"textarea",100),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.comentarioDespacho,l)||(d.comentarioDespacho=l),v(l)}),a()()(),f(23,mt,21,4,"div",16),a()()()}if(r&2){let e=m(2);o(12),E("ngModel",e.tipoDespacho),o(3),u("ngForOf",e.formasDespacho),o(),u("ngIf",e.tipoDespacho==="2"),o(6),E("ngModel",e.comentarioDespacho),o(),u("ngIf",e.tipoDespacho==="3")}}function ft(r,t){if(r&1){let e=y();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",15),f(8,tt,87,12,"div",16),i(9,"div",1),f(10,nt,24,2,"div",17)(11,lt,24,2,"div",17)(12,st,4,0,"div",17)(13,pt,24,5,"div",18),a()(),i(14,"div",19)(15,"button",20),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(16,"Cerrar"),a(),i(17,"button",21),C("click",function(){h(e);let l=m();return v(l.guardarPreparacion())}),s(18,"i",22),n(19,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=m();o(5),p("Ingresar Datos de Dropshipping - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0),o(),u("ngIf",e.productosJaula.length>0||e.productosNoJaula.length>0)}}var xe=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];tipoDespacho="";tiendaDestino="";direccionEnvio="";referenciaEnvio="";telefonoEnvio="";emailEnvio="";comentarioDespacho="";formasDespacho=[];tiendas=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Sucursal",field_value:"departamento_nombre",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDropshipping(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):J.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}}),this.FacturacionService.GetInfoDespacho(t).subscribe({next:e=>{e.success?(this.formasDespacho=e.forma_Despacho||[],this.tiendas=e.tiendas||[]):J.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`,t.departamento_nombre=`<span class="fw-bold">${t.departamento_nombre}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){console.log("data: ",t);let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosDropshipping(e).subscribe({next:c=>{console.log("response: ",c),c.success&&c.cabecera?c.cabecera.length>0?(this.facturaSeleccionada=c,this.facturaActual=c.cabecera[0],this.detalleFactura=c.detalle||[],this.detalleFactura=this.detalleFactura.map((l,d)=>{let g=`${l.ProductoId}_${d}`;return R(P({},l),{codigoBarras:"",input_field:g,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),this.showPrepararModal=!0):(this.showPrepararModal=!1,J.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):J.default.fire("Error!",c.message,"error"),this.isLoading=!1},error:c=>{this.isLoading=!1}})}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.tipoDespacho="",this.tiendaDestino="",this.direccionEnvio="",this.referenciaEnvio="",this.telefonoEnvio="",this.emailEnvio="",this.comentarioDespacho=""}guardarPreparacion(){if(!this.tipoDespacho||this.tipoDespacho===""){J.default.fire({title:"\u26A0\uFE0F Validaci\xF3n requerida",text:"Debe seleccionar un tipo de entrega",icon:"warning",confirmButtonColor:"#f39c12"});return}let t={tipo:this.tipoDespacho,tienda:null,direccion:null,referencia:null,telefono:null,email:null};if(this.tipoDespacho==="1")t.comentario=this.comentarioDespacho||"",console.log("Entrega en Tienda seleccionada");else if(this.tipoDespacho==="2"){if(!this.tiendaDestino||this.tiendaDestino===""){J.default.fire({title:"\u26A0\uFE0F Validaci\xF3n requerida",text:"Debe seleccionar una tienda de destino",icon:"warning",confirmButtonColor:"#f39c12"});return}t.tienda=this.tiendaDestino,t.comentario=this.comentarioDespacho||"",console.log("Entrega en otra tienda:",this.tiendaDestino)}else if(this.tipoDespacho==="3"){let c=[];if((!this.direccionEnvio||this.direccionEnvio.trim()==="")&&c.push("\u2022 Direcci\xF3n"),(!this.referenciaEnvio||this.referenciaEnvio.trim()==="")&&c.push("\u2022 Referencia"),(!this.telefonoEnvio||this.telefonoEnvio.trim()==="")&&c.push("\u2022 Tel\xE9fono"),(!this.emailEnvio||this.emailEnvio.trim()==="")&&c.push("\u2022 Email"),c.length>0){J.default.fire({title:"\u26A0\uFE0F Campos faltantes",html:`
            <div class="text-start">
              <p>Los siguientes campos son requeridos para env\xEDo a domicilio:</p>
              <ul class="list-unstyled">
                ${c.map(g=>`<li class="text-danger fw-bold">${g}</li>`).join("")}
              </ul>
            </div>
          `,icon:"warning",confirmButtonColor:"#f39c12"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.emailEnvio)){J.default.fire({title:"\u26A0\uFE0F Email inv\xE1lido",text:"Por favor ingrese un email v\xE1lido",icon:"warning",confirmButtonColor:"#f39c12"});return}if(!/^[0-9+\-\s()]+$/.test(this.telefonoEnvio)){J.default.fire({title:"\u26A0\uFE0F Tel\xE9fono inv\xE1lido",text:"Por favor ingrese un tel\xE9fono v\xE1lido",icon:"warning",confirmButtonColor:"#f39c12"});return}t.direccion=this.direccionEnvio.trim(),t.referencia=this.referenciaEnvio.trim(),t.telefono=this.telefonoEnvio.trim(),t.email=this.emailEnvio.trim()}let e="";if(this.tipoDespacho==="0"||this.tipoDespacho==="1")e=`
        <p><strong>Tipo:</strong> Entrega en Tienda</p>
        ${this.comentarioDespacho?`<p><strong>Comentario:</strong> ${this.comentarioDespacho}</p>`:""}
      `;else if(this.tipoDespacho==="2"){let c=this.tiendas.find(l=>l.ID===this.tiendaDestino);e=`
        <p><strong>Tipo:</strong> Entrega en otra Tienda</p>
        <p><strong>Tienda:</strong> ${c?.codigo} - ${c?.Nombre}</p>
        ${this.comentarioDespacho?`<p><strong>Comentario:</strong> ${this.comentarioDespacho}</p>`:""}
      `}else this.tipoDespacho==="3"&&(e=`
        <div class="text-start">
          <p><strong>Tipo:</strong> Env\xEDo a Domicilio</p>
          <p><strong>Direcci\xF3n:</strong> ${this.direccionEnvio}</p>
          <p><strong>Referencia:</strong> ${this.referenciaEnvio}</p>
          <p><strong>Tel\xE9fono:</strong> ${this.telefonoEnvio}</p>
          <p><strong>Email:</strong> ${this.emailEnvio}</p>
        </div>
      `);J.default.fire({title:"\u26A0\uFE0F Confirmar Datos de Despacho",html:e,icon:"question",showCancelButton:!0,confirmButtonText:"\u2705 S\xED, Guardar",cancelButtonText:"\u274C Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545"}).then(c=>{if(c.isConfirmed){let l={factura:this.facturaSeleccionada.cabecera[0].Id,bodegas:this.facturaSeleccionada.BODEGAS,tipo:t.tipo||"",tienda:t.tienda||"",direccion:t.direccion||"",referencia:t.referencia||"",telefono:t.telefono||"",email:t.email||"",comentario:t.comentario||""};console.log("param: ",l),this.FacturacionService.GuardarDropshipping(l).subscribe({next:d=>{console.log("response: ",d),d.success?(J.default.fire("\xC9xito!","Datos de despacho guardados correctamente.","success"),this.cerrarModal(),this.loadTableData()):J.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{this.isLoading=!1}})}})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-dropshipping-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],["class","col-12 mt-4",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","15%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","10%"],[1,"text-center","py-2",2,"width","40%"],[1,"text-center","py-2",2,"width","20%"],[1,"fa","fa-map-marker-alt","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"],[1,"col-12","mt-4"],[1,"card","border-info"],[1,"text-info","mb-0"],[1,"fa","fa-truck","me-1"],[1,"card-body"],[1,"col-md-6","mb-3"],["for","tipoDespacho",1,"form-label","fw-bold"],[1,"fa","fa-shipping-fast","me-1"],["id","tipoDespacho","name","tipoDespacho",1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","col-md-6 mb-3",4,"ngIf"],[1,"col-12","mb-3"],["for","comentarioDespacho",1,"form-label","fw-bold"],[1,"fa","fa-comment","me-1"],["id","comentarioDespacho","name","comentarioDespacho","rows","3","placeholder","Escriba aqu\xED cualquier comentario o instrucci\xF3n...",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[3,"value"],["for","tiendaDestino",1,"form-label","fw-bold"],[1,"fa","fa-store","me-1"],["id","tiendaDestino","name","tiendaDestino",1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],["for","direccion",1,"form-label","fw-bold"],["type","text","id","direccion","name","direccionEnvio","placeholder","Calle, n\xFAmero, apto...",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["for","referencia",1,"form-label","fw-bold"],["type","text","id","referencia","name","referenciaEnvio","placeholder","Cerca de...",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["for","telefono",1,"form-label","fw-bold"],[1,"fa","fa-phone","me-1"],["type","tel","id","telefono","name","telefonoEnvio","placeholder","+591 7XXXXXXX",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["for","email",1,"form-label","fw-bold"],[1,"fa","fa-envelope","me-1"],["type","email","id","email","name","emailEnvio","placeholder","correo@ejemplo.com",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(d){return c.onTableAction(d)})("customAction",function(d){return c.onCustomAction(d)}),a()()()()()(),f(8,ft,20,6,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",c.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",c.Buttons_Export)("customButtons",c.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",c.showPrepararModal))},dependencies:[k,B,U,L,V,_e,he,G,ge,$,W,N,K],encapsulation:2})};var D=Z(ee());var gt=(r,t)=>({"bg-warning":r,"bg-info":t}),_t=(r,t,e)=>({"bg-success":r,"bg-warning":t,"bg-secondary":e}),ht=(r,t)=>({"table-success":r,"table-warning":t});function vt(r,t){if(r&1&&(i(0,"div",4)(1,"div",25)(2,"h5",26),n(3,"No cerrar esta ventana si esta realizando el proceso de Verificaci\xF3n"),a(),i(4,"div",27),s(5,"i",28),i(6,"h6",29),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",30)(9,"div",31)(10,"div",32)(11,"small",33),s(12,"i",34),n(13,"Datos Principales "),a()(),i(14,"div",35)(15,"table",36)(16,"tbody")(17,"tr",37)(18,"td",38),s(19,"i",39),n(20,"Bodega: "),a(),i(21,"td",40)(22,"span",41),n(23),a()()(),i(24,"tr",37)(25,"td",42),s(26,"i",43),n(27,"Secuencia: "),a(),i(28,"td",40)(29,"span",44),n(30),a()()(),i(31,"tr",37)(32,"td",42),s(33,"i",45),n(34,"N\xFAmero: "),a(),i(35,"td",40),n(36),a()(),i(37,"tr",37)(38,"td",42),s(39,"i",46),n(40,"Cliente: "),a(),i(41,"td",40),n(42),a()(),i(43,"tr",37)(44,"td",42),s(45,"i",47),n(46,"Fecha: "),a(),i(47,"td",40)(48,"span",48),n(49),w(50,"date"),a()()()()()()()(),i(51,"div",30)(52,"div",31)(53,"div",32)(54,"small",33),s(55,"i",49),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",35)(58,"table",36)(59,"tbody")(60,"tr",37)(61,"td",42),s(62,"i",50),n(63,"Ciudad: "),a(),i(64,"td",40)(65,"span",51),n(66),a()()(),i(67,"tr",37)(68,"td",42),s(69,"i",52),n(70,"Vendedor: "),a(),i(71,"td",40),n(72),a()(),i(73,"tr",37)(74,"td",42),s(75,"i",53),n(76,"Tipo Pedido: "),a(),i(77,"td",40)(78,"span",54),n(79),a()()(),i(80,"tr",37)(81,"td",42),s(82,"i",55),n(83,"Forma Pago: "),a(),i(84,"td",40)(85,"span",56),n(86),a()()()()()()()()()),r&2){let e=m(2);o(23),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Numero),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),p(" ",e.facturaActual.Ciudad," "),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function bt(r,t){if(r&1&&(i(0,"div",5)(1,"div",4)(2,"div",30)(3,"div",57),s(4,"i",58),i(5,"strong"),n(6),a()()(),i(7,"div",30)(8,"div",57),s(9,"i",59),i(10,"strong"),n(11),a()()()()()),r&2){let e=m(2);o(6),p("Total de productos: ",e.detalleFactura.length,""),o(5),p("Productos verificados: ",e.productosVerificados,"")}}function xt(r,t){if(r&1&&(i(0,"div",72),n(1),a()),r&2){let e=m(3);o(),p(" Producto: ",e.productoActual.Detalle," ")}}function Ct(r,t){r&1&&(i(0,"div",73),n(1," C\xF3digo no encontrado en la factura "),a())}function Et(r,t){if(r&1){let e=y();i(0,"div")(1,"label",64),s(2,"i",74),n(3,"Serie: "),i(4,"span",75),n(5),a()(),i(6,"input",76,1),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.serieActual,l)||(d.serieActual=l),v(l)}),C("keypress",function(l){h(e);let d=m(3);return v(d.onSerieEnter(l))}),a()()}if(r&2){let e=m(3);o(4),u("ngClass",De(4,gt,e.productoActual.registroserieEntrada==="0",e.productoActual.registroserieEntrada==="1")),o(),p(" ",e.productoActual.registroserieEntrada==="1"?"Controlada":"Libre"," "),o(),E("ngModel",e.serieActual),u("disabled",!e.productoActual)}}function St(r,t){if(r&1){let e=y();i(0,"div")(1,"label",64),s(2,"i",77),n(3,"Cantidad: "),i(4,"span",78),n(5,"Solo Cantidad"),a()(),i(6,"input",79,2),A("ngModelChange",function(l){h(e);let d=m(3);return S(d.cantidadActual,l)||(d.cantidadActual=l),v(l)}),C("keypress",function(l){h(e);let d=m(3);return v(d.onCantidadEnter(l))}),a()()}if(r&2){let e=m(3);o(6),E("ngModel",e.cantidadActual),u("placeholder","Confirmar cantidad (m\xE1x: "+e.productoActual.Cantidad+")")("disabled",!e.productoActual)("max",e.productoActual.Cantidad)}}function At(r,t){r&1&&(i(0,"div",80),s(1,"i",81),n(2," Primero escanee un c\xF3digo de producto "),a())}function yt(r,t){if(r&1&&(i(0,"div",82)(1,"div",4)(2,"div",83)(3,"strong"),n(4),a(),n(5),a(),i(6,"div",84)(7,"span",85),n(8),a(),i(9,"span",86),n(10),a()()()()),r&2){let e=m(3);o(4),_(e.productoActual.CopProducto),o(),p(" - ",e.productoActual.Detalle," "),o(3),p("Cantidad: ",e.productoActual.Cantidad,""),o(),u("ngClass",Pe(6,_t,e.productoActual.cantidadVerificada===e.productoActual.Cantidad,e.productoActual.cantidadVerificada>0&&e.productoActual.cantidadVerificada<e.productoActual.Cantidad,e.productoActual.cantidadVerificada===0)),o(),ce(" Verificado: ",e.productoActual.cantidadVerificada||0,"/",e.productoActual.Cantidad," ")}}function Tt(r,t){if(r&1){let e=y();i(0,"div",5)(1,"div",60)(2,"div",61)(3,"div",62)(4,"div",30)(5,"div",63)(6,"label",64),s(7,"i",65),n(8,"C\xF3digo Producto: "),a(),i(9,"input",66,0),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.codigoProductoActual,l)||(d.codigoProductoActual=l),v(l)}),C("keypress",function(l){h(e);let d=m(2);return v(d.onCodigoProductoEnter(l))}),a(),f(11,xt,2,1,"div",67)(12,Ct,2,0,"div",68),a()(),i(13,"div",30),f(14,Et,8,7,"div",69)(15,St,8,4,"div",69)(16,At,3,0,"div",70),a()(),f(17,yt,11,10,"div",71),a()()()}if(r&2){let e=m(2);o(9),me("is-valid",e.productoActual)("is-invalid",e.codigoProductoActual&&!e.productoActual),E("ngModel",e.codigoProductoActual),o(2),u("ngIf",e.productoActual),o(),u("ngIf",e.codigoProductoActual&&!e.productoActual),o(2),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="1"),o(),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="0"),o(),u("ngIf",!e.productoActual),o(),u("ngIf",e.productoActual)}}function It(r,t){r&1&&(i(0,"span",113),s(1,"i",77),n(2,"Cantidad "),a())}function Ft(r,t){r&1&&(i(0,"span",114),s(1,"i",74),n(2,"Serie Libre "),a())}function Dt(r,t){r&1&&(i(0,"span",115),s(1,"i",102),n(2,"Serie Obligatoria "),a())}function wt(r,t){if(r&1&&(i(0,"small",122),s(1,"i",74),n(2),a()),r&2){let e=t.$implicit;o(2),p("",e," ")}}function Ot(r,t){if(r&1&&(i(0,"div",118)(1,"div",119)(2,"span",115),n(3),a()(),i(4,"div",120),f(5,wt,3,1,"small",121),a()()),r&2){let e=m(2).$implicit;o(3),ce(" ",e.seriesIngresadas.length,"/",e.Cantidad," series "),o(2),u("ngForOf",e.seriesIngresadas)}}function Pt(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Sin series ingresadas"),a()())}function Rt(r,t){if(r&1&&(i(0,"div"),f(1,Ot,6,3,"div",116)(2,Pt,3,0,"div",117),a()),r&2){let e=m().$implicit;o(),u("ngIf",e.seriesIngresadas&&e.seriesIngresadas.length>0),o(),u("ngIf",!e.seriesIngresadas||e.seriesIngresadas.length===0)}}function Mt(r,t){if(r&1&&(i(0,"div",63)(1,"span",125),s(2,"i",24),n(3),a()()),r&2){let e=m(2).$implicit;o(3),p("",e.cantidadVerificada," confirmados ")}}function Bt(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Cantidad pendiente"),a()())}function kt(r,t){if(r&1&&(i(0,"div"),f(1,Mt,4,1,"div",124)(2,Bt,3,0,"div",117),a()),r&2){let e=m().$implicit;o(),u("ngIf",e.cantidadVerificada>0),o(),u("ngIf",!e.cantidadVerificada||e.cantidadVerificada===0)}}function Vt(r,t){r&1&&(i(0,"span",126),s(1,"i",24),n(2,"Completo "),a())}function Nt(r,t){r&1&&(i(0,"span",114),s(1,"i",127),n(2,"Parcial "),a())}function Ut(r,t){r&1&&(i(0,"span",113),s(1,"i",128),n(2,"Pendiente "),a())}function Lt(r,t){if(r&1&&(i(0,"tr",104)(1,"td",105),f(2,It,3,0,"span",106)(3,Ft,3,0,"span",107)(4,Dt,3,0,"span",108),a(),i(5,"td",109),n(6),a(),i(7,"td",109),n(8),a(),i(9,"td",110),n(10),a(),i(11,"td",111),n(12),a(),i(13,"td",40),f(14,Rt,3,2,"div",69)(15,kt,3,2,"div",69),a(),i(16,"td",105),f(17,Vt,3,0,"span",112)(18,Nt,3,0,"span",107)(19,Ut,3,0,"span",106),a()()),r&2){let e=t.$implicit;u("ngClass",De(13,ht,e.seriesCompletas,e.cantidadVerificada>0&&!e.seriesCompletas)),o(2),u("ngIf",e.RegistaSerie==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="1"),o(2),p(" ",e.CodigosBodega," "),o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(2),u("ngIf",e.RegistaSerie==="1"),o(),u("ngIf",e.RegistaSerie==="0"),o(2),u("ngIf",e.seriesCompletas),o(),u("ngIf",!e.seriesCompletas&&e.cantidadVerificada>0),o(),u("ngIf",!e.seriesCompletas&&(!e.cantidadVerificada||e.cantidadVerificada===0))}}function Gt(r,t){if(r&1&&(i(0,"div",5)(1,"div",87)(2,"div",88)(3,"h6",29),s(4,"i",89),n(5,"Detalle de Productos "),a()(),i(6,"div",90)(7,"div",91)(8,"table",92)(9,"thead",93)(10,"tr")(11,"th",94),s(12,"i",74),n(13,"Tipo "),a(),i(14,"th",94),s(15,"i",95),n(16,"Bodega "),a(),i(17,"th",96),s(18,"i",97),n(19,"C\xF3digo "),a(),i(20,"th",98),n(21," Cant. "),a(),i(22,"th",99),s(23,"i",34),n(24,"Descripci\xF3n "),a(),i(25,"th",100),s(26,"i",101),n(27,"Series/Cantidad Ingresadas "),a(),i(28,"th",94),s(29,"i",102),n(30,"Estado "),a()()(),i(31,"tbody"),f(32,Lt,20,16,"tr",103),a()()()()()()),r&2){let e=m(2);o(32),u("ngForOf",e.detalleFactura)}}function $t(r,t){r&1&&(i(0,"div",5)(1,"div",129),s(2,"i",130),n(3," No hay productos en el detalle "),a()())}function Wt(r,t){if(r&1){let e=y();i(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h5",16),n(5),a(),i(6,"button",17),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",18),f(8,vt,87,12,"div",19),i(9,"div",4),f(10,bt,12,2,"div",20)(11,Tt,18,11,"div",20)(12,Gt,33,1,"div",20)(13,$t,4,0,"div",20),a()(),i(14,"div",21)(15,"button",22),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(16,"Cerrar"),a(),i(17,"button",23),C("click",function(){h(e);let l=m();return v(l.guardarVerificacion())}),s(18,"i",24),n(19,"Guardar Verificaci\xF3n "),a()()()()()}if(r&2){let e=m();o(5),p("Verificar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length===0)}}var Ce=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];codigoProductoActual="";serieActual="";cantidadActual=null;productoActual=null;productosVerificados=0;seriesValidasPrueba=[{codigo:"L3250",serie:"SN001234567"},{codigo:"L3250",serie:"SN001234568"},{codigo:"TG-3468",serie:"SN001234569"},{codigo:"ABC-123",serie:"ABC001"},{codigo:"ABC-123",serie:"ABC002"},{codigo:"XYZ-789",serie:"XYZ100"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL_TEXTO",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-success btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorVerificar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):D.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){let e=t.IDS_BODEGA.split(","),c=t.IDS_PREPARADAS.split(","),l=t.CODIGOS_BODEGA.split(","),d="";for(let g=0;g<l.length;g++){let T=0;c.length<e.length&&l[g]==l[c.length]&&(T=1,d+=`<span title="Pendiente de preparacion" class="text-danger fw-bold">P: ${l[c.length]}</span><br>`),T===0&&(d+=`<span class="fw-bold">${l[g]}</span><br>`)}t.FACTURA_SUCURSAL_TEXTO=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CODIGOS_BODEGA_TEXTO=d,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){console.log("data: ",t);let e=t.IDS_BODEGA.split(",");console.log("IDS_BODEGA: ",e);let c=t.IDS_PREPARADAS.split(",");console.log("ID_PREPARADAS: ",c);let l=t.CODIGOS_BODEGA.split(",");if(c.length<e.length){D.default.fire("Atenci\xF3n!","Hay productos sin preparar en la factura bodega "+l[c.length],"info");return}let d={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",d),this.FacturacionService.GetFacturasDatosVerificar(d).subscribe({next:g=>{console.log("response: ",g),g.success&&g.cabecera?g.cabecera.length>0?(this.facturaSeleccionada=g,this.facturaActual=g.cabecera[0],this.detalleFactura=g.detalle||[],this.detalleFactura=this.detalleFactura.map((T,x)=>R(P({},T),{seriesIngresadas:[],cantidadVerificada:0,seriesCompletas:!1})),this.productosVerificados=0,this.limpiarInputsCaptura(),this.productosJaula=this.detalleFactura.filter(T=>T.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(T=>T.EN_JAULA==="0"),this.showPrepararModal=!0,setTimeout(()=>{this.enfocarInputCodigo()},500)):(this.showPrepararModal=!1,D.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):D.default.fire("Error!",g.message,"error"),this.isLoading=!1},error:g=>{this.isLoading=!1}})}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[]}guardarVerificacion(){let t=this.detalleFactura.filter(c=>!c.seriesCompletas);if(console.log("Productos no verificados:",t),t.length>0){D.default.fire({title:"\u26A0\uFE0F Faltan productos por verificar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de verificaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${t.map(c=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${c.CopProducto}</strong><br>
                  <small class="text-muted">${c.Detalle.substring(0,60)}...</small><br>
                  <small class="text-info">Verificado: ${c.cantidadVerificada||0}/${c.Cantidad}</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total pendientes: <strong>${t.length}</strong> de <strong>${this.detalleFactura.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"});return}let e=this.detalleFactura.filter(c=>c.seriesCompletas);D.default.fire({title:"\u2705 Verificaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido verificados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la verificaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos verificados:</strong> ${e.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#28a745"}).then(()=>{let c={cliente:this.facturaActual.Nombre,factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios,detalle_verificacion:this.detalleFactura.map(l=>({producto:l.CopProducto,productoId:l.ProductoId,cantidad:l.Cantidad,cantidadVerificada:l.cantidadVerificada,seriesIngresadas:l.seriesIngresadas||[],tipoVerificacion:l.RegistaSerie==="1"?"series":"cantidad"}))};console.log("Par\xE1metros verificaci\xF3n:",c),this.FacturacionService.FinalizarVerificacion(c).subscribe({next:l=>{console.log("Respuesta verificaci\xF3n:",l),l.success?D.default.fire({title:"\u2705 Verificaci\xF3n Finalizada",html:`
                <div class="text-start">
                  <p><strong>Factura:</strong> ${this.facturaActual.Secuencia}</p>
                  <p class="text-success">`+l.message+`</p>
                </div>
              `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):D.default.fire({title:"\u274C Error en Verificaci\xF3n",html:`
                <div class="text-start">
                  <p><strong>Error:</strong> ${l.message||"Error desconocido"}</p>
                  <p class="text-muted">Por favor, intente nuevamente.</p>
                </div>
              `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})},error:l=>{console.error("Error en verificaci\xF3n:",l),D.default.fire({title:"\u274C Error de Conexi\xF3n",html:`
              <div class="text-start">
                <p>Ocurri\xF3 un error al finalizar la verificaci\xF3n.</p>
                <p class="text-muted">Verifique su conexi\xF3n e intente nuevamente.</p>
              </div>
            `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})}})})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}limpiarInputsCaptura(){this.codigoProductoActual="",this.serieActual="",this.cantidadActual=null,this.productoActual=null}onCodigoProductoEnter(t){t.key==="Enter"&&(t.preventDefault(),this.validarCodigoProducto())}validarCodigoProducto(){let t=this.codigoProductoActual.trim();if(!t)return;console.log("C\xF3digo ingresado:",t),console.log("Detalle factura:",this.detalleFactura),console.log("C\xF3digos disponibles:",this.detalleFactura.map(c=>c.CopProducto));let e=this.detalleFactura.find(c=>c.CopProducto.toLowerCase()===t.toLowerCase());console.log("Producto encontrado:",e),e?(this.productoActual=e,setTimeout(()=>{if(e.RegistaSerie==="1"){let c=document.querySelector("#inputSerie");c&&c.focus()}else{let c=document.querySelector("#inputCantidad");c&&c.focus()}},100)):(this.productoActual=null,D.default.fire({title:"\u274C C\xF3digo No Encontrado",html:`
          <div class="text-start">
            <p>El c\xF3digo <strong>${t}</strong> no existe en esta factura.</p>
            <p class="text-muted">Verifique el c\xF3digo e intente nuevamente.</p>
          </div>
        `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}).then(()=>{this.codigoProductoActual="",setTimeout(()=>{let c=document.querySelector("#inputCodigo");c&&c.focus()},100)}))}onSerieEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarSerie())}procesarSerie(){let t=this.serieActual.trim();if(!(!t||!this.productoActual)){if(this.productoActual.cantidadVerificada>=this.productoActual.Cantidad){D.default.fire({title:"\u26A0\uFE0F Cantidad Completa",text:`El producto ${this.productoActual.CopProducto} ya tiene todas sus series completas.`,icon:"warning",confirmButtonColor:"#f39c12"}),this.limpiarInputsCaptura(),this.enfocarInputCodigo();return}if(this.productoActual.seriesIngresadas.includes(t)){D.default.fire({title:"\u274C Serie Duplicada",html:`
          <div class="text-start">
            <p>La serie <strong>${t}</strong> ya fue ingresada para el producto <strong>${this.productoActual.CopProducto}</strong>.</p>
          </div>
        `,icon:"error",confirmButtonColor:"#dc3545"}),this.serieActual="";return}this.productoActual.registroserieEntrada==="1"?this.validarSerieEnBaseDatos(this.productoActual.ProductoId,t):this.agregarSerie(t)}}onCantidadEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarCantidad())}procesarCantidad(){if(!(!this.cantidadActual||!this.productoActual)){if(this.cantidadActual<=0||this.cantidadActual>this.productoActual.Cantidad){D.default.fire({title:"\u274C Cantidad Inv\xE1lida",text:`La cantidad debe ser entre 1 y ${this.productoActual.Cantidad}.`,icon:"error",confirmButtonColor:"#dc3545"});return}this.productoActual.cantidadVerificada=this.cantidadActual,this.productoActual.seriesCompletas=this.cantidadActual===parseInt(this.productoActual.Cantidad),console.log("Cantidad confirmada:",this.cantidadActual),console.log("Cantidad total:",this.productoActual.Cantidad),console.log("Series completas:",this.productoActual.seriesCompletas),this.actualizarContadores(),D.default.fire({title:"\u2705 Cantidad Confirmada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Cantidad confirmada:</strong> ${this.cantidadActual}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.limpiarInputsCaptura(),this.enfocarInputCodigo()}}validarSerieEnBaseDatos(t,e){D.default.fire({title:"Validando serie...",html:`
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Validando...</span>
          </div>
          <p class="mt-2">Verificando serie <strong>${e}</strong> en la base de datos</p>
        </div>
      `,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{D.default.showLoading()}});let c={codigo_producto:t,serie:e,bodega:this.facturaActual.CodigoBodega,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",c),this.FacturacionService.ValidarSerie(c).subscribe({next:l=>{console.log("Respuesta validaci\xF3n serie:",l),D.default.close(),l.success?l.serie_encontrada?l.serie_disponible==!0?this.agregarSerie(e):(D.default.fire({title:"\u274C Serie No Disponible",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> ya ha sido utilizada o no est\xE1 disponible para el producto <strong>${t}</strong>.</p>
                <p class="text-muted  ">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(D.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(D.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual="")},error:l=>{console.error("Error validando serie:",l),D.default.fire({title:"\u274C Error de Validaci\xF3n",html:`
            <div class="text-start">
              <p>Ocurri\xF3 un error al validar la serie <strong>${e}</strong>.</p>
              <p class="text-muted">Por favor, intente nuevamente.</p>
            </div>
          `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""}})}agregarSerie(t){this.productoActual.seriesIngresadas.push(t),this.productoActual.cantidadVerificada=this.productoActual.seriesIngresadas.length,this.productoActual.ProductoId=this.productoActual.ProductoId,console.log("Serie agregada:",t),console.log("Cantidad verificada:",this.productoActual.cantidadVerificada),console.log("Cantidad total:",this.productoActual.Cantidad),this.productoActual.cantidadVerificada===parseInt(this.productoActual.Cantidad)&&(this.productoActual.seriesCompletas=!0,console.log("Producto marcado como completo:",this.productoActual.CopProducto)),this.actualizarContadores(),D.default.fire({title:"\u2705 Serie Agregada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Serie:</strong> ${t}</p>
          <p><strong>Progreso:</strong> ${this.productoActual.cantidadVerificada}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.serieActual="",this.productoActual.seriesCompletas&&(this.limpiarInputsCaptura(),this.enfocarInputCodigo())}actualizarContadores(){let t=this.detalleFactura.filter(e=>e.seriesCompletas);this.productosVerificados=t.length,console.log("Actualizando contadores:"),console.log("Productos completos:",t),console.log("Total verificados:",this.productosVerificados),console.log("Detalle factura:",this.detalleFactura.map(e=>({codigo:e.CopProducto,seriesCompletas:e.seriesCompletas,cantidadVerificada:e.cantidadVerificada,cantidad:e.Cantidad}))),this.cdr.detectChanges()}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}puedeGuardar(){return this.detalleFactura.every(t=>t.seriesCompletas)}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-verificar-facturas"]],decls:9,vars:12,consts:[["inputCodigo",""],["inputSerie",""],["inputCantidad",""],[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-check","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"alert","d-flex","align-items-center"],[1,"fa","fa-info-circle","me-2"],[1,"fa","fa-check-circle","me-2"],[1,"card","border-warning"],[1,"card-body","bg-light"],[1,"row","justify-content-center"],[1,"text-center"],[1,"form-label","mb-1"],[1,"fa","fa-search","me-1"],["id","inputCodigo","type","text","placeholder","Escanear c\xF3digo del producto...",1,"form-control","form-control-lg","text-center",3,"ngModelChange","keypress","ngModel"],["class","valid-feedback",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],["class","alert alert-light",4,"ngIf"],[1,"valid-feedback"],[1,"invalid-feedback"],[1,"fa","fa-tag","me-1"],[1,"badge","ms-1",3,"ngClass"],["id","inputSerie","type","text","placeholder","Escanear serie del producto...",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","disabled"],[1,"fa","fa-calculator","me-1"],[1,"badge","bg-secondary","ms-1"],["id","inputCantidad","type","number","min","1",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","placeholder","disabled","max"],[1,"text-muted"],[1,"fa","fa-arrow-left","me-1"],[1,"alert","alert-light"],[1,"col-md-8"],[1,"col-md-4","text-end"],[1,"badge","bg-primary","me-1"],[1,"badge",3,"ngClass"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","20%"],[1,"fa","fa-list-ol","me-1"],[1,"fa","fa-shield-alt","me-1"],["class","align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"align-middle",3,"ngClass"],[1,"text-center","py-1"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-info fs-6",4,"ngIf"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],["class","badge bg-success fs-6",4,"ngIf"],[1,"badge","bg-secondary","fs-6"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"badge","bg-info","fs-6"],["class","series-container",4,"ngIf"],["class","text-center text-muted",4,"ngIf"],[1,"series-container"],[1,"mb-1"],[1,"series-list",2,"max-height","80px","overflow-y","auto"],["class","d-block text-muted",4,"ngFor","ngForOf"],[1,"d-block","text-muted"],[1,"text-center","text-muted"],["class","text-center",4,"ngIf"],[1,"badge","bg-success"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-clock","me-1"],[1,"fa","fa-minus","me-1"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,c){e&1&&(i(0,"div",3)(1,"div",4)(2,"div",5)(3,"app-card",6),s(4,"div",7),i(5,"div",8)(6,"div",9)(7,"app-table",10),C("action",function(d){return c.onTableAction(d)})("customAction",function(d){return c.onCustomAction(d)}),a()()()()()(),f(8,Wt,20,6,"div",11),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por verificar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",c.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",c.Buttons_Export)("customButtons",c.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",c.showPrepararModal))},dependencies:[k,oe,B,U,L,V,G,fe,$,ve,ke,W,N,K],encapsulation:2})};var F=Z(ee());function zt(r,t){r&1&&(i(0,"div",9)(1,"div",10)(2,"div",11)(3,"span",12),n(4,"Cargando..."),a()(),i(5,"p",13),n(6,"Cargando datos de facturas..."),a()()())}function Xt(r,t){if(r&1){let e=y();i(0,"div",14)(1,"div",15)(2,"select",16)(3,"option",17),n(4,"Facturas"),a(),i(5,"option",18),n(6,"Dropshipping"),a()()(),i(7,"app-table",19),C("action",function(l){h(e);let d=m();return v(d.onTableAction(l))})("customAction",function(l){h(e);let d=m();return v(d.onCustomAction(l))}),a()()}if(r&2){let e=m();o(7),u("hasCheckbox",!1)("tableConfig",e.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",e.Buttons_Export)("customButtons",e.customButtons)("initialDateFilter","this_month")}}function Jt(r,t){if(r&1&&(i(0,"div",59)(1,"div",2)(2,"div",60)(3,"div",61),s(4,"i",62),i(5,"div")(6,"strong",63),n(7,"FACTURA MULTIBODEGA"),a(),i(8,"small",64),n(9),a()(),i(10,"div",65)(11,"span",66),n(12),a()()()()()()),r&2){let e=m(2);o(9),p(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),o(3),p("",e.bodegas.length," Bodegas")}}function Ht(r,t){if(r&1&&(i(0,"div",1)(1,"div",67)(2,"div",68),s(3,"i",69),i(4,"h6",70),n(5,"Informaci\xF3n de la Factura"),a()()(),i(6,"div",32)(7,"div",33)(8,"div",34)(9,"small",35),s(10,"i",36),n(11,"Datos Principales "),a()(),i(12,"div",37)(13,"table",38)(14,"tbody")(15,"tr",40)(16,"td",41),s(17,"i",52),n(18,"Bodega: "),a(),i(19,"td",44)(20,"span",71),n(21),a()()(),i(22,"tr",40)(23,"td",49),s(24,"i",72),n(25,"Secuencia: "),a(),i(26,"td",44)(27,"span",73),n(28),a()()(),i(29,"tr",40)(30,"td",49),s(31,"i",74),n(32,"ID: "),a(),i(33,"td",44),n(34),a()(),i(35,"tr",40)(36,"td",49),s(37,"i",75),n(38,"Cliente: "),a(),i(39,"td",44),n(40),a()(),i(41,"tr",40)(42,"td",49),s(43,"i",76),n(44,"Fecha: "),a(),i(45,"td",44)(46,"span",77),n(47),w(48,"date"),a()()()()()()()(),i(49,"div",32)(50,"div",33)(51,"div",34)(52,"small",35),s(53,"i",78),n(54,"Informaci\xF3n de Contacto "),a()(),i(55,"div",37)(56,"table",38)(57,"tbody")(58,"tr",40)(59,"td",41),s(60,"i",79),n(61,"Direcci\xF3n: "),a(),i(62,"td",44),n(63),a()(),i(64,"tr",40)(65,"td",49),s(66,"i",80),n(67,"Ciudad: "),a(),i(68,"td",44)(69,"span",81),n(70),a()()(),i(71,"tr",40)(72,"td",49),s(73,"i",82),n(74,"Tel\xE9fono: "),a(),i(75,"td",44)(76,"span",83),n(77),a()()(),i(78,"tr",40)(79,"td",49),s(80,"i",84),n(81,"Email: "),a(),i(82,"td",44)(83,"small",63),n(84),a()()(),i(85,"tr",40)(86,"td",49),s(87,"i",85),n(88,"Vendedor: "),a(),i(89,"td",44),n(90),a()(),i(91,"tr",40)(92,"td",49),s(93,"i",86),n(94,"Tipo Pedido: "),a(),i(95,"td",44)(96,"span",87),n(97),a()()(),i(98,"tr",40)(99,"td",49),s(100,"i",88),n(101,"Forma Pago: "),a(),i(102,"td",44)(103,"span",89),n(104),a()()()()()()()()()),r&2){let e=m(2);o(21),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Id),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(16),_(e.facturaActual.Direccion),o(7),p(" ",e.facturaActual.Ciudad," "),o(7),_((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),o(7),_(e.facturaActual.Email),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function jt(r,t){if(r&1&&(i(0,"tr",104)(1,"td",105),n(2),a(),i(3,"td",105),n(4),a(),i(5,"td",106),n(6),a(),i(7,"td",107),n(8),a()()),r&2){let e=t.$implicit;o(2),p(" ",e.CodigosBodega," "),o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle)}}function qt(r,t){if(r&1&&(i(0,"div",2)(1,"div",90)(2,"div",91)(3,"h6",70),s(4,"i",92),n(5,"Detalle de Productos "),a()(),i(6,"div",93)(7,"div",94)(8,"table",95)(9,"thead",96)(10,"tr")(11,"th",97),s(12,"i",98),n(13,"Bodega "),a(),i(14,"th",99),s(15,"i",100),n(16,"C\xF3digo "),a(),i(17,"th",101),n(18," Cant. "),a(),i(19,"th",102),s(20,"i",36),n(21,"Descripci\xF3n "),a()()(),i(22,"tbody"),f(23,jt,9,4,"tr",103),a()()()()()()),r&2){let e=m(2);o(23),u("ngForOf",e.detalleFactura)}}function Kt(r,t){if(r&1&&(i(0,"div",4)(1,"div",2)(2,"div",108),s(3,"i",36),i(4,"strong"),n(5,"Factura Multibodega:"),a(),n(6),a()()()),r&2){let e=m(2);o(6),p(" Un solo n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function Yt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",109),s(3,"i",110),i(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),a(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),a()()())}function Qt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",111),s(3,"i",36),i(4,"strong"),n(5,"Centro Consolidado:"),a(),n(6," Esta factura pertenece a un centro consolidado, no requiere consolidaci\xF3n adicional "),a()()())}function Zt(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",41),s(2,"i",112),n(3,"Consolidar: "),a(),i(4,"td",44)(5,"div",113)(6,"input",114),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.consolidar,l)||(d.consolidar=l),v(l)}),a(),i(7,"label",115),n(8," Consolidaci\xF3n obligatoria (no se puede cambiar) "),a()()()()}if(r&2){let e=m(2);o(6),E("ngModel",e.consolidar),u("disabled",!0)}}function ei(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",49),s(2,"i",116),n(3,"Gu\xEDa Consol.: "),i(4,"span",43),n(5,"*"),a()(),i(6,"td",44)(7,"input",117),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.guiaConsolidacion,l)||(d.guiaConsolidacion=l),v(l)}),a()()()}if(r&2){let e=m(2);o(7),E("ngModel",e.guiaConsolidacion)}}function ti(r,t){r&1&&(i(0,"option",118),n(1,"Seleccione transporte"),a())}function ii(r,t){r&1&&(i(0,"option",118),n(1,"Cargando transportes..."),a())}function ai(r,t){if(r&1&&(i(0,"option",119),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),o(),p(" ",e.Codigo," ")}}function ni(r,t){r&1&&(i(0,"small",120),s(1,"i",121),n(2,"Cargando lista de transportes... "),a())}function ri(r,t){if(r&1&&(i(0,"small",120),n(1),a()),r&2){let e=m(3);o(),p(" Este n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function oi(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",49),s(2,"i",122),n(3," N\xFAmero de Gu\xEDa: "),i(4,"span",43),n(5,"*"),a()(),i(6,"td",44)(7,"input",123),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.numeroGuia,l)||(d.numeroGuia=l),v(l)}),a(),f(8,ri,2,1,"small",48),a()()}if(r&2){let e=m(2);o(7),E("ngModel",e.numeroGuia),o(),u("ngIf",e.bodegas.length>1)}}function li(r,t){r&1&&(i(0,"div",2)(1,"div",124),s(2,"i",125),n(3," No hay productos en el detalle "),a()())}function si(r,t){if(r&1){let e=y();i(0,"div",20)(1,"div",21)(2,"div",22)(3,"div",23)(4,"h5",24),n(5),a(),i(6,"button",25),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",26),f(8,Jt,13,2,"div",27)(9,Ht,105,15,"div",28),i(10,"div",1),f(11,qt,24,1,"div",29),i(12,"div",30),f(13,Kt,7,1,"div",31)(14,Yt,7,0,"div",31)(15,Qt,7,0,"div",31),i(16,"div",1)(17,"div",32)(18,"div",33)(19,"div",34)(20,"small",35),s(21,"i",36),n(22,"Datos de envio "),a()(),i(23,"div",37)(24,"table",38)(25,"tbody"),f(26,Zt,9,2,"tr",39)(27,ei,8,1,"tr",39),i(28,"tr",40)(29,"td",41),s(30,"i",42),n(31,"Transporte: "),i(32,"span",43),n(33,"*"),a()(),i(34,"td",44)(35,"select",45),A("ngModelChange",function(l){h(e);let d=m();return S(d.transporteSeleccionado,l)||(d.transporteSeleccionado=l),v(l)}),f(36,ti,2,0,"option",46)(37,ii,2,0,"option",46)(38,ai,2,2,"option",47),a(),f(39,ni,3,0,"small",48),a()(),f(40,oi,9,2,"tr",39),i(41,"tr",40)(42,"td",49),s(43,"i",50),n(44,"Bultos: "),i(45,"span",43),n(46,"*"),a()(),i(47,"td",44)(48,"input",51),A("ngModelChange",function(l){h(e);let d=m();return S(d.numeroBultos,l)||(d.numeroBultos=l),v(l)}),a()()()()()()()(),i(49,"div",32)(50,"div",33)(51,"div",34)(52,"small",35),s(53,"i",36),a()(),i(54,"div",37)(55,"table",38)(56,"tbody")(57,"tr",40)(58,"td",41),s(59,"i",52),n(60,"Peso: "),a(),i(61,"td",44)(62,"input",53),A("ngModelChange",function(l){h(e);let d=m();return S(d.pesoEnvio,l)||(d.pesoEnvio=l),v(l)}),a()()(),i(63,"tr",40)(64,"td",49),s(65,"i",54),n(66,"Comentarios: "),a(),i(67,"td",44)(68,"textarea",55),A("ngModelChange",function(l){h(e);let d=m();return S(d.comentariosEnvio,l)||(d.comentariosEnvio=l),v(l)}),a()()()()()()()()()(),f(69,li,4,0,"div",29),a()(),i(70,"div",56)(71,"button",57),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(72,"Cerrar"),a(),i(73,"button",58),C("click",function(){h(e);let l=m();return v(l.guardarCambios())}),n(74,"Guardar cambios"),a()()()()()}if(r&2){let e=m();o(5),p("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(2),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.consolidar),o(),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)==1),o(11),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.MULTIBODEGA)=="SI"&&(e.facturaRowData==null?null:e.facturaRowData.CONSOLIDAR_FACTURA)==1&&(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)=="0"),o(),u("ngIf",e.consolidar),o(8),E("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),o(),u("ngIf",!e.cargandoTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngForOf",e.listaTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngIf",e.consolidar==!1),o(8),E("ngModel",e.numeroBultos),o(14),E("ngModel",e.pesoEnvio),o(6),E("ngModel",e.comentariosEnvio),o(),u("ngIf",e.detalleFactura.length===0)}}function ci(r,t){if(r&1&&(i(0,"div",59)(1,"div",2)(2,"div",60)(3,"div",61),s(4,"i",62),i(5,"div")(6,"strong",63),n(7,"FACTURA MULTIBODEGA"),a(),i(8,"small",64),n(9),a()(),i(10,"div",65)(11,"span",66),n(12),a()()()()()()),r&2){let e=m(2);o(9),p(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),o(3),p("",e.bodegas.length," Bodegas")}}function di(r,t){if(r&1&&(i(0,"div",1)(1,"div",67)(2,"div",68),s(3,"i",69),i(4,"h6",70),n(5,"Informaci\xF3n de la Factura"),a()()(),i(6,"div",32)(7,"div",33)(8,"div",34)(9,"small",35),s(10,"i",36),n(11,"Datos Principales "),a()(),i(12,"div",37)(13,"table",38)(14,"tbody")(15,"tr",40)(16,"td",41),s(17,"i",52),n(18,"Bodega: "),a(),i(19,"td",44)(20,"span",71),n(21),a()()(),i(22,"tr",40)(23,"td",49),s(24,"i",72),n(25,"Secuencia: "),a(),i(26,"td",44)(27,"span",73),n(28),a()()(),i(29,"tr",40)(30,"td",49),s(31,"i",74),n(32,"N\xFAmero: "),a(),i(33,"td",44),n(34),a()(),i(35,"tr",40)(36,"td",49),s(37,"i",75),n(38,"Cliente: "),a(),i(39,"td",44),n(40),a()(),i(41,"tr",40)(42,"td",49),s(43,"i",76),n(44,"Fecha: "),a(),i(45,"td",44)(46,"span",77),n(47),w(48,"date"),a()()()()()()()(),i(49,"div",32)(50,"div",33)(51,"div",34)(52,"small",35),s(53,"i",78),n(54,"Informaci\xF3n de Contacto "),a()(),i(55,"div",37)(56,"table",38)(57,"tbody")(58,"tr",40)(59,"td",41),s(60,"i",79),n(61,"Direcci\xF3n: "),a(),i(62,"td",44),n(63),a()(),i(64,"tr",40)(65,"td",49),s(66,"i",80),n(67,"Ciudad: "),a(),i(68,"td",44)(69,"span",81),n(70),a()()(),i(71,"tr",40)(72,"td",49),s(73,"i",82),n(74,"Tel\xE9fono: "),a(),i(75,"td",44)(76,"span",83),n(77),a()()(),i(78,"tr",40)(79,"td",49),s(80,"i",84),n(81,"Email: "),a(),i(82,"td",44)(83,"small",63),n(84),a()()(),i(85,"tr",40)(86,"td",49),s(87,"i",85),n(88,"Vendedor: "),a(),i(89,"td",44),n(90),a()(),i(91,"tr",40)(92,"td",49),s(93,"i",86),n(94,"Tipo Pedido: "),a(),i(95,"td",44)(96,"span",87),n(97),a()()(),i(98,"tr",40)(99,"td",49),s(100,"i",88),n(101,"Forma Pago: "),a(),i(102,"td",44)(103,"span",89),n(104),a()()()()()()()()()),r&2){let e=m(2);o(21),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Numero),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(16),_(e.facturaActual.Direccion),o(7),p(" ",e.facturaActual.Ciudad," "),o(7),_((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),o(7),_(e.facturaActual.Email),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function ui(r,t){if(r&1&&(i(0,"tr",104)(1,"td",105),n(2),a(),i(3,"td",105),n(4),a(),i(5,"td",106),n(6),a(),i(7,"td",107),n(8),a()()),r&2){let e=t.$implicit;o(2),p(" ",e.CodigosBodega," "),o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle)}}function mi(r,t){if(r&1&&(i(0,"div",2)(1,"div",90)(2,"div",91)(3,"h6",70),s(4,"i",92),n(5,"Detalle de Productos "),a()(),i(6,"div",93)(7,"div",94)(8,"table",95)(9,"thead",96)(10,"tr")(11,"th",97),s(12,"i",98),n(13,"Bodega "),a(),i(14,"th",99),s(15,"i",100),n(16,"C\xF3digo "),a(),i(17,"th",101),n(18," Cant. "),a(),i(19,"th",102),s(20,"i",36),n(21,"Descripci\xF3n "),a()()(),i(22,"tbody"),f(23,ui,9,4,"tr",103),a()()()()()()),r&2){let e=m(2);o(23),u("ngForOf",e.detalleFactura)}}function pi(r,t){if(r&1&&(i(0,"div",4)(1,"div",2)(2,"div",108),s(3,"i",36),i(4,"strong"),n(5,"Factura Multibodega:"),a(),n(6),a()()()),r&2){let e=m(2);o(6),p(" Un solo n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function fi(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",109),s(3,"i",110),i(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),a(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),a()()())}function gi(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",111),s(3,"i",36),i(4,"strong"),n(5,"Centro Consolidado:"),a(),n(6," Esta factura pertenece a un centro consolidado, no requiere consolidaci\xF3n adicional "),a()()())}function _i(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",41),s(2,"i",112),n(3,"Consolidar: "),a(),i(4,"td",44)(5,"div",113)(6,"input",114),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.consolidar,l)||(d.consolidar=l),v(l)}),a(),i(7,"label",115),n(8," Consolidaci\xF3n obligatoria (no se puede cambiar) "),a()()()()}if(r&2){let e=m(2);o(6),E("ngModel",e.consolidar),u("disabled",!0)}}function hi(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",49),s(2,"i",116),n(3,"Gu\xEDa Consol.: "),i(4,"span",43),n(5,"*"),a()(),i(6,"td",44)(7,"input",117),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.guiaConsolidacion,l)||(d.guiaConsolidacion=l),v(l)}),a()()()}if(r&2){let e=m(2);o(7),E("ngModel",e.guiaConsolidacion)}}function vi(r,t){r&1&&(i(0,"option",118),n(1,"Seleccione transporte"),a())}function bi(r,t){r&1&&(i(0,"option",118),n(1,"Cargando transportes..."),a())}function xi(r,t){if(r&1&&(i(0,"option",119),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),o(),p(" ",e.Codigo," ")}}function Ci(r,t){r&1&&(i(0,"small",120),s(1,"i",121),n(2,"Cargando lista de transportes... "),a())}function Ei(r,t){if(r&1&&(i(0,"small",120),n(1),a()),r&2){let e=m(3);o(),p(" Este n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function Si(r,t){if(r&1){let e=y();i(0,"tr",40)(1,"td",49),s(2,"i",122),n(3," N\xFAmero de Gu\xEDa: "),i(4,"span",43),n(5,"*"),a()(),i(6,"td",44)(7,"input",123),A("ngModelChange",function(l){h(e);let d=m(2);return S(d.numeroGuia,l)||(d.numeroGuia=l),v(l)}),a(),f(8,Ei,2,1,"small",48),a()()}if(r&2){let e=m(2);o(7),E("ngModel",e.numeroGuia),o(),u("ngIf",e.bodegas.length>1)}}function Ai(r,t){r&1&&(i(0,"div",2)(1,"div",124),s(2,"i",125),n(3," No hay productos en el detalle "),a()())}function yi(r,t){if(r&1){let e=y();i(0,"button",58),C("click",function(){h(e);let l=m(2);return v(l.guardarCambios())}),n(1,"Guardar cambios"),a()}}function Ti(r,t){if(r&1){let e=y();i(0,"div",20)(1,"div",21)(2,"div",22)(3,"div",23)(4,"h5",24),n(5),a(),i(6,"button",25),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",26),f(8,ci,13,2,"div",27)(9,di,105,15,"div",28),i(10,"div",1),f(11,mi,24,1,"div",29),i(12,"div",30),f(13,pi,7,1,"div",31)(14,fi,7,0,"div",31)(15,gi,7,0,"div",31),i(16,"div",1)(17,"div",32)(18,"div",33)(19,"div",34)(20,"small",35),s(21,"i",36),n(22,"Datos de envio "),a()(),i(23,"div",37)(24,"table",38)(25,"tbody"),f(26,_i,9,2,"tr",39)(27,hi,8,1,"tr",39),i(28,"tr",40)(29,"td",41),s(30,"i",42),n(31,"Transporte: "),i(32,"span",43),n(33,"*"),a()(),i(34,"td",44)(35,"select",45),A("ngModelChange",function(l){h(e);let d=m();return S(d.transporteSeleccionado,l)||(d.transporteSeleccionado=l),v(l)}),f(36,vi,2,0,"option",46)(37,bi,2,0,"option",46)(38,xi,2,2,"option",47),a(),f(39,Ci,3,0,"small",48),a()(),f(40,Si,9,2,"tr",39),i(41,"tr",40)(42,"td",49),s(43,"i",50),n(44,"Bultos: "),i(45,"span",43),n(46,"*"),a()(),i(47,"td",44)(48,"input",51),A("ngModelChange",function(l){h(e);let d=m();return S(d.numeroBultos,l)||(d.numeroBultos=l),v(l)}),a()()()()()()()(),i(49,"div",32)(50,"div",33)(51,"div",34)(52,"small",35),s(53,"i",36),a()(),i(54,"div",37)(55,"table",38)(56,"tbody")(57,"tr",40)(58,"td",41),s(59,"i",52),n(60,"Peso: "),a(),i(61,"td",44)(62,"input",53),A("ngModelChange",function(l){h(e);let d=m();return S(d.pesoEnvio,l)||(d.pesoEnvio=l),v(l)}),a()()(),i(63,"tr",40)(64,"td",49),s(65,"i",54),n(66,"Comentarios: "),a(),i(67,"td",44)(68,"textarea",55),A("ngModelChange",function(l){h(e);let d=m();return S(d.comentariosEnvio,l)||(d.comentariosEnvio=l),v(l)}),a()()()()()()()()()(),f(69,Ai,4,0,"div",29),a()(),i(70,"div",56)(71,"button",57),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(72,"Cerrar"),a(),f(73,yi,2,0,"button",126),a()()()()}if(r&2){let e=m();o(5),p("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(2),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.consolidar),o(),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)==1),o(11),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.MULTIBODEGA)=="SI"&&(e.facturaRowData==null?null:e.facturaRowData.CONSOLIDAR_FACTURA)==1&&(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)=="0"),o(),u("ngIf",e.consolidar),o(8),E("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),o(),u("ngIf",!e.cargandoTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngForOf",e.listaTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngIf",e.consolidar==!1),o(8),E("ngModel",e.numeroBultos),o(14),E("ngModel",e.pesoEnvio),o(6),E("ngModel",e.comentariosEnvio),o(),u("ngIf",e.detalleFactura.length===0),o(4),u("ngIf",e.facturaRowData.ACTIVAR_LINK==1)}}var Ee=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}showPrepararModal=!1;showDetalleguiaComputronModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;facturaRowData=null;detalleFactura=[];transporteSeleccionado="";numeroGuia="";numeroBultos=null;pesoEnvio="";comentariosEnvio="";consolidar=!1;tipoConsolidacion="";guiaConsolidacion="";bodegas=[];guiasPorBodega=[];listaTransportes=[];cargandoTransportes=!1;empresa="";transportesSeleccionados={};opcionesConsolidacion=[{id:"consolidacion_1",nombre:"Consolidaci\xF3n Centro"},{id:"consolidacion_2",nombre:"Consolidaci\xF3n Norte"},{id:"consolidacion_3",nombre:"Consolidaci\xF3n Sur"},{id:"consolidacion_4",nombre:"Consolidaci\xF3n Express"},{id:"consolidacion_5",nombre:"Consolidaci\xF3n Econ\xF3mica"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA_TEXTO",sort:!0},{title:"Consolidar",field_value:"CONSOLIDAR_FACTURA_TEXTO",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",type:"select",options:[],sort:!1},{title:"Estado",field_value:"FACTURA_BLOQUEADA_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};tableConfigCComputron={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega Facturaci\xF3n",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha Factura",field_value:"FACTURA_FECHA",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA_TEXTO",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!1},{title:"Factura Total",field_value:"FACTURA_TOTAL_TEXTO",sort:!0},{title:"Factura Saldo",field_value:"FACTURA_SALDO_TEXTO",sort:!0},{title:"Bodega de Retiro",field_value:"FACTURA_BODEGA_RETIRO_TEXTO",sort:!0},{title:"Comentario",field_value:"FACTURA_COMENTARIO",sort:!0},{title:"Estado",field_value:"FACTURA_ESTADO_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),this.empresa=this.sessionData?this.sessionData.empleado_empresa:"",console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorGuiasPickup(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):F.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.actualizarOpcionesSelect(),this.empresa==="COMPUTRON"&&(this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span title="${t.BODEGA_CODIGO}-${t.BODEGA_NOMBRE}" class="fw-bold">${t.BODEGA_CODIGO}</span><br><span class="fw-bold text-muted">${t.BODEGA_NOMBRE}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.MULTIBODEGA_TEXTO=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`,t.FACTURA_TOTAL_TEXTO='<span class="fw-bold '+(t.FACTURA_SALDO>0?"text-danger":"")+` fs-6">${new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t.FACTURA_TOTAL)}</span>`,t.FACTURA_SALDO_TEXTO='<span class="fw-bold '+(t.FACTURA_SALDO>0?"text-danger":"")+` fs-6">${new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t.FACTURA_SALDO)}</span>`,t.FACTURA_BODEGA_RETIRO_TEXTO=`<span class="fw-bold">${t.SISCO_BODEGA_RETIRO}</span>`,t.FACTURA_COMENTARIO=t.SISCO_COMENTARIO,t.FACTURA_ESTADO_TEXTO='<span class="fw-bold '+(t.ACTIVAR_LINK==1?"text-success":"text-danger")+'">'+t.FACTURA_ESTADO+"</span>"}),this.tableConfig=R(P({},this.tableConfigCComputron),{data:this.Usuarios_Datos})),this.empresa==="CARTIMEX"&&(this.Usuarios_Datos.map(function(t){let e=t.CODIGOS_VERIFICADAS.split(","),c=t.CODIGOS_CONSOLIDADAS.split(","),l=t.BODEGAS_ENFACTURA.split(","),d="";for(let g=0;g<e.length;g++)e[g]&&e[g]!=""&&(d+=`<span class="fw-bold">${e[g]}</span><br>`);for(let g=0;g<c.length;g++)c[g]&&c[g]!=""&&(d+=`<span class="fw-bold">${c[g]}</span><br>`);(!t.ORDEN_TIPO_PEDIDO||t.ORDEN_TIPO_PEDIDO===""||t.ORDEN_TIPO_PEDIDO===null)&&(t.ORDEN_TIPO_PEDIDO="MOSTRADOR-GYE"),t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CONSOLIDAR_FACTURA_TEXTO=`<span class="fs-6 badge bg-${t.CONSOLIDAR_FACTURA==1?"danger":"secondary"} fw-bold">${t.CONSOLIDAR_FACTURA==1?"SI":"NO"}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span title="${t.BODEGAS_ENFACTURA}" class="fw-bold">${d}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA_TEXTO=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.FACTURA_BLOQUEADA_TEXTO=(t.FACTURA_BLOQUEADA==1?()=>'<span class="fs-6 badge bg-danger fw-bold">Bloqueada</span>':()=>t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+c.length!=l.length?'<span class="fs-6 badge bg-danger fw-bold">Espera Consolidaci\xF3n</span>':t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+c.length==l.length?'<span class="fs-6 badge bg-primary fw-bold">consolidacion completa</span>':t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1&&t.FACTURA_LISTA_ESTADO=="0"?'<span class="fs-6 badge bg-danger fw-bold">Por consolidar</span>':t.FACTURA_LISTA_ESTADO=="1"?'<span class="fs-6 badge bg-success fw-bold">Consolidada</span>':'<span class="fs-6 badge bg-success fw-bold">Desbloqueada</span>')()}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos}))}onTableAction(t){switch(t.action_to_perform){case"detalle_factura":if(this.empresa=="COMPUTRON"){this.onIngresarGuiaComputron(t.data);return}if(this.empresa=="CARTIMEX"){this.onIngresarGuiaCartimex(t.data);return}break;case"ORDEN_TIPO_PEDIDO_change":this.onTransporteChange(t.data,t.value);break;default:break}}onTransporteChange(t,e){if(t.FACTURA_LISTA_ESTADO==1&&t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se puede cambiar el tipo de pedido.","warning");return}let c=t.FACTURA_SECUENCIA||t.ID;this.transportesSeleccionados[c]=e;let l=this.Usuarios_Datos.findIndex(d=>(d.FACTURA_SECUENCIA||d.ID)===c);l!==-1&&(this.Usuarios_Datos[l].ORDEN_TIPO_PEDIDO=e),this.cdr.detectChanges(),this.tableConfig=R(P({},this.tableConfig),{data:[...this.Usuarios_Datos]}),this.guardarTransporteSeleccionado(t,e)}guardarTransporteSeleccionado(t,e){let c={factura:t.FACTURA_ID,tipo:e,usrid:this.sessionData?this.sessionData.usrid:null};this.empresa!=="COMPUTRON"&&F.default.fire({title:"Est\xE1s seguro?",text:"Si ya hay facturas consolidadas puede haber problemas al ingresar la gu\xEDa!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, continuar"}).then(l=>{l.isConfirmed&&this.FacturacionService.GuardarCambioTipoPedido(c).subscribe({next:d=>{d.success?(F.default.fire("\xC9xito!","Transporte actualizado correctamente","success"),this.loadTableData()):F.default.fire("Error!",d.message,"error")},error:d=>{F.default.fire("Error!","No se pudo actualizar el transporte","error")}})})}onIngresarGuiaComputron(t){if(console.log("data: ",t),this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,t.FACTURA_BLOQUEADA==1&&t.CENTRO_CONSOLIDADO==0){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}if(t.CONSOLIDAR_FACTURA==1&&t.CENTRO_CONSOLIDADO==0&&t.FACTURA_LISTA_ESTADO==1){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se pueden ingresar m\xE1s gu\xEDas.","warning");return}let e=t.CODIGOS_VERIFICADAS?t.CODIGOS_VERIFICADAS.split(",").map(b=>b.trim()):[],c=t.CODIGOS_CONSOLIDADAS?t.CODIGOS_CONSOLIDADAS.split(",").map(b=>b.trim()):[],l=[...e,...c],d=t.BODEGAS_ENFACTURA?t.BODEGAS_ENFACTURA.split(",").map(b=>b.trim()):[],g=b=>b?parseFloat(b).toFixed(2):"",T=d.filter(b=>!l.some(Q=>g(Q)===g(b)));if(T.length>0&&t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" tiene bodegas que no se han completado: "+T.join(", "),"warning");return}this.facturaRowData=t;let x={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(x).subscribe({next:b=>{if(console.log("response: ",b),b.success&&b.cabecera)if(b.cabecera.length>0){this.facturaSeleccionada=b,this.facturaActual=b.cabecera[0],this.detalleFactura=b.detalle||[],this.procesarBodegas(t);let Q=this.facturaRowData?.MULTIBODEGA=="SI",Ie=this.facturaRowData?.CONSOLIDAR_FACTURA==1,Fe=this.facturaRowData?.CENTRO_CONSOLIDADO=="0";this.consolidar=Q&&Ie&&Fe,this.showDetalleguiaComputronModal=!0}else this.showDetalleguiaComputronModal=!1,F.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error");else F.default.fire("Error!",b.message,"error");this.isLoading=!1},error:b=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:b=>{b.success&&b.data?this.listaTransportes=b.data:F.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:b=>{F.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}onIngresarGuiaCartimex(t){if(console.log("data: ",t),this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,t.FACTURA_BLOQUEADA==1&&t.CENTRO_CONSOLIDADO==0){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}if(t.CONSOLIDAR_FACTURA==1&&t.CENTRO_CONSOLIDADO==0&&t.FACTURA_LISTA_ESTADO==1){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se pueden ingresar m\xE1s gu\xEDas.","warning");return}let e=t.CODIGOS_VERIFICADAS?t.CODIGOS_VERIFICADAS.split(",").map(b=>b.trim()):[],c=t.CODIGOS_CONSOLIDADAS?t.CODIGOS_CONSOLIDADAS.split(",").map(b=>b.trim()):[],l=[...e,...c],d=t.BODEGAS_ENFACTURA?t.BODEGAS_ENFACTURA.split(",").map(b=>b.trim()):[],g=b=>b?parseFloat(b).toFixed(2):"",T=d.filter(b=>!l.some(Q=>g(Q)===g(b)));if(T.length>0&&t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1){F.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" tiene bodegas que no se han completado: "+T.join(", "),"warning");return}this.facturaRowData=t;let x={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(x).subscribe({next:b=>{if(console.log("response: ",b),b.success&&b.cabecera)if(b.cabecera.length>0){this.facturaSeleccionada=b,this.facturaActual=b.cabecera[0],this.detalleFactura=b.detalle||[],this.procesarBodegas(t);let Q=this.facturaRowData?.MULTIBODEGA=="SI",Ie=this.facturaRowData?.CONSOLIDAR_FACTURA==1,Fe=this.facturaRowData?.CENTRO_CONSOLIDADO=="0";this.consolidar=Q&&Ie&&Fe,this.showPrepararModal=!0}else this.showPrepararModal=!1,F.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error");else F.default.fire("Error!",b.message,"error");this.isLoading=!1},error:b=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:b=>{b.success&&b.data?this.listaTransportes=b.data:F.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:b=>{F.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}procesarBodegas(t){if(t.CODIGOS_BODEGA&&t.BODEGAS){let e=t.CODIGOS_BODEGA.split(",").map(l=>l.trim()),c=t.BODEGAS.split(",").map(l=>l.trim());this.bodegas=e.map((l,d)=>({codigo:l,nombre:c[d]||l}))}}cerrarModal(){this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.facturaRowData=null,this.detalleFactura=[],this.transporteSeleccionado="",this.numeroGuia="",this.numeroBultos=null,this.pesoEnvio="",this.comentariosEnvio="",this.consolidar=!1,this.tipoConsolidacion="",this.guiaConsolidacion="",this.bodegas=[],this.listaTransportes=[],this.cargandoTransportes=!1}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}verEstadoActual(){}actualizarOpcionesSelect(){let t=[];this.empresa==="CARTIMEX"&&(t.push({label:"MOSTRADOR-GYE",value:"MOSTRADOR-GYE"}),t.push({label:"MOSTRADOR-UIO",value:"MOSTRADOR-UIO"}),t.push({label:"CUIDAD-GYE",value:"CUIDAD-GYE"}),t.push({label:"CUIDAD-UIO",value:"CUIDAD-UIO"}),t.push({label:"PROVINCIA",value:"PROVINCIA"})),this.empresa==="COMPUTRON"&&(t.push({label:"PICKUP",value:"PICKUP"}),t.push({label:"ENVIO",value:"ENVIO"}));let e=[...new Set(this.Usuarios_Datos.map(x=>x.ORDEN_TIPO_PEDIDO).filter(x=>x&&x!==""))],c=t.map(x=>x.value),d=e.filter(x=>!c.includes(x)).map(x=>({label:x,value:x})),g=[...t,...d],T=this.tableConfig.columns.find(x=>x.type==="select");T&&(T.options=g)}guardarCambios(){let t=this.listaTransportes.find(x=>x.id===this.transporteSeleccionado),e=t?t.C\u00F3digo:"N/A",c={transporteId:this.transporteSeleccionado,transporteNombre:e,numeroGuia:this.numeroGuia,numeroBultos:this.numeroBultos,peso:this.pesoEnvio,comentarios:this.comentariosEnvio,consolidacion:{activada:this.consolidar,tipo:this.tipoConsolidacion,guia:this.guiaConsolidacion},bodegas:this.bodegas,factura:this.facturaActual.Id,bodegaInfo:this.facturaSeleccionada.BODEGAS};console.log("datosEnvio: ",c);let l=!1;this.consolidar&&!this.guiaConsolidacion.trim()&&(l=!0);let d=!this.consolidar&&!this.numeroGuia?.trim();if(!this.transporteSeleccionado||!this.numeroBultos||d||l){let x=[];this.transporteSeleccionado||x.push("Transporte"),this.numeroBultos||x.push("N\xFAmero de bultos"),d&&x.push("N\xFAmero de gu\xEDa"),this.consolidar&&!this.guiaConsolidacion.trim()&&x.push("Gu\xEDa de consolidaci\xF3n"),F.default.fire({title:"\u26A0\uFE0F Campos Incompletos",html:`
          <div class="text-start">
            <p>Por favor complete los siguientes campos obligatorios:</p>
            <ul class="text-muted">
              ${x.map(b=>`<li>${b}</li>`).join("")}
            </ul>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido"});return}let g=this.bodegas.length>1?`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>
         <p><small class="text-muted">Esta gu\xEDa se aplicar\xE1 a las ${this.bodegas.length} bodegas: ${this.bodegas.map(x=>x.codigo).join(", ")}</small></p>`:`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>`,T=this.consolidar?`
      <hr class="my-2">
      <h6 class="text-warning mb-2"><i class="fa fa-boxes me-1"></i>Consolidaci\xF3n</h6>
      <p><strong>Tipo:</strong> ${this.opcionesConsolidacion.find(x=>x.id===this.tipoConsolidacion)?.nombre||"N/A"}</p>
      <p><strong>Gu\xEDa de consolidaci\xF3n:</strong> ${this.guiaConsolidacion}</p>
    `:"";F.default.fire({title:"\u2705 Datos Guardados",html:`
        <div class="text-start">
          <h6 class="text-primary mb-2"><i class="fa fa-file-invoice me-1"></i>Datos de Factura</h6>
          <p><strong>Factura:</strong> ${this.facturaActual?.Secuencia||"N/A"}</p>
          <p><strong>Cliente:</strong> ${this.facturaActual?.Nombre||"N/A"}</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura?.length||0}</p>
          
          <hr class="my-2">
          
          <h6 class="text-success mb-2"><i class="fa fa-shipping-fast me-1"></i>Datos de Env\xEDo</h6>
          <p><strong>Transporte:</strong> ${e} (${this.transporteSeleccionado})</p>
          <p><strong>Bultos:</strong> ${this.numeroBultos}</p>
          <p><strong>Peso:</strong> ${this.pesoEnvio||"No especificado"}</p>
          ${this.comentariosEnvio?`<p><strong>Comentarios:</strong> ${this.comentariosEnvio}</p>`:""}
          
          ${T}
          
          <hr class="my-2">
          
          <h6 class="text-info mb-2"><i class="fa fa-barcode me-1"></i>Informaci\xF3n de Gu\xEDa</h6>
          ${g}
        </div>
      `,icon:"success",confirmButtonText:"OK"}),F.default.fire({title:"\xBFEst\xE1s seguro?",text:"No podr\xE1s revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, Guardar!"}).then(x=>{x.isConfirmed&&this.FacturacionService.FinalizarGuiasPickup(c).subscribe({next:b=>{console.log("response: ",b),b.success?(F.default.fire("\xC9xito!","Los datos de gu\xEDa han sido guardados correctamente.","success"),this.cerrarModal(),this.loadTableData()):F.default.fire("Error!",b.message,"error"),this.isLoading=!1},error:b=>{console.log("error: ",b),this.isLoading=!1}})})}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-guias-pickup"]],decls:10,vars:6,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],["class","loading-container",4,"ngIf"],["class","recent-table",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],[1,"loading-container"],[1,"loading-content"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted","spinner-text","fw-bold"],[1,"recent-table"],[1,"col-3"],["name","filter","id","filter",1,"form-select","form-select-solid","mb-2"],["value","1",1,"fw-bold"],["value","2",1,"fw-bold"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row mb-3",4,"ngIf"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","my-3"],["class","row mb-2",4,"ngIf"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],["style","height: 28px;",4,"ngIf"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-shopping-cart","text-info","me-1"],[1,"text-danger"],[1,"py-1"],["name","transporte",1,"form-select","form-select-solid","form-select-sm",3,"ngModelChange","ngModel","disabled"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-box-open","text-secondary","me-1"],["type","number","name","numeroBultos","placeholder","N\xFAmero de bultos","min","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-warehouse","text-info","me-1"],["type","text","name","pesoEnvio","placeholder","Peso del paquete (kg)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-address-book","text-primary","me-1"],["name","comentarios","rows","2","placeholder","Comentarios sobre el env\xEDo",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","mb-3"],[1,"alert","alert-success","border-success","py-2","mb-0"],[1,"d-flex","align-items-center"],[1,"fa","fa-warehouse","text-primary","me-2","fs-5"],[1,"text-primary"],[1,"d-block","text-dark","fw-bold"],[1,"ms-auto"],[1,"badge","bg-primary","fs-6"],[1,"col-12","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"fw-bold","text-primary","fs-5"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-map-marker-alt","text-danger","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-phone","text-success","me-1"],[1,"font-monospace"],[1,"fa","fa-envelope","text-primary","me-1"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"align-middle"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],[1,"alert","alert-primary","py-2"],[1,"alert","alert-warning","py-2"],[1,"fa","fa-boxes","me-1"],[1,"alert","alert-info","py-2"],[1,"fa","fa-boxes","text-warning","me-1"],[1,"form-check"],["type","checkbox","name","consolidar","id","checkConsolidar",1,"form-check-input",3,"ngModelChange","ngModel","disabled"],["for","checkConsolidar",1,"form-check-label","text-muted"],[1,"fa","fa-barcode","text-warning","me-1"],["type","text","name","guiaConsolidacion","placeholder","N\xFAmero de gu\xEDa de consolidaci\xF3n",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"text-muted"],[1,"fa","fa-spinner","fa-spin","me-1"],[1,"fa","fa-file","text-primary","me-1"],["type","text","name","numeroGuia","placeholder","Ingrese el n\xFAmero de gu\xEDa",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5),f(6,zt,7,0,"div",6)(7,Xt,8,9,"div",7),a()()()(),f(8,si,75,20,"div",8)(9,Ti,74,21,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por ingresar guias")("cardClass","mb-4"),o(3),u("ngIf",c.isLoading),o(),u("ngIf",!c.isLoading),o(),u("ngIf",c.showPrepararModal),o(),u("ngIf",c.showDetalleguiaComputronModal))},dependencies:[k,B,U,L,V,_e,he,G,fe,Be,ge,$,ve,W,N,K],styles:[".spinner-border[_ngcontent-%COMP%]{border-width:.4em;border-right-color:transparent;animation:_ngcontent-%COMP%_spinner-border .75s linear infinite}.spinner-border.text-primary[_ngcontent-%COMP%]{border-color:currentColor;border-right-color:transparent}@keyframes _ngcontent-%COMP%_spinner-border{to{transform:rotate(360deg)}}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px;background-color:#fffffff2}.loading-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]{text-align:center}.loading-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   .spinner-text[_ngcontent-%COMP%]{font-size:1rem;color:#6c757d;font-weight:500;margin-top:1rem}"]})};var we=r=>({"show active":r});function Ii(r,t){if(r&1){let e=y();i(0,"li",8)(1,"button",9),C("click",function(){let l=h(e).$implicit,d=m();return v(d.setTab(l.id))}),n(2),a()()}if(r&2){let e=t.$implicit,c=m();o(),me("active",c.activeTab===e.id),o(),p(" ",e.label," ")}}var Se=class r{tabs=[{id:"obligaciones",label:"Obligaciones"},{id:"parametros",label:"Par\xE1metros"},{id:"otra",label:"Que otra opci\xF3n"}];activeTab="parametros";setTab(t){this.activeTab=t}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-opciones"]],decls:12,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"nav","nav-tabs","mb-3"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-content"],[1,"tab-pane","fade",3,"ngClass"],[1,"nav-item"],[1,"nav-link",3,"click"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"ul",4),f(5,Ii,3,3,"li",5),a(),i(6,"div",6),s(7,"div",7)(8,"div",7),i(9,"div",7)(10,"p"),n(11,"Contenido de la otra pesta\xF1a..."),a()()()()()()()),e&2&&(o(3),u("headerTitle","Opciones Bancarias")("cardClass","mb-4"),o(2),u("ngForOf",c.tabs),o(2),u("ngClass",pe(6,we,c.activeTab==="obligaciones")),o(),u("ngClass",pe(8,we,c.activeTab==="parametros")),o(),u("ngClass",pe(10,we,c.activeTab==="otra")))},dependencies:[k,oe,B,V,N],encapsulation:2})};var H=Z(ee());function Fi(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),s(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),s(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),s(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),s(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),s(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),s(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),s(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),w(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),s(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),s(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),s(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),s(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),s(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=m(2);o(23),p(" ",e.detalleFactura[0].CodigosBodega," "),o(7),_(e.facturaActual.Secuencia),o(6),_(e.facturaActual.Numero),o(6),_(e.facturaActual.Nombre),o(7),p(" ",O(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),p(" ",e.facturaActual.Ciudad," "),o(6),_(e.facturaActual.Vendedor),o(7),p(" ",e.facturaActual.TipoP," "),o(7),p(" ",e.facturaActual.FPago," ")}}function Di(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function wi(r,t){r&1&&(i(0,"span",90),s(1,"i",91),n(2,"Requerido "),a())}function Oi(r,t){r&1&&(i(0,"span",92),s(1,"i",93),n(2,"N/A "),a())}function Pi(r,t){r&1&&(i(0,"span",94),s(1,"i",95),n(2,"Validado "),a())}function Ri(r,t){r&1&&(i(0,"span",96),s(1,"i",97),n(2,"Pendiente "),a())}function Mi(r,t){r&1&&(i(0,"span",45),s(1,"i",95),n(2,"OK "),a())}function Bi(r,t){if(r&1){let e=y();i(0,"div",98)(1,"span",99),s(2,"i",100),a(),i(3,"input",101),A("ngModelChange",function(l){h(e);let d=m().$implicit,g=m(3);return S(g.inputValues[d.input_field],l)||(g.inputValues[d.input_field]=l),v(l)}),C("keypress",function(l){h(e);let d=m().$implicit,g=m(3);return v(g.onInputKeyPress(l,d,d.input_field))}),a()()}if(r&2){let e=m().$implicit,c=m(3);o(3),E("ngModel",c.inputValues[e.input_field]),u("disabled",e.validado),re("data-product",e.CopProducto)}}function ki(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function Vi(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),f(10,Di,3,1,"div",79),a()(),i(11,"td",80),f(12,wi,3,0,"span",81)(13,Oi,3,0,"span",82),a(),i(14,"td",80),f(15,Pi,3,0,"span",83)(16,Ri,3,0,"span",84)(17,Mi,3,0,"span",85),a(),i(18,"td",37),f(19,Bi,4,3,"div",86)(20,ki,2,0,"div",87),a()()),r&2){let e=t.$implicit;o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function Ni(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),s(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),f(32,Vi,21,12,"tr",73),a()()()()()()),r&2){let e=m(2);o(5),p("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function Ui(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=m().$implicit;o(2),_(e.ubi2)}}function Li(r,t){r&1&&(i(0,"span",113),s(1,"i",95),n(2,"Validado "),a())}function Gi(r,t){r&1&&(i(0,"span",114),s(1,"i",97),n(2,"Pendiente "),a())}function $i(r,t){if(r&1){let e=y();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",107)(8,"div"),n(9),f(10,Ui,3,1,"div",79),a()(),i(11,"td",80)(12,"span",108),s(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),f(16,Li,3,0,"span",109)(17,Gi,3,0,"span",110),a(),i(18,"td",37)(19,"div",98)(20,"span",111),s(21,"i",112),a(),i(22,"input",101),A("ngModelChange",function(l){let d=h(e).$implicit,g=m(3);return S(g.inputValues[d.input_field],l)||(g.inputValues[d.input_field]=l),v(l)}),C("keypress",function(l){let d=h(e).$implicit,g=m(3);return v(g.onInputKeyPress(l,d,d.input_field))}),a()()()()}if(r&2){let e=t.$implicit,c=m(3);o(2),p(" ",e.CopProducto," "),o(2),p(" ",e.Cantidad," "),o(2),_(e.Detalle),o(3),p(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),E("ngModel",c.inputValues[e.input_field]),u("disabled",e.validado),re("data-product",e.CopProducto)}}function Wi(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),s(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),f(32,$i,23,10,"tr",73),a()()()()()()),r&2){let e=m(2);o(5),p("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function zi(r,t){r&1&&(i(0,"div",2)(1,"div",115),s(2,"i",116),n(3," No hay productos en el detalle "),a()())}function Xi(r,t){if(r&1){let e=y();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),a()(),i(7,"div",15),f(8,Fi,87,12,"div",16),i(9,"div",1),f(10,Ni,33,2,"div",17)(11,Wi,33,2,"div",17)(12,zi,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){h(e);let l=m();return v(l.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){h(e);let l=m();return v(l.guardarPreparacion())}),s(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=m();o(5),p("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var Ae=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):H.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:c=>{console.log("response: ",c),c.success&&c.cabecera?c.cabecera.length>0?(this.facturaSeleccionada=c,this.facturaActual=c.cabecera[0],this.detalleFactura=c.detalle||[],this.detalleFactura=this.detalleFactura.map((l,d)=>{let g=`${l.ProductoId}_${d}`;return this.inputValues[g]="",R(P({},l),{codigoBarras:"",input_field:g,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,H.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):H.default.fire("Error!",c.message,"error"),this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})}onInputKeyPress(t,e,c){if(t.key==="Enter"){let l=t.target,d=l.value.trim();if(console.log("Input value for row:",e,"Value:",d),e&&d){let g=e.Codigo_barras?e.Codigo_barras.split(",").map(x=>x.trim()):[],T=g.includes(d)||d===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...g,e.CopProducto]),console.log("C\xF3digo ingresado:",d),console.log("Es v\xE1lido:",T),T?(e.validado=!0,e.codigoBarras=d,l.classList.remove("is-invalid"),l.classList.add("is-valid"),H.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${d}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${d}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),H.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${g.map(x=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${x}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${d}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${d}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(d=>`\u2022 ${d.CopProducto} - ${d.Detalle.substring(0,50)}...`).join(`
`);H.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(d=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${d.CopProducto}</strong><br>
                  <small class="text-muted">${d.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let c=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);H.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${c.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:d=>{if(console.log("response: ",d),d.success)if(d.data&&d.data.length>0){let g=d.data.some(x=>x.data&&x.data.length>0&&x.data.some(b=>b.success==="true"));d.data.some(x=>x.data&&x.data.length>0&&x.data.some(b=>b.menssage==="ya existe registro"))?H.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p><strong>Bodega(s):</strong> ${d.bodegas?d.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):g?H.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p><strong>Bodega(s):</strong> ${d.bodegas?d.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${d.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):H.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${d.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else H.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${d.factura}</p>
                    <p class="text-success">${d.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else H.default.fire({title:"Error!",text:d.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-despachar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(d){return c.onTableAction(d)})("customAction",function(d){return c.onCustomAction(d)}),a()()()()()(),f(8,Xi,19,5,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",c.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",c.Buttons_Export)("customButtons",c.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",c.showPrepararModal))},dependencies:[k,B,U,L,V,G,$,W,N,K],encapsulation:2})};var ne=Z(ee());var Ji=(r,t,e,c)=>({"bg-success":r,"bg-warning text-dark":t,"bg-info":e,"bg-secondary":c});function Hi(r,t){r&1&&(i(0,"div",50)(1,"span",51),s(2,"i",52),n(3,"FACTURA MULTIBODEGA "),a()())}function ji(r,t){if(r&1&&(i(0,"span",53),n(1),a()),r&2){let e=t.$implicit;o(),p(" ",e," ")}}function qi(r,t){if(r&1&&(i(0,"tr",26)(1,"td",31),s(2,"i",39),n(3,"PDF Factura: "),a(),i(4,"td",29)(5,"a",54),s(6,"i",41),n(7,"Ver PDF "),a()()()),r&2){let e=m(2);o(5),u("href","http://"+(e.facturaActual==null?null:e.facturaActual.SRI_LNK),ue)}}function Ki(r,t){if(r&1&&(i(0,"tr",26)(1,"td",31),s(2,"i",55),n(3,"RUC: "),a(),i(4,"td",29)(5,"span",56),n(6),a()()()),r&2){let e=m(2);o(6),_(e.facturaActual==null||e.facturaActual.Ruc==null?null:e.facturaActual.Ruc.trim())}}function Yi(r,t){if(r&1){let e=y();i(0,"div",1)(1,"div",13),f(2,Hi,4,0,"div",14),i(3,"div",15)(4,"div",16),s(5,"i",17),i(6,"h6",18),n(7,"Informaci\xF3n de la Factura"),a()()()(),i(8,"div",19)(9,"div",20)(10,"div",21)(11,"small",22),s(12,"i",23),n(13,"Datos Principales "),a()(),i(14,"div",24)(15,"table",25)(16,"tbody")(17,"tr",26)(18,"td",27),s(19,"i",28),n(20,"Bodega(s): "),a(),i(21,"td",29),f(22,ji,2,1,"span",30),a()(),i(23,"tr",26)(24,"td",31),s(25,"i",32),n(26,"Secuencia: "),a(),i(27,"td",29)(28,"span",33),n(29),a()()(),i(30,"tr",26)(31,"td",31),s(32,"i",34),n(33,"N\xFAmero: "),a(),i(34,"td",29),n(35),a()(),i(36,"tr",26)(37,"td",31),s(38,"i",35),n(39,"Cliente: "),a(),i(40,"td",29),n(41),a()(),i(42,"tr",26)(43,"td",31),s(44,"i",36),n(45,"Fecha: "),a(),i(46,"td",29)(47,"span",37),n(48),w(49,"date"),a()()(),f(50,qi,8,1,"tr",38),i(51,"tr",26)(52,"td",31),s(53,"i",39),n(54,"Series: "),a(),i(55,"td",29)(56,"button",40),C("click",function(){h(e);let l=m();return v(l.verSeries())}),s(57,"i",41),n(58,"Ver series "),a()()()()()()()(),i(59,"div",19)(60,"div",20)(61,"div",21)(62,"small",22),s(63,"i",42),n(64,"Informaci\xF3n de Contacto "),a()(),i(65,"div",24)(66,"table",25)(67,"tbody")(68,"tr",26)(69,"td",31),s(70,"i",43),n(71,"Ciudad: "),a(),i(72,"td",29)(73,"span",44),n(74),a()()(),i(75,"tr",26)(76,"td",31),s(77,"i",45),n(78,"Vendedor: "),a(),i(79,"td",29),n(80),a()(),i(81,"tr",26)(82,"td",31),s(83,"i",46),n(84,"Tipo Pedido: "),a(),i(85,"td",29)(86,"span",47),n(87),a()()(),i(88,"tr",26)(89,"td",31),s(90,"i",48),n(91,"Forma Pago: "),a(),i(92,"td",29)(93,"span",49),n(94),a()()(),f(95,Ki,7,1,"tr",38),a()()()()()()}if(r&2){let e=m();o(2),u("ngIf",e.isMultibodega()),o(20),u("ngForOf",e.getBodegasUnicas()),o(7),p(" ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(6),p(" ",e.facturaActual==null?null:e.facturaActual.Numero," "),o(6),p(" ",e.facturaActual==null||e.facturaActual.Nombre==null?null:e.facturaActual.Nombre.trim()," "),o(7),p(" ",O(49,12,e.facturaActual==null?null:e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(2),u("ngIf",e.facturaActual==null?null:e.facturaActual.SRI_LNK),o(24),p(" ",e.facturaActual==null||e.facturaActual.Ciudad==null?null:e.facturaActual.Ciudad.trim()," "),o(6),_(e.facturaActual==null||e.facturaActual.Vendedor==null?null:e.facturaActual.Vendedor.trim()),o(7),p(" ",e.facturaActual==null||e.facturaActual.TipoP==null?null:e.facturaActual.TipoP.trim()," "),o(7),p(" ",e.facturaActual==null||e.facturaActual.FPago==null?null:e.facturaActual.FPago.trim()," "),o(),u("ngIf",e.facturaActual==null?null:e.facturaActual.Ruc)}}function Qi(r,t){if(r&1&&(i(0,"tr",79)(1,"td",80)(2,"span",81),n(3),a()(),i(4,"td",82),n(5),a(),i(6,"td",83)(7,"small"),n(8),a()(),i(9,"td",84),n(10),a(),i(11,"td",80)(12,"small",85),n(13),w(14,"number"),a()(),i(15,"td",80)(16,"small",85),n(17),w(18,"number"),a()(),i(19,"td",82)(20,"span",86),n(21),w(22,"number"),a()()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),p(" ",e.bodega_codigo," "),o(2),p(" ",e.producto_codigo," "),o(3),_(e.producto_nombre),o(2),p(" ",e.factura_cantidad," "),o(3),p("$",O(14,8,e.factura_subtoal,"1.2-2"),""),o(4),p("$",O(18,11,e.factura_iva,"1.2-2"),""),o(4),p("$",O(22,14,e.factura_total,"1.2-2"),"")}}function Zi(r,t){if(r&1&&(i(0,"div")(1,"small",90),n(2),a(),s(3,"br"),i(4,"small",85),n(5),w(6,"date"),a()()),r&2){let e=m().$implicit;o(2),_(e.fl_preparadapor),o(3),_(O(6,2,e.fl_preparadafecha,"dd/MM/yyyy HH:mm"))}}function ea(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function ta(r,t){if(r&1&&(i(0,"div")(1,"small",33),n(2),a(),s(3,"br"),i(4,"small",85),n(5),w(6,"date"),a()()),r&2){let e=m().$implicit;o(2),_(e.fl_verificadapor),o(3),_(O(6,2,e.fl_verificadafecha,"dd/MM/yyyy HH:mm"))}}function ia(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function aa(r,t){if(r&1&&(i(0,"div")(1,"small",91),n(2),a(),s(3,"br"),i(4,"small",92),n(5),a(),s(6,"br"),i(7,"small",85),n(8),w(9,"date"),a()()),r&2){let e=m().$implicit;o(2),_(e.fl_guiaconsolidado),o(3),_(e.fl_guiaconsolidadopor),o(3),_(O(9,3,e.fl_guiaconsolidadofecha,"dd/MM/yyyy HH:mm"))}}function na(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function ra(r,t){if(r&1&&(i(0,"div")(1,"small",93),n(2),a(),s(3,"br"),i(4,"small",90),n(5),a(),s(6,"br"),i(7,"small",85),n(8),w(9,"date"),a()()),r&2){let e=m().$implicit;o(2),_(e.fl_guiadespachofinal),o(3),_(e.fl_guiadespachofinalpor),o(3),_(O(9,3,e.fl_guiadespachofinalfecha,"dd/MM/yyyy HH:mm"))}}function oa(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function la(r,t){if(r&1&&(i(0,"tr",79)(1,"td",80)(2,"span",81),n(3),a()(),i(4,"td",82),n(5),a(),i(6,"td",80)(7,"span",87),n(8),a()(),i(9,"td",80),f(10,Zi,7,5,"div",88)(11,ea,2,0,"span",89),a(),i(12,"td",80),f(13,ta,7,5,"div",88)(14,ia,2,0,"span",89),a(),i(15,"td",80),f(16,aa,10,6,"div",88)(17,na,2,0,"span",89),a(),i(18,"td",80),f(19,ra,10,6,"div",88)(20,oa,2,0,"span",89),a()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),p(" ",e.bodega_codigo," "),o(2),p(" ",e.productos_count," "),o(2),u("ngClass",Re(13,Ji,e.fl_estado==="INGRESADAGUIA",e.fl_estado==="PREPARADA",e.fl_estado==="VERIFICADA",e.fl_estado==="-"||!e.fl_estado)),o(),p(" ",e.fl_estado==="-"?"Pendiente":e.fl_estado||"Pendiente"," "),o(2),u("ngIf",e.fl_preparadapor&&e.fl_preparadapor!=="-"),o(),u("ngIf",!e.fl_preparadapor||e.fl_preparadapor==="-"),o(2),u("ngIf",e.fl_verificadapor&&e.fl_verificadapor!=="-"),o(),u("ngIf",!e.fl_verificadapor||e.fl_verificadapor==="-"),o(2),u("ngIf",e.fl_guiaconsolidadopor&&e.fl_guiaconsolidadopor!==""),o(),u("ngIf",!e.fl_guiaconsolidadopor||e.fl_guiaconsolidadopor===""),o(2),u("ngIf",e.fl_guiadespachofinalpor&&e.fl_guiadespachofinalpor!=="-"),o(),u("ngIf",!e.fl_guiadespachofinalpor||e.fl_guiadespachofinalpor==="-")}}function sa(r,t){if(r&1&&(i(0,"div",57)(1,"div",58)(2,"div",59)(3,"div",60)(4,"h6",61),s(5,"i",62),n(6),a()(),i(7,"div",63)(8,"div",64)(9,"table",65)(10,"thead",66)(11,"tr")(12,"th",67),s(13,"i",68),n(14,"Bodega "),a(),i(15,"th",69),s(16,"i",70),n(17,"C\xF3digo "),a(),i(18,"th",71),s(19,"i",23),n(20,"Descripci\xF3n "),a(),i(21,"th",67),n(22," Cantidad "),a(),i(23,"th",72),n(24," Subtotal "),a(),i(25,"th",72),n(26," IVA "),a(),i(27,"th",72),n(28," Total "),a()()(),i(29,"tbody"),f(30,Qi,23,17,"tr",73),a()()()()()(),i(31,"div",2)(32,"div",74)(33,"div",60)(34,"h6",75),s(35,"i",76),n(36,"Estado de Tracking por Bodega "),a()(),i(37,"div",63)(38,"div",64)(39,"table",65)(40,"thead",77)(41,"tr")(42,"th",69),n(43,"Bodega"),a(),i(44,"th",67),n(45,"Productos"),a(),i(46,"th",69),n(47,"Estado"),a(),i(48,"th",78),n(49,"Preparado"),a(),i(50,"th",78),n(51,"Verificado"),a(),i(52,"th",78),n(53,"Gu\xEDa Consolidado"),a(),i(54,"th",78),n(55,"Gu\xEDa Despacho"),a()()(),i(56,"tbody"),f(57,la,21,18,"tr",73),a()()()()()()()),r&2){let e=m();o(6),p("Detalle de Productos (",e.detalleFactura.length,") "),o(24),u("ngForOf",e.detalleFactura),o(27),u("ngForOf",e.getDetalleAgrupadoPorBodega())}}function ca(r,t){r&1&&(i(0,"div",107)(1,"div",108)(2,"span",109),n(3,"Cargando..."),a()(),i(4,"p",110),n(5,"Cargando series..."),a()())}function da(r,t){if(r&1&&(i(0,"div",118)(1,"span",119),n(2),a()()),r&2){let e=t.$implicit;o(2),_(e)}}function ua(r,t){if(r&1&&(i(0,"tr",79)(1,"td",115),n(2),a(),i(3,"td",116)(4,"small"),n(5),a()(),i(6,"td",116),f(7,da,3,1,"div",117),a()()),r&2){let e=t.$implicit;o(2),p(" ",e.codigo," "),o(3),_(e.producto_nombre),o(2),u("ngForOf",e.series_array)}}function ma(r,t){if(r&1&&(i(0,"div",64)(1,"table",111)(2,"thead",77)(3,"tr")(4,"th",112),s(5,"i",70),n(6,"C\xF3digo "),a(),i(7,"th",113),s(8,"i",23),n(9,"Producto "),a(),i(10,"th",113),s(11,"i",114),n(12,"Series "),a()()(),i(13,"tbody"),f(14,ua,8,3,"tr",73),a()()()),r&2){let e=m(2);o(14),u("ngForOf",e.seriesData)}}function pa(r,t){r&1&&(i(0,"div",107),s(1,"i",120),i(2,"p",110),n(3,"No se encontraron series para esta factura"),a()())}function fa(r,t){if(r&1){let e=y();i(0,"div",94)(1,"div",95)(2,"div",96)(3,"div",97)(4,"h5",98),s(5,"i",99),n(6),a(),i(7,"button",100),C("click",function(){h(e);let l=m();return v(l.cerrarModalSeries())}),a()(),i(8,"div",101),f(9,ca,6,0,"div",102)(10,ma,15,1,"div",103)(11,pa,4,0,"div",102),a(),i(12,"div",104)(13,"button",105),C("click",function(){h(e);let l=m();return v(l.cerrarModalSeries())}),s(14,"i",106),n(15,"Cerrar "),a()()()()()}if(r&2){let e=m();o(6),p("Series de Productos - Factura ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(3),u("ngIf",e.isLoadingSeries),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length>0),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length===0)}}var ye=class r{constructor(t,e,c){this.FacturacionService=t;this.cdr=e;this.router=c}sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaActual=null;detalleFactura=[];seriesData=[];isLoadingSeries=!1;showModalSeries=!1;fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];secuenciafactura="";MostrarDetalleFactura=!1;customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):ne.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e)}onbuscarFactura(){if(!this.secuenciafactura||this.secuenciafactura.trim()===""){ne.default.fire("Error!","Por favor ingrese una secuencia de factura","warning");return}this.isLoading=!0;let t={secuencia:this.secuenciafactura.trim(),usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasTracking(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data&&e.data.length>0?(this.facturaActual=e.data[0],this.detalleFactura=e.detalle||[],this.MostrarDetalleFactura=!0):(ne.default.fire("Error!","No se encontr\xF3 informaci\xF3n de la factura","error"),this.MostrarDetalleFactura=!1),this.isLoading=!1},error:e=>{console.log("error: ",e),ne.default.fire("Error!","Ocurri\xF3 un error al buscar la factura","error"),this.isLoading=!1,this.MostrarDetalleFactura=!1}})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}getBodegasUnicas(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t=this.detalleFactura.map(e=>e.bodega_codigo);return[...new Set(t)]}isMultibodega(){return this.getBodegasUnicas().length>1}getBodegasString(){return this.getBodegasUnicas().join(", ")}getDetalleAgrupadoPorBodega(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t={};return this.detalleFactura.forEach(e=>{let c=e.bodega_codigo;t[c]?(t[c].productos_count++,t[c].total_factura+=parseFloat(e.factura_total)):t[c]={bodega_codigo:e.bodega_codigo,bodega_nombre:e.bodega_nombre,fl_estado:e.fl_estado,fl_preparadapor:e.fl_preparadapor,fl_preparadafecha:e.fl_preparadafecha,fl_verificadapor:e.fl_verificadapor,fl_verificadafecha:e.fl_verificadafecha,fl_guiaconsolidado:e.fl_guiaconsolidado,fl_guiaconsolidadofecha:e.fl_guiaconsolidadofecha,fl_guiaconsolidadopor:e.fl_guiaconsolidadopor,fl_guiadespachofinal:e.fl_guiadespachofinal,fl_guiadespachofinalfecha:e.fl_guiadespachofinalfecha,fl_guiadespachofinalpor:e.fl_guiadespachofinalpor,productos_count:1,total_factura:parseFloat(e.factura_total)}}),Object.values(t)}verSeries(){if(!this.facturaActual||!this.facturaActual.Id){ne.default.fire("Error!","No hay factura seleccionada","warning");return}this.isLoadingSeries=!0,this.seriesData=[],this.showModalSeries=!0;let t={factura_id:this.facturaActual.Id};console.log("param: ",t),this.FacturacionService.GetFacturasSeries(t).subscribe({next:e=>{console.log("response: ",e),this.isLoadingSeries=!1,e.success&&e.data&&e.data.length>0?this.seriesData=e.data.map(c=>R(P({},c),{series_array:c.series?c.series.split("/"):[]})):this.seriesData=[]},error:e=>{console.log("error: ",e),this.isLoadingSeries=!1,this.seriesData=[],ne.default.fire("Error!","Ocurri\xF3 un error al buscar las series","error")}})}cerrarModalSeries(){this.showModalSeries=!1,this.seriesData=[],this.isLoadingSeries=!1}static \u0275fac=function(e){return new(e||r)(I(z),I(j),I(q))};static \u0275cmp=M({type:r,selectors:[["app-tracking-facturas"]],decls:16,vars:6,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"col-xl-4","col-md-6","mb-2"],[1,"form-label","fw-bold"],[1,"input-group","mb-3"],["type","text","placeholder","001-001-000000123","name","secuenciafactura",1,"form-control","form-control-solid",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","row",4,"ngIf"],["class","row mt-3",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.5);",4,"ngIf"],[1,"col-12","mb-1"],["class","mb-2",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"d-flex","align-items-center"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],["class","badge bg-info me-1 fs-6",4,"ngFor","ngForOf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],["style","height: 28px;",4,"ngIf"],[1,"fa","fa-file-pdf","text-danger","me-1"],[1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-external-link-alt","me-1"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"mb-2"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-info","me-1","fs-6"],["target","_blank",1,"btn","btn-sm","btn-outline-danger",3,"href"],[1,"fa","fa-id-card","text-warning","me-1"],[1,"font-monospace"],[1,"row","mt-3"],[1,"col-12","mb-3"],[1,"card","border-success"],[1,"card-header"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","35%"],[1,"text-center","py-2",2,"width","10%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"card","border-info"],[1,"text-info","mb-0"],[1,"fa","fa-route","me-1"],[1,"table-info"],[1,"text-center","py-2",2,"width","17%"],[1,"align-middle"],[1,"text-center","py-2"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-dark","fs-6",3,"title"],[1,"text-center","fw-bold","py-2"],[1,"py-2"],[1,"text-center","fw-bold","text-primary","py-2"],[1,"text-muted"],[1,"text-success"],[1,"badge","fs-6",3,"ngClass"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-success"],[1,"fw-bold","text-warning"],[1,"fw-bold","text-info"],[1,"fw-bold","text-danger"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","modalSeriesLabel",1,"modal-title"],[1,"fa","fa-barcode","me-2"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa","fa-times","me-1"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-info"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"table","table-striped","table-hover","nowrap"],[1,"",2,"width","20%"],[1,"text-center",2,"width","40%"],[1,"fa","fa-list","me-1"],[1,"fw-bold"],[1,"px-3"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"badge","bg-dark","fs-6"],[1,"fa","fa-exclamation-triangle","text-warning",2,"font-size","2rem"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",4)(6,"div",5)(7,"label",6),n(8,"Secuencia Factura:"),a(),i(9,"div",7)(10,"input",8),A("ngModelChange",function(d){return S(c.secuenciafactura,d)||(c.secuenciafactura=d),d}),a(),i(11,"button",9),C("click",function(){return c.onbuscarFactura()}),n(12,"Buscar"),a()()()(),f(13,Yi,96,15,"div",10)(14,sa,58,3,"div",11),a()()()(),f(15,fa,16,4,"div",12)),e&2&&(o(3),u("headerTitle","Buscar Tracking de Facturas")("cardClass","mb-4"),o(7),E("ngModel",c.secuenciafactura),o(3),u("ngIf",c.MostrarDetalleFactura),o(),u("ngIf",c.MostrarDetalleFactura&&c.detalleFactura.length>0),o(),u("ngIf",c.showModalSeries))},dependencies:[k,oe,B,U,Me,L,V,G,$,W,N],encapsulation:2})};var Y=Z(ee());function ga(r,t){if(r&1&&(i(0,"tr",24)(1,"td",29),s(2,"i",43),n(3,"PDF Factura: "),a(),i(4,"td",27)(5,"a",44),s(6,"i",45),n(7,"Ver PDF "),a()()()),r&2){let e=m(2);o(5),u("href","http://"+(e.facturaActual==null?null:e.facturaActual.SRI_LNK),ue)}}function _a(r,t){if(r&1&&(i(0,"tr",24)(1,"td",29),s(2,"i",46),n(3,"RUC: "),a(),i(4,"td",27)(5,"span",47),n(6),a()()()),r&2){let e=m(2);o(6),_(e.facturaActual==null||e.facturaActual.Ruc==null?null:e.facturaActual.Ruc.trim())}}function ha(r,t){if(r&1&&(i(0,"div",1)(1,"div",12)(2,"div",13)(3,"div",14),s(4,"i",15),i(5,"h6",16),n(6,"Informaci\xF3n de la Factura"),a()()()(),i(7,"div",17)(8,"div",18)(9,"div",19)(10,"small",20),s(11,"i",21),n(12,"Datos Principales "),a()(),i(13,"div",22)(14,"table",23)(15,"tbody")(16,"tr",24)(17,"td",25),s(18,"i",26),n(19,"Secuencia: "),a(),i(20,"td",27)(21,"span",28),n(22),a()()(),i(23,"tr",24)(24,"td",29),s(25,"i",30),n(26,"Id: "),a(),i(27,"td",27),n(28),a()(),i(29,"tr",24)(30,"td",29),s(31,"i",31),n(32,"Cliente: "),a(),i(33,"td",27),n(34),a()(),i(35,"tr",24)(36,"td",29),s(37,"i",32),n(38,"Fecha: "),a(),i(39,"td",27)(40,"span",33),n(41),w(42,"date"),a()()(),f(43,ga,8,1,"tr",34),a()()()()(),i(44,"div",17)(45,"div",18)(46,"div",19)(47,"small",20),s(48,"i",35),n(49,"Informaci\xF3n de Contacto "),a()(),i(50,"div",22)(51,"table",23)(52,"tbody")(53,"tr",24)(54,"td",29),s(55,"i",36),n(56,"Ciudad: "),a(),i(57,"td",27)(58,"span",37),n(59),a()()(),i(60,"tr",24)(61,"td",29),s(62,"i",38),n(63,"Vendedor: "),a(),i(64,"td",27),n(65),a()(),i(66,"tr",24)(67,"td",29),s(68,"i",39),n(69,"Tipo Pedido: "),a(),i(70,"td",27)(71,"span",40),n(72),a()()(),i(73,"tr",24)(74,"td",29),s(75,"i",41),n(76,"Forma Pago: "),a(),i(77,"td",27)(78,"span",42),n(79),a()()(),f(80,_a,7,1,"tr",34),a()()()()()()),r&2){let e=m();o(22),p(" ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(6),p(" ",e.facturaActual==null?null:e.facturaActual.Id," "),o(6),p(" ",e.facturaActual==null||e.facturaActual.Nombre==null?null:e.facturaActual.Nombre.trim()," "),o(7),p(" ",O(42,10,e.facturaActual==null?null:e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(2),u("ngIf",e.facturaActual==null?null:e.facturaActual.SRI_LNK),o(16),p(" ",e.facturaActual==null||e.facturaActual.Ciudad==null?null:e.facturaActual.Ciudad.trim()," "),o(6),_(e.facturaActual==null||e.facturaActual.Vendedor==null?null:e.facturaActual.Vendedor.trim()),o(7),p(" ",e.facturaActual==null||e.facturaActual.TipoP==null?null:e.facturaActual.TipoP.trim()," "),o(7),p(" ",e.facturaActual==null||e.facturaActual.FPago==null?null:e.facturaActual.FPago.trim()," "),o(),u("ngIf",e.facturaActual==null?null:e.facturaActual.Ruc)}}function va(r,t){if(r&1){let e=y();i(0,"tr",66)(1,"td",67),n(2),a(),i(3,"td",68)(4,"small"),n(5),a()(),i(6,"td",68)(7,"input",69),A("ngModelChange",function(l){let d=h(e).$implicit;return S(d.serie,l)||(d.serie=l),v(l)}),a()(),i(8,"td",70)(9,"button",71),C("click",function(){let l=h(e),d=l.$implicit,g=l.index,T=m(2);return v(T.onVerDetalleProducto(d,g))}),s(10,"i",72),a()()()}if(r&2){let e=t.$implicit,c=t.index;o(2),p(" ",e.CopProducto," "),o(3),_(e.Detalle),o(2),Oe("name","serie_",c,""),E("ngModel",e.serie)}}function ba(r,t){if(r&1&&(i(0,"div",48)(1,"div",49)(2,"div",50)(3,"div",51)(4,"h6",52),s(5,"i",53),n(6),a()(),i(7,"div",54)(8,"div",55)(9,"table",56)(10,"thead",57)(11,"tr")(12,"th",58),s(13,"i",59),n(14,"C\xF3digo "),a(),i(15,"th",60),s(16,"i",21),n(17,"Descripci\xF3n "),a(),i(18,"th",61),s(19,"i",62),n(20,"Serie "),a(),i(21,"th",63),s(22,"i",64),n(23,"Acci\xF3n "),a()()(),i(24,"tbody"),f(25,va,11,5,"tr",65),a()()()()()()()),r&2){let e=m();o(6),p("Detalle de Productos (",e.detalleFactura.length,") "),o(19),u("ngForOf",e.detalleFactura)}}var Te=class r{constructor(t){this.FacturacionService=t}sessionData=null;isLoading=!1;facturaActual=null;detalleFactura=[];secuenciafactura="";secuenciafacturatemp="";MostrarDetalleFactura=!1;ngOnInit(){this.loadSessionData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}onbuscarFactura(){if(!this.secuenciafactura||this.secuenciafactura.trim()===""){Y.default.fire("Error!","Por favor ingrese una secuencia de factura","warning");return}this.secuenciafactura.trim()===""&&this.secuenciafacturatemp.trim()!==""&&(this.secuenciafactura=this.secuenciafacturatemp),this.isLoading=!0;let t={secuencia:this.secuenciafactura.trim(),usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasModificarSeries(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data&&e.data.length>0?(this.facturaActual=e.data[0],this.detalleFactura=e.detalle||[],this.MostrarDetalleFactura=!0,this.secuenciafacturatemp=this.secuenciafactura):(Y.default.fire("Error!",e.mensaje,"error"),this.MostrarDetalleFactura=!1),this.isLoading=!1},error:e=>{console.log("error: ",e),Y.default.fire("Error!","Ocurri\xF3 un error al buscar la factura","error"),this.isLoading=!1,this.MostrarDetalleFactura=!1}})}onCustomAction(t){switch(t.action){case"refresh":break;default:}}onVerDetalleProducto(t,e){if(console.log("Producto seleccionado - \xCDndice:",e),console.log("Detalles del producto:",t),t.serie.trim()==""){Y.default.fire("Atenci\xF3n!","El producto seleccionado no tiene serie asignada.","info");return}this.FacturacionService.SetModificarSeries(t).subscribe({next:c=>{console.log("response: ",c),c.success?(Y.default.fire("Exito",c.mensaje,"success"),this.onbuscarFactura()):Y.default.fire("Error!",c.mensaje,"error"),this.isLoading=!1},error:c=>{console.log("error: ",c),Y.default.fire("Error!","Ocurri\xF3 un error al buscar la factura","error"),this.isLoading=!1}})}static \u0275fac=function(e){return new(e||r)(I(z))};static \u0275cmp=M({type:r,selectors:[["app-modificar-series"]],decls:14,vars:5,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"col-xl-4","col-md-6","mb-2"],[1,"form-label","fw-bold"],[1,"input-group","mb-3"],["type","text","placeholder","001-001-000000123","name","secuenciafactura",1,"form-control","form-control-solid",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","row",4,"ngIf"],["class","row mt-3",4,"ngIf"],[1,"col-12","mb-1"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"d-flex","align-items-center"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"py-1"],[1,"fw-bold","text-primary"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],["style","height: 28px;",4,"ngIf"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-file-pdf","text-danger","me-1"],["target","_blank",1,"btn","btn-sm","btn-outline-danger",3,"href"],[1,"fa","fa-external-link-alt","me-1"],[1,"fa","fa-id-card","text-warning","me-1"],[1,"font-monospace"],[1,"row","mt-3"],[1,"col-12","mb-3"],[1,"card","border-success"],[1,"card-header"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","15%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","50%"],[1,"text-center","py-2",2,"width","25%"],[1,"fa","fa-hashtag","me-1"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-eye","me-1"],["class","align-middle",4,"ngFor","ngForOf"],[1,"align-middle"],[1,"text-center","fw-bold","py-2"],[1,"py-2"],["type","text","placeholder","Ingrese serie",1,"form-control","form-control-sm",3,"ngModelChange","ngModel","name"],[1,"text-center","py-2"],["title","Ver detalles",1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-eye"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"label",6),n(7,"Secuencia Factura:"),a(),i(8,"div",7)(9,"input",8),A("ngModelChange",function(d){return S(c.secuenciafactura,d)||(c.secuenciafactura=d),d}),a(),i(10,"button",9),C("click",function(){return c.onbuscarFactura()}),n(11,"Buscar"),a()()()(),f(12,ha,81,13,"div",10)(13,ba,26,2,"div",11),a()()()()),e&2&&(o(3),u("headerTitle","Buscar Tracking de Facturas")("cardClass","mb-4"),o(6),E("ngModel",c.secuenciafactura),o(3),u("ngIf",c.MostrarDetalleFactura),o(),u("ngIf",c.MostrarDetalleFactura&&c.detalleFactura.length>0))},dependencies:[k,B,U,L,V,G,$,W,N],encapsulation:2})};var vn=[{path:"picking/prepararfacturas",component:be,data:{title:"Preparar Facturas",breadcrumb:"Preparar Facturas"}},{path:"picking/dropshipping",component:xe,data:{title:"Dropshipping Facturas",breadcrumb:"Dropshipping Facturas"}},{path:"picking/verificarfacturas",component:Ce,data:{title:"Verificar Facturas",breadcrumb:"Verificar Facturas"}},{path:"picking/guiaspickup",component:Ee,data:{title:"Guias Pickup",breadcrumb:"Guias Pickup"}},{path:"opciones",component:Se,data:{title:"Opciones",breadcrumb:"Opciones"}},{path:"picking/despachar",component:Ae,data:{title:"Facturas por despachar",breadcrumb:"Facturas por despachar"}},{path:"tracking",component:ye,data:{title:"Tracking Facturas",breadcrumb:"Facturas por rastrear"}},{path:"modificarseries",component:Te,data:{title:"Modificar Series",breadcrumb:"Modificar Series"}}];export{vn as LogisticaRoutes};
