import{a as U}from"./chunk-SLII4CAF.js";import{a as q}from"./chunk-GDTWJE5M.js";import{a as le,b as ce}from"./chunk-AMGMCQ56.js";import{a as te}from"./chunk-AI45PTO7.js";import{A as W,N as G,c as ee,d as se,l as H,t as L,v as j}from"./chunk-LVDJUO5Z.js";import{l as z,m as $,t as R}from"./chunk-AQUAFEI7.js";import{$ as ne,Ab as A,Ib as s,Jb as l,Kb as w,Ob as T,Ub as C,Vb as v,a as y,ab as c,b as F,cc as h,dc as B,e as Z,ea as ae,ec as M,gb as x,hc as O,ic as V,jc as k,lb as N,na as b,oa as _,qb as E,yb as f,yc as D}from"./chunk-FF5Z5KFO.js";var m=Z(te());var I=class n extends ce{endpoint=le.apiUrl+"/oym/mpps/";constructor(t){super(t)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let t=localStorage.getItem("user")||"",e=null;try{t&&(e=JSON.parse(t))}catch{e=t}return e}headers=new ee({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});CrearCarpetaMPPs(t){return this.http.post(this.endpoint+"CrearCarpetaMPPs",t,{headers:this.headers})}CargarCarpetaMPPs(t){return this.http.post(this.endpoint+"CargarCarpetaMPPs",t,{headers:this.headers})}EliminarCarpetaMPPs(t){return this.http.post(this.endpoint+"EliminarCarpetaMPPs",t,{headers:this.headers})}GuardarArchivoMPPs(t,e,r){let i=new FormData;return i.append("file",t),i.append("subpath",e),r&&i.append("metadata",JSON.stringify(r)),this.http.post(this.endpoint+"GuardarArchivoMPPs",i,{headers:new ee({Authorization:`Bearer ${this.getUserSessionToken()}`})})}EditarArchivoMPPs(t,e,r){return this.http.post(this.endpoint+"EditarArchivoMPPs",{path:t,newPath:e,metadata:r},{headers:this.headers})}EliminarArchivoMPPs(t){return this.http.post(this.endpoint+"EliminarArchivoMPPs",{path:t},{headers:this.headers})}static \u0275fac=function(e){return new(e||n)(ae(se))};static \u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})};function fe(n,t){n&1&&(s(0,"div",18),h(1,"No hay carpetas."),l())}function he(n,t){if(n&1){let e=T();s(0,"li",21),C("click",function(){let i=b(e).$implicit,o=v(2);return _(o.selectFolder(i.path))}),s(1,"div"),w(2,"i",22),h(3),l(),s(4,"div",23),h(5),l(),s(6,"div")(7,"button",24),C("click",function(i){let o=b(e).$implicit,a=v(2);return _(a.deleteFolder(i,o.path))}),w(8,"i",25),l()()()}if(n&2){let e=t.$implicit,r=v(2);A("active",r.selectedFolder===e.path),c(3),M(" ",e.name," "),c(2),M("",(r.filesMap[e.path]==null?null:r.filesMap[e.path].length)||0," archivos")}}function ve(n,t){if(n&1&&(s(0,"ul",19),E(1,he,9,4,"li",20),l()),n&2){let e=v();c(),f("ngForOf",e.folders)}}function ge(n,t){n&1&&(s(0,"h6"),h(1,"Archivos"),l())}function be(n,t){if(n&1&&(s(0,"h6"),h(1,"Archivos en: "),s(2,"small",26),h(3),l()()),n&2){let e=v();c(3),B(e.selectedFolderName)}}function _e(n,t){n&1&&(s(0,"div",27),h(1,"Selecciona una carpeta a la izquierda para ver su contenido."),l())}function Ce(n,t){if(n&1){let e=T();s(0,"div")(1,"app-table",28),C("action",function(i){b(e);let o=v();return _(o.onFileTableAction(i))})("customAction",function(i){b(e);let o=v();return _(o.onCustomAction(i))}),l()()}if(n&2){let e=v();c(),f("hasCheckbox",!1)("tableConfig",e.filesTableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!1)("customButtons",e.customButtons)}}var Q=class n{constructor(t,e,r){this.OymService=t;this.cdr=e;this.router=r}newFolderName="";folders=[];selectedFiles=[];selectedFolder=null;selectedFolderName=null;filesMap={};customButtons=[{label:"",action:"add_file",icon:"fa fa-plus",class:"btn btn-success",tooltip:"Agregar nuevo archivo"}];filesTableConfig={columns:[{title:"Nombre",field_value:"name",sort:!0},{title:"Version",field_value:"version",sort:!0},{title:"Titulo",field_value:"title",sort:!0}],row_action:[{label:"",action_to_perform:"edit_file",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Editar"},{label:"",action_to_perform:"delete_file",icon:"trash",type:"button",class:"btn btn-danger btn-sm",tooltip:"Eliminar"}],data:[]};ngOnInit(){this.loadFolders()}loadFolders(t="manuales_de_funciones"){this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(!e||!e.success){this.folders=[];return}this.folders=(e.folders||[]).map(r=>({name:r.name,path:r.path||r.name}))},error:e=>{console.error(e),this.folders=[]}})}createFolder(){let t=(this.newFolderName||"").trim();if(!t){m.default.fire("Error","Ingrese un nombre de carpeta v\xE1lido.","error");return}let e=`manuales_de_funciones/${t}`;this.OymService.CrearCarpetaMPPs({subpath:e}).subscribe({next:r=>{r&&r.success?(m.default.fire("\xA1\xC9xito!","Carpeta creada correctamente","success"),this.newFolderName="",this.loadFolders()):m.default.fire("Error",r?.message||"No se pudo crear la carpeta","error")},error:r=>{console.error(r);let i=r?.error?.message||"Error al crear carpeta";m.default.fire("Error",i,"error")}})}selectFolder(t){this.selectedFolder=t,this.selectedFolderName=t.split("/").pop()||t,this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(console.log("CargarCarpetaMPPs res: ",e),!e||!e.success){this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]});return}let r=(e.files||[]).map(i=>({id:i.path,name:i.name,path:i.path,version:i.version||"",title:i.title||i.name,size:i.size,modified:i.modified}));this.filesMap[t]=r,this.filesTableConfig=F(y({},this.filesTableConfig),{data:r})},error:e=>{console.error(e),m.default.fire("Error","No se pudo cargar la carpeta","error")}})}deleteFolder(t,e){t&&t.stopPropagation&&t.stopPropagation(),e&&m.default.fire({title:"\xBFEliminar carpeta?",html:`Eliminar carpeta "${e}"? Esta acci\xF3n tambi\xE9n eliminar\xE1 su contenido.`,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&this.OymService.EliminarCarpetaMPPs({subpath:e}).subscribe({next:i=>{i&&i.success?(m.default.fire("\xA1Eliminada!","Carpeta eliminada correctamente","success"),this.loadFolders(),this.selectedFolder===e&&(this.selectedFolder=null,this.selectedFolderName=null,this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]}))):m.default.fire("Error",i?.message||"No se pudo eliminar la carpeta","error")},error:i=>{console.error(i);let o=i?.error?.message||"Error al eliminar carpeta";m.default.fire("Error",o,"error")}})})}onCustomAction(t){if(!(!t||!t.action))switch(t.action){case"add_file":this.showAddFileModal();break;default:break}}showAddFileModal(){if(!this.selectedFolder){m.default.fire("Error","Selecciona una carpeta primero","error");return}m.default.fire({title:"Agregar Archivo",html:`
        <div class="mb-3">
          <label class="form-label">Archivo</label>
          <input id="swal-input-file" type="file" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Versi\xF3n</label>
          <input id="swal-input-version" class="form-control" placeholder="1.0">
        </div>
        <div class="mb-3">
          <label class="form-label">T\xEDtulo</label>
          <input id="swal-input-title" class="form-control" placeholder="Manual de Funciones v1">
        </div>
      `,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let t=document.getElementById("swal-input-file"),e=document.getElementById("swal-input-version").value,r=document.getElementById("swal-input-title").value;if(!t||!t.files||t.files.length===0)return m.default.showValidationMessage("Debes seleccionar un archivo"),!1;if(!e||!r)return m.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1;let i=t.files[0],a=(i.name||"file").replace(/\.[^/.]+$/,"");return{file:i,name:a,version:e,title:r}}}).then(t=>{if(t.isConfirmed&&t.value){let e=t.value,r=e.file,i={name:e.name,version:e.version,title:e.title},o=this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,o,i).subscribe({next:a=>{a&&a.success?(m.default.fire("\xA1\xC9xito!","Archivo guardado correctamente","success"),this.selectedFolder?this.selectFolder(this.selectedFolder):this.loadFolders("")):m.default.fire("Error",a&&a.message?a.message:"No se pudo guardar el archivo","error")},error:a=>{console.error(a),m.default.fire("Error","Error al subir archivo","error")}})}}).catch(t=>{console.error("Error leyendo archivo:",t),m.default.fire("Error","No se pudo leer el archivo","error")})}onFileTableAction(t){if(!t||!t.action_to_perform)return;let e=t.data;switch(t.action_to_perform){case"edit_file":this.editFile(e);break;case"delete_file":this.deleteFile(e);break;default:}}editFile(t){t&&m.default.fire({title:"Editar Archivo",html:`
      <div class="mb-3">
        <label class="form-label">Archivo (opcional, para reemplazar)</label>
        <input id="swal-input-file" type="file" class="form-control" />
      </div>
      <div class="mb-3">
        <label class="form-label">Versi\xF3n</label>
        <input id="swal-input-version" class="form-control" value="${t.version||""}" placeholder="1.0">
      </div>
      <div class="mb-3">
        <label class="form-label">T\xEDtulo</label>
        <input id="swal-input-title" class="form-control" value="${t.title||""}" placeholder="Manual de Funciones v1">
      </div>
    `,showCancelButton:!0,confirmButtonText:"Guardar cambios",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("swal-input-file"),r=document.getElementById("swal-input-version"),i=document.getElementById("swal-input-title"),o=(r?.value||"").trim(),a=(i?.value||"").trim(),S=e?.files&&e.files.length>0?e.files[0]:null;return!o||!a?(m.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1):{newFile:S,version:o,title:a}}}).then(e=>{if(!e.isConfirmed||!e.value)return;let{newFile:r,version:i,title:o}=e.value,a=(t.path||t.id||"").toString();if(!a){m.default.fire("Error","Ruta del archivo inv\xE1lida.","error");return}if(!r){this.OymService.EditarArchivoMPPs(a,a,{name:t.name,title:o,version:i}).subscribe({next:d=>{d&&d.success?(m.default.fire("\xA1\xC9xito!","Metadatos actualizados correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):m.default.fire("Error",d?.message||"No se pudo actualizar el archivo","error")},error:d=>{console.error(d);let g=d?.error?.message||"Error al actualizar archivo";m.default.fire("Error",g,"error")}});return}let J={name:(r.name||"file").replace(/\.[^/.]+$/,""),title:o,version:i},P=a.lastIndexOf("/"),K=P>=0?a.substring(0,P):this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,K,J).subscribe({next:d=>{if(!d||!d.success){m.default.fire("Error",d?.message||"No se pudo guardar el nuevo archivo","error");return}this.OymService.EliminarArchivoMPPs(a).subscribe({next:g=>{!g||!g.success?m.default.fire("Advertencia","Nuevo archivo guardado, pero no se pudo eliminar el anterior.","warning"):m.default.fire("\xA1\xC9xito!","Archivo actualizado correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)},error:g=>{console.error(g),m.default.fire("Advertencia","Nuevo archivo guardado, pero ocurri\xF3 un error al eliminar el anterior.","warning"),this.selectedFolder&&this.selectFolder(this.selectedFolder)}})},error:d=>{console.error(d);let g=d?.error?.message||"Error al subir el nuevo archivo";m.default.fire("Error",g,"error")}})})}deleteFile(t){t&&this.selectedFolder&&m.default.fire({title:"\xBFEliminar archivo?",html:`
        <div class="text-start">
          <p>\xBFEst\xE1s seguro de eliminar el siguiente archivo?</p>
          <ul class="list-unstyled">
            <li><strong>Nombre:</strong> ${t.name}</li>
            <li><strong>Versi\xF3n:</strong> ${t.version}</li>
            <li><strong>T\xEDtulo:</strong> ${t.title}</li>
          </ul>
          <p class="text-danger">Esta acci\xF3n no se puede deshacer.</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d"}).then(e=>{if(e.isConfirmed){let r=t.path||t.id||t.name;this.OymService.EliminarArchivoMPPs(r).subscribe({next:i=>{i&&i.success?(m.default.fire("\xA1Eliminado!","El archivo ha sido eliminado.","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):m.default.fire("Error",i&&i.message?i.message:"No se pudo eliminar archivo","error")},error:i=>{console.error(i),m.default.fire("Error","Error al eliminar archivo","error")}})}})}static \u0275fac=function(e){return new(e||n)(x(I),x(D),x(H))};static \u0275cmp=N({type:n,selectors:[["app-manuales_de_funciones"]],decls:25,vars:9,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-3"],[1,"col-md-6","mb-2"],[1,"input-group"],["type","text","placeholder","Nombre de la nueva carpeta",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-append","ms-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"col-md-4"],[1,"mb-3"],["class","p-3",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"col-md-8"],[4,"ngIf"],["class","p-3 text-muted",4,"ngIf"],[1,"p-3"],[1,"list-group"],["class","list-group-item d-flex justify-content-between align-items-center","style","cursor:pointer;",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between","align-items-center",2,"cursor","pointer",3,"click"],[1,"fa","fa-folder","me-2"],[1,"text-muted","small"],["type","button",1,"btn","btn-sm",3,"click"],[1,"fa","fa-trash"],[1,"text-primary"],[1,"p-3","text-muted"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","customButtons"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),k("ngModelChange",function(o){return V(r.newFolderName,o)||(r.newFolderName=o),o}),l(),s(8,"div",8)(9,"button",9),C("click",function(){return r.createFolder()}),h(10,"Crear carpeta"),l()()()()(),s(11,"div",10)(12,"div",1)(13,"div",11)(14,"div",12)(15,"h6"),h(16,"Carpetas"),l(),E(17,fe,2,0,"div",13)(18,ve,2,1,"ul",14),l()(),s(19,"div",15)(20,"div",12),E(21,ge,2,0,"h6",16)(22,be,4,1,"h6",16)(23,_e,2,0,"div",17)(24,Ce,2,7,"div",16),l()()()()()()()()),e&2&&(c(3),f("headerTitle","")("cardClass","mb-4"),c(4),O("ngModel",r.newFolderName),c(10),f("ngIf",r.folders.length===0),c(),f("ngIf",r.folders.length>0),c(3),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder),c(),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder))},dependencies:[R,z,$,G,L,j,W,q,U],encapsulation:2})};var u=Z(te());function ye(n,t){n&1&&(s(0,"div",18),h(1,"No hay carpetas."),l())}function Fe(n,t){if(n&1){let e=T();s(0,"li",21),C("click",function(){let i=b(e).$implicit,o=v(2);return _(o.selectFolder(i.path))}),s(1,"div"),w(2,"i",22),h(3),l(),s(4,"div",23),h(5),l(),s(6,"div")(7,"button",24),C("click",function(i){let o=b(e).$implicit,a=v(2);return _(a.deleteFolder(i,o.path))}),w(8,"i",25),l()()()}if(n&2){let e=t.$implicit,r=v(2);A("active",r.selectedFolder===e.path),c(3),M(" ",e.name," "),c(2),M("",(r.filesMap[e.path]==null?null:r.filesMap[e.path].length)||0," archivos")}}function xe(n,t){if(n&1&&(s(0,"ul",19),E(1,Fe,9,4,"li",20),l()),n&2){let e=v();c(),f("ngForOf",e.folders)}}function Ee(n,t){n&1&&(s(0,"h6"),h(1,"Archivos"),l())}function we(n,t){if(n&1&&(s(0,"h6"),h(1,"Archivos en: "),s(2,"small",26),h(3),l()()),n&2){let e=v();c(3),B(e.selectedFolderName)}}function Te(n,t){n&1&&(s(0,"div",27),h(1,"Selecciona una carpeta a la izquierda para ver su contenido."),l())}function Me(n,t){if(n&1){let e=T();s(0,"div")(1,"app-table",28),C("action",function(i){b(e);let o=v();return _(o.onFileTableAction(i))})("customAction",function(i){b(e);let o=v();return _(o.onCustomAction(i))}),l()()}if(n&2){let e=v();c(),f("hasCheckbox",!1)("tableConfig",e.filesTableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!1)("customButtons",e.customButtons)}}var X=class n{constructor(t,e,r){this.OymService=t;this.cdr=e;this.router=r}newFolderName="";folders=[];selectedFiles=[];selectedFolder=null;selectedFolderName=null;filesMap={};customButtons=[{label:"",action:"add_file",icon:"fa fa-plus",class:"btn btn-success",tooltip:"Agregar nuevo archivo"}];filesTableConfig={columns:[{title:"Nombre",field_value:"name",sort:!0},{title:"Version",field_value:"version",sort:!0},{title:"Titulo",field_value:"title",sort:!0}],row_action:[{label:"",action_to_perform:"edit_file",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Editar"},{label:"",action_to_perform:"delete_file",icon:"trash",type:"button",class:"btn btn-danger btn-sm",tooltip:"Eliminar"}],data:[]};ngOnInit(){this.loadFolders()}loadFolders(t="procedimientos"){this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(!e||!e.success){this.folders=[];return}this.folders=(e.folders||[]).map(r=>({name:r.name,path:r.path||r.name}))},error:e=>{console.error(e),this.folders=[]}})}createFolder(){let t=(this.newFolderName||"").trim();if(!t){u.default.fire("Error","Ingrese un nombre de carpeta v\xE1lido.","error");return}let e=`procedimientos/${t}`;this.OymService.CrearCarpetaMPPs({subpath:e}).subscribe({next:r=>{r&&r.success?(u.default.fire("\xA1\xC9xito!","Carpeta creada correctamente","success"),this.newFolderName="",this.loadFolders()):u.default.fire("Error",r?.message||"No se pudo crear la carpeta","error")},error:r=>{console.error(r);let i=r?.error?.message||"Error al crear carpeta";u.default.fire("Error",i,"error")}})}selectFolder(t){this.selectedFolder=t,this.selectedFolderName=t.split("/").pop()||t,this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(console.log("CargarCarpetaMPPs res: ",e),!e||!e.success){this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]});return}let r=(e.files||[]).map(i=>({id:i.path,name:i.name,path:i.path,version:i.version||"",title:i.title||i.name,size:i.size,modified:i.modified}));this.filesMap[t]=r,this.filesTableConfig=F(y({},this.filesTableConfig),{data:r})},error:e=>{console.error(e),u.default.fire("Error","No se pudo cargar la carpeta","error")}})}deleteFolder(t,e){t&&t.stopPropagation&&t.stopPropagation(),e&&u.default.fire({title:"\xBFEliminar carpeta?",html:`Eliminar carpeta "${e}"? Esta acci\xF3n tambi\xE9n eliminar\xE1 su contenido.`,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&this.OymService.EliminarCarpetaMPPs({subpath:e}).subscribe({next:i=>{i&&i.success?(u.default.fire("\xA1Eliminada!","Carpeta eliminada correctamente","success"),this.loadFolders(),this.selectedFolder===e&&(this.selectedFolder=null,this.selectedFolderName=null,this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]}))):u.default.fire("Error",i?.message||"No se pudo eliminar la carpeta","error")},error:i=>{console.error(i);let o=i?.error?.message||"Error al eliminar carpeta";u.default.fire("Error",o,"error")}})})}onCustomAction(t){if(!(!t||!t.action))switch(t.action){case"add_file":this.showAddFileModal();break;default:break}}showAddFileModal(){if(!this.selectedFolder){u.default.fire("Error","Selecciona una carpeta primero","error");return}u.default.fire({title:"Agregar Archivo",html:`
        <div class="mb-3">
          <label class="form-label">Archivo</label>
          <input id="swal-input-file" type="file" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Versi\xF3n</label>
          <input id="swal-input-version" class="form-control" placeholder="1.0">
        </div>
        <div class="mb-3">
          <label class="form-label">T\xEDtulo</label>
          <input id="swal-input-title" class="form-control" placeholder="Procedimiento v1">
        </div>
      `,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let t=document.getElementById("swal-input-file"),e=document.getElementById("swal-input-version").value,r=document.getElementById("swal-input-title").value;if(!t||!t.files||t.files.length===0)return u.default.showValidationMessage("Debes seleccionar un archivo"),!1;if(!e||!r)return u.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1;let i=t.files[0],a=(i.name||"file").replace(/\.[^/.]+$/,"");return{file:i,name:a,version:e,title:r}}}).then(t=>{if(t.isConfirmed&&t.value){let e=t.value,r=e.file,i={name:e.name,version:e.version,title:e.title},o=this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,o,i).subscribe({next:a=>{a&&a.success?(u.default.fire("\xA1\xC9xito!","Archivo guardado correctamente","success"),this.selectedFolder?this.selectFolder(this.selectedFolder):this.loadFolders("")):u.default.fire("Error",a&&a.message?a.message:"No se pudo guardar el archivo","error")},error:a=>{console.error(a),u.default.fire("Error","Error al subir archivo","error")}})}}).catch(t=>{console.error("Error leyendo archivo:",t),u.default.fire("Error","No se pudo leer el archivo","error")})}onFileTableAction(t){if(!t||!t.action_to_perform)return;let e=t.data;switch(t.action_to_perform){case"edit_file":this.editFile(e);break;case"delete_file":this.deleteFile(e);break;default:}}editFile(t){t&&u.default.fire({title:"Editar Archivo",html:`
      <div class="mb-3">
        <label class="form-label">Archivo (opcional, para reemplazar)</label>
        <input id="swal-input-file" type="file" class="form-control" />
      </div>
      <div class="mb-3">
        <label class="form-label">Versi\xF3n</label>
        <input id="swal-input-version" class="form-control" value="${t.version||""}" placeholder="1.0">
      </div>
      <div class="mb-3">
        <label class="form-label">T\xEDtulo</label>
        <input id="swal-input-title" class="form-control" value="${t.title||""}" placeholder="Procedimiento v1">
      </div>
    `,showCancelButton:!0,confirmButtonText:"Guardar cambios",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("swal-input-file"),r=document.getElementById("swal-input-version"),i=document.getElementById("swal-input-title"),o=(r?.value||"").trim(),a=(i?.value||"").trim(),S=e?.files&&e.files.length>0?e.files[0]:null;return!o||!a?(u.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1):{newFile:S,version:o,title:a}}}).then(e=>{if(!e.isConfirmed||!e.value)return;let{newFile:r,version:i,title:o}=e.value,a=(t.path||t.id||"").toString();if(!a){u.default.fire("Error","Ruta del archivo inv\xE1lida.","error");return}if(!r){this.OymService.EditarArchivoMPPs(a,a,{name:t.name,title:o,version:i}).subscribe({next:d=>{d&&d.success?(u.default.fire("\xA1\xC9xito!","Metadatos actualizados correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):u.default.fire("Error",d?.message||"No se pudo actualizar el archivo","error")},error:d=>{console.error(d);let g=d?.error?.message||"Error al actualizar archivo";u.default.fire("Error",g,"error")}});return}let J={name:(r.name||"file").replace(/\.[^/.]+$/,""),title:o,version:i},P=a.lastIndexOf("/"),K=P>=0?a.substring(0,P):this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,K,J).subscribe({next:d=>{if(!d||!d.success){u.default.fire("Error",d?.message||"No se pudo guardar el nuevo archivo","error");return}this.OymService.EliminarArchivoMPPs(a).subscribe({next:g=>{!g||!g.success?u.default.fire("Advertencia","Nuevo archivo guardado, pero no se pudo eliminar el anterior.","warning"):u.default.fire("\xA1\xC9xito!","Archivo actualizado correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)},error:g=>{console.error(g),u.default.fire("Advertencia","Nuevo archivo guardado, pero ocurri\xF3 un error al eliminar el anterior.","warning"),this.selectedFolder&&this.selectFolder(this.selectedFolder)}})},error:d=>{console.error(d);let g=d?.error?.message||"Error al subir el nuevo archivo";u.default.fire("Error",g,"error")}})})}deleteFile(t){t&&this.selectedFolder&&u.default.fire({title:"\xBFEliminar archivo?",html:`
        <div class="text-start">
          <p>\xBFEst\xE1s seguro de eliminar el siguiente archivo?</p>
          <ul class="list-unstyled">
            <li><strong>Nombre:</strong> ${t.name}</li>
            <li><strong>Versi\xF3n:</strong> ${t.version}</li>
            <li><strong>T\xEDtulo:</strong> ${t.title}</li>
          </ul>
          <p class="text-danger">Esta acci\xF3n no se puede deshacer.</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d"}).then(e=>{if(e.isConfirmed){let r=t.path||t.id||t.name;this.OymService.EliminarArchivoMPPs(r).subscribe({next:i=>{i&&i.success?(u.default.fire("\xA1Eliminado!","El archivo ha sido eliminado.","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):u.default.fire("Error",i&&i.message?i.message:"No se pudo eliminar archivo","error")},error:i=>{console.error(i),u.default.fire("Error","Error al eliminar archivo","error")}})}})}static \u0275fac=function(e){return new(e||n)(x(I),x(D),x(H))};static \u0275cmp=N({type:n,selectors:[["app-procedimientos"]],decls:25,vars:9,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-3"],[1,"col-md-6","mb-2"],[1,"input-group"],["type","text","placeholder","Nombre de la nueva carpeta",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-append","ms-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"col-md-4"],[1,"mb-3"],["class","p-3",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"col-md-8"],[4,"ngIf"],["class","p-3 text-muted",4,"ngIf"],[1,"p-3"],[1,"list-group"],["class","list-group-item d-flex justify-content-between align-items-center","style","cursor:pointer;",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between","align-items-center",2,"cursor","pointer",3,"click"],[1,"fa","fa-folder","me-2"],[1,"text-muted","small"],["type","button",1,"btn","btn-sm",3,"click"],[1,"fa","fa-trash"],[1,"text-primary"],[1,"p-3","text-muted"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","customButtons"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),k("ngModelChange",function(o){return V(r.newFolderName,o)||(r.newFolderName=o),o}),l(),s(8,"div",8)(9,"button",9),C("click",function(){return r.createFolder()}),h(10,"Crear carpeta"),l()()()()(),s(11,"div",10)(12,"div",1)(13,"div",11)(14,"div",12)(15,"h6"),h(16,"Carpetas"),l(),E(17,ye,2,0,"div",13)(18,xe,2,1,"ul",14),l()(),s(19,"div",15)(20,"div",12),E(21,Ee,2,0,"h6",16)(22,we,4,1,"h6",16)(23,Te,2,0,"div",17)(24,Me,2,7,"div",16),l()()()()()()()()),e&2&&(c(3),f("headerTitle","")("cardClass","mb-4"),c(4),O("ngModel",r.newFolderName),c(10),f("ngIf",r.folders.length===0),c(),f("ngIf",r.folders.length>0),c(3),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder),c(),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder))},dependencies:[R,z,$,G,L,j,W,q,U],encapsulation:2})};var p=Z(te());function Se(n,t){n&1&&(s(0,"div",18),h(1,"No hay carpetas."),l())}function Pe(n,t){if(n&1){let e=T();s(0,"li",21),C("click",function(){let i=b(e).$implicit,o=v(2);return _(o.selectFolder(i.path))}),s(1,"div"),w(2,"i",22),h(3),l(),s(4,"div",23),h(5),l(),s(6,"div")(7,"button",24),C("click",function(i){let o=b(e).$implicit,a=v(2);return _(a.deleteFolder(i,o.path))}),w(8,"i",25),l()()()}if(n&2){let e=t.$implicit,r=v(2);A("active",r.selectedFolder===e.path),c(3),M(" ",e.name," "),c(2),M("",(r.filesMap[e.path]==null?null:r.filesMap[e.path].length)||0," archivos")}}function Ie(n,t){if(n&1&&(s(0,"ul",19),E(1,Pe,9,4,"li",20),l()),n&2){let e=v();c(),f("ngForOf",e.folders)}}function Ne(n,t){n&1&&(s(0,"h6"),h(1,"Archivos"),l())}function Ae(n,t){if(n&1&&(s(0,"h6"),h(1,"Archivos en: "),s(2,"small",26),h(3),l()()),n&2){let e=v();c(3),B(e.selectedFolderName)}}function Be(n,t){n&1&&(s(0,"div",27),h(1,"Selecciona una carpeta a la izquierda para ver su contenido."),l())}function Oe(n,t){if(n&1){let e=T();s(0,"div")(1,"app-table",28),C("action",function(i){b(e);let o=v();return _(o.onFileTableAction(i))})("customAction",function(i){b(e);let o=v();return _(o.onCustomAction(i))}),l()()}if(n&2){let e=v();c(),f("hasCheckbox",!1)("tableConfig",e.filesTableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!1)("customButtons",e.customButtons)}}var Y=class n{constructor(t,e,r){this.OymService=t;this.cdr=e;this.router=r}newFolderName="";folders=[];selectedFiles=[];selectedFolder=null;selectedFolderName=null;filesMap={};customButtons=[{label:"",action:"add_file",icon:"fa fa-plus",class:"btn btn-success",tooltip:"Agregar nuevo archivo"}];filesTableConfig={columns:[{title:"Nombre",field_value:"name",sort:!0},{title:"Version",field_value:"version",sort:!0},{title:"Titulo",field_value:"title",sort:!0}],row_action:[{label:"",action_to_perform:"edit_file",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Editar"},{label:"",action_to_perform:"delete_file",icon:"trash",type:"button",class:"btn btn-danger btn-sm",tooltip:"Eliminar"}],data:[]};ngOnInit(){this.loadFolders()}loadFolders(t="politicas"){this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(!e||!e.success){this.folders=[];return}this.folders=(e.folders||[]).map(r=>({name:r.name,path:r.path||r.name}))},error:e=>{console.error(e),this.folders=[]}})}createFolder(){let t=(this.newFolderName||"").trim();if(!t){p.default.fire("Error","Ingrese un nombre de carpeta v\xE1lido.","error");return}let e=`politicas/${t}`;this.OymService.CrearCarpetaMPPs({subpath:e}).subscribe({next:r=>{r&&r.success?(p.default.fire("\xA1\xC9xito!","Carpeta creada correctamente","success"),this.newFolderName="",this.loadFolders()):p.default.fire("Error",r?.message||"No se pudo crear la carpeta","error")},error:r=>{console.error(r);let i=r?.error?.message||"Error al crear carpeta";p.default.fire("Error",i,"error")}})}selectFolder(t){this.selectedFolder=t,this.selectedFolderName=t.split("/").pop()||t,this.OymService.CargarCarpetaMPPs({subpath:t}).subscribe({next:e=>{if(console.log("CargarCarpetaMPPs res: ",e),!e||!e.success){this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]});return}let r=(e.files||[]).map(i=>({id:i.path,name:i.name,path:i.path,version:i.version||"",title:i.title||i.name,size:i.size,modified:i.modified}));this.filesMap[t]=r,this.filesTableConfig=F(y({},this.filesTableConfig),{data:r})},error:e=>{console.error(e),p.default.fire("Error","No se pudo cargar la carpeta","error")}})}deleteFolder(t,e){t&&t.stopPropagation&&t.stopPropagation(),e&&p.default.fire({title:"\xBFEliminar carpeta?",html:`Eliminar carpeta "${e}"? Esta acci\xF3n tambi\xE9n eliminar\xE1 su contenido.`,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&this.OymService.EliminarCarpetaMPPs({subpath:e}).subscribe({next:i=>{i&&i.success?(p.default.fire("\xA1Eliminada!","Carpeta eliminada correctamente","success"),this.loadFolders(),this.selectedFolder===e&&(this.selectedFolder=null,this.selectedFolderName=null,this.filesTableConfig=F(y({},this.filesTableConfig),{data:[]}))):p.default.fire("Error",i?.message||"No se pudo eliminar la carpeta","error")},error:i=>{console.error(i);let o=i?.error?.message||"Error al eliminar carpeta";p.default.fire("Error",o,"error")}})})}onCustomAction(t){if(!(!t||!t.action))switch(t.action){case"add_file":this.showAddFileModal();break;default:break}}showAddFileModal(){if(!this.selectedFolder){p.default.fire("Error","Selecciona una carpeta primero","error");return}p.default.fire({title:"Agregar Archivo",html:`
        <div class="mb-3">
          <label class="form-label">Archivo</label>
          <input id="swal-input-file" type="file" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Versi\xF3n</label>
          <input id="swal-input-version" class="form-control" placeholder="1.0">
        </div>
        <div class="mb-3">
          <label class="form-label">T\xEDtulo</label>
          <input id="swal-input-title" class="form-control" placeholder="Politicas v1">
        </div>
      `,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let t=document.getElementById("swal-input-file"),e=document.getElementById("swal-input-version").value,r=document.getElementById("swal-input-title").value;if(!t||!t.files||t.files.length===0)return p.default.showValidationMessage("Debes seleccionar un archivo"),!1;if(!e||!r)return p.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1;let i=t.files[0],a=(i.name||"file").replace(/\.[^/.]+$/,"");return{file:i,name:a,version:e,title:r}}}).then(t=>{if(t.isConfirmed&&t.value){let e=t.value,r=e.file,i={name:e.name,version:e.version,title:e.title},o=this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,o,i).subscribe({next:a=>{a&&a.success?(p.default.fire("\xA1\xC9xito!","Archivo guardado correctamente","success"),this.selectedFolder?this.selectFolder(this.selectedFolder):this.loadFolders("")):p.default.fire("Error",a&&a.message?a.message:"No se pudo guardar el archivo","error")},error:a=>{console.error(a),p.default.fire("Error","Error al subir archivo","error")}})}}).catch(t=>{console.error("Error leyendo archivo:",t),p.default.fire("Error","No se pudo leer el archivo","error")})}onFileTableAction(t){if(!t||!t.action_to_perform)return;let e=t.data;switch(t.action_to_perform){case"edit_file":this.editFile(e);break;case"delete_file":this.deleteFile(e);break;default:}}editFile(t){t&&p.default.fire({title:"Editar Archivo",html:`
      <div class="mb-3">
        <label class="form-label">Archivo (opcional, para reemplazar)</label>
        <input id="swal-input-file" type="file" class="form-control" />
      </div>
      <div class="mb-3">
        <label class="form-label">Versi\xF3n</label>
        <input id="swal-input-version" class="form-control" value="${t.version||""}" placeholder="1.0">
      </div>
      <div class="mb-3">
        <label class="form-label">T\xEDtulo</label>
        <input id="swal-input-title" class="form-control" value="${t.title||""}" placeholder="Politicas v1">
      </div>
    `,showCancelButton:!0,confirmButtonText:"Guardar cambios",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("swal-input-file"),r=document.getElementById("swal-input-version"),i=document.getElementById("swal-input-title"),o=(r?.value||"").trim(),a=(i?.value||"").trim(),S=e?.files&&e.files.length>0?e.files[0]:null;return!o||!a?(p.default.showValidationMessage("Versi\xF3n y T\xEDtulo son requeridos"),!1):{newFile:S,version:o,title:a}}}).then(e=>{if(!e.isConfirmed||!e.value)return;let{newFile:r,version:i,title:o}=e.value,a=(t.path||t.id||"").toString();if(!a){p.default.fire("Error","Ruta del archivo inv\xE1lida.","error");return}if(!r){this.OymService.EditarArchivoMPPs(a,a,{name:t.name,title:o,version:i}).subscribe({next:d=>{d&&d.success?(p.default.fire("\xA1\xC9xito!","Metadatos actualizados correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):p.default.fire("Error",d?.message||"No se pudo actualizar el archivo","error")},error:d=>{console.error(d);let g=d?.error?.message||"Error al actualizar archivo";p.default.fire("Error",g,"error")}});return}let J={name:(r.name||"file").replace(/\.[^/.]+$/,""),title:o,version:i},P=a.lastIndexOf("/"),K=P>=0?a.substring(0,P):this.selectedFolder||"";this.OymService.GuardarArchivoMPPs(r,K,J).subscribe({next:d=>{if(!d||!d.success){p.default.fire("Error",d?.message||"No se pudo guardar el nuevo archivo","error");return}this.OymService.EliminarArchivoMPPs(a).subscribe({next:g=>{!g||!g.success?p.default.fire("Advertencia","Nuevo archivo guardado, pero no se pudo eliminar el anterior.","warning"):p.default.fire("\xA1\xC9xito!","Archivo actualizado correctamente","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)},error:g=>{console.error(g),p.default.fire("Advertencia","Nuevo archivo guardado, pero ocurri\xF3 un error al eliminar el anterior.","warning"),this.selectedFolder&&this.selectFolder(this.selectedFolder)}})},error:d=>{console.error(d);let g=d?.error?.message||"Error al subir el nuevo archivo";p.default.fire("Error",g,"error")}})})}deleteFile(t){t&&this.selectedFolder&&p.default.fire({title:"\xBFEliminar archivo?",html:`
        <div class="text-start">
          <p>\xBFEst\xE1s seguro de eliminar el siguiente archivo?</p>
          <ul class="list-unstyled">
            <li><strong>Nombre:</strong> ${t.name}</li>
            <li><strong>Versi\xF3n:</strong> ${t.version}</li>
            <li><strong>T\xEDtulo:</strong> ${t.title}</li>
          </ul>
          <p class="text-danger">Esta acci\xF3n no se puede deshacer.</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d"}).then(e=>{if(e.isConfirmed){let r=t.path||t.id||t.name;this.OymService.EliminarArchivoMPPs(r).subscribe({next:i=>{i&&i.success?(p.default.fire("\xA1Eliminado!","El archivo ha sido eliminado.","success"),this.selectedFolder&&this.selectFolder(this.selectedFolder)):p.default.fire("Error",i&&i.message?i.message:"No se pudo eliminar archivo","error")},error:i=>{console.error(i),p.default.fire("Error","Error al eliminar archivo","error")}})}})}static \u0275fac=function(e){return new(e||n)(x(I),x(D),x(H))};static \u0275cmp=N({type:n,selectors:[["app-politicas"]],decls:25,vars:9,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-3"],[1,"col-md-6","mb-2"],[1,"input-group"],["type","text","placeholder","Nombre de la nueva carpeta",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-append","ms-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"col-md-4"],[1,"mb-3"],["class","p-3",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"col-md-8"],[4,"ngIf"],["class","p-3 text-muted",4,"ngIf"],[1,"p-3"],[1,"list-group"],["class","list-group-item d-flex justify-content-between align-items-center","style","cursor:pointer;",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between","align-items-center",2,"cursor","pointer",3,"click"],[1,"fa","fa-folder","me-2"],[1,"text-muted","small"],["type","button",1,"btn","btn-sm",3,"click"],[1,"fa","fa-trash"],[1,"text-primary"],[1,"p-3","text-muted"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","customButtons"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),k("ngModelChange",function(o){return V(r.newFolderName,o)||(r.newFolderName=o),o}),l(),s(8,"div",8)(9,"button",9),C("click",function(){return r.createFolder()}),h(10,"Crear carpeta"),l()()()()(),s(11,"div",10)(12,"div",1)(13,"div",11)(14,"div",12)(15,"h6"),h(16,"Carpetas"),l(),E(17,Se,2,0,"div",13)(18,Ie,2,1,"ul",14),l()(),s(19,"div",15)(20,"div",12),E(21,Ne,2,0,"h6",16)(22,Ae,4,1,"h6",16)(23,Be,2,0,"div",17)(24,Oe,2,7,"div",16),l()()()()()()()()),e&2&&(c(3),f("headerTitle","")("cardClass","mb-4"),c(4),O("ngModel",r.newFolderName),c(10),f("ngIf",r.folders.length===0),c(),f("ngIf",r.folders.length>0),c(3),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder),c(),f("ngIf",!r.selectedFolder),c(),f("ngIf",r.selectedFolder))},dependencies:[R,z,$,G,L,j,W,q,U],encapsulation:2})};var st=[{path:"mpps/manuales_de_funciones",component:Q,data:{title:"Manual de Funciones",breadcrumb:"Manual de Funciones"}},{path:"mpps/procedimientos",component:X,data:{title:"Procedimientos",breadcrumb:"Procedimientos"}},{path:"mpps/politicas",component:Y,data:{title:"Pol\xEDticas",breadcrumb:"Pol\xEDticas"}}];export{st as oymRoutes};
