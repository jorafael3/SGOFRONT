import{a as vt}from"./chunk-POMG26IM.js";import{c as Y,d as ut,e as mt,f as Ct,g as gt,n as bt,w as ht,z as ft}from"./chunk-3EDIKQYL.js";import{B as ct,I as dt,J as _t,O as pt,q as lt,t as rt,w as st}from"./chunk-4QEBWWP4.js";import{k as O,n as at,r as B,u as $}from"./chunk-3BZESKLL.js";import{Ab as N,Cb as b,Eb as x,Fb as R,Fc as ot,Gb as q,Hb as _,Jb as S,Kb as y,Lb as w,Mb as s,Nb as c,Ob as F,Sb as h,Yb as p,Zb as l,_a as L,ac as W,ca as H,db as r,e as St,gc as X,hc as d,ic as v,jb as P,jc as T,kc as K,lc as Q,mc as G,nc as J,oc as Z,pa as U,pb as M,pc as tt,qa as u,ra as m,rc as D,ub as g,vc as et,xc as nt,za as k,zc as it}from"./chunk-NIELWWGW.js";var wt=St(vt());var A=o=>({disabled:o}),Ft=o=>({active:o});function Vt(o,e){if(o&1&&(s(0,"p"),d(1),c()),o&2){let t=l();r(),Q("Showing ",t.paginate.total_items>0?t.paginate.start_index+1:0,"- ",t.paginate.total_items>0?t.paginate.end_index+1:0," of ",t.paginate.total_items>0?t.paginate.total_items:0," entries ")}}function Pt(o,e){if(o&1&&(s(0,"span",2)(1,"span",6),d(2),c()()),o&2){let t=l();r(2),T(" ",t.selectedItems," rows selected ")}}function It(o,e){if(o&1){let t=h();s(0,"li",4)(1,"a",5),p("click",function(){let i=u(t).$implicit,a=l();return m(a.pageSet(i))}),d(2),c()()}if(o&2){let t=e.$implicit,n=l();b("ngClass",D(2,Ft,n.paginate.current_page==t)),r(2),v(t)}}var j=class o{total;currentPage;pageSize;paginate={};paginateDetails;selectedItems;selectedRows;setPage=new k;pageSet(e){this.setPage.emit(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=M({type:o,selectors:[["app-pagination"]],inputs:{total:"total",currentPage:"currentPage",pageSize:"pageSize",paginate:"paginate",paginateDetails:"paginateDetails",selectedItems:"selectedItems",selectedRows:"selectedRows"},outputs:{setPage:"setPage"},decls:19,vars:14,consts:[[1,"bottom-info"],[1,"d-flex","cb-info"],[1,"select-info"],[1,"pagination","justify-content-center"],[1,"page-item",3,"ngClass"],["href","javascript:void(0)",1,"page-link",3,"click"],[1,"select-item"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1),g(2,Vt,2,3,"p")(3,Pt,3,1,"span",2),c(),s(4,"ul",3)(5,"li",4)(6,"a",5),p("click",function(){return n.pageSet(1)}),d(7," \xAB "),c()(),s(8,"li",4)(9,"a",5),p("click",function(){return n.pageSet(n.paginate.current_page-1)}),d(10," \u2039 "),c()(),y(11,It,3,4,"li",4,S),s(13,"li",4)(14,"a",5),p("click",function(){return n.pageSet(n.paginate.current_page+1)}),d(15," \u203A "),c()(),s(16,"li",4)(17,"a",5),p("click",function(){return n.pageSet(n.paginate.end_page)}),d(18," \xBB "),c()()()()),t&2&&(r(2),_(n.paginateDetails?2:-1),r(),_(n.selectedItems&&n.selectedRows?3:-1),r(2),b("ngClass",D(6,A,n.paginate.current_page===1)),r(3),b("ngClass",D(8,A,n.paginate.current_page===1)),r(3),w(n.paginate.pages),r(2),b("ngClass",D(10,A,n.paginate.current_page==n.paginate.total_pages)),r(3),b("ngClass",D(12,A,n.paginate.current_page==n.paginate.total_pages)))},dependencies:[$,O],encapsulation:2})};var z=class o{searchText="";getPager(e,t,n){let i=Number(Math.ceil(Number(e)/Number(n))),a=3;Number(t)<1?t=1:Number(t)>Number(i)&&(t=Number(i));let C,f;Number(i)<=Number(a)?(C=1,f=Number(i)):Number(t)<=Number(Math.floor(Number(a)/2))?(C=1,f=Number(a)):Number(t)>=Number(i)-Number(Math.floor(Number(a)/2))?(C=Number(i)-Number(a)+1,f=Number(i)):(C=Number(t)-Number(Math.floor(Number(a)/2)),f=Number(t)+Number(Math.floor(Number(a)/2)));let I=(Number(t)-1)*Number(n),V=Math.min(Number(I)+Number(n)-1,Number(e)-1),E=Array.from(Array(Number(f)+1-Number(C)).keys()).map(Tt=>Number(C)+Number(Tt));return{total_items:e,current_page:t,page_size:n,total_pages:i,start_page:C,end_page:f,start_index:I,end_index:V,pages:E}}static \u0275fac=function(t){return new(t||o)};static \u0275prov=H({token:o,factory:o.\u0275fac,providedIn:"root"})};var Mt=o=>({cursor:o}),Nt=o=>({background:o,cursor:"pointer"}),Rt=(o,e)=>e.action,Ot=(o,e)=>e.value;function Bt(o,e){if(o&1&&(s(0,"option",10),d(1),c()),o&2){let t=e.$implicit;b("value",t.value)("selected",t.selected),r(),v(t.title)}}function $t(o,e){if(o&1){let t=h();s(0,"select",9),p("change",function(i){u(t);let a=l(3);return m(a.handleSelect(i))}),y(1,Bt,2,3,"option",10,S),c()}if(o&2){let t=l(3);r(),w(t.pageSizeOptions)}}function At(o,e){if(o&1){let t=h();s(0,"span",18),p("mouseenter",function(){let i=u(t).$implicit,a=l(5);return m(a.hoveredDate=i)})("mouseleave",function(){u(t);let i=l(5);return m(i.hoveredDate=null)}),d(1),c()}if(o&2){let t=e.$implicit,n=e.focused,i=l(5);x("focused",n)("range",i.isRange(t))("faded",i.isHovered(t)||i.isInside(t)),r(),T(" ",t.day," ")}}function jt(o,e){if(o&1){let t=h();s(0,"ngb-datepicker",17,0),p("dateSelect",function(i){u(t);let a=l(4);return m(a.onDateSelection(i))}),c(),g(2,At,2,7,"ng-template",null,1,it)}if(o&2){let t=X(3);b("displayMonths",2)("dayTemplate",t)}}function zt(o,e){if(o&1){let t=h();s(0,"div")(1,"div",11)(2,"div",12)(3,"label",13),d(4,"Seleccione fechas"),c()(),s(5,"div",12)(6,"div",14)(7,"span",15),p("click",function(){u(t);let i=l(3);return m(i.handleDropdown())}),d(8),c(),s(9,"div",16)(10,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("today"))}),d(11,"Hoy"),c(),s(12,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("yesterday"))}),d(13,"Ayer"),c(),s(14,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("7_days"))}),d(15,"\xDAltimos 7 d\xEDas"),c(),s(16,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("30_days"))}),d(17,"\xDAltimos 30 d\xEDas"),c(),s(18,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("this_month"))}),d(19,"Este mes"),c(),s(20,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("last_month"))}),d(21,"\xDAltimo mes"),c(),s(22,"button",15),p("click",function(){u(t);let i=l(3);return m(i.handleDateFilter("custom"))}),d(23,"Rango personalizado"),c()()(),g(24,jt,4,2),c()()()}if(o&2){let t=l(3);r(8),v(t.selectedDate?t.selectedDate:"Seleccionar"),r(),x("range-option",t.dateDropdownOpen),r(),x("active",t.selectedValue=="today"),r(2),x("active",t.selectedValue=="yesterday"),r(2),x("active",t.selectedValue=="7_days"),r(2),x("active",t.selectedValue=="30_days"),r(2),x("active",t.selectedValue=="this_month"),r(2),x("active",t.selectedValue=="last_month"),r(2),x("active",t.selectedValue=="custom"),r(2),_(t.selectedValue==="custom"?24:-1)}}function Lt(o,e){if(o&1){let t=h();s(0,"div",8)(1,"label"),d(2,"Search: "),s(3,"input",19),Z("ngModelChange",function(i){u(t);let a=l(3);return J(a.searchText,i)||(a.searchText=i),m(i)}),p("keyup",function(){u(t);let i=l(3);return m(i.searchTerm(i.searchText))}),c()()()}if(o&2){let t=l(3);r(3),G("ngModel",t.searchText),b("placeholder",t.searchPlaceholder)}}function Yt(o,e){if(o&1&&(s(0,"div",2),g(1,$t,3,0,"select")(2,zt,25,18,"div")(3,Lt,4,2,"div",8),c()),o&2){let t=l(2);r(),_(t.showPaginate?1:-1),r(),_(t.dateFilter?2:-1),r(),_(t.search?3:-1)}}function Ht(o,e){if(o&1&&F(0,"i"),o&2){let t=l().$implicit;R(t.icon)}}function Ut(o,e){if(o&1){let t=h();s(0,"button",23),p("click",function(){let i=u(t).$implicit,a=l(3);return m(a.handleCustomAction(i.action))}),g(1,Ht,1,2,"i",24),s(2,"span"),d(3),c()()}if(o&2){let t=e.$implicit;R(t.class||"btn btn-outline-secondary"),b("title",t.tooltip||t.label),r(),_(t.icon?1:-1),r(2),v(t.label)}}function qt(o,e){o&1&&F(0,"div",22)}function Wt(o,e){if(o&1){let t=h();s(0,"button",30),p("click",function(){u(t);let i=l(4);return m(i.exportData("copy"))}),s(1,"span"),d(2,"Copy"),c()()}}function Xt(o,e){if(o&1){let t=h();s(0,"button",31),p("click",function(){u(t);let i=l(4);return m(i.exportData("csv"))}),s(1,"span"),d(2,"CSV"),c()()}}function Kt(o,e){if(o&1){let t=h();s(0,"button",32),p("click",function(){u(t);let i=l(4);return m(i.exportData("excel"))}),s(1,"span"),d(2,"Excel"),c()()}}function Qt(o,e){if(o&1){let t=h();s(0,"button",33),p("click",function(){u(t);let i=l(4);return m(i.exportData("pdf"))}),s(1,"span"),d(2,"PDF"),c()()}}function Gt(o,e){if(o&1){let t=h();s(0,"button",34),p("click",function(){u(t);let i=l(4);return m(i.exportData("print"))}),s(1,"span"),d(2,"Print"),c()()}}function Jt(o,e){if(o&1&&g(0,Wt,3,0,"button",25)(1,Xt,3,0,"button",26)(2,Kt,3,0,"button",27)(3,Qt,3,0,"button",28)(4,Gt,3,0,"button",29),o&2){let t=l(3);_(t.shouldShowButton("copy")?0:-1),r(),_(t.shouldShowButton("csv")?1:-1),r(),_(t.shouldShowButton("excel")?2:-1),r(),_(t.shouldShowButton("pdf")?3:-1),r(),_(t.shouldShowButton("print")?4:-1)}}function Zt(o,e){if(o&1&&(s(0,"div",3)(1,"div",20),y(2,Ut,4,5,"button",21,Rt),g(4,qt,1,0,"div",22)(5,Jt,5,5),c()()),o&2){let t=l(2);r(2),w(t.customButtons),r(2),_(t.customButtons.length>0&&t.downloadReports?4:-1),r(),_(t.downloadReports?5:-1)}}function te(o,e){if(o&1){let t=h();s(0,"th",35)(1,"input",36),p("change",function(i){u(t);let a=l(2);return m(a.checkUncheckAll(i))}),c()()}if(o&2){let t=l(2);x("selected-checkbox",t.selectedIds.length&&t.selectedIds.length!=t.tableConfig.data.length),r(),b("checked",t.tableConfig&&t.tableConfig.data.length&&t.selectedIds&&t.selectedIds.length==t.tableConfig.data.length||!1)}}function ee(o,e){o&1&&F(0,"th")}function ne(o,e){if(o&1){let t=h();s(0,"th",38),p("click",function(){u(t);let i=l(2).$implicit,a=l(2);return m(a.onSort(i.sortable_key?i.sortable_key:i.field_value))}),d(1),F(2,"span",39),c()}if(o&2){let t=l(2).$implicit,n=l(2);b("ngClass",n.sortable_key==(t.sortable_key?t.sortable_key:t.field_value)&&n.filter.sort=="asc"?"asc":n.sortable_key==(t.sortable_key?t.sortable_key:t.field_value)&&n.filter.sort=="desc"?"desc":""),r(),T(" ",t.title," ")}}function ie(o,e){if(o&1&&(s(0,"th"),d(1),c()),o&2){let t=l(2).$implicit;r(),T(" ",t.title," ")}}function oe(o,e){if(o&1&&g(0,ne,3,2,"th",37)(1,ie,2,1,"th"),o&2){let t=l().$implicit;_(t.sort?0:1)}}function ae(o,e){if(o&1&&g(0,oe,2,1),o&2){let t=e.$implicit;_(t.hide_column?-1:0)}}function le(o,e){o&1&&(s(0,"th"),d(1),c()),o&2&&(r(),v("Acciones"))}function re(o,e){if(o&1){let t=h();s(0,"td",35)(1,"input",43),p("click",function(i){return u(t),m(i.stopPropagation())})("change",function(i){u(t);let a=l(4);return m(a.onItemChecked(i))}),c()()}if(o&2){let t=l().$implicit,n=l(3);r(),b("value",n.getRowId(t))("checked",n.selectedIds&&n.selectedIds.includes(n.getRowId(t)+"")),N("data-id",n.getRowId(t))}}function se(o,e){if(o&1){let t=h();s(0,"td",40),p("click",function(){u(t);let i=l().$implicit,a=l(3);return m(a.openRowDetails(i.id))}),c()}if(o&2){let t=l().$implicit,n=l(3);b("ngStyle",D(1,Nt,"url(assets/images/"+(n.selectedOpenRows.includes(t.id)?"details_close":"details_open")+".png) no-repeat center center"))}}function ce(o,e){if(o&1&&(s(0,"td"),d(1),c()),o&2){let t=l(2).$implicit,n=l().$implicit;r(),K(" ",n[t.field_value]," ",t.type=="qty"?t.text?t.text:"QTY":t.type=="purchase"?"Purchases":""," ")}}function de(o,e){if(o&1&&(d(0),et(1,"number")),o&2){let t=l(3).$implicit,n=l().$implicit;T(" $",nt(1,1,n[t.field_value],"1.2-2")," ")}}function _e(o,e){if(o&1&&d(0),o&2){let t=l(3).$implicit,n=l().$implicit;T(" $",n[t.field_value]," ")}}function pe(o,e){if(o&1&&(s(0,"td",37),g(1,de,2,4)(2,_e,1,1),c()),o&2){let t=l(2).$implicit;b("ngClass",t.class?t.class:""),r(),_(t.decimal_number?1:2)}}function ue(o,e){if(o&1&&(s(0,"option",10),d(1),c()),o&2){let t=e.$implicit,n=l(3).$implicit,i=l().$implicit;b("value",t.value)("selected",i[n.field_value]===t.value),r(),T(" ",t.label," ")}}function me(o,e){if(o&1){let t=h();s(0,"td")(1,"select",45),p("change",function(i){u(t);let a=l(2).$implicit,C=l().$implicit,f=l(3);return m(f.onSelectChange(i,a,C))}),y(2,ue,2,3,"option",10,Ot),c()()}if(o&2){let t=l(2).$implicit,n=l().$implicit;r(),b("value",n[t.field_value]||""),r(),w(t.options)}}function Ce(o,e){if(o&1&&d(0),o&2){let t=l(3).$implicit;T(" ",t.text," ")}}function ge(o,e){if(o&1&&(s(0,"td",44),g(1,Ce,1,1),c()),o&2){let t=l(2).$implicit,n=l().$implicit;b("innerHTML",n[t.field_value],L),r(),_(t.text?1:-1)}}function be(o,e){if(o&1&&g(0,ce,2,2,"td")(1,pe,3,2,"td",37)(2,me,4,1,"td")(3,ge,2,2,"td",44),o&2){let t=l().$implicit;_(t.type=="qty"||t.type=="purchase"?0:t.type=="price"?1:t.type=="select"?2:3)}}function he(o,e){if(o&1&&g(0,be,4,1),o&2){let t=e.$implicit;_(t.hide_column?-1:0)}}function fe(o,e){if(o&1&&(F(0,"i"),d(1," \xA0 ")),o&2){let t=l().$implicit;q("fa-solid fa-",t.icon,"")}}function xe(o,e){if(o&1&&(s(0,"span"),d(1),c()),o&2){let t=l().$implicit;r(),v(t.label)}}function ye(o,e){if(o&1){let t=h();s(0,"button",48),p("click",function(i){let a=u(t).$implicit,C=l(2).$implicit;return l(3).handleAction(a,C),m(i.stopPropagation())}),s(1,"span"),g(2,fe,2,3)(3,xe,2,1,"span"),c()()}if(o&2){let t=e.$implicit;R(t.class),W("title",t.tooltip),r(2),_(t.icon?2:-1),r(),_(t.label?3:-1)}}function we(o,e){if(o&1&&(s(0,"td")(1,"div",46),y(2,ye,4,5,"button",47,S),c()()),o&2){let t=l(4);r(2),w(t.tableConfig.row_action)}}function Te(o,e){if(o&1&&(s(0,"tr")(1,"td"),d(2),c(),F(3,"td",44),c()),o&2){let t=e.$implicit,n=l(2).$implicit;r(2),v(t.title),r(),b("innerHTML",n[t.field_value],L)}}function Se(o,e){if(o&1&&(s(0,"tr",42)(1,"td",49)(2,"table",50)(3,"tbody"),y(4,Te,4,2,"tr",null,S),c()()()()),o&2){let t=l(4);r(4),w(t.tableConfig.columns)}}function ve(o,e){if(o&1){let t=h();s(0,"tr",40),p("click",function(){let i=u(t).$implicit,a=l(3);return m(a.selectedRows&&a.toggleRowSelection(i))}),g(1,re,2,3,"td",35)(2,se,1,3,"td",41),y(3,he,1,1,null,null,S),g(5,we,4,0,"td"),c(),g(6,Se,6,0,"tr",42)}if(o&2){let t=e.$implicit,n=l(3);x("selected",n.selectedRows&&n.selectedIds&&n.selectedIds.length&&n.selectedIds.includes(n.getRowId(t)+"")),b("ngStyle",D(7,Mt,n.selectedRows?"pointer":"default")),r(),_(n.hasCheckbox?1:-1),r(),_(n.rowDetails?2:-1),r(),w(n.tableConfig.columns),r(2),_(n.tableConfig.row_action?5:-1),r(),_(n.rowDetails&&n.selectedOpenRows.includes(t.id)?6:-1)}}function De(o,e){if(o&1&&(s(0,"tbody"),y(1,ve,7,9,null,null,S),c()),o&2){let t=l(2);r(),w(t.tableData)}}function ke(o,e){if(o&1&&(s(0,"tbody")(1,"tr")(2,"td",51),d(3,"No hay datos disponibles"),c()()()),o&2){let t=l(2);r(),N("data-dt-row",t.getColSpan()),r(),N("colspan",t.getColSpan())}}function Fe(o,e){if(o&1){let t=h();s(0,"app-pagination",52),p("setPage",function(i){u(t);let a=l(2);return m(a.setPage(i))}),c()}if(o&2){let t=l(2);b("total",t.tableConfig.data.length)("paginate",t.paginate)("paginateDetails",t.paginateDetails)("selectedRows",t.selectedRows)("selectedItems",t.selected.length)}}function Ve(o,e){if(o&1&&(g(0,Yt,4,3,"div",2)(1,Zt,6,2,"div",3),s(2,"table",4)(3,"thead",5)(4,"tr"),g(5,te,2,3,"th",6)(6,ee,1,0,"th"),y(7,ae,1,1,null,null,S),g(9,le,2,1,"th"),c()(),g(10,De,3,0,"tbody")(11,ke,4,2,"tbody"),c(),g(12,Fe,1,5,"app-pagination",7)),o&2){let t=l();_(t.search||t.dateFilter||t.showPaginate?0:-1),r(),_(t.downloadReports||t.customButtons.length>0?1:-1),r(),b("ngClass",t.tableClass),r(3),_(t.hasCheckbox?5:-1),r(),_(t.rowDetails?6:-1),r(),w(t.tableConfig.columns),r(2),_(t.tableConfig.row_action?9:-1),r(),_(t.tableData&&t.tableData.length?10:t.tableData.length?-1:11),r(2),_(t.tableConfig.data.length&&t.pagination?12:-1)}}var yt=class o{constructor(e,t,n,i,a){this.tableService=e;this.modal=t;this.calendar=n;this.formatter=i;this.cdr=a}selectValues={};tableConfig;hasCheckbox;pageSize=4;paginateDetails=!1;showPaginate=!1;tableClass;search=!0;pagination=!0;selectedRows=!1;rowDetails=!1;dateFilter=!1;initialDateFilter="";downloadReports=!1;searchPlaceholder="";showCopyButton=!0;showCsvButton=!0;showExcelButton=!0;showPdfButton=!0;showPrintButton=!0;exportButtons=[];customButtons=[];action=new k;customAction=new k;dateFilterChange=new k;selectedRowsChange=new k;tableData$;total$;selected=[];selectedIds=[];paginate;tableData;pageNo=1;sortValue="asc";sortable_key;searchText="";rowDetailOpen=!1;selectedOpenRows=[];dateDropdownOpen=!1;hoveredDate=null;fromDate;toDate;filter={search:"",sort:"asc",page:this.pageNo,pageSize:this.pageSize,date:{start_date:"",to_date:""}};pageSizeOptions=[{title:10,value:10},{title:15,value:15},{title:25,value:25},{title:50,value:50},{title:100,value:100}];selectedDate="";selectedValue="";shouldShowButton(e){if(this.exportButtons&&this.exportButtons.length>0)return this.exportButtons.includes(e);switch(e){case"copy":return this.showCopyButton;case"csv":return this.showCsvButton;case"excel":return this.showExcelButton;case"pdf":return this.showPdfButton;case"print":return this.showPrintButton;default:return!0}}handleCustomAction(e){this.customAction.emit({action:e,data:this.tableConfig.data})}ngOnChanges(e){if(e.pageSize&&(this.filter.pageSize=e.pageSize.currentValue,!this.pageSizeOptions.some(t=>t.value===this.filter.pageSize))){let t=this.pageSizeOptions.findIndex(i=>i.value>this.filter.pageSize),n={title:this.filter.pageSize,value:this.filter.pageSize,selected:!0};t===-1?this.pageSizeOptions.push(n):this.pageSizeOptions.splice(t,0,n)}if(e.initialDateFilter&&e.initialDateFilter.currentValue&&(this.selectedValue=e.initialDateFilter.currentValue,this.handleDateFilter(this.selectedValue)),e.tableConfig&&this.tableConfig?.data){if(this.selectedIds=[],this.selectedRows){let t=this.tableConfig.data.filter(n=>n&&(n.is_checked===!0||n.is_checked===1)).map(n=>String(this.getRowId(n))).filter(n=>n&&n!=="null");if(t&&t.length){this.selectedIds=Array.from(new Set(t)),this.tableConfig.data.forEach(i=>{let a=this.getRowId(i);i.is_checked=a!=null&&this.selectedIds.includes(String(a))});let n=this.tableConfig.data.filter(i=>{let a=this.getRowId(i);return a!=null&&this.selectedIds.includes(String(a))});setTimeout(()=>this.selectedRowsChange.emit(n))}}else this.tableConfig.data.forEach(t=>{t&&(t.is_checked=!1)}),setTimeout(()=>this.selectedRowsChange.emit([]));this.paginateData(),this.cdr.detectChanges()}e.pageNo&&this.paginateData()}isArray(e){return Array.isArray(e)}getNestedPropertyValue(e,t){if(!e)return"";let n=e.split("."),i=t;for(let a of n)if(i&&i.hasOwnProperty(a))i=i[a];else return"";return i}getColumnClass(e,t){for(let n in t)if(e.includes(n)){let i=t[n];e=e.replace(n,i)}return e}checkUncheckAll(e){let t=e?.target?.checked;this.tableConfig.data.forEach(n=>{n.is_checked=t,this.setSelectedItem(t,this.getRowId(n))})}onItemChecked(e){let t=e.target;this.setSelectedItem(t.checked,t.value)}getRowId(e){return e?e.CONSOLIDADO_ID??e.ACTIVIDAD_ID??e.id??e.ID??e.Id??e.key??null:null}toggleRowSelection(e){let t=this.getRowId(e);if(t==null)return;let n=this.selectedIds.includes(String(t));this.setSelectedItem(!n,t)}setSelectedItem(e,t){let n=t==null?"":String(t),i=this.selectedIds.indexOf(n);e?i===-1&&this.selectedIds.push(n):this.selectedIds=this.selectedIds.filter(C=>C!==n),this.tableConfig.data.forEach(C=>{let f=this.getRowId(C);C.is_checked=f!=null&&this.selectedIds.includes(String(f))});let a=this.tableConfig.data.filter(C=>{let f=this.getRowId(C);return f!=null&&this.selectedIds.includes(String(f))});this.selectedRowsChange.emit(a)}onSort(e){this.sortable_key=e,this.filter.page=1,this.filter.sort=="asc"?this.filter.sort="desc":this.filter.sort="asc",this.applyFilters()}paginateData(){this.tableConfig&&this.tableConfig.data&&this.applyFilters()}setPage(e){this.filter.page=e,this.paginateData()}searchTerm(e){this.filter.page=1,this.filter.search=e,this.applyFilters()}handleSelect(e){this.filter.pageSize=+e.target.value,this.applyFilters()}handleAction(e,t){e.action_to_perform=="delete"?e.modal?wt.default.fire({title:"Are you sure?",text:e.model_text?e.model_text:"Do you really want to delete the product?",imageUrl:"assets/images/gif/trash.gif",confirmButtonText:"Yes, delete it!",showCancelButton:!0,cancelButtonText:"Cancel",cancelButtonColor:"#FC4438"}).then(n=>{n.isConfirmed&&this.action.emit({action_to_perform:e.action_to_perform,data:t})}):this.action.emit({action_to_perform:e.action_to_perform,data:t}):this.action.emit({action_to_perform:e.action_to_perform,data:t})}openRowDetails(e){this.selectedOpenRows.indexOf(e)===-1?this.selectedOpenRows.push(e):this.selectedOpenRows=this.selectedOpenRows.filter(n=>n!==e)}getColSpan(){let e=this.tableConfig.columns.length,t=this.tableConfig.row_action?1:0,n=this.hasCheckbox?1:0,i=this.rowDetails?1:0;return e+t+n+i}handleDropdown(){this.dateDropdownOpen=!this.dateDropdownOpen}handleDateFilter(e){this.selectedValue=e;let t=new Date,n=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");if(this.selectedValue){if(this.selectedValue==="today")this.filter.date.start_date=n,this.filter.date.to_date=n;else if(this.selectedValue==="yesterday"){let i=new Date(t);i.setDate(t.getDate()-1),n=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0"),this.filter.date.start_date=n,this.filter.date.to_date=n}else if(this.selectedValue==="7_days"){let i=new Date(t);i.setDate(t.getDate()-7),n=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0"),this.filter.date.start_date=n,this.filter.date.to_date=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}else if(this.selectedValue==="30_days"){let i=new Date(t);i.setDate(t.getDate()-30),n=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0"),this.filter.date.start_date=n,this.filter.date.to_date=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}else if(this.selectedValue==="this_month"){let i=new Date(t.getFullYear(),t.getMonth(),1),a=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0"),C=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");this.filter.date.start_date=a,this.filter.date.to_date=C}else if(this.selectedValue==="last_month"){let i=new Date(t.getFullYear(),t.getMonth()-1,1),a=new Date(t.getFullYear(),t.getMonth(),0);n=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0"),this.filter.date.start_date=n,n=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0"),this.filter.date.to_date=n}}this.selectedDate=`${this.filter.date.start_date} - ${this.filter.date.to_date}`,this.dateDropdownOpen=!1,this.applyFilters(),console.log("Rango de fechas seleccionado:",this.selectedDate),this.dateFilterChange.emit(this.selectedValue)}onDateSelection(e){!this.fromDate||this.fromDate&&this.toDate?(this.fromDate=e,this.toDate=null):this.fromDate&&!this.toDate&&(e.after(this.fromDate)?(this.toDate=e,this.filter.date.start_date=`${this.fromDate.year}-${String(this.fromDate.month).padStart(2,"0")}-${String(this.fromDate.day).padStart(2,"0")}`,this.filter.date.to_date=`${this.toDate.year}-${String(this.toDate.month).padStart(2,"0")}-${String(this.toDate.day).padStart(2,"0")}`,this.selectedDate=`${this.filter.date.start_date} - ${this.filter.date.to_date}`):this.fromDate=e),this.fromDate&&this.toDate&&(this.selectedValue=""),this.applyFilters()}isHovered(e){return this.fromDate&&!this.toDate&&this.hoveredDate&&e.after(this.fromDate)&&e.before(this.hoveredDate)}isInside(e){return this.toDate&&e.after(this.fromDate)&&e.before(this.toDate)}isRange(e){return e.equals(this.fromDate)||this.toDate&&e.equals(this.toDate)||this.isInside(e)||this.isHovered(e)}validateInput(e,t){let n=this.formatter.parse(t);return n&&this.calendar.isValid(Y.from(n))?Y.from(n):e}applyFilters(){let e=[...this.tableConfig.data];this.filter.search.trim()!==""&&(e=e.filter(t=>Object.keys(t).some(n=>{let i=t[n];if(i==null)return!1;if(typeof i=="string"){if(i.toLowerCase().includes(this.filter.search.toLowerCase()))return!0}else if(typeof i=="number"){if(i.toString().includes(this.filter.search))return!0}else if(typeof i=="object")try{if(i.toString().toLowerCase().includes(this.filter.search.toLowerCase()))return!0}catch{return!1}return!1}))),this.filter.sort&&e.sort((t,n)=>{let i=t[this.sortable_key],a=n[this.sortable_key],C=V=>{if(typeof V=="string")return V;if(typeof V=="object"){let E=document.createElement("div");return E.innerHTML=V.toString(),E.textContent||E.innerText||""}return""},f=C(i),I=C(a);return(typeof i=="string"||typeof i=="object")&&(typeof a=="string"||typeof a=="object")?this.filter.sort==="asc"?f.localeCompare(I):I.localeCompare(f):typeof i=="number"&&typeof a=="number"?this.filter.sort==="asc"?i-a:a-i:0}),this.filter.date.start_date&&(e=e.filter(t=>{if(t&&t.date){let n=new Date(t.date),i=new Date(this.filter.date.start_date),a=this.filter.date.to_date?new Date(this.filter.date.to_date):null;if(i&&a)return n>=i&&n<=a;if(i)return n>=i;if(a)return n<=a}return!0})),this.paginate=this.tableService.getPager(e.length,this.filter.page,this.filter.pageSize),this.tableData=e.slice(this.paginate.start_index,this.paginate.end_index+1)}exportData(e){let t=this.getExportData();switch(e){case"copy":this.copyToClipboard(t);break;case"csv":this.exportToCSV(t);break;case"excel":this.exportToExcel(t);break;case"pdf":this.exportToPDF(t);break;case"print":this.printData(t);break}}getExportData(){let e=this.tableConfig.columns.filter(n=>!n.hide_column).map(n=>n.title),t=this.tableConfig.data.map(n=>this.tableConfig.columns.filter(i=>!i.hide_column).map(i=>{let a=n[i.field_value];return typeof a=="string"&&(a=a.replace(/<[^>]*>/g,"").trim()),a||""}));return{headers:e,rows:t}}copyToClipboard(e){let t=[e.headers,...e.rows].map(n=>n.join("	")).join(`
`);navigator.clipboard.writeText(t).then(()=>{alert("Datos copiados al portapapeles")})}exportToCSV(e){let t=[e.headers,...e.rows].map(C=>C.map(f=>`"${f}"`).join(",")).join(`
`),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),a=URL.createObjectURL(n);i.setAttribute("href",a),i.setAttribute("download","export.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}exportToExcel(e){try{let t=window.XLSX;if(t){let n=t.utils.aoa_to_sheet([e.headers,...e.rows]),i=t.utils.book_new();t.utils.book_append_sheet(i,n,"Sheet1"),t.writeFile(i,"export.xlsx")}else this.exportToCSV(e),alert("Excel no disponible, exportando como CSV")}catch{this.exportToCSV(e),alert("Error al exportar Excel, exportando como CSV")}}exportToPDF(e){try{let t=window.jspdf?.jsPDF;if(t){let n=new t;if(n.text("Reporte de Datos",20,20),n.autoTable)n.autoTable({head:[e.headers],body:e.rows,startY:30});else{let i=40;e.rows.forEach(a=>{n.text(a.join(" | "),20,i),i+=10})}n.save("export.pdf")}else alert("PDF no disponible, use otra opci\xF3n de exportaci\xF3n")}catch{alert("Error al exportar PDF")}}printData(e){let t=window.open("","","height=600,width=800");if(t){let n=`
        <html>
          <head>
            <title>Reporte</title>
            <style>
              table { border-collapse: collapse; width: 100%; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>Reporte de Datos</h2>
            <table>
              <thead>
                <tr>${e.headers.map(i=>`<th>${i}</th>`).join("")}</tr>
              </thead>
              <tbody>
                ${e.rows.map(i=>`<tr>${i.map(a=>`<td>${a}</td>`).join("")}</tr>`).join("")}
              </tbody>
            </table>
          </body>
        </html>
      `;t.document.write(n),t.document.close(),t.print()}}onSelectChange(e,t,n){let a=e.target.value;this.action.emit({action_to_perform:t.field_value+"_change",data:n,value:a})}static \u0275fac=function(t){return new(t||o)(P(z),P(bt),P(ut),P(Ct),P(ot))};static \u0275cmp=M({type:o,selectors:[["app-table"]],inputs:{tableConfig:"tableConfig",hasCheckbox:"hasCheckbox",pageSize:"pageSize",paginateDetails:"paginateDetails",showPaginate:"showPaginate",tableClass:"tableClass",search:"search",pagination:"pagination",selectedRows:"selectedRows",rowDetails:"rowDetails",dateFilter:"dateFilter",initialDateFilter:"initialDateFilter",downloadReports:"downloadReports",searchPlaceholder:"searchPlaceholder",showCopyButton:"showCopyButton",showCsvButton:"showCsvButton",showExcelButton:"showExcelButton",showPdfButton:"showPdfButton",showPrintButton:"showPrintButton",exportButtons:"exportButtons",customButtons:"customButtons"},outputs:{action:"action",customAction:"customAction",dateFilterChange:"dateFilterChange",selectedRowsChange:"selectedRowsChange"},features:[tt([B]),U],decls:1,vars:1,consts:[["dp",""],["t",""],[1,"top-body"],[1,"p-3"],[1,"table","table-hover",3,"ngClass"],[1,"bg-light"],[1,"datatable-checkbox",3,"selected-checkbox"],[3,"total","paginate","paginateDetails","selectedRows","selectedItems"],["id","basic-1_filter","search","",1,"dataTables_filter"],[3,"change"],[3,"value","selected"],[1,"row","align-items-center","g-1"],[1,"col-auto"],[1,"form-label"],["id","reportrange","readonly","readonly",1,"range-dropdown","flatpickr-input"],[3,"click"],["id","rangeButtons"],["outsideDays","hidden",3,"dateSelect","displayMonths","dayTemplate"],[1,"custom-day",3,"mouseenter","mouseleave"],["type","text","name","searchTerm",3,"ngModelChange","keyup","ngModel","placeholder"],[1,"dt-buttons","btn-group","flex-wrap"],["type","button",3,"class","title"],[1,"btn-separator","mx-2"],["type","button",3,"click","title"],[3,"class"],["type","button",1,"btn","buttons-copy","buttons-html5","btn-outline-primary"],["type","button",1,"btn","buttons-csv","buttons-html5","btn-outline-primary"],["type","button",1,"btn","buttons-excel","buttons-html5","btn-outline-primary"],["type","button",1,"btn","buttons-pdf","buttons-html5","btn-outline-primary"],["type","button",1,"btn","buttons-print","btn-outline-primary"],["type","button",1,"btn","buttons-copy","buttons-html5","btn-outline-primary",3,"click"],["type","button",1,"btn","buttons-csv","buttons-html5","btn-outline-primary",3,"click"],["type","button",1,"btn","buttons-excel","buttons-html5","btn-outline-primary",3,"click"],["type","button",1,"btn","buttons-pdf","buttons-html5","btn-outline-primary",3,"click"],["type","button",1,"btn","buttons-print","btn-outline-primary",3,"click"],[1,"datatable-checkbox"],["type","checkbox",1,"cb-select-checkbox",3,"change","checked"],[3,"ngClass"],[3,"click","ngClass"],[1,"cb-accending-decending"],[3,"click","ngStyle"],[3,"ngStyle"],["data-dt-row","8"],["type","checkbox",3,"click","change","value","checked"],[3,"innerHTML"],[1,"form-control","form-select",3,"change","value"],[1,"product-action","common-align","gap-2","justify-content-start"],[1,"btn-sm",3,"title","class"],[1,"btn-sm",3,"click","title"],["colspan","8"],["cellpadding","5","cellspacing","0","border","0",2,"padding-left","50px"],[1,"empty-data"],[3,"setPage","total","paginate","paginateDetails","selectedRows","selectedItems"]],template:function(t,n){t&1&&g(0,Ve,13,8),t&2&&_(n.tableConfig?0:-1)},dependencies:[$,O,at,B,ht,pt,dt,_t,rt,st,ct,lt,gt,mt,ft,j],styles:['@charset "UTF-8";.btn-separator[_ngcontent-%COMP%]{border-left:1px solid #dee2e6;height:32px;align-self:center}.dt-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:5px}.dt-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.table-actions-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;padding:15px 0;border-bottom:1px solid #e9ecef;background-color:#f8f9fa;border-radius:5px}.table-actions-section[_ngcontent-%COMP%]   .dt-buttons[_ngcontent-%COMP%]{gap:5px;flex-wrap:wrap}.table-actions-section[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:5px}@media (max-width: 768px){.table-actions-section[_ngcontent-%COMP%]{justify-content:center}.table-actions-section[_ngcontent-%COMP%]   .dt-buttons[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.table-actions-section[_ngcontent-%COMP%]   .dt-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:2px 0;width:100%;max-width:200px}.table-actions-section[_ngcontent-%COMP%]   .dt-buttons[_ngcontent-%COMP%]   .btn-separator[_ngcontent-%COMP%]{display:none}}.table-hover.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#dce6f0!important;color:inherit!important}']})};export{yt as a};
