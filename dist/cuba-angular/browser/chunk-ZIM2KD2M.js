import{a as Oe}from"./chunk-4DCX2U46.js";import{a as be}from"./chunk-POMG26IM.js";import{a as k}from"./chunk-JETGV2KU.js";import{a as X,b as Z}from"./chunk-3EDIKQYL.js";import{B as K,D as ae,E as Ee,H as ne,I as oe,J as re,O as N,c as H,d as J,l as Y,t as Q,w as q}from"./chunk-4QEBWWP4.js";import{k as ie,l as U,m as we,s as Te,u as R}from"./chunk-3BZESKLL.js";import{Cb as p,Eb as ye,Fc as G,Mb as a,Nb as i,Ob as y,Sb as M,Yb as _,Zb as m,a as B,b as F,ca as D,db as l,e as fe,ha as L,hc as r,ic as S,jb as O,jc as C,mc as g,nc as f,oc as b,pb as j,qa as d,ra as u,rc as te,ub as T,vc as z,xc as V}from"./chunk-NIELWWGW.js";var v=fe(be());var se=class c extends Z{endpoint=X.apiUrl+"/financiero/bancos/obligacionesbancarias/";constructor(n){super(n)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let n=localStorage.getItem("user")||"",e=null;try{n&&(e=JSON.parse(n))}catch{e=n}return e}headers=new H({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});BuscarProveedor(n){return n.userdata=this.getUserSessionData(),this.http.post(this.endpoint+"buscar_proveedor",n,{headers:this.headers})}CargarTiposObligaciones(){return this.http.post(this.endpoint+"Cargar_Tipos_Obligaciones",{headers:this.headers})}CalcularAmortizacion(n){return this.http.post(this.endpoint+"Calcular_Amortizacion",n,{headers:this.headers})}GuardarAmortizacion(n){return this.http.post(this.endpoint+"guardar_modelo_amortizacion",n,{headers:this.headers})}CargarAmortizacion(){return this.http.post(this.endpoint+"cargar_amortizaciones",{headers:this.headers})}GuardarReajuste(n){return this.http.post(this.endpoint+"guardar_reajuste",n,{headers:this.headers})}static \u0275fac=function(e){return new(e||c)(L(J))};static \u0275prov=D({token:c,factory:c.\u0275fac,providedIn:"root"})};function Ne(c,n){if(c&1&&(a(0,"option",49),r(1),i()),c&2){let e=n.$implicit;p("ngValue",e.id),l(),C(" ",e.nombre," ")}}function ke(c,n){if(c&1){let e=M();a(0,"div")(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"div",1)(6,"div",16)(7,"div",17)(8,"label",18),r(9,"Valor del pr\xE9stamo"),i(),a(10,"div",19)(11,"span",20),r(12,"$"),i(),a(13,"input",21),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumen())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.capital,t)||(s.form.capital=t),u(t)}),i()()(),a(14,"div",17)(15,"label",18),r(16,"Tasa nominal anual(T.N.A.)"),i(),a(17,"div",19)(18,"input",22),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumen())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tna,t)||(s.form.tna=t),u(t)}),i(),a(19,"span",20),r(20,"%"),i()()(),a(21,"div",17)(22,"label",18),r(23,"Plazo (cuotas)"),i(),a(24,"input",22),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumen())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.cuotas,t)||(s.form.cuotas=t),u(t)}),i()(),a(25,"div",17)(26,"label",18),r(27,"Fecha inicio"),i(),a(28,"input",23),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumen())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.fechaInicio,t)||(s.form.fechaInicio=t),u(t)}),i()(),a(29,"div",17)(30,"label",18),r(31,"Otros (Solca)"),i(),a(32,"div",19)(33,"span",20),r(34,"$"),i(),a(35,"input",24),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.otros,t)||(s.form.otros=t),u(t)}),i()()()(),a(36,"div",16)(37,"div",17)(38,"label",18),r(39,"Tasa Mensual:"),i(),a(40,"div",19)(41,"span",20),r(42,"%"),i(),a(43,"input",24),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tasaMensual,t)||(s.form.tasaMensual=t),u(t)}),i()()(),a(44,"div",17)(45,"label",18),r(46,"Cuota"),i(),a(47,"div",19)(48,"span",20),r(49,"%"),i(),y(50,"input",25),i()(),a(51,"div",17)(52,"label",26),r(53,"Sistema de amortizaci\xF3n"),i(),a(54,"div",9)(55,"input",27),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoAmortizacion,t)||(s.form.tipoAmortizacion=t),u(t)}),i(),a(56,"label",11),r(57,"Sistema Franc\xE9s (cuota fija)"),i()(),a(58,"div",9)(59,"input",28),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoAmortizacion,t)||(s.form.tipoAmortizacion=t),u(t)}),i(),a(60,"label",29),r(61,"Sistema Alem\xE1n"),i()()(),a(62,"div",17)(63,"label",18),r(64,"Referencia"),i(),a(65,"div",19)(66,"span",20),r(67,"#"),i(),a(68,"input",30),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.referencia,t)||(s.form.referencia=t),u(t)}),i()()(),a(69,"div",17)(70,"label",18),r(71,"Tipo de obligaci\xF3n"),i(),a(72,"select",31),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoObligacion,t)||(s.form.tipoObligacion=t),u(t)}),a(73,"option",32),r(74,"Seleccione"),i(),T(75,Ne,2,2,"option",33),i()(),a(76,"div",17)(77,"label",18),r(78,"Proveedor"),i(),a(79,"div",19)(80,"input",34),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.proveedor,t)||(s.form.proveedor=t),u(t)}),i(),a(81,"button",35),_("click",function(){d(e);let t=m(2);return u(t.abrirModalProveedor())}),r(82," Buscar "),i()()()()(),a(83,"div",36)(84,"button",37),_("click",function(){d(e);let t=m(2);return u(t.calcularAmortizacion())}),r(85," Calcular amortizaci\xF3n "),i()()()()(),a(86,"div",38)(87,"div",14)(88,"div",39)(89,"h5"),r(90,"Resumen"),i()(),a(91,"div",15)(92,"div",40)(93,"div",1)(94,"div",41)(95,"span",29),r(96,"Capital"),i(),a(97,"div",42),r(98),z(99,"currency"),i()(),a(100,"div",41)(101,"span",29),r(102,"Tasa"),i(),a(103,"div",42),r(104),i()(),a(105,"div",41)(106,"span",29),r(107,"Plazo"),i(),a(108,"div",42),r(109),i()(),a(110,"div",41)(111,"span",29),r(112,"Cuota"),i(),a(113,"div",43),r(114),z(115,"currency"),i()(),a(116,"div",41)(117,"span",29),r(118,"Total intereses"),i(),a(119,"div",44),r(120),z(121,"currency"),i()(),a(122,"div",41)(123,"span",29),r(124,"Total"),i(),a(125,"div",45),r(126),z(127,"currency"),i()(),a(128,"div",2)(129,"span",29),r(130,"Proveedor"),i(),a(131,"div",42),r(132),i()()()()()()()(),a(133,"div",46)(134,"div",39)(135,"h5"),r(136,"Tabla de Amortizaci\xF3n Compuesta"),i()(),a(137,"div")(138,"div",47)(139,"app-table",48),_("action",function(t){d(e);let s=m(2);return u(s.onListaAction(t))})("customAction",function(t){d(e);let s=m(2);return u(s.onAmortizacionAction(t))}),i()()()()()}if(c&2){let e=m(2);l(13),g("ngModel",e.form.capital),l(5),g("ngModel",e.form.tna),l(6),g("ngModel",e.form.cuotas),l(4),g("ngModel",e.form.fechaInicio),l(7),g("ngModel",e.form.otros),l(8),g("ngModel",e.form.tasaMensual),l(7),p("ngModel",e.form.cuotaFija),l(5),g("ngModel",e.form.tipoAmortizacion),p("value",1),l(4),g("ngModel",e.form.tipoAmortizacion),p("value",2),l(9),g("ngModel",e.form.referencia),l(4),g("ngModel",e.form.tipoObligacion),l(3),p("ngForOf",e.tiposObligaciones),l(5),g("ngModel",e.form.proveedor),l(18),C("",V(99,30,e.resumen.capital,"USD")," "),l(6),C("",e.resumen.tasa,"%"),l(5),C("",e.resumen.plazo," mensual"),l(5),S(V(115,33,e.resumen.cuota,"USD")),l(6),S(V(121,36,e.resumen.intereses,"USD")),l(6),S(V(127,39,e.resumen.total,"USD")),l(6),S(e.resumen.proveedor),l(7),p("hasCheckbox",!1)("tableConfig",e.amortizacionTableConfig)("pageSize",13)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",e.Buttons_Export)("customButtons",e.amortizacionButtons)}}function We(c,n){if(c&1&&(a(0,"option",49),r(1),i()),c&2){let e=n.$implicit;p("ngValue",e.id),l(),C(" ",e.nombre," ")}}function De(c,n){if(c&1){let e=M();a(0,"div")(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"div",1)(6,"div",16)(7,"div",17)(8,"label",18),r(9,"Valor del pr\xE9stamo"),i(),a(10,"div",19)(11,"span",20),r(12,"$"),i(),a(13,"input",21),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumenSimple())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.capital,t)||(s.form.capital=t),u(t)}),i()()(),a(14,"div",17)(15,"label",18),r(16,"Tasa nominal anual(T.N.A.)"),i(),a(17,"div",19)(18,"input",22),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumenSimple())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tna,t)||(s.form.tna=t),u(t)}),i(),a(19,"span",20),r(20,"%"),i()()(),a(21,"div",17)(22,"label",18),r(23,"Plazo (cuotas)"),i(),a(24,"input",22),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumenSimple())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.cuotas,t)||(s.form.cuotas=t),u(t)}),i()(),a(25,"div",17)(26,"label",18),r(27,"Fecha inicio"),i(),a(28,"input",23),_("input",function(){d(e);let t=m(2);return u(t.actualizarResumenSimple())}),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.fechaInicio,t)||(s.form.fechaInicio=t),u(t)}),i()()(),a(29,"div",16)(30,"div",17)(31,"label",26),r(32,"Sistema de amortizaci\xF3n"),i(),a(33,"div",9)(34,"input",27),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoAmortizacion,t)||(s.form.tipoAmortizacion=t),u(t)}),i(),a(35,"label",11),r(36,"Sistema Franc\xE9s (cuota fija)"),i()(),a(37,"div",9)(38,"input",28),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoAmortizacion,t)||(s.form.tipoAmortizacion=t),u(t)}),i(),a(39,"label",29),r(40,"Sistema Alem\xE1n"),i()()(),a(41,"div",17)(42,"label",18),r(43,"Referencia"),i(),a(44,"div",19)(45,"span",20),r(46,"#"),i(),a(47,"input",30),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.referencia,t)||(s.form.referencia=t),u(t)}),i()()(),a(48,"div",17)(49,"label",18),r(50,"Tipo de obligaci\xF3n"),i(),a(51,"select",31),b("ngModelChange",function(t){d(e);let s=m(2);return f(s.form.tipoObligacion,t)||(s.form.tipoObligacion=t),u(t)}),a(52,"option",32),r(53,"Seleccione"),i(),T(54,We,2,2,"option",33),i()()()(),a(55,"div",36)(56,"button",37),_("click",function(){d(e);let t=m(2);return u(t.calcularAmortizacion())}),r(57," Calcular amortizaci\xF3n "),i()()()()(),a(58,"div",38)(59,"div",14)(60,"div",39)(61,"h5"),r(62,"Resumen"),i()(),a(63,"div",15)(64,"div",40)(65,"div",1)(66,"div",41)(67,"span",29),r(68,"Capital"),i(),a(69,"div",42),r(70),z(71,"currency"),i()(),a(72,"div",41)(73,"span",29),r(74,"Tasa"),i(),a(75,"div",42),r(76),i()(),a(77,"div",41)(78,"span",29),r(79,"Plazo"),i(),a(80,"div",42),r(81),i()(),a(82,"div",41)(83,"span",29),r(84,"Provision"),i(),a(85,"div",43),r(86,"$ 0.00"),i()(),a(87,"div",41)(88,"span",29),r(89,"Interes Simple"),i(),a(90,"div",44),r(91),z(92,"currency"),i()(),a(93,"div",41)(94,"span",29),r(95,"Total"),i(),a(96,"div",45),r(97),z(98,"currency"),i()(),a(99,"div",2)(100,"span",29),r(101,"Proveedor"),i(),a(102,"div",42),r(103),i()()()()()()()(),a(104,"div",46)(105,"div",39)(106,"h5"),r(107,"Tabla de Amortizaci\xF3n Simple"),i()(),a(108,"div")(109,"div",47)(110,"app-table",48),_("action",function(t){d(e);let s=m(2);return u(s.onListaAction(t))})("customAction",function(t){d(e);let s=m(2);return u(s.onAmortizacionAction(t))}),i()()()()()}if(c&2){let e=m(2);l(13),g("ngModel",e.form.capital),l(5),g("ngModel",e.form.tna),l(6),g("ngModel",e.form.cuotas),l(4),g("ngModel",e.form.fechaInicio),l(6),g("ngModel",e.form.tipoAmortizacion),p("value",1),l(4),g("ngModel",e.form.tipoAmortizacion),p("value",2),l(9),g("ngModel",e.form.referencia),l(4),g("ngModel",e.form.tipoObligacion),l(3),p("ngForOf",e.tiposObligaciones),l(16),C("",V(71,25,e.resumen.capital,"USD")," "),l(6),C("",e.resumen.tasa,"%"),l(5),C("",e.resumen.plazo," mensual"),l(10),S(V(92,28,e.resumen.intereses,"USD")),l(6),S(V(98,31,e.resumen.total,"USD")),l(6),S(e.resumen.proveedor),l(7),p("hasCheckbox",!1)("tableConfig",e.amortizacionTableConfig)("pageSize",13)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",e.Buttons_Export)("customButtons",e.amortizacionButtons)}}function Le(c,n){if(c&1){let e=M();a(0,"div")(1,"div",8)(2,"div",9)(3,"input",10),b("ngModelChange",function(t){d(e);let s=m();return f(s.modoInteres,t)||(s.modoInteres=t),u(t)}),_("ngModelChange",function(){d(e);let t=m();return u(t.onModoInteresChange())}),i(),a(4,"label",11),r(5,"Interes Compuesto"),i()(),a(6,"div",9)(7,"input",10),b("ngModelChange",function(t){d(e);let s=m();return f(s.modoInteres,t)||(s.modoInteres=t),u(t)}),_("ngModelChange",function(){d(e);let t=m();return u(t.onModoInteresChange())}),i(),a(8,"label",11),r(9,"Interes Simple"),i()()(),T(10,ke,140,42,"div",7)(11,De,111,34,"div",7),i()}if(c&2){let e=m();l(3),p("value","compuesto"),g("ngModel",e.modoInteres),l(4),p("value","simple"),g("ngModel",e.modoInteres),l(3),p("ngIf",e.modoInteres==="compuesto"),l(),p("ngIf",e.modoInteres==="simple")}}function Ge(c,n){if(c&1){let e=M();a(0,"div")(1,"div",47)(2,"app-table",50),_("action",function(t){d(e);let s=m();return u(s.onListaAction(t))}),i()()()}if(c&2){let e=m();l(2),p("hasCheckbox",!1)("tableConfig",e.listaTableConfig)("pageSize",10)("selectedRows",!0)}}function Ue(c,n){if(c&1){let e=M();a(0,"div")(1,"div",51),_("click",function(){d(e);let t=m();return u(t.cerrarModalRecalculo())}),i(),a(2,"div",52)(3,"div",53)(4,"div",54)(5,"div",55)(6,"h5",56),r(7,"Reajuste de Amortizaci\xF3n"),i(),a(8,"button",57),_("click",function(){d(e);let t=m();return u(t.cerrarModalRecalculo())}),i()(),a(9,"div",58)(10,"div",59)(11,"div",38)(12,"div",60)(13,"div",1)(14,"div",41)(15,"span",61),r(16,"Valor del pr\xE9stamo:"),i(),a(17,"div",62),r(18),z(19,"currency"),i()(),a(20,"div",41)(21,"span",61),r(22,"Tasa nominal anual(T.N.A.):"),i(),a(23,"div",62),r(24),i()(),a(25,"div",41)(26,"span",61),r(27,"Cantidad de cuotas:"),i(),a(28,"div",62),r(29),i()(),a(30,"div",41)(31,"span",61),r(32,"Fecha Inicio pr\xE9stamo:"),i(),a(33,"div",62),r(34),i()(),a(35,"div",41)(36,"span",61),r(37,"Otros (Solca):"),i(),a(38,"div",62),r(39),z(40,"currency"),i()(),a(41,"div",41)(42,"span",61),r(43,"Tasa Mensual:"),i(),a(44,"div",62),r(45),i()(),a(46,"div",41)(47,"span",63),r(48,"Cuota Fija (Sistema Franc\xE9s):"),i(),a(49,"div",62),r(50),z(51,"currency"),i()(),a(52,"div",41)(53,"span",63),r(54,"Tipo de Amortizaci\xF3n:"),i(),a(55,"div",62),r(56),i()()()()(),a(57,"div",13)(58,"div",64)(59,"div",1)(60,"h5"),r(61,"Datos para el reajuste"),i(),a(62,"div",65)(63,"div",17)(64,"label",18),r(65,"Cuota para el reajuste:"),i(),a(66,"div",19)(67,"span",20),r(68,"#"),i(),a(69,"input",66),b("ngModelChange",function(t){d(e);let s=m();return f(s.reajusteForm.cuota,t)||(s.reajusteForm.cuota=t),u(t)}),_("input",function(){d(e);let t=m();return u(t.actualizarReajuste())}),i()()(),a(70,"div",17)(71,"label",18),r(72,"Saldo Capital al reajuste:"),i(),a(73,"div",19)(74,"span",20),r(75,"$"),i(),y(76,"input",25),i()(),a(77,"div",17)(78,"label",18),r(79,"Tasa Ajustada:"),i(),a(80,"div",19)(81,"input",66),b("ngModelChange",function(t){d(e);let s=m();return f(s.reajusteForm.tasa,t)||(s.reajusteForm.tasa=t),u(t)}),_("input",function(){d(e);let t=m();return u(t.actualizarReajuste())}),i(),a(82,"span",20),r(83,"%"),i()()(),a(84,"div",67)(85,"label",18),r(86,"Fecha pago:"),i(),a(87,"div",19),y(88,"input",68),i()(),a(89,"div",17)(90,"label",18),r(91,"N\xB0 Cuotas faltantes:"),i(),y(92,"input",25),i()(),a(93,"div",65)(94,"div",17)(95,"label",18),r(96,"Tasa Mensual:"),i(),a(97,"div",19),y(98,"input",25),a(99,"span",20),r(100,"%"),i()()(),a(101,"div",17)(102,"label",18),r(103,"Cuota Fija:"),i(),a(104,"div",19)(105,"span",20),r(106,"$"),i(),y(107,"input",25),i()()()(),a(108,"div",8)(109,"div",17)(110,"button",37),_("click",function(){d(e);let t=m();return u(t.calcularReajuste())}),r(111," Calcular "),y(112,"i",69),i()(),a(113,"div",17)(114,"button",70),_("click",function(){d(e);let t=m();return u(t.guardarRefinanciamiento())}),r(115,"Guardar "),y(116,"i",71),i()()()()()(),a(117,"div",47)(118,"app-table",72),_("action",function(t){d(e);let s=m();return u(s.onListaAction(t))})("customAction",function(t){d(e);let s=m();return u(s.onAmortizacionAction(t))}),i()()(),a(119,"div",73)(120,"button",74),_("click",function(){d(e);let t=m();return u(t.cerrarModalRecalculo())}),r(121," Cerrar "),i()()()()()()}if(c&2){let e=m();l(18),S(V(19,20,e.recalculoResumen.capital,"USD")),l(6),C("",e.recalculoResumen.tasa,"%"),l(5),S(e.recalculoResumen.plazo),l(5),S(e.recalculoResumen.fechaInicio),l(5),C("",V(40,23,e.recalculoResumen.otros,"USD")," "),l(6),C("",e.recalculoResumen.tasaMensual,"%"),l(5),S(V(51,26,e.recalculoResumen.cuotaFija,"USD")),l(6),S(e.recalculoResumen.tipoAmortizacion),l(13),g("ngModel",e.reajusteForm.cuota),l(7),p("ngModel",e.reajusteForm.saldoCapital),l(5),g("ngModel",e.reajusteForm.tasa),l(7),p("ngModel",e.reajusteForm.fechaPago),l(4),p("ngModel",e.reajusteForm.cuotasFaltantes),l(6),p("ngModel",e.reajusteForm.tasaMensual),l(9),p("ngModel",e.reajusteForm.cuotaFija),l(11),p("hasCheckbox",!1)("tableConfig",e.reajusteTableConfig)("pageSize",13)("paginateDetails",!0)("selectedRows",!0)}}function He(c,n){if(c&1){let e=M();a(0,"tr")(1,"td"),r(2),i(),a(3,"td"),r(4),i(),a(5,"td"),r(6),i(),a(7,"td")(8,"button",80),_("click",function(){let t=d(e).$implicit,s=m(2);return u(s.seleccionarProveedor(t))}),r(9," Seleccionar "),i()()()}if(c&2){let e=n.$implicit,o=n.index;l(2),S(o+1),l(2),S(e.Nombre),l(2),S(e.id)}}function Je(c,n){c&1&&(a(0,"tr")(1,"td",81),r(2," No se encontraron proveedores. "),i()())}function Ye(c,n){if(c&1){let e=M();a(0,"div")(1,"div",51),_("click",function(){d(e);let t=m();return u(t.cerrarModalProveedor())}),i(),a(2,"div",52)(3,"div",75)(4,"div",54)(5,"div",55)(6,"h5",56),r(7,"Seleccionar Proveedor"),i(),a(8,"button",57),_("click",function(){d(e);let t=m();return u(t.cerrarModalProveedor())}),i()(),a(9,"div",58)(10,"div",17)(11,"input",76),b("ngModelChange",function(t){d(e);let s=m();return f(s.filtroProveedor,t)||(s.filtroProveedor=t),u(t)}),i()(),a(12,"div",77)(13,"table",78)(14,"thead")(15,"tr")(16,"th"),r(17,"#"),i(),a(18,"th"),r(19,"Nombre"),i(),a(20,"th"),r(21,"Identificaci\xF3n"),i(),a(22,"th"),r(23,"Acci\xF3n"),i()()(),a(24,"tbody"),T(25,He,10,3,"tr",79)(26,Je,3,0,"tr",7),i()()()(),a(27,"div",73)(28,"button",74),_("click",function(){d(e);let t=m();return u(t.cerrarModalProveedor())}),r(29," Cerrar "),i()()()()()()}if(c&2){let e=m();l(11),g("ngModel",e.filtroProveedor),l(14),p("ngForOf",e.proveedoresFiltrados),l(),p("ngIf",e.proveedoresFiltrados.length===0)}}var le=class c{constructor(n,e,o){this.BancoService=n;this.cdr=e;this.router=o}sessionData=null;Usuarios_Datos=[];isLoading=!1;tiposObligaciones=[];listProveedores=[];showModalProveedor=!1;filtroProveedor="";amortizacionSeleccionada=null;activeTab="nueva";modoInteres="compuesto";form={capital:0,tna:0,cuotas:12,fechaInicio:"",otros:0,referencia:"",tipoAmortizacion:1,tipoObligacion:"",proveedor:"",proveedorId:"",tasaMensual:0,cuotaFija:0};resumen={capital:0,tasa:0,plazo:0,cuota:0,intereses:0,total:0,proveedor:""};showModalRecalculo=!1;recalculoResumen={capital:0,tasa:0,plazo:0,fechaInicio:"",otros:0,tasaMensual:0,cuotaFija:0,tipoAmortizacion:""};detalleRecalculo=[];reajusteForm={cuota:0,saldoCapital:0,tasa:0,fechaPago:"",cuotasFaltantes:0,tasaMensual:0,cuotaFija:0};Buttons_Export=["excel"];listaButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos"}];amortizacionButtons=[{label:"",action:"save",icon:"fa fa-save",class:"btn btn-success",tooltip:"Guardar"}];listaTableConfig={columns:[{title:"Amortizacion #",field_value:"id",sort:!0},{title:"Detalle",field_value:"detalle",sort:!0},{title:"Capital",field_value:"capital",sort:!0},{title:"Tasa",field_value:"tasa",sort:!0},{title:"Plazo",field_value:"plazo",sort:!0},{title:"Sistema",field_value:"sistema",sort:!0},{title:"Fecha de Creaci\xF3n",field_value:"creado_date",sort:!0}],row_action:[{label:"",action_to_perform:"edit",icon:"fa fa-edit",type:"button",class:"btn btn-primary btn-sm",tooltip:"Reajuste"}],data:[]};amortizacionTableConfig={columns:[{title:"N\xB0 de Cuota",field_value:"cuota",sort:!0},{title:"Fecha a Pagar",field_value:"fechaPago",sort:!0},{title:"Valor Capital",field_value:"pagoTotal",sort:!0},{title:"Interes del Per\xEDodo",field_value:"interes",sort:!0},{title:"Otros",field_value:"otros",sort:!0},{title:"Cuota (constante)",field_value:"abonoCapital",sort:!0},{title:"Saldo",field_value:"saldo",sort:!0}],data:[]};reajusteTableConfig={columns:[{title:"N\xB0 de Cuota",field_value:"cuota",sort:!0},{title:"Fecha a Pagar",field_value:"fechaPago",sort:!0},{title:"Valor Capital",field_value:"pagoTotal",sort:!0},{title:"Interes del Per\xEDodo",field_value:"interes",sort:!0},{title:"Otros",field_value:"otros",sort:!0},{title:"Cuota (constante)",field_value:"abonoCapital",sort:!0},{title:"Saldo",field_value:"saldo",sort:!0}],data:[]};ngOnInit(){this.form.fechaInicio=this.hoy(),this.buscarProveedor(),this.cargarTiposObligaciones()}hoy(){return new Date().toISOString().split("T")[0]}actualizarResumen(){let n=Number(this.form.capital)||0,e=Number(this.form.tna)||0,o=Number(this.form.cuotas)||0;if(this.resumen.capital=n,this.resumen.tasa=e,this.resumen.plazo=o,this.form.otros=this.modoInteres==="compuesto"&&n>0?+(n*.005).toFixed(2):0,n>0&&e>0&&o>0){let t=e/o,s=t/100;this.form.tasaMensual=+t.toFixed(2);let A=this.calcularCuotaFrancesa(n,s,o);this.form.cuotaFija=+A.toFixed(2);let I=e/100/12,E=n*I/(1-Math.pow(1+I,-o)),P=E*o,x=P-n;this.resumen.cuota=E,this.resumen.intereses=x,this.resumen.total=P}else this.form.tasaMensual=0,this.form.cuotaFija=0,this.resumen.cuota=0,this.resumen.intereses=0,this.resumen.total=0}calcularCuotaFrancesa(n,e,o){let t=e,s=o,A=t*Math.pow(1+t,s),w=Math.pow(1+t,s)-1;return n*(A/w)}buscarProveedor(){this.BancoService.BuscarProveedor({nombre:""}).subscribe({next:n=>{n.success&&(this.listProveedores=n.data,console.log("Buscar Proveedor ",n.data))}})}cargarTiposObligaciones(){this.BancoService.CargarTiposObligaciones().subscribe({next:n=>{n.success&&(this.tiposObligaciones=n.data,console.log("Cargar Tipos Obligaciones ",this.tiposObligaciones))}})}calcularAmortizacion(){let n={capital:this.form.capital,tasa:this.form.tna,plazo:this.form.cuotas,tipo_pago:12,tipo_amortizacion:this.form.tipoAmortizacion,fecha_primer_pago:this.form.fechaInicio,otros:this.form.otros,tasaMensual:this.form.tasaMensual,cuotafija:this.form.cuotaFija};if(isNaN(this.form.capital)||isNaN(this.form.tna)||isNaN(this.form.cuotas)||this.form.capital<=0||this.form.tna<=0||this.form.cuotas<=0){v.default.fire("Error","Por favor ingrese valores num\xE9ricos v\xE1lidos mayores a cero","error");return}this.BancoService.CalcularAmortizacion(n).subscribe({next:e=>{if(!e.success){v.default.fire("Error","Ocurri\xF3 un error al calcular.","error");return}console.log("Calcular Amortizaci\xF3n ",e.data);let o={abonoCapital:"-",cuota:0,fechaPago:this.form.fechaInicio,interes:"-",otros:this.form.otros,pagoTotal:"-",saldo:this.form.capital};this.amortizacionTableConfig=F(B({},this.amortizacionTableConfig),{data:[o,...e.data]});let t=e.data.reduce((A,w)=>A+parseFloat(w.interes),0),s=e.data.reduce((A,w)=>A+parseFloat(w.pagoTotal),0);this.resumen={capital:this.form.capital,tasa:this.form.tna,plazo:this.form.cuotas,cuota:parseFloat(e.data[0].pagoTotal),intereses:t,total:s,proveedor:this.form.proveedor}}})}actualizarResumenSimple(){let n=Number(this.form.capital),e=Number(this.form.tna),o=Number(this.form.cuotas);if(this.resumen.capital=n,this.resumen.tasa=e,this.resumen.plazo=o,this.form.otros=0,this.form.tasaMensual=0,this.form.cuotaFija=0,n>0&&e>0&&o>0){let t=n*e*o/100;this.resumen.intereses=t,this.resumen.total=n+t,this.resumen.proveedor="",this.resumen.cuota=0}else this.form.tasaMensual=0,this.form.cuotaFija=0,this.resumen.cuota=0,this.resumen.intereses=0,this.resumen.total=0}guardarAmortizacion(){if(!this.amortizacionTableConfig.data||this.amortizacionTableConfig.data.length===0){v.default.fire("Error","Primero debe calcular una tabla de amortizaci\xF3n","error");return}if(this.modoInteres==="compuesto"&&this.form.proveedorId.length===0){v.default.fire("Error","Por favor seleccione un proveedor antes de guardar el modelo","error");return}v.default.fire({title:"Guardar Amortizaci\xF3n",input:"text",inputLabel:"Ingrese un nombre para la amortizaci\xF3n",inputPlaceholder:"Nombre de la amortizaci\xF3n",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",preConfirm:n=>(n||v.default.showValidationMessage("El nombre es obligatorio"),n)}).then(n=>{if(!n.isConfirmed)return;let e={nombre:n.value,capital:this.form.capital,tasa:this.form.tna,plazo:this.form.cuotas,tipo_pago:12,tipo_amortizacion:this.form.tipoAmortizacion,fecha_primer_pago:this.form.fechaInicio,tasaMensual:this.form.tasaMensual,otros:this.form.otros,cuotafija:this.form.cuotaFija,referencia:this.form.referencia,tipo_obligacion:this.form.tipoObligacion,proveedor:this.form.proveedorId,datos:this.amortizacionTableConfig.data};console.log("Params Guardar Amortizaci\xF3n ",e),this.BancoService.GuardarAmortizacion(e).subscribe({next:o=>{if(console.log("Guardar Amortizaci\xF3n ",o),!o.success){v.default.fire("Error","Ocurri\xF3 un error al Guardar.","error");return}v.default.fire("\xC9xito","Amortizaci\xF3n guardada correctamente.","success")}})})}cargarLista(){this.BancoService.CargarAmortizacion().subscribe({next:n=>{if(!n.success)return;let e=n.data.map(o=>F(B({},o),{sistema:o.tipo_amortizacion==1||o.tipo_amortizacion=="1"?"Franc\xE9s":"Alem\xE1n"}));this.listaTableConfig=F(B({},this.listaTableConfig),{data:e})}})}onListaAction(n){switch(n.action_to_perform){case"edit":let e=n.data;console.log("Reajustar Amortizaci\xF3n ",e),this.amortizacionSeleccionada=e,this.recalculoResumen={capital:parseFloat(e.capital??0),tasa:parseFloat(e.tasa??0),plazo:Number(e.plazo??e.cuotas??0),fechaInicio:e.fecha_inicio??e.fechaInicio??"",otros:parseFloat(e.otros_valores??0),tasaMensual:parseFloat(e.tasa_mensual??0),cuotaFija:parseFloat(e.cuota_fija??0),tipoAmortizacion:e.tipo_amortizacion??""};let o=(e.amortizacion_detalle??[]).map(t=>({cuota:Number(t.n_cuota),fechaPago:t.fecha_pago,abonoCapital:parseFloat(t.abono_capital),interes:parseFloat(t.interes),otros:parseFloat(t.otros),pagoTotal:parseFloat(t.cuota),saldo:parseFloat(t.saldo)}));this.detalleRecalculo=o,this.reajusteTableConfig=F(B({},this.reajusteTableConfig),{data:this.detalleRecalculo}),this.reajusteForm={cuota:0,saldoCapital:0,tasa:0,fechaPago:"",cuotasFaltantes:0,tasaMensual:0,cuotaFija:0},this.showModalRecalculo=!0;break;default:break}}onAmortizacionAction(n){switch(n.action){case"save":this.guardarAmortizacion();break;default:}}abrirModalProveedor(){this.showModalProveedor=!0,this.filtroProveedor=""}cerrarModalProveedor(){this.showModalProveedor=!1,this.filtroProveedor=""}cerrarModalRecalculo(){this.showModalRecalculo=!1}seleccionarProveedor(n){this.form.proveedor=n.Nombre,this.form.proveedorId=n.id,this.resumen.proveedor=n.Nombre,this.showModalProveedor=!1,this.filtroProveedor=""}get proveedoresFiltrados(){if(!this.filtroProveedor)return this.listProveedores;let n=this.filtroProveedor.toLowerCase();return this.listProveedores.filter(e=>(e.Nombre||"").toLowerCase().includes(n)||(e.id!==void 0?String(e.id).toLowerCase():"").includes(n))}onModoInteresChange(){this.limpiarFormularioYTabla()}limpiarFormularioYTabla(){this.form.capital=0,this.form.tna=0,this.form.cuotas=0,this.form.fechaInicio="",this.form.referencia="",this.form.tipoObligacion="",this.form.otros=0,this.form.tasaMensual=0,this.form.cuotaFija=0,this.form.proveedor="",this.form.proveedorId="",this.resumen={capital:0,tasa:0,plazo:0,cuota:0,intereses:0,total:0,proveedor:""},this.amortizacionTableConfig&&(this.amortizacionTableConfig=F(B({},this.amortizacionTableConfig),{data:[]})),this.amortizacionSeleccionada=null,this.detalleRecalculo=[],this.reajusteForm={cuota:0,saldoCapital:0,tasa:0,fechaPago:"",cuotasFaltantes:0,tasaMensual:0,cuotaFija:0},this.reajusteTableConfig=F(B({},this.reajusteTableConfig),{data:[]}),this.showModalRecalculo=!1}calcularReajuste(){let{cuota:n,saldoCapital:e,tasa:o,fechaPago:t,cuotasFaltantes:s,tasaMensual:A,cuotaFija:w}=this.reajusteForm;if(isNaN(e)||isNaN(o)||isNaN(s)||isNaN(w)||e<=0||o<=0||s<=0||w<=0){v.default.fire("Error","Por favor ingrese valores num\xE9ricos v\xE1lidos mayores a cero","error");return}if(!this.amortizacionSeleccionada){v.default.fire("Error","No se ha cargado la amortizaci\xF3n base para el reajuste","error");return}v.default.fire({title:"Calculando",html:"Generando tabla de amortizaci\xF3n reajustada...",allowOutsideClick:!1,didOpen:()=>{v.default.showLoading()}});let I=Number(this.amortizacionSeleccionada.tipo_pago??12),E=this.amortizacionSeleccionada.tipo_amortizacion??this.recalculoResumen.tipoAmortizacion??1;typeof E=="string"&&(isNaN(+E)?E=E.toLowerCase().startsWith("franc")?1:2:E=+E);let P=Number(E),x={capital:Number(e),tasa:Number(o),plazo:Number(s),tipo_pago:I,tipo_amortizacion:P,fecha_primer_pago:t,otros:0,tasaMensual:Number(A),cuotafija:Number(w)};console.log("Payload para recalculo:",x),this.BancoService.CalcularAmortizacion(x).subscribe({next:W=>{if(v.default.close(),!W.success){v.default.fire("Error",W.message||"Error al calcular la amortizaci\xF3n reajustada","error");return}let _e=Number(this.reajusteForm.cuota),Ce=this.amortizacionSeleccionada.amortizacion_detalle||[],xe={};Ce.forEach(h=>{xe[Number(h.n_cuota)]=h.ACR_ID||null});let Ve=Ce.filter(h=>Number(h.n_cuota)<=_e),Ae=(W.data||[]).map((h,ge)=>{let je=_e+ge+1;return{id:"",cabecera_id:this.amortizacionSeleccionada.id,n_cuota:String(_e+ge+1),fecha_pago:h.fechaPago,abono_capital:Number(h.abonoCapital).toFixed(4),interes:Number(h.interes).toFixed(4),cuota:Number(h.pagoTotal).toFixed(4),saldo:Number(h.saldo).toFixed(4),otros:Number(h.otros??0).toFixed(4),fila_reajuste:ge===0?"1":"0",ACR_ID:xe[je]||null}}),Se=[...Ve,...Ae],Ie={id:this.amortizacionSeleccionada.id,detalle:this.amortizacionSeleccionada.detalle,capital:x.capital,tasa:x.tasa,plazo:x.plazo,tipo_pago:I,tipo_amortizacion:P,creado_por:this.amortizacionSeleccionada.creado_por??"",creado_date:this.amortizacionSeleccionada.creado_date??"",otros_valores:0,cuota_fija:x.cuotafija,tasa_mensual:x.tasaMensual,fecha_inicio:x.fecha_primer_pago,amortizacion_detalle:Se};this.amortizacionSeleccionada=Ie,this.recalculoResumen.capital=x.capital,this.recalculoResumen.tasa=x.tasa,this.recalculoResumen.plazo=x.plazo,this.recalculoResumen.fechaInicio=x.fecha_primer_pago,this.recalculoResumen.otros=x.otros,this.recalculoResumen.tasaMensual=this.reajusteForm.tasaMensual,this.recalculoResumen.cuotaFija=this.reajusteForm.cuotaFija,this.recalculoResumen.tipoAmortizacion=P===1?"Franc\xE9s":"Alem\xE1n",this.detalleRecalculo=Se.map(h=>({cuota:Number(h.n_cuota),fechaPago:h.fecha_pago,abonoCapital:Number(h.abono_capital),interes:Number(h.interes),otros:Number(h.otros),pagoTotal:Number(h.cuota),saldo:Number(h.saldo)})),this.reajusteTableConfig=F(B({},this.reajusteTableConfig),{data:this.detalleRecalculo}),v.default.fire("\xC9xito","Amortizaci\xF3n reajustada calculada correctamente.","success")},error:W=>{v.default.close(),console.error(W),v.default.fire("Error","Ocurri\xF3 un error al calcular la amortizaci\xF3n reajustada","error")}})}actualizarReajuste(){let n=Number(this.reajusteForm.cuota)||0,e=Number(this.reajusteForm.tasa)||0,o=Number(this.recalculoResumen.plazo)||0;if(!n||n<=0||!o)this.reajusteForm.saldoCapital=0,this.reajusteForm.cuotasFaltantes=0,this.reajusteForm.fechaPago="";else{let P=this.detalleRecalculo.find(x=>Number(x.cuota)===n);P?(this.reajusteForm.saldoCapital=Number(P.saldo)||0,this.reajusteForm.fechaPago=P.fechaPago||P.fecha_pago||"",this.reajusteForm.cuotasFaltantes=Math.max(0,o-n)):(this.reajusteForm.saldoCapital=0,this.reajusteForm.cuotasFaltantes=0,this.reajusteForm.fechaPago="")}let t=Number(this.reajusteForm.saldoCapital),s=Number(this.reajusteForm.cuotasFaltantes);if(!e||e<=0||!s||s<=0||!t||t<=0){this.reajusteForm.tasaMensual=0,this.reajusteForm.cuotaFija=0;return}let w=e/100/12;this.reajusteForm.tasaMensual=+(w*100).toFixed(4);let I=w,E=t*I/(1-Math.pow(1+I,-s));this.reajusteForm.cuotaFija=+E.toFixed(2)}guardarRefinanciamiento(){if(!this.amortizacionSeleccionada){v.default.fire("Error","No hay datos de reajuste para guardar.","error");return}if(!this.reajusteForm.cuota||this.reajusteForm.cuota<=0){v.default.fire("Error","Debe seleccionar una cuota para el reajuste.","error");return}let n={ARRAY_DATOS_REAJUSTE:this.amortizacionSeleccionada,ARRAYCUOTASREAJUSTE:[Number(this.reajusteForm.cuota)]};console.log("param refinanciamiento: ",n),v.default.fire({title:"\xBFEst\xE1s seguro?",text:"No podr\xE1s revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, guardar cambios"}).then(e=>{e.isConfirmed&&this.BancoService.GuardarReajuste(n).subscribe({next:o=>{if(console.log("GuardarReajuste respuesta: ",o),!o.success){v.default.fire("Error",o.message||"Ocurri\xF3 un error al Guardar.","error");return}this.cargarLista(),v.default.fire("Guardado",o.message||"Refinanciamiento guardado correctamente.","success"),this.amortizacionSeleccionada=null,this.detalleRecalculo=[],this.reajusteForm={cuota:0,saldoCapital:0,tasa:0,fechaPago:"",cuotasFaltantes:0,tasaMensual:0,cuotaFija:0},this.reajusteTableConfig=F(B({},this.reajusteTableConfig),{data:[]}),this.showModalRecalculo=!1},error:o=>{console.error(o),v.default.fire("Error","Ocurri\xF3 un error al Guardar el refinanciamiento.","error")}})})}static \u0275fac=function(e){return new(e||c)(O(se),O(G),O(Y))};static \u0275cmp=j({type:c,selectors:[["app-obligaciones-bancarias"]],decls:15,vars:8,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"mb-4","text-muted"],[1,"d-flex","gap-2","mb-4"],[1,"btn",3,"click","ngClass"],[4,"ngIf"],[1,"d-flex","mb-3","gap-4"],[1,"form-check"],["type","radio","name","modo_interes",1,"form-check-input",3,"ngModelChange","value","ngModel"],[1,"fst-italic"],[1,"row","g-4"],[1,"col-md-7"],[1,"card","shadow-sm","border-0"],[1,"card-body"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],[1,"input-group"],[1,"input-group-text"],["type","number","value","0",1,"form-control",3,"input","ngModelChange","ngModel"],["type","number",1,"form-control",3,"input","ngModelChange","ngModel"],["type","date",1,"form-control",3,"input","ngModelChange","ngModel"],["type","number","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","number","disabled","",1,"form-control",3,"ngModel"],[1,"fw-semibold"],["checked","","type","radio",1,"form-check-input",3,"ngModelChange","ngModel","value"],["disabled","","type","radio",1,"form-check-input",3,"ngModelChange","ngModel","value"],[1,"text-muted"],["type","text","placeholder","xxxxxxxxxx",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","placeholder","Proveedor","readonly","",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary",3,"click"],[1,"mt-3"],[1,"btn","btn-primary",3,"click"],[1,"col-md-5"],[1,"card-header","bg-white","border-0"],[1,"p-4","rounded",2,"background","#e9fff1"],[1,"col-6","mb-3"],[1,"fw-bold","fs-5"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-danger","fs-5"],[1,"fw-bold","text-success","fs-5"],[1,"card","shadow-sm","border-0","mt-4"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons"],[3,"ngValue"],[3,"action","hasCheckbox","tableConfig","pageSize","selectedRows"],[1,"modal-backdrop","fade","show",3,"click"],["tabindex","-1",1,"modal","fade","show","d-block"],[1,"modal-dialog","modal-xl","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","mt-2"],[1,"bg-primary","p-3","rounded"],[1,"fs-6"],[1,"fs-4"],[1,"fw-bold","fs-6"],[1,"p-3","rounded"],[1,"col-6"],["type","number",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"mb-3","d-none"],["type","text","disabled","",1,"form-control",3,"ngModel"],[1,"bi","bi-cash-coin"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-floppy-fill"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],["type","text","placeholder","Buscar por nombre o identificaci\xF3n...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table-responsive"],[1,"table","table-hover","align-middle"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["colspan","4",1,"text-center","text-muted"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4),r(5," Ingrese los valores para calcular una tabla de amortizaci\xF3n "),i(),a(6,"div",5)(7,"button",6),_("click",function(){return o.activeTab="nueva"}),r(8,"Nueva Amortizaci\xF3n"),i(),a(9,"button",6),_("click",function(){return o.activeTab="lista",o.cargarLista()}),r(10,"Lista Amortizaciones"),i()(),T(11,Le,12,6,"div",7)(12,Ge,3,4,"div",7)(13,Ue,122,29,"div",7)(14,Ye,30,3,"div",7),i()()()()),e&2&&(l(3),p("headerTitle","Calculadora de Amortizaci\xF3n")("cardClass","mb-4"),l(4),p("ngClass",o.activeTab==="nueva"?"btn-primary":"btn-light"),l(2),p("ngClass",o.activeTab==="lista"?"btn-primary":"btn-light"),l(2),p("ngIf",o.activeTab==="nueva"),l(),p("ngIf",o.activeTab==="lista"),l(),p("ngIf",o.showModalRecalculo),l(),p("ngIf",o.showModalProveedor))},dependencies:[R,ie,U,we,Te,N,oe,re,Q,ae,ne,Ee,q,K,k,Oe],encapsulation:2})};var ee=fe(be());var ce=class c extends Z{endpoint=X.apiUrl+"/financiero/opciones/obligaciones/";constructor(n){super(n)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let n=localStorage.getItem("user")||"",e=null;try{n&&(e=JSON.parse(n))}catch{e=n}return e}headers=new H({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});CargarTiposObligaciones(n){return this.http.post(this.endpoint+"Cargar_Tipos_Obligaciones",n,{headers:this.headers})}CargarACCuentasGastos(n){return this.http.post(this.endpoint+"Cargar_ACC_CuentasGastos",n,{headers:this.headers})}Cargar_ACC_CuentasPasivos_Provision(n){return this.http.post(this.endpoint+"Cargar_ACC_CuentasPasivos_Provision",n,{headers:this.headers})}ActualizarCuentasObligaciones(n){return this.http.post(this.endpoint+"Actualizar_cuentas_obligaciones",n,{headers:this.headers})}BorrarTipoObligacion(n){return this.http.post(this.endpoint+"Borrar_Tipo_Obligacion",n,{headers:this.headers})}static \u0275fac=function(e){return new(e||c)(L(J))};static \u0275prov=D({token:c,factory:c.\u0275fac,providedIn:"root"})};function qe(c,n){if(c&1&&(a(0,"option",18),r(1),i()),c&2){let e=n.$implicit;p("value",e.ID),l(),C(" ",e.Nombre," ")}}function Ke(c,n){if(c&1&&(a(0,"option",18),r(1),i()),c&2){let e=n.$implicit;p("value",e.ID),l(),C(" ",e.Nombre," ")}}function Xe(c,n){if(c&1&&(a(0,"option",18),r(1),i()),c&2){let e=n.$implicit;p("value",e.ID),l(),C(" ",e.Nombre," ")}}function Ze(c,n){if(c&1){let e=M();a(0,"tr")(1,"td")(2,"input",13),b("ngModelChange",function(t){let s=d(e).$implicit;return f(s.nombre,t)||(s.nombre=t),u(t)}),i()(),a(3,"td")(4,"select",14),b("ngModelChange",function(t){let s=d(e).$implicit;return f(s.cuentaPasivo,t)||(s.cuentaPasivo=t),u(t)}),a(5,"option",15),r(6,"Seleccione"),i(),T(7,qe,2,2,"option",16),i()(),a(8,"td")(9,"select",14),b("ngModelChange",function(t){let s=d(e).$implicit;return f(s.cuentaGasto,t)||(s.cuentaGasto=t),u(t)}),a(10,"option",15),r(11,"Seleccione"),i(),T(12,Ke,2,2,"option",16),i()(),a(13,"td")(14,"select",14),b("ngModelChange",function(t){let s=d(e).$implicit;return f(s.cuentaProvision,t)||(s.cuentaProvision=t),u(t)}),a(15,"option",15),r(16,"Seleccione"),i(),T(17,Xe,2,2,"option",16),i()(),a(18,"td")(19,"button",17),_("click",function(){let t=d(e).$implicit,s=m();return u(s.borrarTipoObligacion(t))}),r(20," Borrar "),i()()()}if(c&2){let e=n.$implicit,o=m();l(2),g("ngModel",e.nombre),l(2),g("ngModel",e.cuentaPasivo),l(3),p("ngForOf",o.cuentasACPP),l(2),g("ngModel",e.cuentaGasto),l(3),p("ngForOf",o.cuentasACGastos),l(2),g("ngModel",e.cuentaProvision),l(3),p("ngForOf",o.cuentasACPP)}}var me=class c{constructor(n,e,o){this.service=n;this.cdr=e;this.router=o}tiposObligaciones=[];cuentasACPP=[];cuentasACGastos=[];cuentaGasto="";cuentaPasivo="";cuentaProvision="";ngOnInit(){this.cargarTiposObligaciones(),this.cargarACCuentasPP(),this.cargarACCuentasGastos()}cargarTiposObligaciones(){let n=[];this.service.CargarTiposObligaciones(n).subscribe({next:e=>{e.success&&(this.tiposObligaciones=e.data.map(o=>F(B({},o),{cuentaGasto:o.cuentaGasto||"",cuentaPasivo:o.cuentaPasivo||"",cuentaProvision:o.cuentaProvision||""})),console.log("Cargar Tipos Obligaciones ",this.tiposObligaciones))}})}cargarACCuentasPP(){let n=[];this.service.Cargar_ACC_CuentasPasivos_Provision(n).subscribe({next:e=>{e.success&&(this.cuentasACPP=e.data,console.log("Cargar ACCuentas Pasivos y Provisi\xF3n",this.cuentasACPP))}})}cargarACCuentasGastos(){let n=[];this.service.CargarACCuentasGastos(n).subscribe({next:e=>{e.success&&(this.cuentasACGastos=e.data,console.log("Cargar ACCuentas Gastos",this.cuentasACGastos))}})}guardarCuentasObligaciones(){let n=this.tiposObligaciones.map(e=>({id:e.id,nombre:e.nombre,cuenta:e.cuenta,estado:e.estado,cuentaGasto:e.cuentaGasto,cuentaPasivo:e.cuentaPasivo,cuentaProvision:e.cuentaProvision}));console.log("Payload a guardar:",n),this.service.ActualizarCuentasObligaciones(n).subscribe({next:e=>{if(console.log("Respuesta del servidor:",e),!e.success){ee.default.fire("Error","No se pudieron guardar las cuentas","error");return}ee.default.fire("Guardado","Cuentas actualizadas correctamente","success"),this.cargarTiposObligaciones()}})}agregarTipoObligacion(){this.tiposObligaciones.push({id:0,nombre:"",cuenta:"",estado:1,cuentaGasto:"",cuentaPasivo:"",cuentaProvision:""})}borrarTipoObligacion(n){ee.default.fire({title:"\xBFEst\xE1s seguro?"}).then(e=>{this.service.BorrarTipoObligacion({id:n.id}).subscribe({next:o=>{if(console.log("Respuesta del servidor:",o),!o.success){ee.default.fire("Error","No se pudieron guardar las cuentas","error");return}ee.default.fire("Eliminado","Cuentas desactivada correctamente","success"),this.cargarTiposObligaciones()}})})}static \u0275fac=function(e){return new(e||c)(O(ce),O(G),O(Y))};static \u0275cmp=j({type:c,selectors:[["app-obligaciones"]],decls:29,vars:3,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"mb-2","d-flex","justify-content-between","align-items-center"],[1,"fw-semibold"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"table-responsive"],[1,"table","table-bordered","align-middle"],[1,""],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"click"],["type","text ",1,"form-control","fw-semibold",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-danger","btn-sm",3,"click"],[3,"value"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"span",5),r(6,"Listado de tipos de obligaci\xF3n"),i(),a(7,"button",6),_("click",function(){return o.agregarTipoObligacion()}),r(8," + Agregar tipo de obligaci\xF3n "),i()(),a(9,"div",7)(10,"table",8)(11,"thead",9)(12,"tr")(13,"th"),r(14,"Nombre"),i(),a(15,"th",10),r(16,"Cuenta Pasivo"),i(),a(17,"th",10),r(18,"Cuenta Gasto"),i(),a(19,"th",10),r(20,"Cuenta Provisional"),i(),a(21,"th",10),r(22,"Borrar"),i()()(),a(23,"tbody"),T(24,Ze,21,7,"tr",11),i()(),y(25,"hr"),a(26,"button",12),_("click",function(){return o.guardarCuentasObligaciones()}),a(27,"span"),r(28,"Guardar cuentas"),i()()()()()()()),e&2&&(l(3),p("headerTitle","Tipos de Obligaci\xF3n")("cardClass","mb-4"),l(21),p("ngForOf",o.tiposObligaciones))},dependencies:[R,U,N,oe,re,Q,ne,q,K,k],encapsulation:2})};var ze=fe(be());var de=class c extends Z{endpoint=X.apiUrl+"/financiero/opciones/parametros/";constructor(n){super(n)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let n=localStorage.getItem("user")||"",e=null;try{n&&(e=JSON.parse(n))}catch{e=n}return e}headers=new H({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});Cargar_OPT_Param(){return this.http.post(this.endpoint+"Cargar_OPT_Param",{headers:this.headers})}Guardar_OPT_Param(n){return this.http.post(this.endpoint+"Guardar_OPT_Param",n,{headers:this.headers})}static \u0275fac=function(e){return new(e||c)(L(J))};static \u0275prov=D({token:c,factory:c.\u0275fac,providedIn:"root"})};var ue=class c{constructor(n,e,o){this.service=n;this.cdr=e;this.router=o}optParam={};ngOnInit(){this.cargarParam()}cargarParam(){this.service.Cargar_OPT_Param().subscribe({next:n=>{n.success&&(this.optParam=n.data[0]||{})}})}guardarParametros(){this.service.Guardar_OPT_Param(this.optParam).subscribe({next:n=>{n.success&&ze.default.fire("Guardado","Los par\xE1metros fueron actualizados","success")}})}static \u0275fac=function(e){return new(e||c)(O(de),O(G),O(Y))};static \u0275cmp=j({type:c,selectors:[["app-parametros"]],decls:14,vars:3,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],[1,"input-group"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-success",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"label",6),r(7,"Fecha"),i(),a(8,"div",7)(9,"input",8),b("ngModelChange",function(s){return f(o.optParam.fechaVencimientoCalcInt,s)||(o.optParam.fechaVencimientoCalcInt=s),s}),i()()(),a(10,"td")(11,"button",9),_("click",function(){return o.guardarParametros()}),a(12,"span"),r(13,"Guardar"),i()()()()()()()()),e&2&&(l(3),p("headerTitle","Par\xE1metros")("cardClass","mb-4"),l(6),g("ngModel",o.optParam.fechaVencimientoCalcInt))},dependencies:[R,N,Q,ae,q,K,k],encapsulation:2})};var he=c=>({"show active":c});function et(c,n){if(c&1){let e=M();a(0,"li",8)(1,"button",9),_("click",function(){let t=d(e).$implicit,s=m();return u(s.setTab(t.id))}),r(2),i()()}if(c&2){let e=n.$implicit,o=m();l(),ye("active",o.activeTab===e.id),l(),C(" ",e.label," ")}}var pe=class c{tabs=[{id:"obligaciones",label:"Obligaciones"},{id:"parametros",label:"Par\xE1metros"},{id:"otra",label:"Que otra opci\xF3n"}];activeTab="parametros";setTab(n){this.activeTab=n}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=j({type:c,selectors:[["app-opciones-bancarias"]],decls:14,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"nav","nav-tabs","mb-3"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-content"],[1,"tab-pane","fade",3,"ngClass"],[1,"nav-item"],[1,"nav-link",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"ul",4),T(5,et,3,3,"li",5),i(),a(6,"div",6)(7,"div",7),y(8,"app-obligaciones"),i(),a(9,"div",7),y(10,"app-parametros"),i(),a(11,"div",7)(12,"p"),r(13,"Contenido de la otra pesta\xF1a..."),i()()()()()()()),e&2&&(l(3),p("headerTitle","Opciones Bancarias")("cardClass","mb-4"),l(2),p("ngForOf",o.tabs),l(2),p("ngClass",te(6,he,o.activeTab==="obligaciones")),l(2),p("ngClass",te(8,he,o.activeTab==="parametros")),l(2),p("ngClass",te(10,he,o.activeTab==="otra")))},dependencies:[R,ie,U,N,k,me,ue],encapsulation:2})};var jt=[{path:"obligacionesbancarias",component:le,data:{title:"Obligaciones Bancarias",breadcrumb:"Obligaciones Bancarias"}},{path:"opciones",component:pe,data:{title:"Opciones",breadcrumb:"Opciones"}}];export{jt as FinancieroRoutes};
