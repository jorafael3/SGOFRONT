import{a as q}from"./chunk-QEZRQYYF.js";import{a as K}from"./chunk-INOCVZ2U.js";import{a as te}from"./chunk-POMG26IM.js";import{a as j}from"./chunk-OXQZC7J3.js";import"./chunk-EPETCGXL.js";import{B as X,D as ce,H as Ie,I as Fe,J as De,K as Oe,L as de,O as H,l as z,s as Te,t as W,w as J}from"./chunk-YIZZPA6C.js";import{k as se,l as U,m as L,q as G,s as ye,v as $}from"./chunk-ZRCY7LVU.js";import{$a as Ce,Ab as Y,Cb as u,Eb as Ee,Fc as M,Mb as i,Nb as a,Ob as s,Sb as S,Yb as C,Zb as p,a as P,b as R,db as o,e as ee,hc as n,ic as x,jb as F,jc as m,kc as be,mc as A,nc as y,oc as T,pb as N,qa as b,ra as h,sc as he,tc as Se,ub as g,uc as Ae,vc as O,xc as w}from"./chunk-NIELWWGW.js";var k=ee(te());function we(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),s(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),s(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),s(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),s(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),s(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),s(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),s(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),s(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),s(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),s(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),s(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),s(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Pe(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function Re(r,t){r&1&&(i(0,"span",90),s(1,"i",91),n(2,"Requerido "),a())}function ke(r,t){r&1&&(i(0,"span",92),s(1,"i",93),n(2,"N/A "),a())}function Be(r,t){r&1&&(i(0,"span",94),s(1,"i",95),n(2,"Validado "),a())}function Ve(r,t){r&1&&(i(0,"span",96),s(1,"i",97),n(2,"Pendiente "),a())}function Ne(r,t){r&1&&(i(0,"span",45),s(1,"i",95),n(2,"OK "),a())}function Me(r,t){if(r&1){let e=S();i(0,"div",98)(1,"span",99),s(2,"i",100),a(),i(3,"input",101),T("ngModelChange",function(l){b(e);let c=p().$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){b(e);let c=p().$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()}if(r&2){let e=p().$implicit,d=p(3);o(3),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Ue(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function Le(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),g(10,Pe,3,1,"div",79),a()(),i(11,"td",80),g(12,Re,3,0,"span",81)(13,ke,3,0,"span",82),a(),i(14,"td",80),g(15,Be,3,0,"span",83)(16,Ve,3,0,"span",84)(17,Ne,3,0,"span",85),a(),i(18,"td",37),g(19,Me,4,3,"div",86)(20,Ue,2,0,"div",87),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function Ge(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),s(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Le,21,12,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function $e(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function ze(r,t){r&1&&(i(0,"span",113),s(1,"i",95),n(2,"Validado "),a())}function We(r,t){r&1&&(i(0,"span",114),s(1,"i",97),n(2,"Pendiente "),a())}function Je(r,t){if(r&1){let e=S();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",107)(8,"div"),n(9),g(10,$e,3,1,"div",79),a()(),i(11,"td",80)(12,"span",108),s(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),g(16,ze,3,0,"span",109)(17,We,3,0,"span",110),a(),i(18,"td",37)(19,"div",98)(20,"span",111),s(21,"i",112),a(),i(22,"input",101),T("ngModelChange",function(l){let c=b(e).$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){let c=b(e).$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Xe(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),s(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Je,23,10,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function He(r,t){r&1&&(i(0,"div",2)(1,"div",115),s(2,"i",116),n(3," No hay productos en el detalle "),a()())}function je(r,t){if(r&1){let e=S();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",15),g(8,we,87,12,"div",16),i(9,"div",1),g(10,Ge,33,2,"div",17)(11,Xe,33,2,"div",17)(12,He,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){b(e);let l=p();return h(l.guardarPreparacion())}),s(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var ue=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Sucursal",field_value:"departamento_nombre",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):k.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`,t.departamento_nombre=`<span class="fw-bold">${t.departamento_nombre}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,c)=>{let f=`${l.ProductoId}_${c}`;return this.inputValues[f]="",R(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,k.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):k.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,c=l.value.trim();if(console.log("Input value for row:",e,"Value:",c),e&&c){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(v=>v.trim()):[],E=f.includes(c)||c===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",c),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=c,l.classList.remove("is-invalid"),l.classList.add("is-valid"),k.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${c}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),k.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(v=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${v}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${c}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(c=>`\u2022 ${c.CopProducto} - ${c.Detalle.substring(0,50)}...`).join(`
`);k.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(c=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${c.CopProducto}</strong><br>
                  <small class="text-muted">${c.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);k.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:c=>{if(console.log("response: ",c),c.success)if(c.data&&c.data.length>0){let f=c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.success==="true"));c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.menssage==="ya existe registro"))?k.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?k.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${c.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):k.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else k.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${c.factura}</p>
                    <p class="text-success">${c.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else k.default.fire({title:"Error!",text:c.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-preparar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(c){return d.onTableAction(c)})("customAction",function(c){return d.onCustomAction(c)}),a()()()()()(),g(8,je,19,5,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[$,U,L,G,H,W,J,X,j,K],encapsulation:2})};var D=ee(te());var qe=(r,t)=>({"bg-warning":r,"bg-info":t}),Ke=(r,t,e)=>({"bg-success":r,"bg-warning":t,"bg-secondary":e}),Ye=(r,t)=>({"table-success":r,"table-warning":t});function Qe(r,t){if(r&1&&(i(0,"div",4)(1,"div",25)(2,"h5",26),n(3,"No cerrar esta ventana si esta realizando el proceso de Verificaci\xF3n"),a(),i(4,"div",27),s(5,"i",28),i(6,"h6",29),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",30)(9,"div",31)(10,"div",32)(11,"small",33),s(12,"i",34),n(13,"Datos Principales "),a()(),i(14,"div",35)(15,"table",36)(16,"tbody")(17,"tr",37)(18,"td",38),s(19,"i",39),n(20,"Bodega: "),a(),i(21,"td",40)(22,"span",41),n(23),a()()(),i(24,"tr",37)(25,"td",42),s(26,"i",43),n(27,"Secuencia: "),a(),i(28,"td",40)(29,"span",44),n(30),a()()(),i(31,"tr",37)(32,"td",42),s(33,"i",45),n(34,"N\xFAmero: "),a(),i(35,"td",40),n(36),a()(),i(37,"tr",37)(38,"td",42),s(39,"i",46),n(40,"Cliente: "),a(),i(41,"td",40),n(42),a()(),i(43,"tr",37)(44,"td",42),s(45,"i",47),n(46,"Fecha: "),a(),i(47,"td",40)(48,"span",48),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",30)(52,"div",31)(53,"div",32)(54,"small",33),s(55,"i",49),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",35)(58,"table",36)(59,"tbody")(60,"tr",37)(61,"td",42),s(62,"i",50),n(63,"Ciudad: "),a(),i(64,"td",40)(65,"span",51),n(66),a()()(),i(67,"tr",37)(68,"td",42),s(69,"i",52),n(70,"Vendedor: "),a(),i(71,"td",40),n(72),a()(),i(73,"tr",37)(74,"td",42),s(75,"i",53),n(76,"Tipo Pedido: "),a(),i(77,"td",40)(78,"span",54),n(79),a()()(),i(80,"tr",37)(81,"td",42),s(82,"i",55),n(83,"Forma Pago: "),a(),i(84,"td",40)(85,"span",56),n(86),a()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Ze(r,t){if(r&1&&(i(0,"div",5)(1,"div",4)(2,"div",30)(3,"div",57),s(4,"i",58),i(5,"strong"),n(6),a()()(),i(7,"div",30)(8,"div",57),s(9,"i",59),i(10,"strong"),n(11),a()()()()()),r&2){let e=p(2);o(6),m("Total de productos: ",e.detalleFactura.length,""),o(5),m("Productos verificados: ",e.productosVerificados,"")}}function et(r,t){if(r&1&&(i(0,"div",72),n(1),a()),r&2){let e=p(3);o(),m(" Producto: ",e.productoActual.Detalle," ")}}function tt(r,t){r&1&&(i(0,"div",73),n(1," C\xF3digo no encontrado en la factura "),a())}function it(r,t){if(r&1){let e=S();i(0,"div")(1,"label",64),s(2,"i",74),n(3,"Serie: "),i(4,"span",75),n(5),a()(),i(6,"input",76,1),T("ngModelChange",function(l){b(e);let c=p(3);return y(c.serieActual,l)||(c.serieActual=l),h(l)}),C("keypress",function(l){b(e);let c=p(3);return h(c.onSerieEnter(l))}),a()()}if(r&2){let e=p(3);o(4),u("ngClass",he(4,qe,e.productoActual.registroserieEntrada==="0",e.productoActual.registroserieEntrada==="1")),o(),m(" ",e.productoActual.registroserieEntrada==="1"?"Controlada":"Libre"," "),o(),A("ngModel",e.serieActual),u("disabled",!e.productoActual)}}function at(r,t){if(r&1){let e=S();i(0,"div")(1,"label",64),s(2,"i",77),n(3,"Cantidad: "),i(4,"span",78),n(5,"Solo Cantidad"),a()(),i(6,"input",79,2),T("ngModelChange",function(l){b(e);let c=p(3);return y(c.cantidadActual,l)||(c.cantidadActual=l),h(l)}),C("keypress",function(l){b(e);let c=p(3);return h(c.onCantidadEnter(l))}),a()()}if(r&2){let e=p(3);o(6),A("ngModel",e.cantidadActual),u("placeholder","Confirmar cantidad (m\xE1x: "+e.productoActual.Cantidad+")")("disabled",!e.productoActual)("max",e.productoActual.Cantidad)}}function nt(r,t){r&1&&(i(0,"div",80),s(1,"i",81),n(2," Primero escanee un c\xF3digo de producto "),a())}function rt(r,t){if(r&1&&(i(0,"div",82)(1,"div",4)(2,"div",83)(3,"strong"),n(4),a(),n(5),a(),i(6,"div",84)(7,"span",85),n(8),a(),i(9,"span",86),n(10),a()()()()),r&2){let e=p(3);o(4),x(e.productoActual.CopProducto),o(),m(" - ",e.productoActual.Detalle," "),o(3),m("Cantidad: ",e.productoActual.Cantidad,""),o(),u("ngClass",Se(6,Ke,e.productoActual.cantidadVerificada===e.productoActual.Cantidad,e.productoActual.cantidadVerificada>0&&e.productoActual.cantidadVerificada<e.productoActual.Cantidad,e.productoActual.cantidadVerificada===0)),o(),be(" Verificado: ",e.productoActual.cantidadVerificada||0,"/",e.productoActual.Cantidad," ")}}function ot(r,t){if(r&1){let e=S();i(0,"div",5)(1,"div",60)(2,"div",61)(3,"div",62)(4,"div",30)(5,"div",63)(6,"label",64),s(7,"i",65),n(8,"C\xF3digo Producto: "),a(),i(9,"input",66,0),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.codigoProductoActual,l)||(c.codigoProductoActual=l),h(l)}),C("keypress",function(l){b(e);let c=p(2);return h(c.onCodigoProductoEnter(l))}),a(),g(11,et,2,1,"div",67)(12,tt,2,0,"div",68),a()(),i(13,"div",30),g(14,it,8,7,"div",69)(15,at,8,4,"div",69)(16,nt,3,0,"div",70),a()(),g(17,rt,11,10,"div",71),a()()()}if(r&2){let e=p(2);o(9),Ee("is-valid",e.productoActual)("is-invalid",e.codigoProductoActual&&!e.productoActual),A("ngModel",e.codigoProductoActual),o(2),u("ngIf",e.productoActual),o(),u("ngIf",e.codigoProductoActual&&!e.productoActual),o(2),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="1"),o(),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="0"),o(),u("ngIf",!e.productoActual),o(),u("ngIf",e.productoActual)}}function lt(r,t){r&1&&(i(0,"span",113),s(1,"i",77),n(2,"Cantidad "),a())}function st(r,t){r&1&&(i(0,"span",114),s(1,"i",74),n(2,"Serie Libre "),a())}function ct(r,t){r&1&&(i(0,"span",115),s(1,"i",102),n(2,"Serie Obligatoria "),a())}function dt(r,t){if(r&1&&(i(0,"small",122),s(1,"i",74),n(2),a()),r&2){let e=t.$implicit;o(2),m("",e," ")}}function ut(r,t){if(r&1&&(i(0,"div",118)(1,"div",119)(2,"span",115),n(3),a()(),i(4,"div",120),g(5,dt,3,1,"small",121),a()()),r&2){let e=p(2).$implicit;o(3),be(" ",e.seriesIngresadas.length,"/",e.Cantidad," series "),o(2),u("ngForOf",e.seriesIngresadas)}}function pt(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Sin series ingresadas"),a()())}function mt(r,t){if(r&1&&(i(0,"div"),g(1,ut,6,3,"div",116)(2,pt,3,0,"div",117),a()),r&2){let e=p().$implicit;o(),u("ngIf",e.seriesIngresadas&&e.seriesIngresadas.length>0),o(),u("ngIf",!e.seriesIngresadas||e.seriesIngresadas.length===0)}}function ft(r,t){if(r&1&&(i(0,"div",63)(1,"span",125),s(2,"i",24),n(3),a()()),r&2){let e=p(2).$implicit;o(3),m("",e.cantidadVerificada," confirmados ")}}function gt(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Cantidad pendiente"),a()())}function _t(r,t){if(r&1&&(i(0,"div"),g(1,ft,4,1,"div",124)(2,gt,3,0,"div",117),a()),r&2){let e=p().$implicit;o(),u("ngIf",e.cantidadVerificada>0),o(),u("ngIf",!e.cantidadVerificada||e.cantidadVerificada===0)}}function vt(r,t){r&1&&(i(0,"span",126),s(1,"i",24),n(2,"Completo "),a())}function xt(r,t){r&1&&(i(0,"span",114),s(1,"i",127),n(2,"Parcial "),a())}function bt(r,t){r&1&&(i(0,"span",113),s(1,"i",128),n(2,"Pendiente "),a())}function ht(r,t){if(r&1&&(i(0,"tr",104)(1,"td",105),g(2,lt,3,0,"span",106)(3,st,3,0,"span",107)(4,ct,3,0,"span",108),a(),i(5,"td",109),n(6),a(),i(7,"td",109),n(8),a(),i(9,"td",110),n(10),a(),i(11,"td",111),n(12),a(),i(13,"td",40),g(14,mt,3,2,"div",69)(15,_t,3,2,"div",69),a(),i(16,"td",105),g(17,vt,3,0,"span",112)(18,xt,3,0,"span",107)(19,bt,3,0,"span",106),a()()),r&2){let e=t.$implicit;u("ngClass",he(13,Ye,e.seriesCompletas,e.cantidadVerificada>0&&!e.seriesCompletas)),o(2),u("ngIf",e.RegistaSerie==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="1"),o(2),m(" ",e.CodigosBodega," "),o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(2),u("ngIf",e.RegistaSerie==="1"),o(),u("ngIf",e.RegistaSerie==="0"),o(2),u("ngIf",e.seriesCompletas),o(),u("ngIf",!e.seriesCompletas&&e.cantidadVerificada>0),o(),u("ngIf",!e.seriesCompletas&&(!e.cantidadVerificada||e.cantidadVerificada===0))}}function Ct(r,t){if(r&1&&(i(0,"div",5)(1,"div",87)(2,"div",88)(3,"h6",29),s(4,"i",89),n(5,"Detalle de Productos "),a()(),i(6,"div",90)(7,"div",91)(8,"table",92)(9,"thead",93)(10,"tr")(11,"th",94),s(12,"i",74),n(13,"Tipo "),a(),i(14,"th",94),s(15,"i",95),n(16,"Bodega "),a(),i(17,"th",96),s(18,"i",97),n(19,"C\xF3digo "),a(),i(20,"th",98),n(21," Cant. "),a(),i(22,"th",99),s(23,"i",34),n(24,"Descripci\xF3n "),a(),i(25,"th",100),s(26,"i",101),n(27,"Series/Cantidad Ingresadas "),a(),i(28,"th",94),s(29,"i",102),n(30,"Estado "),a()()(),i(31,"tbody"),g(32,ht,20,16,"tr",103),a()()()()()()),r&2){let e=p(2);o(32),u("ngForOf",e.detalleFactura)}}function Et(r,t){r&1&&(i(0,"div",5)(1,"div",129),s(2,"i",130),n(3," No hay productos en el detalle "),a()())}function St(r,t){if(r&1){let e=S();i(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h5",16),n(5),a(),i(6,"button",17),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",18),g(8,Qe,87,12,"div",19),i(9,"div",4),g(10,Ze,12,2,"div",20)(11,ot,18,11,"div",20)(12,Ct,33,1,"div",20)(13,Et,4,0,"div",20),a()(),i(14,"div",21)(15,"button",22),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(16,"Cerrar"),a(),i(17,"button",23),C("click",function(){b(e);let l=p();return h(l.guardarVerificacion())}),s(18,"i",24),n(19,"Guardar Verificaci\xF3n "),a()()()()()}if(r&2){let e=p();o(5),m("Verificar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length===0)}}var pe=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];codigoProductoActual="";serieActual="";cantidadActual=null;productoActual=null;productosVerificados=0;seriesValidasPrueba=[{codigo:"L3250",serie:"SN001234567"},{codigo:"L3250",serie:"SN001234568"},{codigo:"TG-3468",serie:"SN001234569"},{codigo:"ABC-123",serie:"ABC001"},{codigo:"ABC-123",serie:"ABC002"},{codigo:"XYZ-789",serie:"XYZ100"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL_TEXTO",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-success btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorVerificar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):D.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){let e=t.IDS_BODEGA.split(","),d=t.IDS_PREPARADAS.split(","),l=t.CODIGOS_BODEGA.split(","),c="";for(let f=0;f<l.length;f++){let E=0;d.length<e.length&&l[f]==l[d.length]&&(E=1,c+=`<span title="Pendiente de preparacion" class="text-danger fw-bold">P: ${l[d.length]}</span><br>`),E===0&&(c+=`<span class="fw-bold">${l[f]}</span><br>`)}t.FACTURA_SUCURSAL_TEXTO=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CODIGOS_BODEGA_TEXTO=c,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){console.log("data: ",t);let e=t.IDS_BODEGA.split(",");console.log("IDS_BODEGA: ",e);let d=t.IDS_PREPARADAS.split(",");console.log("ID_PREPARADAS: ",d);let l=t.CODIGOS_BODEGA.split(",");if(d.length<e.length){D.default.fire("Atenci\xF3n!","Hay productos sin preparar en la factura bodega "+l[d.length],"info");return}let c={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",c),this.FacturacionService.GetFacturasDatosVerificar(c).subscribe({next:f=>{console.log("response: ",f),f.success&&f.cabecera?f.cabecera.length>0?(this.facturaSeleccionada=f,this.facturaActual=f.cabecera[0],this.detalleFactura=f.detalle||[],this.detalleFactura=this.detalleFactura.map((E,v)=>R(P({},E),{seriesIngresadas:[],cantidadVerificada:0,seriesCompletas:!1})),this.productosVerificados=0,this.limpiarInputsCaptura(),this.productosJaula=this.detalleFactura.filter(E=>E.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(E=>E.EN_JAULA==="0"),this.showPrepararModal=!0,setTimeout(()=>{this.enfocarInputCodigo()},500)):(this.showPrepararModal=!1,D.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):D.default.fire("Error!",f.message,"error"),this.isLoading=!1},error:f=>{this.isLoading=!1}})}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[]}guardarVerificacion(){let t=this.detalleFactura.filter(d=>!d.seriesCompletas);if(console.log("Productos no verificados:",t),t.length>0){D.default.fire({title:"\u26A0\uFE0F Faltan productos por verificar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de verificaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${t.map(d=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${d.CopProducto}</strong><br>
                  <small class="text-muted">${d.Detalle.substring(0,60)}...</small><br>
                  <small class="text-info">Verificado: ${d.cantidadVerificada||0}/${d.Cantidad}</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total pendientes: <strong>${t.length}</strong> de <strong>${this.detalleFactura.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"});return}let e=this.detalleFactura.filter(d=>d.seriesCompletas);D.default.fire({title:"\u2705 Verificaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido verificados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la verificaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos verificados:</strong> ${e.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#28a745"}).then(()=>{let d={cliente:this.facturaActual.Nombre,factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios,detalle_verificacion:this.detalleFactura.map(l=>({producto:l.CopProducto,productoId:l.ProductoId,cantidad:l.Cantidad,cantidadVerificada:l.cantidadVerificada,seriesIngresadas:l.seriesIngresadas||[],tipoVerificacion:l.RegistaSerie==="1"?"series":"cantidad"}))};console.log("Par\xE1metros verificaci\xF3n:",d),this.FacturacionService.FinalizarVerificacion(d).subscribe({next:l=>{console.log("Respuesta verificaci\xF3n:",l),l.success?D.default.fire({title:"\u2705 Verificaci\xF3n Finalizada",html:`
                <div class="text-start">
                  <p><strong>Factura:</strong> ${this.facturaActual.Secuencia}</p>
                  <p class="text-success">`+l.message+`</p>
                </div>
              `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):D.default.fire({title:"\u274C Error en Verificaci\xF3n",html:`
                <div class="text-start">
                  <p><strong>Error:</strong> ${l.message||"Error desconocido"}</p>
                  <p class="text-muted">Por favor, intente nuevamente.</p>
                </div>
              `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})},error:l=>{console.error("Error en verificaci\xF3n:",l),D.default.fire({title:"\u274C Error de Conexi\xF3n",html:`
              <div class="text-start">
                <p>Ocurri\xF3 un error al finalizar la verificaci\xF3n.</p>
                <p class="text-muted">Verifique su conexi\xF3n e intente nuevamente.</p>
              </div>
            `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})}})})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}limpiarInputsCaptura(){this.codigoProductoActual="",this.serieActual="",this.cantidadActual=null,this.productoActual=null}onCodigoProductoEnter(t){t.key==="Enter"&&(t.preventDefault(),this.validarCodigoProducto())}validarCodigoProducto(){let t=this.codigoProductoActual.trim();if(!t)return;console.log("C\xF3digo ingresado:",t),console.log("Detalle factura:",this.detalleFactura),console.log("C\xF3digos disponibles:",this.detalleFactura.map(d=>d.CopProducto));let e=this.detalleFactura.find(d=>d.CopProducto.toLowerCase()===t.toLowerCase());console.log("Producto encontrado:",e),e?(this.productoActual=e,setTimeout(()=>{if(e.RegistaSerie==="1"){let d=document.querySelector("#inputSerie");d&&d.focus()}else{let d=document.querySelector("#inputCantidad");d&&d.focus()}},100)):(this.productoActual=null,D.default.fire({title:"\u274C C\xF3digo No Encontrado",html:`
          <div class="text-start">
            <p>El c\xF3digo <strong>${t}</strong> no existe en esta factura.</p>
            <p class="text-muted">Verifique el c\xF3digo e intente nuevamente.</p>
          </div>
        `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}).then(()=>{this.codigoProductoActual="",setTimeout(()=>{let d=document.querySelector("#inputCodigo");d&&d.focus()},100)}))}onSerieEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarSerie())}procesarSerie(){let t=this.serieActual.trim();if(!(!t||!this.productoActual)){if(this.productoActual.cantidadVerificada>=this.productoActual.Cantidad){D.default.fire({title:"\u26A0\uFE0F Cantidad Completa",text:`El producto ${this.productoActual.CopProducto} ya tiene todas sus series completas.`,icon:"warning",confirmButtonColor:"#f39c12"}),this.limpiarInputsCaptura(),this.enfocarInputCodigo();return}if(this.productoActual.seriesIngresadas.includes(t)){D.default.fire({title:"\u274C Serie Duplicada",html:`
          <div class="text-start">
            <p>La serie <strong>${t}</strong> ya fue ingresada para el producto <strong>${this.productoActual.CopProducto}</strong>.</p>
          </div>
        `,icon:"error",confirmButtonColor:"#dc3545"}),this.serieActual="";return}this.productoActual.registroserieEntrada==="1"?this.validarSerieEnBaseDatos(this.productoActual.ProductoId,t):this.agregarSerie(t)}}onCantidadEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarCantidad())}procesarCantidad(){if(!(!this.cantidadActual||!this.productoActual)){if(this.cantidadActual<=0||this.cantidadActual>this.productoActual.Cantidad){D.default.fire({title:"\u274C Cantidad Inv\xE1lida",text:`La cantidad debe ser entre 1 y ${this.productoActual.Cantidad}.`,icon:"error",confirmButtonColor:"#dc3545"});return}this.productoActual.cantidadVerificada=this.cantidadActual,this.productoActual.seriesCompletas=this.cantidadActual===parseInt(this.productoActual.Cantidad),console.log("Cantidad confirmada:",this.cantidadActual),console.log("Cantidad total:",this.productoActual.Cantidad),console.log("Series completas:",this.productoActual.seriesCompletas),this.actualizarContadores(),D.default.fire({title:"\u2705 Cantidad Confirmada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Cantidad confirmada:</strong> ${this.cantidadActual}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.limpiarInputsCaptura(),this.enfocarInputCodigo()}}validarSerieEnBaseDatos(t,e){D.default.fire({title:"Validando serie...",html:`
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Validando...</span>
          </div>
          <p class="mt-2">Verificando serie <strong>${e}</strong> en la base de datos</p>
        </div>
      `,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{D.default.showLoading()}});let d={codigo_producto:t,serie:e,bodega:this.facturaActual.CodigoBodega,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",d),this.FacturacionService.ValidarSerie(d).subscribe({next:l=>{console.log("Respuesta validaci\xF3n serie:",l),D.default.close(),l.success?l.serie_encontrada?l.serie_disponible==!0?this.agregarSerie(e):(D.default.fire({title:"\u274C Serie No Disponible",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> ya ha sido utilizada o no est\xE1 disponible para el producto <strong>${t}</strong>.</p>
                <p class="text-muted  ">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(D.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(D.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual="")},error:l=>{console.error("Error validando serie:",l),D.default.fire({title:"\u274C Error de Validaci\xF3n",html:`
            <div class="text-start">
              <p>Ocurri\xF3 un error al validar la serie <strong>${e}</strong>.</p>
              <p class="text-muted">Por favor, intente nuevamente.</p>
            </div>
          `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""}})}agregarSerie(t){this.productoActual.seriesIngresadas.push(t),this.productoActual.cantidadVerificada=this.productoActual.seriesIngresadas.length,this.productoActual.ProductoId=this.productoActual.ProductoId,console.log("Serie agregada:",t),console.log("Cantidad verificada:",this.productoActual.cantidadVerificada),console.log("Cantidad total:",this.productoActual.Cantidad),this.productoActual.cantidadVerificada===parseInt(this.productoActual.Cantidad)&&(this.productoActual.seriesCompletas=!0,console.log("Producto marcado como completo:",this.productoActual.CopProducto)),this.actualizarContadores(),D.default.fire({title:"\u2705 Serie Agregada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Serie:</strong> ${t}</p>
          <p><strong>Progreso:</strong> ${this.productoActual.cantidadVerificada}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.serieActual="",this.productoActual.seriesCompletas&&(this.limpiarInputsCaptura(),this.enfocarInputCodigo())}actualizarContadores(){let t=this.detalleFactura.filter(e=>e.seriesCompletas);this.productosVerificados=t.length,console.log("Actualizando contadores:"),console.log("Productos completos:",t),console.log("Total verificados:",this.productosVerificados),console.log("Detalle factura:",this.detalleFactura.map(e=>({codigo:e.CopProducto,seriesCompletas:e.seriesCompletas,cantidadVerificada:e.cantidadVerificada,cantidad:e.Cantidad}))),this.cdr.detectChanges()}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}puedeGuardar(){return this.detalleFactura.every(t=>t.seriesCompletas)}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-verificar-facturas"]],decls:9,vars:12,consts:[["inputCodigo",""],["inputSerie",""],["inputCantidad",""],[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-check","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"alert","d-flex","align-items-center"],[1,"fa","fa-info-circle","me-2"],[1,"fa","fa-check-circle","me-2"],[1,"card","border-warning"],[1,"card-body","bg-light"],[1,"row","justify-content-center"],[1,"text-center"],[1,"form-label","mb-1"],[1,"fa","fa-search","me-1"],["id","inputCodigo","type","text","placeholder","Escanear c\xF3digo del producto...",1,"form-control","form-control-lg","text-center",3,"ngModelChange","keypress","ngModel"],["class","valid-feedback",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],["class","alert alert-light",4,"ngIf"],[1,"valid-feedback"],[1,"invalid-feedback"],[1,"fa","fa-tag","me-1"],[1,"badge","ms-1",3,"ngClass"],["id","inputSerie","type","text","placeholder","Escanear serie del producto...",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","disabled"],[1,"fa","fa-calculator","me-1"],[1,"badge","bg-secondary","ms-1"],["id","inputCantidad","type","number","min","1",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","placeholder","disabled","max"],[1,"text-muted"],[1,"fa","fa-arrow-left","me-1"],[1,"alert","alert-light"],[1,"col-md-8"],[1,"col-md-4","text-end"],[1,"badge","bg-primary","me-1"],[1,"badge",3,"ngClass"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","20%"],[1,"fa","fa-list-ol","me-1"],[1,"fa","fa-shield-alt","me-1"],["class","align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"align-middle",3,"ngClass"],[1,"text-center","py-1"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-info fs-6",4,"ngIf"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],["class","badge bg-success fs-6",4,"ngIf"],[1,"badge","bg-secondary","fs-6"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"badge","bg-info","fs-6"],["class","series-container",4,"ngIf"],["class","text-center text-muted",4,"ngIf"],[1,"series-container"],[1,"mb-1"],[1,"series-list",2,"max-height","80px","overflow-y","auto"],["class","d-block text-muted",4,"ngFor","ngForOf"],[1,"d-block","text-muted"],[1,"text-center","text-muted"],["class","text-center",4,"ngIf"],[1,"badge","bg-success"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-clock","me-1"],[1,"fa","fa-minus","me-1"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(i(0,"div",3)(1,"div",4)(2,"div",5)(3,"app-card",6),s(4,"div",7),i(5,"div",8)(6,"div",9)(7,"app-table",10),C("action",function(c){return d.onTableAction(c)})("customAction",function(c){return d.onCustomAction(c)}),a()()()()()(),g(8,St,20,6,"div",11),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por verificar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[$,se,U,L,G,H,W,ce,J,de,Oe,X,j,K],encapsulation:2})};var I=ee(te());function At(r,t){r&1&&(i(0,"div",9)(1,"div",10)(2,"div",11)(3,"span",12),n(4,"Cargando..."),a()(),i(5,"p",13),n(6,"Cargando datos de facturas..."),a()()())}function yt(r,t){if(r&1){let e=S();i(0,"div",14)(1,"app-table",15),C("action",function(l){b(e);let c=p();return h(c.onTableAction(l))})("customAction",function(l){b(e);let c=p();return h(c.onCustomAction(l))}),a()()}if(r&2){let e=p();o(),u("hasCheckbox",!1)("tableConfig",e.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",e.Buttons_Export)("customButtons",e.customButtons)("initialDateFilter","this_month")}}function Tt(r,t){if(r&1&&(i(0,"div",55)(1,"div",2)(2,"div",56)(3,"div",57),s(4,"i",58),i(5,"div")(6,"strong",59),n(7,"FACTURA MULTIBODEGA"),a(),i(8,"small",60),n(9),a()(),i(10,"div",61)(11,"span",62),n(12),a()()()()()()),r&2){let e=p(2);o(9),m(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),o(3),m("",e.bodegas.length," Bodegas")}}function It(r,t){if(r&1&&(i(0,"div",1)(1,"div",63)(2,"div",64),s(3,"i",65),i(4,"h6",66),n(5,"Informaci\xF3n de la Factura"),a()()(),i(6,"div",28)(7,"div",29)(8,"div",30)(9,"small",31),s(10,"i",32),n(11,"Datos Principales "),a()(),i(12,"div",33)(13,"table",34)(14,"tbody")(15,"tr",36)(16,"td",37),s(17,"i",48),n(18,"Bodega: "),a(),i(19,"td",40)(20,"span",67),n(21),a()()(),i(22,"tr",36)(23,"td",45),s(24,"i",68),n(25,"Secuencia: "),a(),i(26,"td",40)(27,"span",69),n(28),a()()(),i(29,"tr",36)(30,"td",45),s(31,"i",70),n(32,"N\xFAmero: "),a(),i(33,"td",40),n(34),a()(),i(35,"tr",36)(36,"td",45),s(37,"i",71),n(38,"Cliente: "),a(),i(39,"td",40),n(40),a()(),i(41,"tr",36)(42,"td",45),s(43,"i",72),n(44,"Fecha: "),a(),i(45,"td",40)(46,"span",73),n(47),O(48,"date"),a()()()()()()()(),i(49,"div",28)(50,"div",29)(51,"div",30)(52,"small",31),s(53,"i",74),n(54,"Informaci\xF3n de Contacto "),a()(),i(55,"div",33)(56,"table",34)(57,"tbody")(58,"tr",36)(59,"td",37),s(60,"i",75),n(61,"Direcci\xF3n: "),a(),i(62,"td",40),n(63),a()(),i(64,"tr",36)(65,"td",45),s(66,"i",76),n(67,"Ciudad: "),a(),i(68,"td",40)(69,"span",77),n(70),a()()(),i(71,"tr",36)(72,"td",45),s(73,"i",78),n(74,"Tel\xE9fono: "),a(),i(75,"td",40)(76,"span",79),n(77),a()()(),i(78,"tr",36)(79,"td",45),s(80,"i",80),n(81,"Email: "),a(),i(82,"td",40)(83,"small",59),n(84),a()()(),i(85,"tr",36)(86,"td",45),s(87,"i",81),n(88,"Vendedor: "),a(),i(89,"td",40),n(90),a()(),i(91,"tr",36)(92,"td",45),s(93,"i",82),n(94,"Tipo Pedido: "),a(),i(95,"td",40)(96,"span",83),n(97),a()()(),i(98,"tr",36)(99,"td",45),s(100,"i",84),n(101,"Forma Pago: "),a(),i(102,"td",40)(103,"span",85),n(104),a()()()()()()()()()),r&2){let e=p(2);o(21),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(16),x(e.facturaActual.Direccion),o(7),m(" ",e.facturaActual.Ciudad," "),o(7),x((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),o(7),x(e.facturaActual.Email),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Ft(r,t){if(r&1&&(i(0,"tr",100)(1,"td",101),n(2),a(),i(3,"td",101),n(4),a(),i(5,"td",102),n(6),a(),i(7,"td",103),n(8),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.CodigosBodega," "),o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle)}}function Dt(r,t){if(r&1&&(i(0,"div",2)(1,"div",86)(2,"div",87)(3,"h6",66),s(4,"i",88),n(5,"Detalle de Productos "),a()(),i(6,"div",89)(7,"div",90)(8,"table",91)(9,"thead",92)(10,"tr")(11,"th",93),s(12,"i",94),n(13,"Bodega "),a(),i(14,"th",95),s(15,"i",96),n(16,"C\xF3digo "),a(),i(17,"th",97),n(18," Cant. "),a(),i(19,"th",98),s(20,"i",32),n(21,"Descripci\xF3n "),a()()(),i(22,"tbody"),g(23,Ft,9,4,"tr",99),a()()()()()()),r&2){let e=p(2);o(23),u("ngForOf",e.detalleFactura)}}function Ot(r,t){if(r&1&&(i(0,"div",4)(1,"div",2)(2,"div",104),s(3,"i",32),i(4,"strong"),n(5,"Factura Multibodega:"),a(),n(6),a()()()),r&2){let e=p(2);o(6),m(" Un solo n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function wt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",105),s(3,"i",106),i(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),a(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),a()()())}function Pt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",107),s(3,"i",32),i(4,"strong"),n(5,"Centro Consolidado:"),a(),n(6," Esta factura pertenece a un centro consolidado, no requiere consolidaci\xF3n adicional "),a()()())}function Rt(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",37),s(2,"i",108),n(3,"Consolidar: "),a(),i(4,"td",40)(5,"div",109)(6,"input",110),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.consolidar,l)||(c.consolidar=l),h(l)}),a(),i(7,"label",111),n(8," Consolidaci\xF3n obligatoria (no se puede cambiar) "),a()()()()}if(r&2){let e=p(2);o(6),A("ngModel",e.consolidar),u("disabled",!0)}}function kt(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",45),s(2,"i",112),n(3,"Gu\xEDa Consol.: "),i(4,"span",39),n(5,"*"),a()(),i(6,"td",40)(7,"input",113),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.guiaConsolidacion,l)||(c.guiaConsolidacion=l),h(l)}),a()()()}if(r&2){let e=p(2);o(7),A("ngModel",e.guiaConsolidacion)}}function Bt(r,t){r&1&&(i(0,"option",114),n(1,"Seleccione transporte"),a())}function Vt(r,t){r&1&&(i(0,"option",114),n(1,"Cargando transportes..."),a())}function Nt(r,t){if(r&1&&(i(0,"option",115),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),o(),m(" ",e.Codigo," ")}}function Mt(r,t){r&1&&(i(0,"small",116),s(1,"i",117),n(2,"Cargando lista de transportes... "),a())}function Ut(r,t){if(r&1&&(i(0,"small",116),n(1),a()),r&2){let e=p(3);o(),m(" Este n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function Lt(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",45),s(2,"i",118),n(3," N\xFAmero de Gu\xEDa: "),i(4,"span",39),n(5,"*"),a()(),i(6,"td",40)(7,"input",119),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.numeroGuia,l)||(c.numeroGuia=l),h(l)}),a(),g(8,Ut,2,1,"small",44),a()()}if(r&2){let e=p(2);o(7),A("ngModel",e.numeroGuia),o(),u("ngIf",e.bodegas.length>1)}}function Gt(r,t){r&1&&(i(0,"div",2)(1,"div",120),s(2,"i",121),n(3," No hay productos en el detalle "),a()())}function $t(r,t){if(r&1){let e=S();i(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"h5",20),n(5),a(),i(6,"button",21),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",22),g(8,Tt,13,2,"div",23)(9,It,105,15,"div",24),i(10,"div",1),g(11,Dt,24,1,"div",25),i(12,"div",26),g(13,Ot,7,1,"div",27)(14,wt,7,0,"div",27)(15,Pt,7,0,"div",27),i(16,"div",1)(17,"div",28)(18,"div",29)(19,"div",30)(20,"small",31),s(21,"i",32),n(22,"Datos de envio "),a()(),i(23,"div",33)(24,"table",34)(25,"tbody"),g(26,Rt,9,2,"tr",35)(27,kt,8,1,"tr",35),i(28,"tr",36)(29,"td",37),s(30,"i",38),n(31,"Transporte: "),i(32,"span",39),n(33,"*"),a()(),i(34,"td",40)(35,"select",41),T("ngModelChange",function(l){b(e);let c=p();return y(c.transporteSeleccionado,l)||(c.transporteSeleccionado=l),h(l)}),g(36,Bt,2,0,"option",42)(37,Vt,2,0,"option",42)(38,Nt,2,2,"option",43),a(),g(39,Mt,3,0,"small",44),a()(),g(40,Lt,9,2,"tr",35),i(41,"tr",36)(42,"td",45),s(43,"i",46),n(44,"Bultos: "),i(45,"span",39),n(46,"*"),a()(),i(47,"td",40)(48,"input",47),T("ngModelChange",function(l){b(e);let c=p();return y(c.numeroBultos,l)||(c.numeroBultos=l),h(l)}),a()()()()()()()(),i(49,"div",28)(50,"div",29)(51,"div",30)(52,"small",31),s(53,"i",32),a()(),i(54,"div",33)(55,"table",34)(56,"tbody")(57,"tr",36)(58,"td",37),s(59,"i",48),n(60,"Peso: "),a(),i(61,"td",40)(62,"input",49),T("ngModelChange",function(l){b(e);let c=p();return y(c.pesoEnvio,l)||(c.pesoEnvio=l),h(l)}),a()()(),i(63,"tr",36)(64,"td",45),s(65,"i",50),n(66,"Comentarios: "),a(),i(67,"td",40)(68,"textarea",51),T("ngModelChange",function(l){b(e);let c=p();return y(c.comentariosEnvio,l)||(c.comentariosEnvio=l),h(l)}),a()()()()()()()()()(),g(69,Gt,4,0,"div",25),a()(),i(70,"div",52)(71,"button",53),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(72,"Cerrar"),a(),i(73,"button",54),C("click",function(){b(e);let l=p();return h(l.guardarCambios())}),n(74,"Guardar cambios"),a()()()()()}if(r&2){let e=p();o(5),m("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(2),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.consolidar),o(),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)==1),o(11),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.MULTIBODEGA)=="SI"&&(e.facturaRowData==null?null:e.facturaRowData.CONSOLIDAR_FACTURA)==1&&(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)=="0"),o(),u("ngIf",e.consolidar),o(8),A("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),o(),u("ngIf",!e.cargandoTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngForOf",e.listaTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngIf",e.consolidar==!1),o(8),A("ngModel",e.numeroBultos),o(14),A("ngModel",e.pesoEnvio),o(6),A("ngModel",e.comentariosEnvio),o(),u("ngIf",e.detalleFactura.length===0)}}function zt(r,t){if(r&1&&(i(0,"div",55)(1,"div",2)(2,"div",56)(3,"div",57),s(4,"i",58),i(5,"div")(6,"strong",59),n(7,"FACTURA MULTIBODEGA"),a(),i(8,"small",60),n(9),a()(),i(10,"div",61)(11,"span",62),n(12),a()()()()()()),r&2){let e=p(2);o(9),m(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),o(3),m("",e.bodegas.length," Bodegas")}}function Wt(r,t){if(r&1&&(i(0,"div",1)(1,"div",63)(2,"div",64),s(3,"i",65),i(4,"h6",66),n(5,"Informaci\xF3n de la Factura"),a()()(),i(6,"div",28)(7,"div",29)(8,"div",30)(9,"small",31),s(10,"i",32),n(11,"Datos Principales "),a()(),i(12,"div",33)(13,"table",34)(14,"tbody")(15,"tr",36)(16,"td",37),s(17,"i",48),n(18,"Bodega: "),a(),i(19,"td",40)(20,"span",67),n(21),a()()(),i(22,"tr",36)(23,"td",45),s(24,"i",68),n(25,"Secuencia: "),a(),i(26,"td",40)(27,"span",69),n(28),a()()(),i(29,"tr",36)(30,"td",45),s(31,"i",70),n(32,"N\xFAmero: "),a(),i(33,"td",40),n(34),a()(),i(35,"tr",36)(36,"td",45),s(37,"i",71),n(38,"Cliente: "),a(),i(39,"td",40),n(40),a()(),i(41,"tr",36)(42,"td",45),s(43,"i",72),n(44,"Fecha: "),a(),i(45,"td",40)(46,"span",73),n(47),O(48,"date"),a()()()()()()()(),i(49,"div",28)(50,"div",29)(51,"div",30)(52,"small",31),s(53,"i",74),n(54,"Informaci\xF3n de Contacto "),a()(),i(55,"div",33)(56,"table",34)(57,"tbody")(58,"tr",36)(59,"td",37),s(60,"i",75),n(61,"Direcci\xF3n: "),a(),i(62,"td",40),n(63),a()(),i(64,"tr",36)(65,"td",45),s(66,"i",76),n(67,"Ciudad: "),a(),i(68,"td",40)(69,"span",77),n(70),a()()(),i(71,"tr",36)(72,"td",45),s(73,"i",78),n(74,"Tel\xE9fono: "),a(),i(75,"td",40)(76,"span",79),n(77),a()()(),i(78,"tr",36)(79,"td",45),s(80,"i",80),n(81,"Email: "),a(),i(82,"td",40)(83,"small",59),n(84),a()()(),i(85,"tr",36)(86,"td",45),s(87,"i",81),n(88,"Vendedor: "),a(),i(89,"td",40),n(90),a()(),i(91,"tr",36)(92,"td",45),s(93,"i",82),n(94,"Tipo Pedido: "),a(),i(95,"td",40)(96,"span",83),n(97),a()()(),i(98,"tr",36)(99,"td",45),s(100,"i",84),n(101,"Forma Pago: "),a(),i(102,"td",40)(103,"span",85),n(104),a()()()()()()()()()),r&2){let e=p(2);o(21),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(16),x(e.facturaActual.Direccion),o(7),m(" ",e.facturaActual.Ciudad," "),o(7),x((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),o(7),x(e.facturaActual.Email),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Jt(r,t){if(r&1&&(i(0,"tr",100)(1,"td",101),n(2),a(),i(3,"td",101),n(4),a(),i(5,"td",102),n(6),a(),i(7,"td",103),n(8),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.CodigosBodega," "),o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle)}}function Xt(r,t){if(r&1&&(i(0,"div",2)(1,"div",86)(2,"div",87)(3,"h6",66),s(4,"i",88),n(5,"Detalle de Productos "),a()(),i(6,"div",89)(7,"div",90)(8,"table",91)(9,"thead",92)(10,"tr")(11,"th",93),s(12,"i",94),n(13,"Bodega "),a(),i(14,"th",95),s(15,"i",96),n(16,"C\xF3digo "),a(),i(17,"th",97),n(18," Cant. "),a(),i(19,"th",98),s(20,"i",32),n(21,"Descripci\xF3n "),a()()(),i(22,"tbody"),g(23,Jt,9,4,"tr",99),a()()()()()()),r&2){let e=p(2);o(23),u("ngForOf",e.detalleFactura)}}function Ht(r,t){if(r&1&&(i(0,"div",4)(1,"div",2)(2,"div",104),s(3,"i",32),i(4,"strong"),n(5,"Factura Multibodega:"),a(),n(6),a()()()),r&2){let e=p(2);o(6),m(" Un solo n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function jt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",105),s(3,"i",106),i(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),a(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),a()()())}function qt(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",107),s(3,"i",32),i(4,"strong"),n(5,"Centro Consolidado:"),a(),n(6," Esta factura pertenece a un centro consolidado, no requiere consolidaci\xF3n adicional "),a()()())}function Kt(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",37),s(2,"i",108),n(3,"Consolidar: "),a(),i(4,"td",40)(5,"div",109)(6,"input",110),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.consolidar,l)||(c.consolidar=l),h(l)}),a(),i(7,"label",111),n(8," Consolidaci\xF3n obligatoria (no se puede cambiar) "),a()()()()}if(r&2){let e=p(2);o(6),A("ngModel",e.consolidar),u("disabled",!0)}}function Yt(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",45),s(2,"i",112),n(3,"Gu\xEDa Consol.: "),i(4,"span",39),n(5,"*"),a()(),i(6,"td",40)(7,"input",113),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.guiaConsolidacion,l)||(c.guiaConsolidacion=l),h(l)}),a()()()}if(r&2){let e=p(2);o(7),A("ngModel",e.guiaConsolidacion)}}function Qt(r,t){r&1&&(i(0,"option",114),n(1,"Seleccione transporte"),a())}function Zt(r,t){r&1&&(i(0,"option",114),n(1,"Cargando transportes..."),a())}function ei(r,t){if(r&1&&(i(0,"option",115),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),o(),m(" ",e.Codigo," ")}}function ti(r,t){r&1&&(i(0,"small",116),s(1,"i",117),n(2,"Cargando lista de transportes... "),a())}function ii(r,t){if(r&1&&(i(0,"small",116),n(1),a()),r&2){let e=p(3);o(),m(" Este n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function ai(r,t){if(r&1){let e=S();i(0,"tr",36)(1,"td",45),s(2,"i",118),n(3," N\xFAmero de Gu\xEDa: "),i(4,"span",39),n(5,"*"),a()(),i(6,"td",40)(7,"input",119),T("ngModelChange",function(l){b(e);let c=p(2);return y(c.numeroGuia,l)||(c.numeroGuia=l),h(l)}),a(),g(8,ii,2,1,"small",44),a()()}if(r&2){let e=p(2);o(7),A("ngModel",e.numeroGuia),o(),u("ngIf",e.bodegas.length>1)}}function ni(r,t){r&1&&(i(0,"div",2)(1,"div",120),s(2,"i",121),n(3," No hay productos en el detalle "),a()())}function ri(r,t){if(r&1){let e=S();i(0,"button",54),C("click",function(){b(e);let l=p(2);return h(l.guardarCambios())}),n(1,"Guardar cambios"),a()}}function oi(r,t){if(r&1){let e=S();i(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"h5",20),n(5),a(),i(6,"button",21),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",22),g(8,zt,13,2,"div",23)(9,Wt,105,15,"div",24),i(10,"div",1),g(11,Xt,24,1,"div",25),i(12,"div",26),g(13,Ht,7,1,"div",27)(14,jt,7,0,"div",27)(15,qt,7,0,"div",27),i(16,"div",1)(17,"div",28)(18,"div",29)(19,"div",30)(20,"small",31),s(21,"i",32),n(22,"Datos de envio "),a()(),i(23,"div",33)(24,"table",34)(25,"tbody"),g(26,Kt,9,2,"tr",35)(27,Yt,8,1,"tr",35),i(28,"tr",36)(29,"td",37),s(30,"i",38),n(31,"Transporte: "),i(32,"span",39),n(33,"*"),a()(),i(34,"td",40)(35,"select",41),T("ngModelChange",function(l){b(e);let c=p();return y(c.transporteSeleccionado,l)||(c.transporteSeleccionado=l),h(l)}),g(36,Qt,2,0,"option",42)(37,Zt,2,0,"option",42)(38,ei,2,2,"option",43),a(),g(39,ti,3,0,"small",44),a()(),g(40,ai,9,2,"tr",35),i(41,"tr",36)(42,"td",45),s(43,"i",46),n(44,"Bultos: "),i(45,"span",39),n(46,"*"),a()(),i(47,"td",40)(48,"input",47),T("ngModelChange",function(l){b(e);let c=p();return y(c.numeroBultos,l)||(c.numeroBultos=l),h(l)}),a()()()()()()()(),i(49,"div",28)(50,"div",29)(51,"div",30)(52,"small",31),s(53,"i",32),a()(),i(54,"div",33)(55,"table",34)(56,"tbody")(57,"tr",36)(58,"td",37),s(59,"i",48),n(60,"Peso: "),a(),i(61,"td",40)(62,"input",49),T("ngModelChange",function(l){b(e);let c=p();return y(c.pesoEnvio,l)||(c.pesoEnvio=l),h(l)}),a()()(),i(63,"tr",36)(64,"td",45),s(65,"i",50),n(66,"Comentarios: "),a(),i(67,"td",40)(68,"textarea",51),T("ngModelChange",function(l){b(e);let c=p();return y(c.comentariosEnvio,l)||(c.comentariosEnvio=l),h(l)}),a()()()()()()()()()(),g(69,ni,4,0,"div",25),a()(),i(70,"div",52)(71,"button",53),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(72,"Cerrar"),a(),g(73,ri,2,0,"button",122),a()()()()}if(r&2){let e=p();o(5),m("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(2),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.consolidar),o(),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)==1),o(11),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.MULTIBODEGA)=="SI"&&(e.facturaRowData==null?null:e.facturaRowData.CONSOLIDAR_FACTURA)==1&&(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)=="0"),o(),u("ngIf",e.consolidar),o(8),A("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),o(),u("ngIf",!e.cargandoTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngForOf",e.listaTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngIf",e.consolidar==!1),o(8),A("ngModel",e.numeroBultos),o(14),A("ngModel",e.pesoEnvio),o(6),A("ngModel",e.comentariosEnvio),o(),u("ngIf",e.detalleFactura.length===0),o(4),u("ngIf",e.facturaRowData.ACTIVAR_LINK==1)}}var me=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;showDetalleguiaComputronModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;facturaRowData=null;detalleFactura=[];transporteSeleccionado="";numeroGuia="";numeroBultos=null;pesoEnvio="";comentariosEnvio="";consolidar=!1;tipoConsolidacion="";guiaConsolidacion="";bodegas=[];guiasPorBodega=[];listaTransportes=[];cargandoTransportes=!1;empresa="";transportesSeleccionados={};opcionesConsolidacion=[{id:"consolidacion_1",nombre:"Consolidaci\xF3n Centro"},{id:"consolidacion_2",nombre:"Consolidaci\xF3n Norte"},{id:"consolidacion_3",nombre:"Consolidaci\xF3n Sur"},{id:"consolidacion_4",nombre:"Consolidaci\xF3n Express"},{id:"consolidacion_5",nombre:"Consolidaci\xF3n Econ\xF3mica"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA_TEXTO",sort:!0},{title:"Consolidar",field_value:"CONSOLIDAR_FACTURA_TEXTO",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",type:"select",options:[],sort:!1},{title:"Estado",field_value:"FACTURA_BLOQUEADA_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};tableConfigCComputron={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega Facturaci\xF3n",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha Factura",field_value:"FACTURA_FECHA",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA_TEXTO",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!1},{title:"Factura Total",field_value:"FACTURA_TOTAL_TEXTO",sort:!0},{title:"Factura Saldo",field_value:"FACTURA_SALDO_TEXTO",sort:!0},{title:"Bodega de Retiro",field_value:"FACTURA_BODEGA_RETIRO_TEXTO",sort:!0},{title:"Comentario",field_value:"FACTURA_COMENTARIO",sort:!0},{title:"Estado",field_value:"FACTURA_ESTADO_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),this.empresa=this.sessionData?this.sessionData.empleado_empresa:"",console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorGuiasPickup(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):I.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.actualizarOpcionesSelect(),this.empresa==="COMPUTRON"&&(this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span title="${t.BODEGA_CODIGO}-${t.BODEGA_NOMBRE}" class="fw-bold">${t.BODEGA_CODIGO}</span><br><span class="fw-bold text-muted">${t.BODEGA_NOMBRE}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.MULTIBODEGA_TEXTO=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`,t.FACTURA_TOTAL_TEXTO='<span class="fw-bold '+(t.FACTURA_SALDO>0?"text-danger":"")+` fs-6">${new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t.FACTURA_TOTAL)}</span>`,t.FACTURA_SALDO_TEXTO='<span class="fw-bold '+(t.FACTURA_SALDO>0?"text-danger":"")+` fs-6">${new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t.FACTURA_SALDO)}</span>`,t.FACTURA_BODEGA_RETIRO_TEXTO=`<span class="fw-bold">${t.SISCO_BODEGA_RETIRO}</span>`,t.FACTURA_COMENTARIO=t.SISCO_COMENTARIO,t.FACTURA_ESTADO_TEXTO='<span class="fw-bold '+(t.ACTIVAR_LINK==1?"text-success":"text-danger")+'">'+t.FACTURA_ESTADO+"</span>"}),this.tableConfig=R(P({},this.tableConfigCComputron),{data:this.Usuarios_Datos})),this.empresa==="CARTIMEX"&&(this.Usuarios_Datos.map(function(t){let e=t.CODIGOS_VERIFICADAS.split(","),d=t.CODIGOS_CONSOLIDADAS.split(","),l=t.BODEGAS_ENFACTURA.split(","),c="";for(let f=0;f<e.length;f++)e[f]&&e[f]!=""&&(c+=`<span class="fw-bold">${e[f]}</span><br>`);for(let f=0;f<d.length;f++)d[f]&&d[f]!=""&&(c+=`<span class="fw-bold">${d[f]}</span><br>`);(!t.ORDEN_TIPO_PEDIDO||t.ORDEN_TIPO_PEDIDO===""||t.ORDEN_TIPO_PEDIDO===null)&&(t.ORDEN_TIPO_PEDIDO="MOSTRADOR-GYE"),t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CONSOLIDAR_FACTURA_TEXTO=`<span class="fs-6 badge bg-${t.CONSOLIDAR_FACTURA==1?"danger":"secondary"} fw-bold">${t.CONSOLIDAR_FACTURA==1?"SI":"NO"}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span title="${t.BODEGAS_ENFACTURA}" class="fw-bold">${c}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA_TEXTO=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.FACTURA_BLOQUEADA_TEXTO=(t.FACTURA_BLOQUEADA==1?()=>'<span class="fs-6 badge bg-danger fw-bold">Bloqueada</span>':()=>t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+d.length!=l.length?'<span class="fs-6 badge bg-danger fw-bold">Espera Consolidaci\xF3n</span>':t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+d.length==l.length?'<span class="fs-6 badge bg-primary fw-bold">consolidacion completa</span>':t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1&&t.FACTURA_LISTA_ESTADO=="0"?'<span class="fs-6 badge bg-danger fw-bold">Por consolidar</span>':t.FACTURA_LISTA_ESTADO=="1"?'<span class="fs-6 badge bg-success fw-bold">Consolidada</span>':'<span class="fs-6 badge bg-success fw-bold">Desbloqueada</span>')()}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos}))}onTableAction(t){switch(t.action_to_perform){case"detalle_factura":if(this.empresa=="COMPUTRON"){this.onIngresarGuiaComputron(t.data);return}if(this.empresa=="CARTIMEX"){this.onIngresarGuiaCartimex(t.data);return}break;case"ORDEN_TIPO_PEDIDO_change":this.onTransporteChange(t.data,t.value);break;default:break}}onTransporteChange(t,e){if(t.FACTURA_LISTA_ESTADO==1&&t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se puede cambiar el tipo de pedido.","warning");return}let d=t.FACTURA_SECUENCIA||t.ID;this.transportesSeleccionados[d]=e;let l=this.Usuarios_Datos.findIndex(c=>(c.FACTURA_SECUENCIA||c.ID)===d);l!==-1&&(this.Usuarios_Datos[l].ORDEN_TIPO_PEDIDO=e),this.cdr.detectChanges(),this.tableConfig=R(P({},this.tableConfig),{data:[...this.Usuarios_Datos]}),this.guardarTransporteSeleccionado(t,e)}guardarTransporteSeleccionado(t,e){let d={factura:t.FACTURA_ID,tipo:e,usrid:this.sessionData?this.sessionData.usrid:null};this.empresa!=="COMPUTRON"&&I.default.fire({title:"Est\xE1s seguro?",text:"Si ya hay facturas consolidadas puede haber problemas al ingresar la gu\xEDa!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, continuar"}).then(l=>{l.isConfirmed&&this.FacturacionService.GuardarCambioTipoPedido(d).subscribe({next:c=>{c.success?(I.default.fire("\xC9xito!","Transporte actualizado correctamente","success"),this.loadTableData()):I.default.fire("Error!",c.message,"error")},error:c=>{I.default.fire("Error!","No se pudo actualizar el transporte","error")}})})}onIngresarGuiaComputron(t){if(console.log("data: ",t),this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,t.FACTURA_BLOQUEADA==1&&t.CENTRO_CONSOLIDADO==0){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}if(t.CONSOLIDAR_FACTURA==1&&t.CENTRO_CONSOLIDADO==0&&t.FACTURA_LISTA_ESTADO==1){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se pueden ingresar m\xE1s gu\xEDas.","warning");return}let e=t.CODIGOS_VERIFICADAS?t.CODIGOS_VERIFICADAS.split(",").map(_=>_.trim()):[],d=t.CODIGOS_CONSOLIDADAS?t.CODIGOS_CONSOLIDADAS.split(",").map(_=>_.trim()):[],l=[...e,...d],c=t.BODEGAS_ENFACTURA?t.BODEGAS_ENFACTURA.split(",").map(_=>_.trim()):[],f=_=>_?parseFloat(_).toFixed(2):"",E=c.filter(_=>!l.some(Q=>f(Q)===f(_)));if(E.length>0&&t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" tiene bodegas que no se han completado: "+E.join(", "),"warning");return}this.facturaRowData=t;let v={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(v).subscribe({next:_=>{if(console.log("response: ",_),_.success&&_.cabecera)if(_.cabecera.length>0){this.facturaSeleccionada=_,this.facturaActual=_.cabecera[0],this.detalleFactura=_.detalle||[],this.procesarBodegas(t);let Q=this.facturaRowData?.MULTIBODEGA=="SI",ve=this.facturaRowData?.CONSOLIDAR_FACTURA==1,xe=this.facturaRowData?.CENTRO_CONSOLIDADO=="0";this.consolidar=Q&&ve&&xe,this.showDetalleguiaComputronModal=!0}else this.showDetalleguiaComputronModal=!1,I.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error");else I.default.fire("Error!",_.message,"error");this.isLoading=!1},error:_=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:_=>{_.success&&_.data?this.listaTransportes=_.data:I.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:_=>{I.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}onIngresarGuiaCartimex(t){if(console.log("data: ",t),this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,t.FACTURA_BLOQUEADA==1&&t.CENTRO_CONSOLIDADO==0){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}if(t.CONSOLIDAR_FACTURA==1&&t.CENTRO_CONSOLIDADO==0&&t.FACTURA_LISTA_ESTADO==1){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se pueden ingresar m\xE1s gu\xEDas.","warning");return}let e=t.CODIGOS_VERIFICADAS?t.CODIGOS_VERIFICADAS.split(",").map(_=>_.trim()):[],d=t.CODIGOS_CONSOLIDADAS?t.CODIGOS_CONSOLIDADAS.split(",").map(_=>_.trim()):[],l=[...e,...d],c=t.BODEGAS_ENFACTURA?t.BODEGAS_ENFACTURA.split(",").map(_=>_.trim()):[],f=_=>_?parseFloat(_).toFixed(2):"",E=c.filter(_=>!l.some(Q=>f(Q)===f(_)));if(E.length>0&&t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1){I.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" tiene bodegas que no se han completado: "+E.join(", "),"warning");return}this.facturaRowData=t;let v={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(v).subscribe({next:_=>{if(console.log("response: ",_),_.success&&_.cabecera)if(_.cabecera.length>0){this.facturaSeleccionada=_,this.facturaActual=_.cabecera[0],this.detalleFactura=_.detalle||[],this.procesarBodegas(t);let Q=this.facturaRowData?.MULTIBODEGA=="SI",ve=this.facturaRowData?.CONSOLIDAR_FACTURA==1,xe=this.facturaRowData?.CENTRO_CONSOLIDADO=="0";this.consolidar=Q&&ve&&xe,this.showPrepararModal=!0}else this.showPrepararModal=!1,I.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error");else I.default.fire("Error!",_.message,"error");this.isLoading=!1},error:_=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:_=>{_.success&&_.data?this.listaTransportes=_.data:I.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:_=>{I.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}procesarBodegas(t){if(t.CODIGOS_BODEGA&&t.BODEGAS){let e=t.CODIGOS_BODEGA.split(",").map(l=>l.trim()),d=t.BODEGAS.split(",").map(l=>l.trim());this.bodegas=e.map((l,c)=>({codigo:l,nombre:d[c]||l}))}}cerrarModal(){this.showPrepararModal=!1,this.showDetalleguiaComputronModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.facturaRowData=null,this.detalleFactura=[],this.transporteSeleccionado="",this.numeroGuia="",this.numeroBultos=null,this.pesoEnvio="",this.comentariosEnvio="",this.consolidar=!1,this.tipoConsolidacion="",this.guiaConsolidacion="",this.bodegas=[],this.listaTransportes=[],this.cargandoTransportes=!1}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}verEstadoActual(){}actualizarOpcionesSelect(){let t=[];this.empresa==="CARTIMEX"&&(t.push({label:"MOSTRADOR-GYE",value:"MOSTRADOR-GYE"}),t.push({label:"MOSTRADOR-UIO",value:"MOSTRADOR-UIO"}),t.push({label:"CUIDAD-GYE",value:"CUIDAD-GYE"}),t.push({label:"CUIDAD-UIO",value:"CUIDAD-UIO"}),t.push({label:"PROVINCIA",value:"PROVINCIA"})),this.empresa==="COMPUTRON"&&(t.push({label:"PICKUP",value:"PICKUP"}),t.push({label:"ENVIO",value:"ENVIO"}));let e=[...new Set(this.Usuarios_Datos.map(v=>v.ORDEN_TIPO_PEDIDO).filter(v=>v&&v!==""))],d=t.map(v=>v.value),c=e.filter(v=>!d.includes(v)).map(v=>({label:v,value:v})),f=[...t,...c],E=this.tableConfig.columns.find(v=>v.type==="select");E&&(E.options=f)}guardarCambios(){let t=this.listaTransportes.find(v=>v.id===this.transporteSeleccionado),e=t?t.C\u00F3digo:"N/A",d={transporteId:this.transporteSeleccionado,transporteNombre:e,numeroGuia:this.numeroGuia,numeroBultos:this.numeroBultos,peso:this.pesoEnvio,comentarios:this.comentariosEnvio,consolidacion:{activada:this.consolidar,tipo:this.tipoConsolidacion,guia:this.guiaConsolidacion},bodegas:this.bodegas,factura:this.facturaActual.Id,bodegaInfo:this.facturaSeleccionada.BODEGAS};console.log("datosEnvio: ",d);let l=!1;this.consolidar&&!this.guiaConsolidacion.trim()&&(l=!0);let c=!this.consolidar&&!this.numeroGuia?.trim();if(!this.transporteSeleccionado||!this.numeroBultos||c||l){let v=[];this.transporteSeleccionado||v.push("Transporte"),this.numeroBultos||v.push("N\xFAmero de bultos"),c&&v.push("N\xFAmero de gu\xEDa"),this.consolidar&&!this.guiaConsolidacion.trim()&&v.push("Gu\xEDa de consolidaci\xF3n"),I.default.fire({title:"\u26A0\uFE0F Campos Incompletos",html:`
          <div class="text-start">
            <p>Por favor complete los siguientes campos obligatorios:</p>
            <ul class="text-muted">
              ${v.map(_=>`<li>${_}</li>`).join("")}
            </ul>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido"});return}let f=this.bodegas.length>1?`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>
         <p><small class="text-muted">Esta gu\xEDa se aplicar\xE1 a las ${this.bodegas.length} bodegas: ${this.bodegas.map(v=>v.codigo).join(", ")}</small></p>`:`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>`,E=this.consolidar?`
      <hr class="my-2">
      <h6 class="text-warning mb-2"><i class="fa fa-boxes me-1"></i>Consolidaci\xF3n</h6>
      <p><strong>Tipo:</strong> ${this.opcionesConsolidacion.find(v=>v.id===this.tipoConsolidacion)?.nombre||"N/A"}</p>
      <p><strong>Gu\xEDa de consolidaci\xF3n:</strong> ${this.guiaConsolidacion}</p>
    `:"";I.default.fire({title:"\u2705 Datos Guardados",html:`
        <div class="text-start">
          <h6 class="text-primary mb-2"><i class="fa fa-file-invoice me-1"></i>Datos de Factura</h6>
          <p><strong>Factura:</strong> ${this.facturaActual?.Secuencia||"N/A"}</p>
          <p><strong>Cliente:</strong> ${this.facturaActual?.Nombre||"N/A"}</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura?.length||0}</p>
          
          <hr class="my-2">
          
          <h6 class="text-success mb-2"><i class="fa fa-shipping-fast me-1"></i>Datos de Env\xEDo</h6>
          <p><strong>Transporte:</strong> ${e} (${this.transporteSeleccionado})</p>
          <p><strong>Bultos:</strong> ${this.numeroBultos}</p>
          <p><strong>Peso:</strong> ${this.pesoEnvio||"No especificado"}</p>
          ${this.comentariosEnvio?`<p><strong>Comentarios:</strong> ${this.comentariosEnvio}</p>`:""}
          
          ${E}
          
          <hr class="my-2">
          
          <h6 class="text-info mb-2"><i class="fa fa-barcode me-1"></i>Informaci\xF3n de Gu\xEDa</h6>
          ${f}
        </div>
      `,icon:"success",confirmButtonText:"OK"}),I.default.fire({title:"\xBFEst\xE1s seguro?",text:"No podr\xE1s revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, Guardar!"}).then(v=>{v.isConfirmed&&this.FacturacionService.FinalizarGuiasPickup(d).subscribe({next:_=>{console.log("response: ",_),_.success?(I.default.fire("\xC9xito!","Los datos de gu\xEDa han sido guardados correctamente.","success"),this.cerrarModal(),this.loadTableData()):I.default.fire("Error!",_.message,"error"),this.isLoading=!1},error:_=>{console.log("error: ",_),this.isLoading=!1}})})}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-guias-pickup"]],decls:10,vars:6,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],["class","loading-container",4,"ngIf"],["class","recent-table",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],[1,"loading-container"],[1,"loading-content"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted","spinner-text","fw-bold"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row mb-3",4,"ngIf"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","my-3"],["class","row mb-2",4,"ngIf"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],["style","height: 28px;",4,"ngIf"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-shopping-cart","text-info","me-1"],[1,"text-danger"],[1,"py-1"],["name","transporte",1,"form-select","form-select-solid","form-select-sm",3,"ngModelChange","ngModel","disabled"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-box-open","text-secondary","me-1"],["type","number","name","numeroBultos","placeholder","N\xFAmero de bultos","min","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-warehouse","text-info","me-1"],["type","text","name","pesoEnvio","placeholder","Peso del paquete (kg)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-address-book","text-primary","me-1"],["name","comentarios","rows","2","placeholder","Comentarios sobre el env\xEDo",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","mb-3"],[1,"alert","alert-success","border-success","py-2","mb-0"],[1,"d-flex","align-items-center"],[1,"fa","fa-warehouse","text-primary","me-2","fs-5"],[1,"text-primary"],[1,"d-block","text-dark","fw-bold"],[1,"ms-auto"],[1,"badge","bg-primary","fs-6"],[1,"col-12","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"fw-bold","text-primary","fs-5"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-map-marker-alt","text-danger","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-phone","text-success","me-1"],[1,"font-monospace"],[1,"fa","fa-envelope","text-primary","me-1"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"align-middle"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],[1,"alert","alert-primary","py-2"],[1,"alert","alert-warning","py-2"],[1,"fa","fa-boxes","me-1"],[1,"alert","alert-info","py-2"],[1,"fa","fa-boxes","text-warning","me-1"],[1,"form-check"],["type","checkbox","name","consolidar","id","checkConsolidar",1,"form-check-input",3,"ngModelChange","ngModel","disabled"],["for","checkConsolidar",1,"form-check-label","text-muted"],[1,"fa","fa-barcode","text-warning","me-1"],["type","text","name","guiaConsolidacion","placeholder","N\xFAmero de gu\xEDa de consolidaci\xF3n",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"text-muted"],[1,"fa","fa-spinner","fa-spin","me-1"],[1,"fa","fa-file","text-primary","me-1"],["type","text","name","numeroGuia","placeholder","Ingrese el n\xFAmero de gu\xEDa",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5),g(6,At,7,0,"div",6)(7,yt,2,9,"div",7),a()()()(),g(8,$t,75,20,"div",8)(9,oi,74,21,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por ingresar guias")("cardClass","mb-4"),o(3),u("ngIf",d.isLoading),o(),u("ngIf",!d.isLoading),o(),u("ngIf",d.showPrepararModal),o(),u("ngIf",d.showDetalleguiaComputronModal))},dependencies:[$,U,L,G,H,Fe,De,W,ce,Te,Ie,J,de,X,j,K],styles:[".spinner-border[_ngcontent-%COMP%]{border-width:.4em;border-right-color:transparent;animation:_ngcontent-%COMP%_spinner-border .75s linear infinite}.spinner-border.text-primary[_ngcontent-%COMP%]{border-color:currentColor;border-right-color:transparent}@keyframes _ngcontent-%COMP%_spinner-border{to{transform:rotate(360deg)}}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px;background-color:#fffffff2}.loading-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]{text-align:center}.loading-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   .spinner-text[_ngcontent-%COMP%]{font-size:1rem;color:#6c757d;font-weight:500;margin-top:1rem}"]})};var B=ee(te());function li(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),s(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),s(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),s(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),s(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),s(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),s(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),s(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),s(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),s(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),s(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),s(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),s(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function si(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function ci(r,t){r&1&&(i(0,"span",90),s(1,"i",91),n(2,"Requerido "),a())}function di(r,t){r&1&&(i(0,"span",92),s(1,"i",93),n(2,"N/A "),a())}function ui(r,t){r&1&&(i(0,"span",94),s(1,"i",95),n(2,"Validado "),a())}function pi(r,t){r&1&&(i(0,"span",96),s(1,"i",97),n(2,"Pendiente "),a())}function mi(r,t){r&1&&(i(0,"span",45),s(1,"i",95),n(2,"OK "),a())}function fi(r,t){if(r&1){let e=S();i(0,"div",98)(1,"span",99),s(2,"i",100),a(),i(3,"input",101),T("ngModelChange",function(l){b(e);let c=p().$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){b(e);let c=p().$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()}if(r&2){let e=p().$implicit,d=p(3);o(3),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function gi(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function _i(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),g(10,si,3,1,"div",79),a()(),i(11,"td",80),g(12,ci,3,0,"span",81)(13,di,3,0,"span",82),a(),i(14,"td",80),g(15,ui,3,0,"span",83)(16,pi,3,0,"span",84)(17,mi,3,0,"span",85),a(),i(18,"td",37),g(19,fi,4,3,"div",86)(20,gi,2,0,"div",87),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function vi(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),s(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,_i,21,12,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function xi(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function bi(r,t){r&1&&(i(0,"span",113),s(1,"i",95),n(2,"Validado "),a())}function hi(r,t){r&1&&(i(0,"span",114),s(1,"i",97),n(2,"Pendiente "),a())}function Ci(r,t){if(r&1){let e=S();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",107)(8,"div"),n(9),g(10,xi,3,1,"div",79),a()(),i(11,"td",80)(12,"span",108),s(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),g(16,bi,3,0,"span",109)(17,hi,3,0,"span",110),a(),i(18,"td",37)(19,"div",98)(20,"span",111),s(21,"i",112),a(),i(22,"input",101),T("ngModelChange",function(l){let c=b(e).$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){let c=b(e).$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Ei(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),s(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Ci,23,10,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function Si(r,t){r&1&&(i(0,"div",2)(1,"div",115),s(2,"i",116),n(3," No hay productos en el detalle "),a()())}function Ai(r,t){if(r&1){let e=S();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",15),g(8,li,87,12,"div",16),i(9,"div",1),g(10,vi,33,2,"div",17)(11,Ei,33,2,"div",17)(12,Si,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){b(e);let l=p();return h(l.guardarPreparacion())}),s(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var fe=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):B.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,c)=>{let f=`${l.ProductoId}_${c}`;return this.inputValues[f]="",R(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,B.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):B.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,c=l.value.trim();if(console.log("Input value for row:",e,"Value:",c),e&&c){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(v=>v.trim()):[],E=f.includes(c)||c===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",c),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=c,l.classList.remove("is-invalid"),l.classList.add("is-valid"),B.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${c}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),B.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(v=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${v}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${c}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(c=>`\u2022 ${c.CopProducto} - ${c.Detalle.substring(0,50)}...`).join(`
`);B.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(c=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${c.CopProducto}</strong><br>
                  <small class="text-muted">${c.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);B.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:c=>{if(console.log("response: ",c),c.success)if(c.data&&c.data.length>0){let f=c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.success==="true"));c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.menssage==="ya existe registro"))?B.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?B.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${c.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):B.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else B.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${c.factura}</p>
                    <p class="text-success">${c.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else B.default.fire({title:"Error!",text:c.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-opciones"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(c){return d.onTableAction(c)})("customAction",function(c){return d.onCustomAction(c)}),a()()()()()(),g(8,Ai,19,5,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[$,U,L,G,H,W,J,X,j,K],encapsulation:2})};var V=ee(te());function yi(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),s(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),s(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),s(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),s(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),s(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),s(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),s(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),s(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),s(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),s(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),s(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),s(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),x(e.facturaActual.Secuencia),o(6),x(e.facturaActual.Numero),o(6),x(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),x(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Ti(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function Ii(r,t){r&1&&(i(0,"span",90),s(1,"i",91),n(2,"Requerido "),a())}function Fi(r,t){r&1&&(i(0,"span",92),s(1,"i",93),n(2,"N/A "),a())}function Di(r,t){r&1&&(i(0,"span",94),s(1,"i",95),n(2,"Validado "),a())}function Oi(r,t){r&1&&(i(0,"span",96),s(1,"i",97),n(2,"Pendiente "),a())}function wi(r,t){r&1&&(i(0,"span",45),s(1,"i",95),n(2,"OK "),a())}function Pi(r,t){if(r&1){let e=S();i(0,"div",98)(1,"span",99),s(2,"i",100),a(),i(3,"input",101),T("ngModelChange",function(l){b(e);let c=p().$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){b(e);let c=p().$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()}if(r&2){let e=p().$implicit,d=p(3);o(3),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Ri(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function ki(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),g(10,Ti,3,1,"div",79),a()(),i(11,"td",80),g(12,Ii,3,0,"span",81)(13,Fi,3,0,"span",82),a(),i(14,"td",80),g(15,Di,3,0,"span",83)(16,Oi,3,0,"span",84)(17,wi,3,0,"span",85),a(),i(18,"td",37),g(19,Pi,4,3,"div",86)(20,Ri,2,0,"div",87),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function Bi(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),s(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,ki,21,12,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function Vi(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;o(2),x(e.ubi2)}}function Ni(r,t){r&1&&(i(0,"span",113),s(1,"i",95),n(2,"Validado "),a())}function Mi(r,t){r&1&&(i(0,"span",114),s(1,"i",97),n(2,"Pendiente "),a())}function Ui(r,t){if(r&1){let e=S();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",107)(8,"div"),n(9),g(10,Vi,3,1,"div",79),a()(),i(11,"td",80)(12,"span",108),s(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),g(16,Ni,3,0,"span",109)(17,Mi,3,0,"span",110),a(),i(18,"td",37)(19,"div",98)(20,"span",111),s(21,"i",112),a(),i(22,"input",101),T("ngModelChange",function(l){let c=b(e).$implicit,f=p(3);return y(f.inputValues[c.input_field],l)||(f.inputValues[c.input_field]=l),h(l)}),C("keypress",function(l){let c=b(e).$implicit,f=p(3);return h(f.onInputKeyPress(l,c,c.input_field))}),a()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),x(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),A("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Li(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),s(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),s(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),s(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),s(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),s(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),s(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),s(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Ui,23,10,"tr",73),a()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function Gi(r,t){r&1&&(i(0,"div",2)(1,"div",115),s(2,"i",116),n(3," No hay productos en el detalle "),a()())}function $i(r,t){if(r&1){let e=S();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),a()(),i(7,"div",15),g(8,yi,87,12,"div",16),i(9,"div",1),g(10,Bi,33,2,"div",17)(11,Li,33,2,"div",17)(12,Gi,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){b(e);let l=p();return h(l.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){b(e);let l=p();return h(l.guardarPreparacion())}),s(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var ge=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):V.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,c)=>{let f=`${l.ProductoId}_${c}`;return this.inputValues[f]="",R(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,V.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):V.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,c=l.value.trim();if(console.log("Input value for row:",e,"Value:",c),e&&c){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(v=>v.trim()):[],E=f.includes(c)||c===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",c),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=c,l.classList.remove("is-invalid"),l.classList.add("is-valid"),V.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${c}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),V.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(v=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${v}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${c}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(c=>`\u2022 ${c.CopProducto} - ${c.Detalle.substring(0,50)}...`).join(`
`);V.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(c=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${c.CopProducto}</strong><br>
                  <small class="text-muted">${c.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);V.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:c=>{if(console.log("response: ",c),c.success)if(c.data&&c.data.length>0){let f=c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.success==="true"));c.data.some(v=>v.data&&v.data.length>0&&v.data.some(_=>_.menssage==="ya existe registro"))?V.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?V.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${c.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):V.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else V.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${c.factura}</p>
                    <p class="text-success">${c.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else V.default.fire({title:"Error!",text:c.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-despachar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(c){return d.onTableAction(c)})("customAction",function(c){return d.onCustomAction(c)}),a()()()()()(),g(8,$i,19,5,"div",8),a()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[$,U,L,G,H,W,J,X,j,K],encapsulation:2})};var Z=ee(te());var zi=(r,t,e,d)=>({"bg-success":r,"bg-warning text-dark":t,"bg-info":e,"bg-secondary":d});function Wi(r,t){r&1&&(i(0,"div",50)(1,"span",51),s(2,"i",52),n(3,"FACTURA MULTIBODEGA "),a()())}function Ji(r,t){if(r&1&&(i(0,"span",53),n(1),a()),r&2){let e=t.$implicit;o(),m(" ",e," ")}}function Xi(r,t){if(r&1&&(i(0,"tr",26)(1,"td",31),s(2,"i",39),n(3,"PDF Factura: "),a(),i(4,"td",29)(5,"a",54),s(6,"i",41),n(7,"Ver PDF "),a()()()),r&2){let e=p(2);o(5),u("href","http://"+(e.facturaActual==null?null:e.facturaActual.SRI_LNK),Ce)}}function Hi(r,t){if(r&1&&(i(0,"tr",26)(1,"td",31),s(2,"i",55),n(3,"RUC: "),a(),i(4,"td",29)(5,"span",56),n(6),a()()()),r&2){let e=p(2);o(6),x(e.facturaActual==null||e.facturaActual.Ruc==null?null:e.facturaActual.Ruc.trim())}}function ji(r,t){if(r&1){let e=S();i(0,"div",1)(1,"div",13),g(2,Wi,4,0,"div",14),i(3,"div",15)(4,"div",16),s(5,"i",17),i(6,"h6",18),n(7,"Informaci\xF3n de la Factura"),a()()()(),i(8,"div",19)(9,"div",20)(10,"div",21)(11,"small",22),s(12,"i",23),n(13,"Datos Principales "),a()(),i(14,"div",24)(15,"table",25)(16,"tbody")(17,"tr",26)(18,"td",27),s(19,"i",28),n(20,"Bodega(s): "),a(),i(21,"td",29),g(22,Ji,2,1,"span",30),a()(),i(23,"tr",26)(24,"td",31),s(25,"i",32),n(26,"Secuencia: "),a(),i(27,"td",29)(28,"span",33),n(29),a()()(),i(30,"tr",26)(31,"td",31),s(32,"i",34),n(33,"N\xFAmero: "),a(),i(34,"td",29),n(35),a()(),i(36,"tr",26)(37,"td",31),s(38,"i",35),n(39,"Cliente: "),a(),i(40,"td",29),n(41),a()(),i(42,"tr",26)(43,"td",31),s(44,"i",36),n(45,"Fecha: "),a(),i(46,"td",29)(47,"span",37),n(48),O(49,"date"),a()()(),g(50,Xi,8,1,"tr",38),i(51,"tr",26)(52,"td",31),s(53,"i",39),n(54,"Series: "),a(),i(55,"td",29)(56,"button",40),C("click",function(){b(e);let l=p();return h(l.verSeries())}),s(57,"i",41),n(58,"Ver series "),a()()()()()()()(),i(59,"div",19)(60,"div",20)(61,"div",21)(62,"small",22),s(63,"i",42),n(64,"Informaci\xF3n de Contacto "),a()(),i(65,"div",24)(66,"table",25)(67,"tbody")(68,"tr",26)(69,"td",31),s(70,"i",43),n(71,"Ciudad: "),a(),i(72,"td",29)(73,"span",44),n(74),a()()(),i(75,"tr",26)(76,"td",31),s(77,"i",45),n(78,"Vendedor: "),a(),i(79,"td",29),n(80),a()(),i(81,"tr",26)(82,"td",31),s(83,"i",46),n(84,"Tipo Pedido: "),a(),i(85,"td",29)(86,"span",47),n(87),a()()(),i(88,"tr",26)(89,"td",31),s(90,"i",48),n(91,"Forma Pago: "),a(),i(92,"td",29)(93,"span",49),n(94),a()()(),g(95,Hi,7,1,"tr",38),a()()()()()()}if(r&2){let e=p();o(2),u("ngIf",e.isMultibodega()),o(20),u("ngForOf",e.getBodegasUnicas()),o(7),m(" ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(6),m(" ",e.facturaActual==null?null:e.facturaActual.Numero," "),o(6),m(" ",e.facturaActual==null||e.facturaActual.Nombre==null?null:e.facturaActual.Nombre.trim()," "),o(7),m(" ",w(49,12,e.facturaActual==null?null:e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(2),u("ngIf",e.facturaActual==null?null:e.facturaActual.SRI_LNK),o(24),m(" ",e.facturaActual==null||e.facturaActual.Ciudad==null?null:e.facturaActual.Ciudad.trim()," "),o(6),x(e.facturaActual==null||e.facturaActual.Vendedor==null?null:e.facturaActual.Vendedor.trim()),o(7),m(" ",e.facturaActual==null||e.facturaActual.TipoP==null?null:e.facturaActual.TipoP.trim()," "),o(7),m(" ",e.facturaActual==null||e.facturaActual.FPago==null?null:e.facturaActual.FPago.trim()," "),o(),u("ngIf",e.facturaActual==null?null:e.facturaActual.Ruc)}}function qi(r,t){if(r&1&&(i(0,"tr",79)(1,"td",80)(2,"span",81),n(3),a()(),i(4,"td",82),n(5),a(),i(6,"td",83)(7,"small"),n(8),a()(),i(9,"td",84),n(10),a(),i(11,"td",80)(12,"small",85),n(13),O(14,"number"),a()(),i(15,"td",80)(16,"small",85),n(17),O(18,"number"),a()(),i(19,"td",82)(20,"span",86),n(21),O(22,"number"),a()()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),m(" ",e.bodega_codigo," "),o(2),m(" ",e.producto_codigo," "),o(3),x(e.producto_nombre),o(2),m(" ",e.factura_cantidad," "),o(3),m("$",w(14,8,e.factura_subtoal,"1.2-2"),""),o(4),m("$",w(18,11,e.factura_iva,"1.2-2"),""),o(4),m("$",w(22,14,e.factura_total,"1.2-2"),"")}}function Ki(r,t){if(r&1&&(i(0,"div")(1,"small",90),n(2),a(),s(3,"br"),i(4,"small",85),n(5),O(6,"date"),a()()),r&2){let e=p().$implicit;o(2),x(e.fl_preparadapor),o(3),x(w(6,2,e.fl_preparadafecha,"dd/MM/yyyy HH:mm"))}}function Yi(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function Qi(r,t){if(r&1&&(i(0,"div")(1,"small",33),n(2),a(),s(3,"br"),i(4,"small",85),n(5),O(6,"date"),a()()),r&2){let e=p().$implicit;o(2),x(e.fl_verificadapor),o(3),x(w(6,2,e.fl_verificadafecha,"dd/MM/yyyy HH:mm"))}}function Zi(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function ea(r,t){if(r&1&&(i(0,"div")(1,"small",91),n(2),a(),s(3,"br"),i(4,"small",92),n(5),a(),s(6,"br"),i(7,"small",85),n(8),O(9,"date"),a()()),r&2){let e=p().$implicit;o(2),x(e.fl_guiaconsolidado),o(3),x(e.fl_guiaconsolidadopor),o(3),x(w(9,3,e.fl_guiaconsolidadofecha,"dd/MM/yyyy HH:mm"))}}function ta(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function ia(r,t){if(r&1&&(i(0,"div")(1,"small",93),n(2),a(),s(3,"br"),i(4,"small",90),n(5),a(),s(6,"br"),i(7,"small",85),n(8),O(9,"date"),a()()),r&2){let e=p().$implicit;o(2),x(e.fl_guiadespachofinal),o(3),x(e.fl_guiadespachofinalpor),o(3),x(w(9,3,e.fl_guiadespachofinalfecha,"dd/MM/yyyy HH:mm"))}}function aa(r,t){r&1&&(i(0,"span",85),n(1,"-"),a())}function na(r,t){if(r&1&&(i(0,"tr",79)(1,"td",80)(2,"span",81),n(3),a()(),i(4,"td",82),n(5),a(),i(6,"td",80)(7,"span",87),n(8),a()(),i(9,"td",80),g(10,Ki,7,5,"div",88)(11,Yi,2,0,"span",89),a(),i(12,"td",80),g(13,Qi,7,5,"div",88)(14,Zi,2,0,"span",89),a(),i(15,"td",80),g(16,ea,10,6,"div",88)(17,ta,2,0,"span",89),a(),i(18,"td",80),g(19,ia,10,6,"div",88)(20,aa,2,0,"span",89),a()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),m(" ",e.bodega_codigo," "),o(2),m(" ",e.productos_count," "),o(2),u("ngClass",Ae(13,zi,e.fl_estado==="INGRESADAGUIA",e.fl_estado==="PREPARADA",e.fl_estado==="VERIFICADA",e.fl_estado==="-"||!e.fl_estado)),o(),m(" ",e.fl_estado==="-"?"Pendiente":e.fl_estado||"Pendiente"," "),o(2),u("ngIf",e.fl_preparadapor&&e.fl_preparadapor!=="-"),o(),u("ngIf",!e.fl_preparadapor||e.fl_preparadapor==="-"),o(2),u("ngIf",e.fl_verificadapor&&e.fl_verificadapor!=="-"),o(),u("ngIf",!e.fl_verificadapor||e.fl_verificadapor==="-"),o(2),u("ngIf",e.fl_guiaconsolidadopor&&e.fl_guiaconsolidadopor!==""),o(),u("ngIf",!e.fl_guiaconsolidadopor||e.fl_guiaconsolidadopor===""),o(2),u("ngIf",e.fl_guiadespachofinalpor&&e.fl_guiadespachofinalpor!=="-"),o(),u("ngIf",!e.fl_guiadespachofinalpor||e.fl_guiadespachofinalpor==="-")}}function ra(r,t){if(r&1&&(i(0,"div",57)(1,"div",58)(2,"div",59)(3,"div",60)(4,"h6",61),s(5,"i",62),n(6),a()(),i(7,"div",63)(8,"div",64)(9,"table",65)(10,"thead",66)(11,"tr")(12,"th",67),s(13,"i",68),n(14,"Bodega "),a(),i(15,"th",69),s(16,"i",70),n(17,"C\xF3digo "),a(),i(18,"th",71),s(19,"i",23),n(20,"Descripci\xF3n "),a(),i(21,"th",67),n(22," Cantidad "),a(),i(23,"th",72),n(24," Subtotal "),a(),i(25,"th",72),n(26," IVA "),a(),i(27,"th",72),n(28," Total "),a()()(),i(29,"tbody"),g(30,qi,23,17,"tr",73),a()()()()()(),i(31,"div",2)(32,"div",74)(33,"div",60)(34,"h6",75),s(35,"i",76),n(36,"Estado de Tracking por Bodega "),a()(),i(37,"div",63)(38,"div",64)(39,"table",65)(40,"thead",77)(41,"tr")(42,"th",69),n(43,"Bodega"),a(),i(44,"th",67),n(45,"Productos"),a(),i(46,"th",69),n(47,"Estado"),a(),i(48,"th",78),n(49,"Preparado"),a(),i(50,"th",78),n(51,"Verificado"),a(),i(52,"th",78),n(53,"Gu\xEDa Consolidado"),a(),i(54,"th",78),n(55,"Gu\xEDa Despacho"),a()()(),i(56,"tbody"),g(57,na,21,18,"tr",73),a()()()()()()()),r&2){let e=p();o(6),m("Detalle de Productos (",e.detalleFactura.length,") "),o(24),u("ngForOf",e.detalleFactura),o(27),u("ngForOf",e.getDetalleAgrupadoPorBodega())}}function oa(r,t){r&1&&(i(0,"div",107)(1,"div",108)(2,"span",109),n(3,"Cargando..."),a()(),i(4,"p",110),n(5,"Cargando series..."),a()())}function la(r,t){if(r&1&&(i(0,"div",118)(1,"span",119),n(2),a()()),r&2){let e=t.$implicit;o(2),x(e)}}function sa(r,t){if(r&1&&(i(0,"tr",79)(1,"td",115),n(2),a(),i(3,"td",116)(4,"small"),n(5),a()(),i(6,"td",116),g(7,la,3,1,"div",117),a()()),r&2){let e=t.$implicit;o(2),m(" ",e.codigo," "),o(3),x(e.producto_nombre),o(2),u("ngForOf",e.series_array)}}function ca(r,t){if(r&1&&(i(0,"div",64)(1,"table",111)(2,"thead",77)(3,"tr")(4,"th",112),s(5,"i",70),n(6,"C\xF3digo "),a(),i(7,"th",113),s(8,"i",23),n(9,"Producto "),a(),i(10,"th",113),s(11,"i",114),n(12,"Series "),a()()(),i(13,"tbody"),g(14,sa,8,3,"tr",73),a()()()),r&2){let e=p(2);o(14),u("ngForOf",e.seriesData)}}function da(r,t){r&1&&(i(0,"div",107),s(1,"i",120),i(2,"p",110),n(3,"No se encontraron series para esta factura"),a()())}function ua(r,t){if(r&1){let e=S();i(0,"div",94)(1,"div",95)(2,"div",96)(3,"div",97)(4,"h5",98),s(5,"i",99),n(6),a(),i(7,"button",100),C("click",function(){b(e);let l=p();return h(l.cerrarModalSeries())}),a()(),i(8,"div",101),g(9,oa,6,0,"div",102)(10,ca,15,1,"div",103)(11,da,4,0,"div",102),a(),i(12,"div",104)(13,"button",105),C("click",function(){b(e);let l=p();return h(l.cerrarModalSeries())}),s(14,"i",106),n(15,"Cerrar "),a()()()()()}if(r&2){let e=p();o(6),m("Series de Productos - Factura ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(3),u("ngIf",e.isLoadingSeries),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length>0),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length===0)}}var _e=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaActual=null;detalleFactura=[];seriesData=[];isLoadingSeries=!1;showModalSeries=!1;fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];secuenciafactura="";MostrarDetalleFactura=!1;customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):Z.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=R(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e)}onbuscarFactura(){if(!this.secuenciafactura||this.secuenciafactura.trim()===""){Z.default.fire("Error!","Por favor ingrese una secuencia de factura","warning");return}this.isLoading=!0;let t={secuencia:this.secuenciafactura.trim(),usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasTracking(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data&&e.data.length>0?(this.facturaActual=e.data[0],this.detalleFactura=e.detalle||[],this.MostrarDetalleFactura=!0):(Z.default.fire("Error!","No se encontr\xF3 informaci\xF3n de la factura","error"),this.MostrarDetalleFactura=!1),this.isLoading=!1},error:e=>{console.log("error: ",e),Z.default.fire("Error!","Ocurri\xF3 un error al buscar la factura","error"),this.isLoading=!1,this.MostrarDetalleFactura=!1}})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}getBodegasUnicas(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t=this.detalleFactura.map(e=>e.bodega_codigo);return[...new Set(t)]}isMultibodega(){return this.getBodegasUnicas().length>1}getBodegasString(){return this.getBodegasUnicas().join(", ")}getDetalleAgrupadoPorBodega(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t={};return this.detalleFactura.forEach(e=>{let d=e.bodega_codigo;t[d]?(t[d].productos_count++,t[d].total_factura+=parseFloat(e.factura_total)):t[d]={bodega_codigo:e.bodega_codigo,bodega_nombre:e.bodega_nombre,fl_estado:e.fl_estado,fl_preparadapor:e.fl_preparadapor,fl_preparadafecha:e.fl_preparadafecha,fl_verificadapor:e.fl_verificadapor,fl_verificadafecha:e.fl_verificadafecha,fl_guiaconsolidado:e.fl_guiaconsolidado,fl_guiaconsolidadofecha:e.fl_guiaconsolidadofecha,fl_guiaconsolidadopor:e.fl_guiaconsolidadopor,fl_guiadespachofinal:e.fl_guiadespachofinal,fl_guiadespachofinalfecha:e.fl_guiadespachofinalfecha,fl_guiadespachofinalpor:e.fl_guiadespachofinalpor,productos_count:1,total_factura:parseFloat(e.factura_total)}}),Object.values(t)}verSeries(){if(!this.facturaActual||!this.facturaActual.Id){Z.default.fire("Error!","No hay factura seleccionada","warning");return}this.isLoadingSeries=!0,this.seriesData=[],this.showModalSeries=!0;let t={factura_id:this.facturaActual.Id};console.log("param: ",t),this.FacturacionService.GetFacturasSeries(t).subscribe({next:e=>{console.log("response: ",e),this.isLoadingSeries=!1,e.success&&e.data&&e.data.length>0?this.seriesData=e.data.map(d=>R(P({},d),{series_array:d.series?d.series.split("/"):[]})):this.seriesData=[]},error:e=>{console.log("error: ",e),this.isLoadingSeries=!1,this.seriesData=[],Z.default.fire("Error!","Ocurri\xF3 un error al buscar las series","error")}})}cerrarModalSeries(){this.showModalSeries=!1,this.seriesData=[],this.isLoadingSeries=!1}static \u0275fac=function(e){return new(e||r)(F(q),F(M),F(z))};static \u0275cmp=N({type:r,selectors:[["app-tracking-facturas"]],decls:16,vars:6,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"col-xl-4","col-md-6","mb-2"],[1,"form-label","fw-bold"],[1,"input-group","mb-3"],["type","text","placeholder","001-001-000000123","name","secuenciafactura",1,"form-control","form-control-solid",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","row",4,"ngIf"],["class","row mt-3",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.5);",4,"ngIf"],[1,"col-12","mb-1"],["class","mb-2",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"d-flex","align-items-center"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],["class","badge bg-info me-1 fs-6",4,"ngFor","ngForOf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],["style","height: 28px;",4,"ngIf"],[1,"fa","fa-file-pdf","text-danger","me-1"],[1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-external-link-alt","me-1"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"mb-2"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-info","me-1","fs-6"],["target","_blank",1,"btn","btn-sm","btn-outline-danger",3,"href"],[1,"fa","fa-id-card","text-warning","me-1"],[1,"font-monospace"],[1,"row","mt-3"],[1,"col-12","mb-3"],[1,"card","border-success"],[1,"card-header"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","35%"],[1,"text-center","py-2",2,"width","10%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"card","border-info"],[1,"text-info","mb-0"],[1,"fa","fa-route","me-1"],[1,"table-info"],[1,"text-center","py-2",2,"width","17%"],[1,"align-middle"],[1,"text-center","py-2"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-dark","fs-6",3,"title"],[1,"text-center","fw-bold","py-2"],[1,"py-2"],[1,"text-center","fw-bold","text-primary","py-2"],[1,"text-muted"],[1,"text-success"],[1,"badge","fs-6",3,"ngClass"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-success"],[1,"fw-bold","text-warning"],[1,"fw-bold","text-info"],[1,"fw-bold","text-danger"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","modalSeriesLabel",1,"modal-title"],[1,"fa","fa-barcode","me-2"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa","fa-times","me-1"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-info"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"table","table-striped","table-hover","nowrap"],[1,"",2,"width","20%"],[1,"text-center",2,"width","40%"],[1,"fa","fa-list","me-1"],[1,"fw-bold"],[1,"px-3"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"badge","bg-dark","fs-6"],[1,"fa","fa-exclamation-triangle","text-warning",2,"font-size","2rem"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),s(4,"div",4),i(5,"div",4)(6,"div",5)(7,"label",6),n(8,"Secuencia Factura:"),a(),i(9,"div",7)(10,"input",8),T("ngModelChange",function(c){return y(d.secuenciafactura,c)||(d.secuenciafactura=c),c}),a(),i(11,"button",9),C("click",function(){return d.onbuscarFactura()}),n(12,"Buscar"),a()()()(),g(13,ji,96,15,"div",10)(14,ra,58,3,"div",11),a()()()(),g(15,ua,16,4,"div",12)),e&2&&(o(3),u("headerTitle","Buscar Tracking de Facturas")("cardClass","mb-4"),o(7),A("ngModel",d.secuenciafactura),o(3),u("ngIf",d.MostrarDetalleFactura),o(),u("ngIf",d.MostrarDetalleFactura&&d.detalleFactura.length>0),o(),u("ngIf",d.showModalSeries))},dependencies:[$,se,U,L,ye,G,H,W,J,X,j],encapsulation:2})};var Za=[{path:"picking/prepararfacturas",component:ue,data:{title:"Preparar Facturas",breadcrumb:"Preparar Facturas"}},{path:"picking/verificarfacturas",component:pe,data:{title:"Verificar Facturas",breadcrumb:"Verificar Facturas"}},{path:"picking/guiaspickup",component:me,data:{title:"Guias Pickup",breadcrumb:"Guias Pickup"}},{path:"opciones",component:fe,data:{title:"Opciones",breadcrumb:"Opciones"}},{path:"picking/despachar",component:ge,data:{title:"Facturas por despachar",breadcrumb:"Facturas por despachar"}},{path:"tracking",component:_e,data:{title:"Tracking Facturas",breadcrumb:"Facturas por rastrear"}}];export{Za as LogisticaRoutes};
