import{a as q}from"./chunk-VMKRNOHW.js";import{a as K}from"./chunk-SLII4CAF.js";import{a as j}from"./chunk-GDTWJE5M.js";import"./chunk-AMGMCQ56.js";import{a as ee}from"./chunk-AI45PTO7.js";import{A as H,C as se,G as ye,H as Ie,I as Te,J as Fe,K as ce,N as X,l as z,s as Ae,t as J,v as W}from"./chunk-LVDJUO5Z.js";import{k as le,l as U,m as L,p as $,r as Se,t as G}from"./chunk-AQUAFEI7.js";import{Ab as xe,Ib as a,Jb as i,Kb as c,Ob as S,Ub as C,Vb as p,Ya as ve,a as P,ab as o,b as k,cc as n,dc as b,e as Z,ec as m,fc as be,gb as A,hc as y,ic as I,jc as T,lb as N,na as h,nc as he,oa as v,oc as Ce,pc as Ee,qb as g,qc as D,sc as w,wb as Y,yb as u,yc as M}from"./chunk-FF5Z5KFO.js";var R=Z(ee());function Oe(r,t){if(r&1&&(a(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),i(),a(4,"div",24),c(5,"i",25),a(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),i()()(),a(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),c(12,"i",31),n(13,"Datos Principales "),i()(),a(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),c(19,"i",36),n(20,"Bodega: "),i(),a(21,"td",37)(22,"span",38),n(23),i()()(),a(24,"tr",34)(25,"td",39),c(26,"i",40),n(27,"Secuencia: "),i(),a(28,"td",37)(29,"span",41),n(30),i()()(),a(31,"tr",34)(32,"td",39),c(33,"i",42),n(34,"N\xFAmero: "),i(),a(35,"td",37),n(36),i()(),a(37,"tr",34)(38,"td",39),c(39,"i",43),n(40,"Cliente: "),i(),a(41,"td",37),n(42),i()(),a(43,"tr",34)(44,"td",39),c(45,"i",44),n(46,"Fecha: "),i(),a(47,"td",37)(48,"span",45),n(49),D(50,"date"),i()()()()()()()(),a(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),c(55,"i",46),n(56,"Informaci\xF3n de Contacto "),i()(),a(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),c(62,"i",47),n(63,"Ciudad: "),i(),a(64,"td",37)(65,"span",48),n(66),i()()(),a(67,"tr",34)(68,"td",39),c(69,"i",49),n(70,"Vendedor: "),i(),a(71,"td",37),n(72),i()(),a(73,"tr",34)(74,"td",39),c(75,"i",50),n(76,"Tipo Pedido: "),i(),a(77,"td",37)(78,"span",51),n(79),i()()(),a(80,"tr",34)(81,"td",39),c(82,"i",52),n(83,"Forma Pago: "),i(),a(84,"td",37)(85,"span",53),n(86),i()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),b(e.facturaActual.Secuencia),o(6),b(e.facturaActual.Numero),o(6),b(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),b(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Pe(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function ke(r,t){r&1&&(a(0,"span",90),c(1,"i",91),n(2,"Requerido "),i())}function Re(r,t){r&1&&(a(0,"span",92),c(1,"i",93),n(2,"N/A "),i())}function Ve(r,t){r&1&&(a(0,"span",94),c(1,"i",95),n(2,"Validado "),i())}function Be(r,t){r&1&&(a(0,"span",96),c(1,"i",97),n(2,"Pendiente "),i())}function Ne(r,t){r&1&&(a(0,"span",45),c(1,"i",95),n(2,"OK "),i())}function Me(r,t){if(r&1){let e=S();a(0,"div",98)(1,"span",99),c(2,"i",100),i(),a(3,"input",101),T("ngModelChange",function(l){h(e);let s=p().$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){h(e);let s=p().$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()}if(r&2){let e=p().$implicit,d=p(3);o(3),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function Ue(r,t){r&1&&(a(0,"div",102),n(1," Sin c\xF3digo de barras "),i())}function Le(r,t){if(r&1&&(a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",78)(8,"div"),n(9),g(10,Pe,3,1,"div",79),i()(),a(11,"td",80),g(12,ke,3,0,"span",81)(13,Re,3,0,"span",82),i(),a(14,"td",80),g(15,Ve,3,0,"span",83)(16,Be,3,0,"span",84)(17,Ne,3,0,"span",85),i(),a(18,"td",37),g(19,Me,4,3,"div",86)(20,Ue,2,0,"div",87),i()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function $e(r,t){if(r&1&&(a(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),c(4,"i",57),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,Le,21,12,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function Ge(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function ze(r,t){r&1&&(a(0,"span",113),c(1,"i",95),n(2,"Validado "),i())}function Je(r,t){r&1&&(a(0,"span",114),c(1,"i",97),n(2,"Pendiente "),i())}function We(r,t){if(r&1){let e=S();a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",107)(8,"div"),n(9),g(10,Ge,3,1,"div",79),i()(),a(11,"td",80)(12,"span",108),c(13,"i",91),n(14,"Requerido "),i()(),a(15,"td",80),g(16,ze,3,0,"span",109)(17,Je,3,0,"span",110),i(),a(18,"td",37)(19,"div",98)(20,"span",111),c(21,"i",112),i(),a(22,"input",101),T("ngModelChange",function(l){let s=h(e).$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){let s=h(e).$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function He(r,t){if(r&1&&(a(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),c(4,"i",105),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,We,23,10,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function Xe(r,t){r&1&&(a(0,"div",2)(1,"div",115),c(2,"i",116),n(3," No hay productos en el detalle "),i()())}function je(r,t){if(r&1){let e=S();a(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),i(),a(6,"button",14),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),i()(),a(7,"div",15),g(8,Oe,87,12,"div",16),a(9,"div",1),g(10,$e,33,2,"div",17)(11,He,33,2,"div",17)(12,Xe,4,0,"div",17),i()(),a(13,"div",18)(14,"button",19),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),n(15,"Cerrar"),i(),a(16,"button",20),C("click",function(){h(e);let l=p();return v(l.guardarPreparacion())}),c(17,"i",21),n(18,"Guardar Preparaci\xF3n "),i()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var de=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):R.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,s)=>{let f=`${l.ProductoId}_${s}`;return this.inputValues[f]="",k(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,R.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):R.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,s=l.value.trim();if(console.log("Input value for row:",e,"Value:",s),e&&s){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(_=>_.trim()):[],E=f.includes(s)||s===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",s),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=s,l.classList.remove("is-invalid"),l.classList.add("is-valid"),R.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${s}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),R.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(_=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${_}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${s}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(s=>`\u2022 ${s.CopProducto} - ${s.Detalle.substring(0,50)}...`).join(`
`);R.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(s=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${s.CopProducto}</strong><br>
                  <small class="text-muted">${s.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);R.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:s=>{if(console.log("response: ",s),s.success)if(s.data&&s.data.length>0){let f=s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.success==="true"));s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.menssage==="ya existe registro"))?R.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?R.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${s.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):R.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else R.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${s.factura}</p>
                    <p class="text-success">${s.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else R.default.fire({title:"Error!",text:s.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:s=>{console.log("error: ",s),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-preparar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),c(4,"div",4),a(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(s){return d.onTableAction(s)})("customAction",function(s){return d.onCustomAction(s)}),i()()()()()(),g(8,je,19,5,"div",8),i()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[G,U,L,$,X,J,W,H,j,K],encapsulation:2})};var F=Z(ee());var qe=(r,t)=>({"bg-warning":r,"bg-info":t}),Ke=(r,t,e)=>({"bg-success":r,"bg-warning":t,"bg-secondary":e}),Ye=(r,t)=>({"table-success":r,"table-warning":t});function Qe(r,t){if(r&1&&(a(0,"div",4)(1,"div",25)(2,"h5",26),n(3,"No cerrar esta ventana si esta realizando el proceso de Verificaci\xF3n"),i(),a(4,"div",27),c(5,"i",28),a(6,"h6",29),n(7,"Informaci\xF3n de la Factura"),i()()(),a(8,"div",30)(9,"div",31)(10,"div",32)(11,"small",33),c(12,"i",34),n(13,"Datos Principales "),i()(),a(14,"div",35)(15,"table",36)(16,"tbody")(17,"tr",37)(18,"td",38),c(19,"i",39),n(20,"Bodega: "),i(),a(21,"td",40)(22,"span",41),n(23),i()()(),a(24,"tr",37)(25,"td",42),c(26,"i",43),n(27,"Secuencia: "),i(),a(28,"td",40)(29,"span",44),n(30),i()()(),a(31,"tr",37)(32,"td",42),c(33,"i",45),n(34,"N\xFAmero: "),i(),a(35,"td",40),n(36),i()(),a(37,"tr",37)(38,"td",42),c(39,"i",46),n(40,"Cliente: "),i(),a(41,"td",40),n(42),i()(),a(43,"tr",37)(44,"td",42),c(45,"i",47),n(46,"Fecha: "),i(),a(47,"td",40)(48,"span",48),n(49),D(50,"date"),i()()()()()()()(),a(51,"div",30)(52,"div",31)(53,"div",32)(54,"small",33),c(55,"i",49),n(56,"Informaci\xF3n de Contacto "),i()(),a(57,"div",35)(58,"table",36)(59,"tbody")(60,"tr",37)(61,"td",42),c(62,"i",50),n(63,"Ciudad: "),i(),a(64,"td",40)(65,"span",51),n(66),i()()(),a(67,"tr",37)(68,"td",42),c(69,"i",52),n(70,"Vendedor: "),i(),a(71,"td",40),n(72),i()(),a(73,"tr",37)(74,"td",42),c(75,"i",53),n(76,"Tipo Pedido: "),i(),a(77,"td",40)(78,"span",54),n(79),i()()(),a(80,"tr",37)(81,"td",42),c(82,"i",55),n(83,"Forma Pago: "),i(),a(84,"td",40)(85,"span",56),n(86),i()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),b(e.facturaActual.Secuencia),o(6),b(e.facturaActual.Numero),o(6),b(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),b(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Ze(r,t){if(r&1&&(a(0,"div",5)(1,"div",4)(2,"div",30)(3,"div",57),c(4,"i",58),a(5,"strong"),n(6),i()()(),a(7,"div",30)(8,"div",57),c(9,"i",59),a(10,"strong"),n(11),i()()()()()),r&2){let e=p(2);o(6),m("Total de productos: ",e.detalleFactura.length,""),o(5),m("Productos verificados: ",e.productosVerificados,"")}}function et(r,t){if(r&1&&(a(0,"div",72),n(1),i()),r&2){let e=p(3);o(),m(" Producto: ",e.productoActual.Detalle," ")}}function tt(r,t){r&1&&(a(0,"div",73),n(1," C\xF3digo no encontrado en la factura "),i())}function at(r,t){if(r&1){let e=S();a(0,"div")(1,"label",64),c(2,"i",74),n(3,"Serie: "),a(4,"span",75),n(5),i()(),a(6,"input",76,1),T("ngModelChange",function(l){h(e);let s=p(3);return I(s.serieActual,l)||(s.serieActual=l),v(l)}),C("keypress",function(l){h(e);let s=p(3);return v(s.onSerieEnter(l))}),i()()}if(r&2){let e=p(3);o(4),u("ngClass",he(4,qe,e.productoActual.registroserieEntrada==="0",e.productoActual.registroserieEntrada==="1")),o(),m(" ",e.productoActual.registroserieEntrada==="1"?"Controlada":"Libre"," "),o(),y("ngModel",e.serieActual),u("disabled",!e.productoActual)}}function it(r,t){if(r&1){let e=S();a(0,"div")(1,"label",64),c(2,"i",77),n(3,"Cantidad: "),a(4,"span",78),n(5,"Solo Cantidad"),i()(),a(6,"input",79,2),T("ngModelChange",function(l){h(e);let s=p(3);return I(s.cantidadActual,l)||(s.cantidadActual=l),v(l)}),C("keypress",function(l){h(e);let s=p(3);return v(s.onCantidadEnter(l))}),i()()}if(r&2){let e=p(3);o(6),y("ngModel",e.cantidadActual),u("placeholder","Confirmar cantidad (m\xE1x: "+e.productoActual.Cantidad+")")("disabled",!e.productoActual)("max",e.productoActual.Cantidad)}}function nt(r,t){r&1&&(a(0,"div",80),c(1,"i",81),n(2," Primero escanee un c\xF3digo de producto "),i())}function rt(r,t){if(r&1&&(a(0,"div",82)(1,"div",4)(2,"div",83)(3,"strong"),n(4),i(),n(5),i(),a(6,"div",84)(7,"span",85),n(8),i(),a(9,"span",86),n(10),i()()()()),r&2){let e=p(3);o(4),b(e.productoActual.CopProducto),o(),m(" - ",e.productoActual.Detalle," "),o(3),m("Cantidad: ",e.productoActual.Cantidad,""),o(),u("ngClass",Ce(6,Ke,e.productoActual.cantidadVerificada===e.productoActual.Cantidad,e.productoActual.cantidadVerificada>0&&e.productoActual.cantidadVerificada<e.productoActual.Cantidad,e.productoActual.cantidadVerificada===0)),o(),be(" Verificado: ",e.productoActual.cantidadVerificada||0,"/",e.productoActual.Cantidad," ")}}function ot(r,t){if(r&1){let e=S();a(0,"div",5)(1,"div",60)(2,"div",61)(3,"div",62)(4,"div",30)(5,"div",63)(6,"label",64),c(7,"i",65),n(8,"C\xF3digo Producto: "),i(),a(9,"input",66,0),T("ngModelChange",function(l){h(e);let s=p(2);return I(s.codigoProductoActual,l)||(s.codigoProductoActual=l),v(l)}),C("keypress",function(l){h(e);let s=p(2);return v(s.onCodigoProductoEnter(l))}),i(),g(11,et,2,1,"div",67)(12,tt,2,0,"div",68),i()(),a(13,"div",30),g(14,at,8,7,"div",69)(15,it,8,4,"div",69)(16,nt,3,0,"div",70),i()(),g(17,rt,11,10,"div",71),i()()()}if(r&2){let e=p(2);o(9),xe("is-valid",e.productoActual)("is-invalid",e.codigoProductoActual&&!e.productoActual),y("ngModel",e.codigoProductoActual),o(2),u("ngIf",e.productoActual),o(),u("ngIf",e.codigoProductoActual&&!e.productoActual),o(2),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="1"),o(),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="0"),o(),u("ngIf",!e.productoActual),o(),u("ngIf",e.productoActual)}}function lt(r,t){r&1&&(a(0,"span",113),c(1,"i",77),n(2,"Cantidad "),i())}function st(r,t){r&1&&(a(0,"span",114),c(1,"i",74),n(2,"Serie Libre "),i())}function ct(r,t){r&1&&(a(0,"span",115),c(1,"i",102),n(2,"Serie Obligatoria "),i())}function dt(r,t){if(r&1&&(a(0,"small",122),c(1,"i",74),n(2),i()),r&2){let e=t.$implicit;o(2),m("",e," ")}}function ut(r,t){if(r&1&&(a(0,"div",118)(1,"div",119)(2,"span",115),n(3),i()(),a(4,"div",120),g(5,dt,3,1,"small",121),i()()),r&2){let e=p(2).$implicit;o(3),be(" ",e.seriesIngresadas.length,"/",e.Cantidad," series "),o(2),u("ngForOf",e.seriesIngresadas)}}function pt(r,t){r&1&&(a(0,"div",123)(1,"small"),n(2,"Sin series ingresadas"),i()())}function mt(r,t){if(r&1&&(a(0,"div"),g(1,ut,6,3,"div",116)(2,pt,3,0,"div",117),i()),r&2){let e=p().$implicit;o(),u("ngIf",e.seriesIngresadas&&e.seriesIngresadas.length>0),o(),u("ngIf",!e.seriesIngresadas||e.seriesIngresadas.length===0)}}function ft(r,t){if(r&1&&(a(0,"div",63)(1,"span",125),c(2,"i",24),n(3),i()()),r&2){let e=p(2).$implicit;o(3),m("",e.cantidadVerificada," confirmados ")}}function gt(r,t){r&1&&(a(0,"div",123)(1,"small"),n(2,"Cantidad pendiente"),i()())}function _t(r,t){if(r&1&&(a(0,"div"),g(1,ft,4,1,"div",124)(2,gt,3,0,"div",117),i()),r&2){let e=p().$implicit;o(),u("ngIf",e.cantidadVerificada>0),o(),u("ngIf",!e.cantidadVerificada||e.cantidadVerificada===0)}}function bt(r,t){r&1&&(a(0,"span",126),c(1,"i",24),n(2,"Completo "),i())}function ht(r,t){r&1&&(a(0,"span",114),c(1,"i",127),n(2,"Parcial "),i())}function vt(r,t){r&1&&(a(0,"span",113),c(1,"i",128),n(2,"Pendiente "),i())}function xt(r,t){if(r&1&&(a(0,"tr",104)(1,"td",105),g(2,lt,3,0,"span",106)(3,st,3,0,"span",107)(4,ct,3,0,"span",108),i(),a(5,"td",109),n(6),i(),a(7,"td",109),n(8),i(),a(9,"td",110),n(10),i(),a(11,"td",111),n(12),i(),a(13,"td",40),g(14,mt,3,2,"div",69)(15,_t,3,2,"div",69),i(),a(16,"td",105),g(17,bt,3,0,"span",112)(18,ht,3,0,"span",107)(19,vt,3,0,"span",106),i()()),r&2){let e=t.$implicit;u("ngClass",he(13,Ye,e.seriesCompletas,e.cantidadVerificada>0&&!e.seriesCompletas)),o(2),u("ngIf",e.RegistaSerie==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="0"),o(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="1"),o(2),m(" ",e.CodigosBodega," "),o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(2),u("ngIf",e.RegistaSerie==="1"),o(),u("ngIf",e.RegistaSerie==="0"),o(2),u("ngIf",e.seriesCompletas),o(),u("ngIf",!e.seriesCompletas&&e.cantidadVerificada>0),o(),u("ngIf",!e.seriesCompletas&&(!e.cantidadVerificada||e.cantidadVerificada===0))}}function Ct(r,t){if(r&1&&(a(0,"div",5)(1,"div",87)(2,"div",88)(3,"h6",29),c(4,"i",89),n(5,"Detalle de Productos "),i()(),a(6,"div",90)(7,"div",91)(8,"table",92)(9,"thead",93)(10,"tr")(11,"th",94),c(12,"i",74),n(13,"Tipo "),i(),a(14,"th",94),c(15,"i",95),n(16,"Bodega "),i(),a(17,"th",96),c(18,"i",97),n(19,"C\xF3digo "),i(),a(20,"th",98),n(21," Cant. "),i(),a(22,"th",99),c(23,"i",34),n(24,"Descripci\xF3n "),i(),a(25,"th",100),c(26,"i",101),n(27,"Series/Cantidad Ingresadas "),i(),a(28,"th",94),c(29,"i",102),n(30,"Estado "),i()()(),a(31,"tbody"),g(32,xt,20,16,"tr",103),i()()()()()()),r&2){let e=p(2);o(32),u("ngForOf",e.detalleFactura)}}function Et(r,t){r&1&&(a(0,"div",5)(1,"div",129),c(2,"i",130),n(3," No hay productos en el detalle "),i()())}function St(r,t){if(r&1){let e=S();a(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h5",16),n(5),i(),a(6,"button",17),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),i()(),a(7,"div",18),g(8,Qe,87,12,"div",19),a(9,"div",4),g(10,Ze,12,2,"div",20)(11,ot,18,11,"div",20)(12,Ct,33,1,"div",20)(13,Et,4,0,"div",20),i()(),a(14,"div",21)(15,"button",22),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),n(16,"Cerrar"),i(),a(17,"button",23),C("click",function(){h(e);let l=p();return v(l.guardarVerificacion())}),c(18,"i",24),n(19,"Guardar Verificaci\xF3n "),i()()()()()}if(r&2){let e=p();o(5),m("Verificar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length>0),o(),u("ngIf",e.detalleFactura.length===0)}}var ue=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];codigoProductoActual="";serieActual="";cantidadActual=null;productoActual=null;productosVerificados=0;seriesValidasPrueba=[{codigo:"L3250",serie:"SN001234567"},{codigo:"L3250",serie:"SN001234568"},{codigo:"TG-3468",serie:"SN001234569"},{codigo:"ABC-123",serie:"ABC001"},{codigo:"ABC-123",serie:"ABC002"},{codigo:"XYZ-789",serie:"XYZ100"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-success btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorVerificar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):F.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){let e=t.IDS_BODEGA.split(","),d=t.IDS_PREPARADAS.split(","),l=t.CODIGOS_BODEGA.split(","),s="";for(let f=0;f<l.length;f++){let E=0;d.length<e.length&&l[f]==l[d.length]&&(E=1,s+=`<span title="Pendiente de preparacion" class="text-danger fw-bold">P: ${l[d.length]}</span><br>`),E===0&&(s+=`<span class="fw-bold">${l[f]}</span><br>`)}t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CODIGOS_BODEGA_TEXTO=s,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){console.log("data: ",t);let e=t.IDS_BODEGA.split(",");console.log("IDS_BODEGA: ",e);let d=t.IDS_PREPARADAS.split(",");console.log("ID_PREPARADAS: ",d);let l=t.CODIGOS_BODEGA.split(",");if(d.length<e.length){F.default.fire("Atenci\xF3n!","Hay productos sin preparar en la factura bodega "+l[d.length],"info");return}let s={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",s),this.FacturacionService.GetFacturasDatosVerificar(s).subscribe({next:f=>{console.log("response: ",f),f.success&&f.cabecera?f.cabecera.length>0?(this.facturaSeleccionada=f,this.facturaActual=f.cabecera[0],this.detalleFactura=f.detalle||[],this.detalleFactura=this.detalleFactura.map((E,_)=>k(P({},E),{seriesIngresadas:[],cantidadVerificada:0,seriesCompletas:!1})),this.productosVerificados=0,this.limpiarInputsCaptura(),this.productosJaula=this.detalleFactura.filter(E=>E.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(E=>E.EN_JAULA==="0"),this.showPrepararModal=!0,setTimeout(()=>{this.enfocarInputCodigo()},500)):(this.showPrepararModal=!1,F.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):F.default.fire("Error!",f.message,"error"),this.isLoading=!1},error:f=>{this.isLoading=!1}})}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[]}guardarVerificacion(){let t=this.detalleFactura.filter(d=>!d.seriesCompletas);if(console.log("Productos no verificados:",t),t.length>0){F.default.fire({title:"\u26A0\uFE0F Faltan productos por verificar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de verificaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${t.map(d=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${d.CopProducto}</strong><br>
                  <small class="text-muted">${d.Detalle.substring(0,60)}...</small><br>
                  <small class="text-info">Verificado: ${d.cantidadVerificada||0}/${d.Cantidad}</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total pendientes: <strong>${t.length}</strong> de <strong>${this.detalleFactura.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"});return}let e=this.detalleFactura.filter(d=>d.seriesCompletas);F.default.fire({title:"\u2705 Verificaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido verificados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la verificaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos verificados:</strong> ${e.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#28a745"}).then(()=>{let d={cliente:this.facturaActual.Nombre,factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios,detalle_verificacion:this.detalleFactura.map(l=>({producto:l.CopProducto,productoId:l.ProductoId,cantidad:l.Cantidad,cantidadVerificada:l.cantidadVerificada,seriesIngresadas:l.seriesIngresadas||[],tipoVerificacion:l.RegistaSerie==="1"?"series":"cantidad"}))};console.log("Par\xE1metros verificaci\xF3n:",d),this.FacturacionService.FinalizarVerificacion(d).subscribe({next:l=>{console.log("Respuesta verificaci\xF3n:",l),l.success?F.default.fire({title:"\u2705 Verificaci\xF3n Finalizada",html:`
                <div class="text-start">
                  <p><strong>Factura:</strong> ${this.facturaActual.Secuencia}</p>
                  <p class="text-success">`+l.message+`</p>
                </div>
              `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):F.default.fire({title:"\u274C Error en Verificaci\xF3n",html:`
                <div class="text-start">
                  <p><strong>Error:</strong> ${l.message||"Error desconocido"}</p>
                  <p class="text-muted">Por favor, intente nuevamente.</p>
                </div>
              `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})},error:l=>{console.error("Error en verificaci\xF3n:",l),F.default.fire({title:"\u274C Error de Conexi\xF3n",html:`
              <div class="text-start">
                <p>Ocurri\xF3 un error al finalizar la verificaci\xF3n.</p>
                <p class="text-muted">Verifique su conexi\xF3n e intente nuevamente.</p>
              </div>
            `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})}})})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}limpiarInputsCaptura(){this.codigoProductoActual="",this.serieActual="",this.cantidadActual=null,this.productoActual=null}onCodigoProductoEnter(t){t.key==="Enter"&&(t.preventDefault(),this.validarCodigoProducto())}validarCodigoProducto(){let t=this.codigoProductoActual.trim();if(!t)return;console.log("C\xF3digo ingresado:",t),console.log("Detalle factura:",this.detalleFactura),console.log("C\xF3digos disponibles:",this.detalleFactura.map(d=>d.CopProducto));let e=this.detalleFactura.find(d=>d.CopProducto.toLowerCase()===t.toLowerCase());console.log("Producto encontrado:",e),e?(this.productoActual=e,setTimeout(()=>{if(e.RegistaSerie==="1"){let d=document.querySelector("#inputSerie");d&&d.focus()}else{let d=document.querySelector("#inputCantidad");d&&d.focus()}},100)):(this.productoActual=null,F.default.fire({title:"\u274C C\xF3digo No Encontrado",html:`
          <div class="text-start">
            <p>El c\xF3digo <strong>${t}</strong> no existe en esta factura.</p>
            <p class="text-muted">Verifique el c\xF3digo e intente nuevamente.</p>
          </div>
        `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}).then(()=>{this.codigoProductoActual="",setTimeout(()=>{let d=document.querySelector("#inputCodigo");d&&d.focus()},100)}))}onSerieEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarSerie())}procesarSerie(){let t=this.serieActual.trim();if(!(!t||!this.productoActual)){if(this.productoActual.cantidadVerificada>=this.productoActual.Cantidad){F.default.fire({title:"\u26A0\uFE0F Cantidad Completa",text:`El producto ${this.productoActual.CopProducto} ya tiene todas sus series completas.`,icon:"warning",confirmButtonColor:"#f39c12"}),this.limpiarInputsCaptura(),this.enfocarInputCodigo();return}if(this.productoActual.seriesIngresadas.includes(t)){F.default.fire({title:"\u274C Serie Duplicada",html:`
          <div class="text-start">
            <p>La serie <strong>${t}</strong> ya fue ingresada para el producto <strong>${this.productoActual.CopProducto}</strong>.</p>
          </div>
        `,icon:"error",confirmButtonColor:"#dc3545"}),this.serieActual="";return}this.productoActual.registroserieEntrada==="1"?this.validarSerieEnBaseDatos(this.productoActual.ProductoId,t):this.agregarSerie(t)}}onCantidadEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarCantidad())}procesarCantidad(){if(!(!this.cantidadActual||!this.productoActual)){if(this.cantidadActual<=0||this.cantidadActual>this.productoActual.Cantidad){F.default.fire({title:"\u274C Cantidad Inv\xE1lida",text:`La cantidad debe ser entre 1 y ${this.productoActual.Cantidad}.`,icon:"error",confirmButtonColor:"#dc3545"});return}this.productoActual.cantidadVerificada=this.cantidadActual,this.productoActual.seriesCompletas=this.cantidadActual===parseInt(this.productoActual.Cantidad),console.log("Cantidad confirmada:",this.cantidadActual),console.log("Cantidad total:",this.productoActual.Cantidad),console.log("Series completas:",this.productoActual.seriesCompletas),this.actualizarContadores(),F.default.fire({title:"\u2705 Cantidad Confirmada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Cantidad confirmada:</strong> ${this.cantidadActual}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.limpiarInputsCaptura(),this.enfocarInputCodigo()}}validarSerieEnBaseDatos(t,e){F.default.fire({title:"Validando serie...",html:`
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Validando...</span>
          </div>
          <p class="mt-2">Verificando serie <strong>${e}</strong> en la base de datos</p>
        </div>
      `,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{F.default.showLoading()}});let d={codigo_producto:t,serie:e,bodega:this.facturaActual.CodigoBodega,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",d),this.FacturacionService.ValidarSerie(d).subscribe({next:l=>{console.log("Respuesta validaci\xF3n serie:",l),F.default.close(),l.success?l.serie_encontrada?l.serie_disponible==!0?this.agregarSerie(e):(F.default.fire({title:"\u274C Serie No Disponible",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> ya ha sido utilizada o no est\xE1 disponible para el producto <strong>${t}</strong>.</p>
                <p class="text-muted  ">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(F.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(F.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${l.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual="")},error:l=>{console.error("Error validando serie:",l),F.default.fire({title:"\u274C Error de Validaci\xF3n",html:`
            <div class="text-start">
              <p>Ocurri\xF3 un error al validar la serie <strong>${e}</strong>.</p>
              <p class="text-muted">Por favor, intente nuevamente.</p>
            </div>
          `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""}})}agregarSerie(t){this.productoActual.seriesIngresadas.push(t),this.productoActual.cantidadVerificada=this.productoActual.seriesIngresadas.length,this.productoActual.ProductoId=this.productoActual.ProductoId,console.log("Serie agregada:",t),console.log("Cantidad verificada:",this.productoActual.cantidadVerificada),console.log("Cantidad total:",this.productoActual.Cantidad),this.productoActual.cantidadVerificada===parseInt(this.productoActual.Cantidad)&&(this.productoActual.seriesCompletas=!0,console.log("Producto marcado como completo:",this.productoActual.CopProducto)),this.actualizarContadores(),F.default.fire({title:"\u2705 Serie Agregada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Serie:</strong> ${t}</p>
          <p><strong>Progreso:</strong> ${this.productoActual.cantidadVerificada}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.serieActual="",this.productoActual.seriesCompletas&&(this.limpiarInputsCaptura(),this.enfocarInputCodigo())}actualizarContadores(){let t=this.detalleFactura.filter(e=>e.seriesCompletas);this.productosVerificados=t.length,console.log("Actualizando contadores:"),console.log("Productos completos:",t),console.log("Total verificados:",this.productosVerificados),console.log("Detalle factura:",this.detalleFactura.map(e=>({codigo:e.CopProducto,seriesCompletas:e.seriesCompletas,cantidadVerificada:e.cantidadVerificada,cantidad:e.Cantidad}))),this.cdr.detectChanges()}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}puedeGuardar(){return this.detalleFactura.every(t=>t.seriesCompletas)}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-verificar-facturas"]],decls:9,vars:12,consts:[["inputCodigo",""],["inputSerie",""],["inputCantidad",""],[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-check","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"alert","d-flex","align-items-center"],[1,"fa","fa-info-circle","me-2"],[1,"fa","fa-check-circle","me-2"],[1,"card","border-warning"],[1,"card-body","bg-light"],[1,"row","justify-content-center"],[1,"text-center"],[1,"form-label","mb-1"],[1,"fa","fa-search","me-1"],["id","inputCodigo","type","text","placeholder","Escanear c\xF3digo del producto...",1,"form-control","form-control-lg","text-center",3,"ngModelChange","keypress","ngModel"],["class","valid-feedback",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],["class","alert alert-light",4,"ngIf"],[1,"valid-feedback"],[1,"invalid-feedback"],[1,"fa","fa-tag","me-1"],[1,"badge","ms-1",3,"ngClass"],["id","inputSerie","type","text","placeholder","Escanear serie del producto...",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","disabled"],[1,"fa","fa-calculator","me-1"],[1,"badge","bg-secondary","ms-1"],["id","inputCantidad","type","number","min","1",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","placeholder","disabled","max"],[1,"text-muted"],[1,"fa","fa-arrow-left","me-1"],[1,"alert","alert-light"],[1,"col-md-8"],[1,"col-md-4","text-end"],[1,"badge","bg-primary","me-1"],[1,"badge",3,"ngClass"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","20%"],[1,"fa","fa-list-ol","me-1"],[1,"fa","fa-shield-alt","me-1"],["class","align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"align-middle",3,"ngClass"],[1,"text-center","py-1"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-info fs-6",4,"ngIf"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],["class","badge bg-success fs-6",4,"ngIf"],[1,"badge","bg-secondary","fs-6"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"badge","bg-info","fs-6"],["class","series-container",4,"ngIf"],["class","text-center text-muted",4,"ngIf"],[1,"series-container"],[1,"mb-1"],[1,"series-list",2,"max-height","80px","overflow-y","auto"],["class","d-block text-muted",4,"ngFor","ngForOf"],[1,"d-block","text-muted"],[1,"text-center","text-muted"],["class","text-center",4,"ngIf"],[1,"badge","bg-success"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-clock","me-1"],[1,"fa","fa-minus","me-1"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(a(0,"div",3)(1,"div",4)(2,"div",5)(3,"app-card",6),c(4,"div",7),a(5,"div",8)(6,"div",9)(7,"app-table",10),C("action",function(s){return d.onTableAction(s)})("customAction",function(s){return d.onCustomAction(s)}),i()()()()()(),g(8,St,20,6,"div",11),i()),e&2&&(o(3),u("headerTitle","Lista de Facturas por verificar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[G,le,U,L,$,X,J,se,W,ce,Fe,H,j,K],encapsulation:2})};var O=Z(ee());function At(r,t){if(r&1&&(a(0,"div",48)(1,"div",2)(2,"div",49)(3,"div",50),c(4,"i",51),a(5,"div")(6,"strong",52),n(7,"FACTURA MULTIBODEGA"),i(),a(8,"small",53),n(9),i()(),a(10,"div",54)(11,"span",55),n(12),i()()()()()()),r&2){let e=p(2);o(9),m(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),o(3),m("",e.bodegas.length," Bodegas")}}function yt(r,t){if(r&1&&(a(0,"div",1)(1,"div",56)(2,"div",57),c(3,"i",58),a(4,"h6",59),n(5,"Informaci\xF3n de la Factura"),i()()(),a(6,"div",21)(7,"div",22)(8,"div",23)(9,"small",24),c(10,"i",25),n(11,"Datos Principales "),i()(),a(12,"div",26)(13,"table",27)(14,"tbody")(15,"tr",29)(16,"td",30),c(17,"i",41),n(18,"Bodega: "),i(),a(19,"td",33)(20,"span",60),n(21),i()()(),a(22,"tr",29)(23,"td",38),c(24,"i",61),n(25,"Secuencia: "),i(),a(26,"td",33)(27,"span",62),n(28),i()()(),a(29,"tr",29)(30,"td",38),c(31,"i",63),n(32,"N\xFAmero: "),i(),a(33,"td",33),n(34),i()(),a(35,"tr",29)(36,"td",38),c(37,"i",64),n(38,"Cliente: "),i(),a(39,"td",33),n(40),i()(),a(41,"tr",29)(42,"td",38),c(43,"i",65),n(44,"Fecha: "),i(),a(45,"td",33)(46,"span",66),n(47),D(48,"date"),i()()()()()()()(),a(49,"div",21)(50,"div",22)(51,"div",23)(52,"small",24),c(53,"i",67),n(54,"Informaci\xF3n de Contacto "),i()(),a(55,"div",26)(56,"table",27)(57,"tbody")(58,"tr",29)(59,"td",30),c(60,"i",68),n(61,"Direcci\xF3n: "),i(),a(62,"td",33),n(63),i()(),a(64,"tr",29)(65,"td",38),c(66,"i",69),n(67,"Ciudad: "),i(),a(68,"td",33)(69,"span",70),n(70),i()()(),a(71,"tr",29)(72,"td",38),c(73,"i",71),n(74,"Tel\xE9fono: "),i(),a(75,"td",33)(76,"span",72),n(77),i()()(),a(78,"tr",29)(79,"td",38),c(80,"i",73),n(81,"Email: "),i(),a(82,"td",33)(83,"small",52),n(84),i()()(),a(85,"tr",29)(86,"td",38),c(87,"i",74),n(88,"Vendedor: "),i(),a(89,"td",33),n(90),i()(),a(91,"tr",29)(92,"td",38),c(93,"i",75),n(94,"Tipo Pedido: "),i(),a(95,"td",33)(96,"span",76),n(97),i()()(),a(98,"tr",29)(99,"td",38),c(100,"i",77),n(101,"Forma Pago: "),i(),a(102,"td",33)(103,"span",78),n(104),i()()()()()()()()()),r&2){let e=p(2);o(21),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),b(e.facturaActual.Secuencia),o(6),b(e.facturaActual.Numero),o(6),b(e.facturaActual.Nombre),o(7),m(" ",w(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(16),b(e.facturaActual.Direccion),o(7),m(" ",e.facturaActual.Ciudad," "),o(7),b((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),o(7),b(e.facturaActual.Email),o(6),b(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function It(r,t){if(r&1&&(a(0,"tr",93)(1,"td",94),n(2),i(),a(3,"td",94),n(4),i(),a(5,"td",95),n(6),i(),a(7,"td",96),n(8),i()()),r&2){let e=t.$implicit;o(2),m(" ",e.CodigosBodega," "),o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle)}}function Tt(r,t){if(r&1&&(a(0,"div",2)(1,"div",79)(2,"div",80)(3,"h6",59),c(4,"i",81),n(5,"Detalle de Productos "),i()(),a(6,"div",82)(7,"div",83)(8,"table",84)(9,"thead",85)(10,"tr")(11,"th",86),c(12,"i",87),n(13,"Bodega "),i(),a(14,"th",88),c(15,"i",89),n(16,"C\xF3digo "),i(),a(17,"th",90),n(18," Cant. "),i(),a(19,"th",91),c(20,"i",25),n(21,"Descripci\xF3n "),i()()(),a(22,"tbody"),g(23,It,9,4,"tr",92),i()()()()()()),r&2){let e=p(2);o(23),u("ngForOf",e.detalleFactura)}}function Ft(r,t){if(r&1&&(a(0,"div",4)(1,"div",2)(2,"div",97),c(3,"i",25),a(4,"strong"),n(5,"Factura Multibodega:"),i(),n(6),i()()()),r&2){let e=p(2);o(6),m(" Un solo n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function Dt(r,t){r&1&&(a(0,"div",4)(1,"div",2)(2,"div",98),c(3,"i",99),a(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),i(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),i()()())}function wt(r,t){r&1&&(a(0,"div",4)(1,"div",2)(2,"div",100),c(3,"i",25),a(4,"strong"),n(5,"Centro Consolidado:"),i(),n(6," Esta factura pertenece a un centro consolidado, no requiere consolidaci\xF3n adicional "),i()()())}function Ot(r,t){if(r&1){let e=S();a(0,"tr",29)(1,"td",30),c(2,"i",101),n(3,"Consolidar: "),i(),a(4,"td",33)(5,"div",102)(6,"input",103),T("ngModelChange",function(l){h(e);let s=p(2);return I(s.consolidar,l)||(s.consolidar=l),v(l)}),i(),a(7,"label",104),n(8," Consolidaci\xF3n obligatoria (no se puede cambiar) "),i()()()()}if(r&2){let e=p(2);o(6),y("ngModel",e.consolidar),u("disabled",!0)}}function Pt(r,t){if(r&1){let e=S();a(0,"tr",29)(1,"td",38),c(2,"i",105),n(3,"Gu\xEDa Consol.: "),a(4,"span",32),n(5,"*"),i()(),a(6,"td",33)(7,"input",106),T("ngModelChange",function(l){h(e);let s=p(2);return I(s.guiaConsolidacion,l)||(s.guiaConsolidacion=l),v(l)}),i()()()}if(r&2){let e=p(2);o(7),y("ngModel",e.guiaConsolidacion)}}function kt(r,t){r&1&&(a(0,"option",107),n(1,"Seleccione transporte"),i())}function Rt(r,t){r&1&&(a(0,"option",107),n(1,"Cargando transportes..."),i())}function Vt(r,t){if(r&1&&(a(0,"option",108),n(1),i()),r&2){let e=t.$implicit;u("value",e.id),o(),m(" ",e.Codigo," ")}}function Bt(r,t){r&1&&(a(0,"small",109),c(1,"i",110),n(2,"Cargando lista de transportes... "),i())}function Nt(r,t){if(r&1&&(a(0,"small",109),n(1),i()),r&2){let e=p(3);o(),m(" Este n\xFAmero de gu\xEDa se aplicar\xE1 a todas las bodegas (",e.bodegas.length," bodegas) ")}}function Mt(r,t){if(r&1){let e=S();a(0,"tr",29)(1,"td",38),c(2,"i",111),n(3," N\xFAmero de Gu\xEDa: "),a(4,"span",32),n(5,"*"),i()(),a(6,"td",33)(7,"input",112),T("ngModelChange",function(l){h(e);let s=p(2);return I(s.numeroGuia,l)||(s.numeroGuia=l),v(l)}),i(),g(8,Nt,2,1,"small",37),i()()}if(r&2){let e=p(2);o(7),y("ngModel",e.numeroGuia),o(),u("ngIf",e.bodegas.length>1)}}function Ut(r,t){r&1&&(a(0,"div",2)(1,"div",113),c(2,"i",114),n(3," No hay productos en el detalle "),i()())}function Lt(r,t){if(r&1){let e=S();a(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),i(),a(6,"button",14),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),i()(),a(7,"div",15),g(8,At,13,2,"div",16)(9,yt,105,15,"div",17),a(10,"div",1),g(11,Tt,24,1,"div",18),a(12,"div",19),g(13,Ft,7,1,"div",20)(14,Dt,7,0,"div",20)(15,wt,7,0,"div",20),a(16,"div",1)(17,"div",21)(18,"div",22)(19,"div",23)(20,"small",24),c(21,"i",25),n(22,"Datos de envio "),i()(),a(23,"div",26)(24,"table",27)(25,"tbody"),g(26,Ot,9,2,"tr",28)(27,Pt,8,1,"tr",28),a(28,"tr",29)(29,"td",30),c(30,"i",31),n(31,"Transporte: "),a(32,"span",32),n(33,"*"),i()(),a(34,"td",33)(35,"select",34),T("ngModelChange",function(l){h(e);let s=p();return I(s.transporteSeleccionado,l)||(s.transporteSeleccionado=l),v(l)}),g(36,kt,2,0,"option",35)(37,Rt,2,0,"option",35)(38,Vt,2,2,"option",36),i(),g(39,Bt,3,0,"small",37),i()(),g(40,Mt,9,2,"tr",28),a(41,"tr",29)(42,"td",38),c(43,"i",39),n(44,"Bultos: "),a(45,"span",32),n(46,"*"),i()(),a(47,"td",33)(48,"input",40),T("ngModelChange",function(l){h(e);let s=p();return I(s.numeroBultos,l)||(s.numeroBultos=l),v(l)}),i()()()()()()()(),a(49,"div",21)(50,"div",22)(51,"div",23)(52,"small",24),c(53,"i",25),i()(),a(54,"div",26)(55,"table",27)(56,"tbody")(57,"tr",29)(58,"td",30),c(59,"i",41),n(60,"Peso: "),i(),a(61,"td",33)(62,"input",42),T("ngModelChange",function(l){h(e);let s=p();return I(s.pesoEnvio,l)||(s.pesoEnvio=l),v(l)}),i()()(),a(63,"tr",29)(64,"td",38),c(65,"i",43),n(66,"Comentarios: "),i(),a(67,"td",33)(68,"textarea",44),T("ngModelChange",function(l){h(e);let s=p();return I(s.comentariosEnvio,l)||(s.comentariosEnvio=l),v(l)}),i()()()()()()()()()(),g(69,Ut,4,0,"div",18),i()(),a(70,"div",45)(71,"button",46),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),n(72,"Cerrar"),i(),a(73,"button",47),C("click",function(){h(e);let l=p();return v(l.guardarCambios())}),n(74,"Guardar cambios"),i()()()()()}if(r&2){let e=p();o(5),m("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.facturaActual),o(2),u("ngIf",e.detalleFactura.length>0),o(2),u("ngIf",e.bodegas.length>1),o(),u("ngIf",e.consolidar),o(),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)==1),o(11),u("ngIf",(e.facturaRowData==null?null:e.facturaRowData.MULTIBODEGA)=="SI"&&(e.facturaRowData==null?null:e.facturaRowData.CONSOLIDAR_FACTURA)==1&&(e.facturaRowData==null?null:e.facturaRowData.CENTRO_CONSOLIDADO)=="0"),o(),u("ngIf",e.consolidar),o(8),y("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),o(),u("ngIf",!e.cargandoTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngForOf",e.listaTransportes),o(),u("ngIf",e.cargandoTransportes),o(),u("ngIf",e.consolidar==!1),o(8),y("ngModel",e.numeroBultos),o(14),y("ngModel",e.pesoEnvio),o(6),y("ngModel",e.comentariosEnvio),o(),u("ngIf",e.detalleFactura.length===0)}}var pe=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;facturaRowData=null;detalleFactura=[];transporteSeleccionado="";numeroGuia="";numeroBultos=null;pesoEnvio="";comentariosEnvio="";consolidar=!1;tipoConsolidacion="";guiaConsolidacion="";bodegas=[];guiasPorBodega=[];listaTransportes=[];cargandoTransportes=!1;transportesSeleccionados={};opcionesConsolidacion=[{id:"consolidacion_1",nombre:"Consolidaci\xF3n Centro"},{id:"consolidacion_2",nombre:"Consolidaci\xF3n Norte"},{id:"consolidacion_3",nombre:"Consolidaci\xF3n Sur"},{id:"consolidacion_4",nombre:"Consolidaci\xF3n Express"},{id:"consolidacion_5",nombre:"Consolidaci\xF3n Econ\xF3mica"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA_TEXTO",sort:!0},{title:"Consolidar",field_value:"CONSOLIDAR_FACTURA_TEXTO",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",type:"select",options:[{label:"MOSTRADOR-GYE",value:"MOSTRADOR-GYE"},{label:"MOSTRADOR-UIO",value:"MOSTRADOR-UIO"},{label:"CUIDAD-GYE",value:"CUIDAD-GYE"},{label:"CUIDAD-UIO",value:"CUIDAD-UIO"},{label:"PROVINCIA",value:"PROVINCIA"}],sort:!1},{title:"Estado",field_value:"FACTURA_BLOQUEADA_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorGuiasPickup(t).subscribe({next:e=>{e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):O.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.actualizarOpcionesSelect(),this.Usuarios_Datos.map(function(t){let e=t.CODIGOS_VERIFICADAS.split(","),d=t.CODIGOS_CONSOLIDADAS.split(","),l=t.BODEGAS_ENFACTURA.split(","),s="";for(let f=0;f<e.length;f++)e[f]&&e[f]!=""&&(s+=`<span class="fw-bold">${e[f]}</span><br>`);for(let f=0;f<d.length;f++)d[f]&&d[f]!=""&&(s+=`<span class="fw-bold">${d[f]}</span><br>`);(!t.ORDEN_TIPO_PEDIDO||t.ORDEN_TIPO_PEDIDO===""||t.ORDEN_TIPO_PEDIDO===null)&&(t.ORDEN_TIPO_PEDIDO="MOSTRADOR-GYE"),t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.CONSOLIDAR_FACTURA_TEXTO=`<span class="fs-6 badge bg-${t.CONSOLIDAR_FACTURA==1?"danger":"secondary"} fw-bold">${t.CONSOLIDAR_FACTURA==1?"SI":"NO"}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span title="${t.BODEGAS_ENFACTURA}" class="fw-bold">${s}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA_TEXTO=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.FACTURA_BLOQUEADA_TEXTO=(t.FACTURA_BLOQUEADA==1?()=>'<span class="fs-6 badge bg-danger fw-bold">Bloqueada</span>':()=>t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+d.length!=l.length?'<span class="fs-6 badge bg-danger fw-bold">Espera Consolidaci\xF3n</span>':t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1&&e.length+d.length==l.length?'<span class="fs-6 badge bg-primary fw-bold">consolidacion completa</span>':t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1&&t.FACTURA_LISTA_ESTADO=="0"?'<span class="fs-6 badge bg-danger fw-bold">Por consolidar</span>':t.FACTURA_LISTA_ESTADO=="1"?'<span class="fs-6 badge bg-success fw-bold">Consolidada</span>':'<span class="fs-6 badge bg-success fw-bold">Desbloqueada</span>')()}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"detalle_factura":this.onPrepararFactura(t.data);break;case"ORDEN_TIPO_PEDIDO_change":this.onTransporteChange(t.data,t.value);break;default:}}onTransporteChange(t,e){if(t.FACTURA_LISTA_ESTADO==1&&t.CENTRO_CONSOLIDADO==0&&t.CONSOLIDAR_FACTURA==1){O.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se puede cambiar el tipo de pedido.","warning");return}let d=t.FACTURA_SECUENCIA||t.ID;this.transportesSeleccionados[d]=e;let l=this.Usuarios_Datos.findIndex(s=>(s.FACTURA_SECUENCIA||s.ID)===d);l!==-1&&(this.Usuarios_Datos[l].ORDEN_TIPO_PEDIDO=e),this.cdr.detectChanges(),this.tableConfig=k(P({},this.tableConfig),{data:[...this.Usuarios_Datos]}),this.guardarTransporteSeleccionado(t,e)}guardarTransporteSeleccionado(t,e){let d={factura:t.FACTURA_ID,tipo:e,usrid:this.sessionData?this.sessionData.usrid:null};O.default.fire({title:"Est\xE1s seguro?",text:"Si ya hay facturas consolidadas puede haber problemas al ingresar la gu\xEDa!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, continuar"}).then(l=>{l.isConfirmed&&this.FacturacionService.GuardarCambioTipoPedido(d).subscribe({next:s=>{s.success?(O.default.fire("\xC9xito!","Transporte actualizado correctamente","success"),this.loadTableData()):O.default.fire("Error!",s.message,"error")},error:s=>{O.default.fire("Error!","No se pudo actualizar el transporte","error")}})})}onPrepararFactura(t){if(console.log("data: ",t),t.FACTURA_BLOQUEADA==1&&t.CENTRO_CONSOLIDADO==0){O.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}if(t.CONSOLIDAR_FACTURA==1&&t.CENTRO_CONSOLIDADO==0&&t.FACTURA_LISTA_ESTADO==1){O.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" ya ha sido consolidada y no se pueden ingresar m\xE1s gu\xEDas.","warning");return}let e=t.CODIGOS_VERIFICADAS?t.CODIGOS_VERIFICADAS.split(",").map(x=>x.trim()):[],d=t.CODIGOS_CONSOLIDADAS?t.CODIGOS_CONSOLIDADAS.split(",").map(x=>x.trim()):[],l=[...e,...d],s=t.BODEGAS_ENFACTURA?t.BODEGAS_ENFACTURA.split(",").map(x=>x.trim()):[],f=x=>x?parseFloat(x).toFixed(2):"",E=s.filter(x=>!l.some(_e=>f(_e)===f(x)));if(E.length>0&&t.CENTRO_CONSOLIDADO==1&&t.CONSOLIDAR_FACTURA==1){O.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" tiene bodegas que no se han completado: "+E.join(", "),"warning");return}this.facturaRowData=t;let _={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(_).subscribe({next:x=>{if(x.success&&x.cabecera)if(x.cabecera.length>0){this.facturaSeleccionada=x,this.facturaActual=x.cabecera[0],this.detalleFactura=x.detalle||[],this.procesarBodegas(t);let _e=this.facturaRowData?.MULTIBODEGA=="SI",De=this.facturaRowData?.CONSOLIDAR_FACTURA==1,we=this.facturaRowData?.CENTRO_CONSOLIDADO=="0";this.consolidar=_e&&De&&we,this.showPrepararModal=!0}else this.showPrepararModal=!1,O.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error");else O.default.fire("Error!",x.message,"error");this.isLoading=!1},error:x=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:x=>{x.success&&x.data?this.listaTransportes=x.data:O.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:x=>{O.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}procesarBodegas(t){if(t.CODIGOS_BODEGA&&t.BODEGAS){let e=t.CODIGOS_BODEGA.split(",").map(l=>l.trim()),d=t.BODEGAS.split(",").map(l=>l.trim());this.bodegas=e.map((l,s)=>({codigo:l,nombre:d[s]||l}))}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.facturaRowData=null,this.detalleFactura=[],this.transporteSeleccionado="",this.numeroGuia="",this.numeroBultos=null,this.pesoEnvio="",this.comentariosEnvio="",this.consolidar=!1,this.tipoConsolidacion="",this.guiaConsolidacion="",this.bodegas=[],this.listaTransportes=[],this.cargandoTransportes=!1}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}verEstadoActual(){}actualizarOpcionesSelect(){let t=[{label:"MOSTRADOR-GYE",value:"MOSTRADOR-GYE"},{label:"MOSTRADOR-UIO",value:"MOSTRADOR-UIO"},{label:"CUIDAD-GYE",value:"CUIDAD-GYE"},{label:"CUIDAD-UIO",value:"CUIDAD-UIO"},{label:"PROVINCIA",value:"PROVINCIA"}],e=[...new Set(this.Usuarios_Datos.map(_=>_.ORDEN_TIPO_PEDIDO).filter(_=>_&&_!==""))],d=t.map(_=>_.value),s=e.filter(_=>!d.includes(_)).map(_=>({label:_,value:_})),f=[...t,...s],E=this.tableConfig.columns.find(_=>_.type==="select");E&&(E.options=f)}guardarCambios(){let t=this.listaTransportes.find(_=>_.id===this.transporteSeleccionado),e=t?t.C\u00F3digo:"N/A",d={transporteId:this.transporteSeleccionado,transporteNombre:e,numeroGuia:this.numeroGuia,numeroBultos:this.numeroBultos,peso:this.pesoEnvio,comentarios:this.comentariosEnvio,consolidacion:{activada:this.consolidar,tipo:this.tipoConsolidacion,guia:this.guiaConsolidacion},bodegas:this.bodegas,factura:this.facturaActual.Id,bodegaInfo:this.facturaSeleccionada.BODEGAS};console.log("datosEnvio: ",d);let l=!1;this.consolidar&&!this.guiaConsolidacion.trim()&&(l=!0);let s=!this.consolidar&&!this.numeroGuia?.trim();if(!this.transporteSeleccionado||!this.numeroBultos||s||l){let _=[];this.transporteSeleccionado||_.push("Transporte"),this.numeroBultos||_.push("N\xFAmero de bultos"),s&&_.push("N\xFAmero de gu\xEDa"),this.consolidar&&!this.guiaConsolidacion.trim()&&_.push("Gu\xEDa de consolidaci\xF3n"),O.default.fire({title:"\u26A0\uFE0F Campos Incompletos",html:`
          <div class="text-start">
            <p>Por favor complete los siguientes campos obligatorios:</p>
            <ul class="text-muted">
              ${_.map(x=>`<li>${x}</li>`).join("")}
            </ul>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido"});return}let f=this.bodegas.length>1?`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>
         <p><small class="text-muted">Esta gu\xEDa se aplicar\xE1 a las ${this.bodegas.length} bodegas: ${this.bodegas.map(_=>_.codigo).join(", ")}</small></p>`:`<p><strong>N\xFAmero de gu\xEDa:</strong> ${this.numeroGuia}</p>`,E=this.consolidar?`
      <hr class="my-2">
      <h6 class="text-warning mb-2"><i class="fa fa-boxes me-1"></i>Consolidaci\xF3n</h6>
      <p><strong>Tipo:</strong> ${this.opcionesConsolidacion.find(_=>_.id===this.tipoConsolidacion)?.nombre||"N/A"}</p>
      <p><strong>Gu\xEDa de consolidaci\xF3n:</strong> ${this.guiaConsolidacion}</p>
    `:"";O.default.fire({title:"\u2705 Datos Guardados",html:`
        <div class="text-start">
          <h6 class="text-primary mb-2"><i class="fa fa-file-invoice me-1"></i>Datos de Factura</h6>
          <p><strong>Factura:</strong> ${this.facturaActual?.Secuencia||"N/A"}</p>
          <p><strong>Cliente:</strong> ${this.facturaActual?.Nombre||"N/A"}</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura?.length||0}</p>
          
          <hr class="my-2">
          
          <h6 class="text-success mb-2"><i class="fa fa-shipping-fast me-1"></i>Datos de Env\xEDo</h6>
          <p><strong>Transporte:</strong> ${e} (${this.transporteSeleccionado})</p>
          <p><strong>Bultos:</strong> ${this.numeroBultos}</p>
          <p><strong>Peso:</strong> ${this.pesoEnvio||"No especificado"}</p>
          ${this.comentariosEnvio?`<p><strong>Comentarios:</strong> ${this.comentariosEnvio}</p>`:""}
          
          ${E}
          
          <hr class="my-2">
          
          <h6 class="text-info mb-2"><i class="fa fa-barcode me-1"></i>Informaci\xF3n de Gu\xEDa</h6>
          ${f}
        </div>
      `,icon:"success",confirmButtonText:"OK"}),O.default.fire({title:"\xBFEst\xE1s seguro?",text:"No podr\xE1s revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, Guardar!"}).then(_=>{_.isConfirmed&&this.FacturacionService.FinalizarGuiasPickup(d).subscribe({next:x=>{console.log("response: ",x),x.success?(O.default.fire("\xC9xito!","Los datos de gu\xEDa han sido guardados correctamente.","success"),this.cerrarModal(),this.loadTableData()):O.default.fire("Error!",x.message,"error"),this.isLoading=!1},error:x=>{console.log("error: ",x),this.isLoading=!1}})})}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-guias-pickup"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row mb-3",4,"ngIf"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","my-3"],["class","row mb-2",4,"ngIf"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],["style","height: 28px;",4,"ngIf"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-shopping-cart","text-info","me-1"],[1,"text-danger"],[1,"py-1"],["name","transporte",1,"form-select","form-select-solid","form-select-sm",3,"ngModelChange","ngModel","disabled"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-box-open","text-secondary","me-1"],["type","number","name","numeroBultos","placeholder","N\xFAmero de bultos","min","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-warehouse","text-info","me-1"],["type","text","name","pesoEnvio","placeholder","Peso del paquete (kg)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-address-book","text-primary","me-1"],["name","comentarios","rows","2","placeholder","Comentarios sobre el env\xEDo",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","mb-3"],[1,"alert","alert-success","border-success","py-2","mb-0"],[1,"d-flex","align-items-center"],[1,"fa","fa-warehouse","text-primary","me-2","fs-5"],[1,"text-primary"],[1,"d-block","text-dark","fw-bold"],[1,"ms-auto"],[1,"badge","bg-primary","fs-6"],[1,"col-12","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"fw-bold","text-primary","fs-5"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-map-marker-alt","text-danger","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-phone","text-success","me-1"],[1,"font-monospace"],[1,"fa","fa-envelope","text-primary","me-1"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"align-middle"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],[1,"alert","alert-primary","py-2"],[1,"alert","alert-warning","py-2"],[1,"fa","fa-boxes","me-1"],[1,"alert","alert-info","py-2"],[1,"fa","fa-boxes","text-warning","me-1"],[1,"form-check"],["type","checkbox","name","consolidar","id","checkConsolidar",1,"form-check-input",3,"ngModelChange","ngModel","disabled"],["for","checkConsolidar",1,"form-check-label","text-muted"],[1,"fa","fa-barcode","text-warning","me-1"],["type","text","name","guiaConsolidacion","placeholder","N\xFAmero de gu\xEDa de consolidaci\xF3n",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"text-muted"],[1,"fa","fa-spinner","fa-spin","me-1"],[1,"fa","fa-file","text-primary","me-1"],["type","text","name","numeroGuia","placeholder","Ingrese el n\xFAmero de gu\xEDa",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),c(4,"div",4),a(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(s){return d.onTableAction(s)})("customAction",function(s){return d.onCustomAction(s)}),i()()()()()(),g(8,Lt,75,20,"div",8),i()),e&2&&(o(3),u("headerTitle","Lista de Facturas por ingresar guias")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[G,U,L,$,X,Ie,Te,J,se,Ae,ye,W,ce,H,j,K],encapsulation:2})};var V=Z(ee());function $t(r,t){if(r&1&&(a(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),i(),a(4,"div",24),c(5,"i",25),a(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),i()()(),a(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),c(12,"i",31),n(13,"Datos Principales "),i()(),a(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),c(19,"i",36),n(20,"Bodega: "),i(),a(21,"td",37)(22,"span",38),n(23),i()()(),a(24,"tr",34)(25,"td",39),c(26,"i",40),n(27,"Secuencia: "),i(),a(28,"td",37)(29,"span",41),n(30),i()()(),a(31,"tr",34)(32,"td",39),c(33,"i",42),n(34,"N\xFAmero: "),i(),a(35,"td",37),n(36),i()(),a(37,"tr",34)(38,"td",39),c(39,"i",43),n(40,"Cliente: "),i(),a(41,"td",37),n(42),i()(),a(43,"tr",34)(44,"td",39),c(45,"i",44),n(46,"Fecha: "),i(),a(47,"td",37)(48,"span",45),n(49),D(50,"date"),i()()()()()()()(),a(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),c(55,"i",46),n(56,"Informaci\xF3n de Contacto "),i()(),a(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),c(62,"i",47),n(63,"Ciudad: "),i(),a(64,"td",37)(65,"span",48),n(66),i()()(),a(67,"tr",34)(68,"td",39),c(69,"i",49),n(70,"Vendedor: "),i(),a(71,"td",37),n(72),i()(),a(73,"tr",34)(74,"td",39),c(75,"i",50),n(76,"Tipo Pedido: "),i(),a(77,"td",37)(78,"span",51),n(79),i()()(),a(80,"tr",34)(81,"td",39),c(82,"i",52),n(83,"Forma Pago: "),i(),a(84,"td",37)(85,"span",53),n(86),i()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),b(e.facturaActual.Secuencia),o(6),b(e.facturaActual.Numero),o(6),b(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),b(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function Gt(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function zt(r,t){r&1&&(a(0,"span",90),c(1,"i",91),n(2,"Requerido "),i())}function Jt(r,t){r&1&&(a(0,"span",92),c(1,"i",93),n(2,"N/A "),i())}function Wt(r,t){r&1&&(a(0,"span",94),c(1,"i",95),n(2,"Validado "),i())}function Ht(r,t){r&1&&(a(0,"span",96),c(1,"i",97),n(2,"Pendiente "),i())}function Xt(r,t){r&1&&(a(0,"span",45),c(1,"i",95),n(2,"OK "),i())}function jt(r,t){if(r&1){let e=S();a(0,"div",98)(1,"span",99),c(2,"i",100),i(),a(3,"input",101),T("ngModelChange",function(l){h(e);let s=p().$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){h(e);let s=p().$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()}if(r&2){let e=p().$implicit,d=p(3);o(3),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function qt(r,t){r&1&&(a(0,"div",102),n(1," Sin c\xF3digo de barras "),i())}function Kt(r,t){if(r&1&&(a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",78)(8,"div"),n(9),g(10,Gt,3,1,"div",79),i()(),a(11,"td",80),g(12,zt,3,0,"span",81)(13,Jt,3,0,"span",82),i(),a(14,"td",80),g(15,Wt,3,0,"span",83)(16,Ht,3,0,"span",84)(17,Xt,3,0,"span",85),i(),a(18,"td",37),g(19,jt,4,3,"div",86)(20,qt,2,0,"div",87),i()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function Yt(r,t){if(r&1&&(a(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),c(4,"i",57),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,Kt,21,12,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function Qt(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function Zt(r,t){r&1&&(a(0,"span",113),c(1,"i",95),n(2,"Validado "),i())}function ea(r,t){r&1&&(a(0,"span",114),c(1,"i",97),n(2,"Pendiente "),i())}function ta(r,t){if(r&1){let e=S();a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",107)(8,"div"),n(9),g(10,Qt,3,1,"div",79),i()(),a(11,"td",80)(12,"span",108),c(13,"i",91),n(14,"Requerido "),i()(),a(15,"td",80),g(16,Zt,3,0,"span",109)(17,ea,3,0,"span",110),i(),a(18,"td",37)(19,"div",98)(20,"span",111),c(21,"i",112),i(),a(22,"input",101),T("ngModelChange",function(l){let s=h(e).$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){let s=h(e).$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function aa(r,t){if(r&1&&(a(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),c(4,"i",105),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,ta,23,10,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function ia(r,t){r&1&&(a(0,"div",2)(1,"div",115),c(2,"i",116),n(3," No hay productos en el detalle "),i()())}function na(r,t){if(r&1){let e=S();a(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),i(),a(6,"button",14),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),i()(),a(7,"div",15),g(8,$t,87,12,"div",16),a(9,"div",1),g(10,Yt,33,2,"div",17)(11,aa,33,2,"div",17)(12,ia,4,0,"div",17),i()(),a(13,"div",18)(14,"button",19),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),n(15,"Cerrar"),i(),a(16,"button",20),C("click",function(){h(e);let l=p();return v(l.guardarPreparacion())}),c(17,"i",21),n(18,"Guardar Preparaci\xF3n "),i()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var me=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):V.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,s)=>{let f=`${l.ProductoId}_${s}`;return this.inputValues[f]="",k(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,V.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):V.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,s=l.value.trim();if(console.log("Input value for row:",e,"Value:",s),e&&s){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(_=>_.trim()):[],E=f.includes(s)||s===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",s),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=s,l.classList.remove("is-invalid"),l.classList.add("is-valid"),V.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${s}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),V.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(_=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${_}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${s}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(s=>`\u2022 ${s.CopProducto} - ${s.Detalle.substring(0,50)}...`).join(`
`);V.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(s=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${s.CopProducto}</strong><br>
                  <small class="text-muted">${s.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);V.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:s=>{if(console.log("response: ",s),s.success)if(s.data&&s.data.length>0){let f=s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.success==="true"));s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.menssage==="ya existe registro"))?V.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?V.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${s.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):V.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else V.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${s.factura}</p>
                    <p class="text-success">${s.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else V.default.fire({title:"Error!",text:s.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:s=>{console.log("error: ",s),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-opciones"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),c(4,"div",4),a(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(s){return d.onTableAction(s)})("customAction",function(s){return d.onCustomAction(s)}),i()()()()()(),g(8,na,19,5,"div",8),i()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[G,U,L,$,X,J,W,H,j,K],encapsulation:2})};var B=Z(ee());function ra(r,t){if(r&1&&(a(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),i(),a(4,"div",24),c(5,"i",25),a(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),i()()(),a(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),c(12,"i",31),n(13,"Datos Principales "),i()(),a(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),c(19,"i",36),n(20,"Bodega: "),i(),a(21,"td",37)(22,"span",38),n(23),i()()(),a(24,"tr",34)(25,"td",39),c(26,"i",40),n(27,"Secuencia: "),i(),a(28,"td",37)(29,"span",41),n(30),i()()(),a(31,"tr",34)(32,"td",39),c(33,"i",42),n(34,"N\xFAmero: "),i(),a(35,"td",37),n(36),i()(),a(37,"tr",34)(38,"td",39),c(39,"i",43),n(40,"Cliente: "),i(),a(41,"td",37),n(42),i()(),a(43,"tr",34)(44,"td",39),c(45,"i",44),n(46,"Fecha: "),i(),a(47,"td",37)(48,"span",45),n(49),D(50,"date"),i()()()()()()()(),a(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),c(55,"i",46),n(56,"Informaci\xF3n de Contacto "),i()(),a(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),c(62,"i",47),n(63,"Ciudad: "),i(),a(64,"td",37)(65,"span",48),n(66),i()()(),a(67,"tr",34)(68,"td",39),c(69,"i",49),n(70,"Vendedor: "),i(),a(71,"td",37),n(72),i()(),a(73,"tr",34)(74,"td",39),c(75,"i",50),n(76,"Tipo Pedido: "),i(),a(77,"td",37)(78,"span",51),n(79),i()()(),a(80,"tr",34)(81,"td",39),c(82,"i",52),n(83,"Forma Pago: "),i(),a(84,"td",37)(85,"span",53),n(86),i()()()()()()()()()),r&2){let e=p(2);o(23),m(" ",e.detalleFactura[0].CodigosBodega," "),o(7),b(e.facturaActual.Secuencia),o(6),b(e.facturaActual.Numero),o(6),b(e.facturaActual.Nombre),o(7),m(" ",w(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(17),m(" ",e.facturaActual.Ciudad," "),o(6),b(e.facturaActual.Vendedor),o(7),m(" ",e.facturaActual.TipoP," "),o(7),m(" ",e.facturaActual.FPago," ")}}function oa(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function la(r,t){r&1&&(a(0,"span",90),c(1,"i",91),n(2,"Requerido "),i())}function sa(r,t){r&1&&(a(0,"span",92),c(1,"i",93),n(2,"N/A "),i())}function ca(r,t){r&1&&(a(0,"span",94),c(1,"i",95),n(2,"Validado "),i())}function da(r,t){r&1&&(a(0,"span",96),c(1,"i",97),n(2,"Pendiente "),i())}function ua(r,t){r&1&&(a(0,"span",45),c(1,"i",95),n(2,"OK "),i())}function pa(r,t){if(r&1){let e=S();a(0,"div",98)(1,"span",99),c(2,"i",100),i(),a(3,"input",101),T("ngModelChange",function(l){h(e);let s=p().$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){h(e);let s=p().$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()}if(r&2){let e=p().$implicit,d=p(3);o(3),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function ma(r,t){r&1&&(a(0,"div",102),n(1," Sin c\xF3digo de barras "),i())}function fa(r,t){if(r&1&&(a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",78)(8,"div"),n(9),g(10,oa,3,1,"div",79),i()(),a(11,"td",80),g(12,la,3,0,"span",81)(13,sa,3,0,"span",82),i(),a(14,"td",80),g(15,ca,3,0,"span",83)(16,da,3,0,"span",84)(17,ua,3,0,"span",85),i(),a(18,"td",37),g(19,pa,4,3,"div",86)(20,ma,2,0,"div",87),i()()),r&2){let e=t.$implicit;o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion),o(2),u("ngIf",e.validado),o(),u("ngIf",!e.validado&&e.necesitaValidacion),o(),u("ngIf",!e.validado&&!e.necesitaValidacion),o(2),u("ngIf",e.necesitaValidacion),o(),u("ngIf",!e.necesitaValidacion)}}function ga(r,t){if(r&1&&(a(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),c(4,"i",57),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,fa,21,12,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos Libres (",e.productosNoJaula.length,") "),o(27),u("ngForOf",e.productosNoJaula)}}function _a(r,t){if(r&1&&(a(0,"div",88)(1,"small",89),n(2),i()()),r&2){let e=p().$implicit;o(2),b(e.ubi2)}}function ba(r,t){r&1&&(a(0,"span",113),c(1,"i",95),n(2,"Validado "),i())}function ha(r,t){r&1&&(a(0,"span",114),c(1,"i",97),n(2,"Pendiente "),i())}function va(r,t){if(r&1){let e=S();a(0,"tr",74)(1,"td",75),n(2),i(),a(3,"td",76),n(4),i(),a(5,"td",77),n(6),i(),a(7,"td",107)(8,"div"),n(9),g(10,_a,3,1,"div",79),i()(),a(11,"td",80)(12,"span",108),c(13,"i",91),n(14,"Requerido "),i()(),a(15,"td",80),g(16,ba,3,0,"span",109)(17,ha,3,0,"span",110),i(),a(18,"td",37)(19,"div",98)(20,"span",111),c(21,"i",112),i(),a(22,"input",101),T("ngModelChange",function(l){let s=h(e).$implicit,f=p(3);return I(f.inputValues[s.input_field],l)||(f.inputValues[s.input_field]=l),v(l)}),C("keypress",function(l){let s=h(e).$implicit,f=p(3);return v(f.onInputKeyPress(l,s,s.input_field))}),i()()()()}if(r&2){let e=t.$implicit,d=p(3);o(2),m(" ",e.CopProducto," "),o(2),m(" ",e.Cantidad," "),o(2),b(e.Detalle),o(3),m(" ",e.ubi1," "),o(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),o(6),u("ngIf",e.validado),o(),u("ngIf",!e.validado),o(5),y("ngModel",d.inputValues[e.input_field]),u("disabled",e.validado),Y("data-product",e.CopProducto)}}function xa(r,t){if(r&1&&(a(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),c(4,"i",105),n(5),i()(),a(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),c(12,"i",63),n(13,"C\xF3digo "),i(),a(14,"th",64),n(15," Cant. "),i(),a(16,"th",65),c(17,"i",31),n(18,"Descripci\xF3n "),i(),a(19,"th",66),c(20,"i",67),n(21,"Ubicaci\xF3n "),i(),a(22,"th",68),c(23,"i",69),n(24,"Validar "),i(),a(25,"th",68),c(26,"i",70),n(27,"Estado "),i(),a(28,"th",71),c(29,"i",72),n(30,"C\xF3digo de barras "),i()()(),a(31,"tbody"),g(32,va,23,10,"tr",73),i()()()()()()),r&2){let e=p(2);o(5),m("Productos en JAULA (",e.productosJaula.length,") "),o(27),u("ngForOf",e.productosJaula)}}function Ca(r,t){r&1&&(a(0,"div",2)(1,"div",115),c(2,"i",116),n(3," No hay productos en el detalle "),i()())}function Ea(r,t){if(r&1){let e=S();a(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),i(),a(6,"button",14),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),i()(),a(7,"div",15),g(8,ra,87,12,"div",16),a(9,"div",1),g(10,ga,33,2,"div",17)(11,xa,33,2,"div",17)(12,Ca,4,0,"div",17),i()(),a(13,"div",18)(14,"button",19),C("click",function(){h(e);let l=p();return v(l.cerrarModal())}),n(15,"Cerrar"),i(),a(16,"button",20),C("click",function(){h(e);let l=p();return v(l.guardarPreparacion())}),c(17,"i",21),n(18,"Guardar Preparaci\xF3n "),i()()()()()}if(r&2){let e=p();o(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),o(3),u("ngIf",e.facturaActual),o(2),u("ngIf",e.productosNoJaula.length>0),o(),u("ngIf",e.productosJaula.length>0),o(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var fe=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):B.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:d=>{console.log("response: ",d),d.success&&d.cabecera?d.cabecera.length>0?(this.facturaSeleccionada=d,this.facturaActual=d.cabecera[0],this.detalleFactura=d.detalle||[],this.detalleFactura=this.detalleFactura.map((l,s)=>{let f=`${l.ProductoId}_${s}`;return this.inputValues[f]="",k(P({},l),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:l.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(l=>l.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,B.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):B.default.fire("Error!",d.message,"error"),this.isLoading=!1},error:d=>{console.log("error: ",d),this.isLoading=!1}})}onInputKeyPress(t,e,d){if(t.key==="Enter"){let l=t.target,s=l.value.trim();if(console.log("Input value for row:",e,"Value:",s),e&&s){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(_=>_.trim()):[],E=f.includes(s)||s===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",s),console.log("Es v\xE1lido:",E),E?(e.validado=!0,e.codigoBarras=s,l.classList.remove("is-invalid"),l.classList.add("is-valid"),B.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${s}`),setTimeout(()=>{l.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,l.classList.remove("is-valid"),l.classList.add("is-invalid"),B.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(_=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${_}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${s}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${s}`),setTimeout(()=>{l.classList.remove("is-invalid"),l.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(l=>l.necesitaValidacion),e=t.filter(l=>!l.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let l=e.map(s=>`\u2022 ${s.CopProducto} - ${s.Detalle.substring(0,50)}...`).join(`
`);B.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(s=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${s.CopProducto}</strong><br>
                  <small class="text-muted">${s.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let d=this.detalleFactura.filter(l=>l.validado||!l.necesitaValidacion);B.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${d.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let l={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",l),this.FacturacionService.FinalizarPreparacion(l).subscribe({next:s=>{if(console.log("response: ",s),s.success)if(s.data&&s.data.length>0){let f=s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.success==="true"));s.data.some(_=>_.data&&_.data.length>0&&_.data.some(x=>x.menssage==="ya existe registro"))?B.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?B.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p><strong>Bodega(s):</strong> ${s.bodegas?s.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${s.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):B.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${s.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else B.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${s.factura}</p>
                    <p class="text-success">${s.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else B.default.fire({title:"Error!",text:s.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:s=>{console.log("error: ",s),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-despachar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1","fw-bold"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-success fs-6",4,"ngIf"],["class","badge bg-danger fs-6",4,"ngIf"],["class","badge bg-light text-dark fs-6",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary","fs-6"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger","fs-6"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"text-center","small","py-1"],[1,"badge","bg-warning","text-dark"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),c(4,"div",4),a(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(s){return d.onTableAction(s)})("customAction",function(s){return d.onCustomAction(s)}),i()()()()()(),g(8,Ea,19,5,"div",8),i()),e&2&&(o(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),o(4),u("hasCheckbox",!1)("tableConfig",d.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",d.Buttons_Export)("customButtons",d.customButtons)("initialDateFilter","this_month"),o(),u("ngIf",d.showPrepararModal))},dependencies:[G,U,L,$,X,J,W,H,j,K],encapsulation:2})};var Q=Z(ee());var Sa=(r,t,e,d)=>({"bg-success":r,"bg-warning text-dark":t,"bg-info":e,"bg-secondary":d});function Aa(r,t){r&1&&(a(0,"div",50)(1,"span",51),c(2,"i",52),n(3,"FACTURA MULTIBODEGA "),i()())}function ya(r,t){if(r&1&&(a(0,"span",53),n(1),i()),r&2){let e=t.$implicit;o(),m(" ",e," ")}}function Ia(r,t){if(r&1&&(a(0,"tr",26)(1,"td",31),c(2,"i",39),n(3,"PDF Factura: "),i(),a(4,"td",29)(5,"a",54),c(6,"i",41),n(7,"Ver PDF "),i()()()),r&2){let e=p(2);o(5),u("href","http://"+(e.facturaActual==null?null:e.facturaActual.SRI_LNK),ve)}}function Ta(r,t){if(r&1&&(a(0,"tr",26)(1,"td",31),c(2,"i",55),n(3,"RUC: "),i(),a(4,"td",29)(5,"span",56),n(6),i()()()),r&2){let e=p(2);o(6),b(e.facturaActual==null||e.facturaActual.Ruc==null?null:e.facturaActual.Ruc.trim())}}function Fa(r,t){if(r&1){let e=S();a(0,"div",1)(1,"div",13),g(2,Aa,4,0,"div",14),a(3,"div",15)(4,"div",16),c(5,"i",17),a(6,"h6",18),n(7,"Informaci\xF3n de la Factura"),i()()()(),a(8,"div",19)(9,"div",20)(10,"div",21)(11,"small",22),c(12,"i",23),n(13,"Datos Principales "),i()(),a(14,"div",24)(15,"table",25)(16,"tbody")(17,"tr",26)(18,"td",27),c(19,"i",28),n(20,"Bodega(s): "),i(),a(21,"td",29),g(22,ya,2,1,"span",30),i()(),a(23,"tr",26)(24,"td",31),c(25,"i",32),n(26,"Secuencia: "),i(),a(27,"td",29)(28,"span",33),n(29),i()()(),a(30,"tr",26)(31,"td",31),c(32,"i",34),n(33,"N\xFAmero: "),i(),a(34,"td",29),n(35),i()(),a(36,"tr",26)(37,"td",31),c(38,"i",35),n(39,"Cliente: "),i(),a(40,"td",29),n(41),i()(),a(42,"tr",26)(43,"td",31),c(44,"i",36),n(45,"Fecha: "),i(),a(46,"td",29)(47,"span",37),n(48),D(49,"date"),i()()(),g(50,Ia,8,1,"tr",38),a(51,"tr",26)(52,"td",31),c(53,"i",39),n(54,"Series: "),i(),a(55,"td",29)(56,"button",40),C("click",function(){h(e);let l=p();return v(l.verSeries())}),c(57,"i",41),n(58,"Ver series "),i()()()()()()()(),a(59,"div",19)(60,"div",20)(61,"div",21)(62,"small",22),c(63,"i",42),n(64,"Informaci\xF3n de Contacto "),i()(),a(65,"div",24)(66,"table",25)(67,"tbody")(68,"tr",26)(69,"td",31),c(70,"i",43),n(71,"Ciudad: "),i(),a(72,"td",29)(73,"span",44),n(74),i()()(),a(75,"tr",26)(76,"td",31),c(77,"i",45),n(78,"Vendedor: "),i(),a(79,"td",29),n(80),i()(),a(81,"tr",26)(82,"td",31),c(83,"i",46),n(84,"Tipo Pedido: "),i(),a(85,"td",29)(86,"span",47),n(87),i()()(),a(88,"tr",26)(89,"td",31),c(90,"i",48),n(91,"Forma Pago: "),i(),a(92,"td",29)(93,"span",49),n(94),i()()(),g(95,Ta,7,1,"tr",38),i()()()()()()}if(r&2){let e=p();o(2),u("ngIf",e.isMultibodega()),o(20),u("ngForOf",e.getBodegasUnicas()),o(7),m(" ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(6),m(" ",e.facturaActual==null?null:e.facturaActual.Numero," "),o(6),m(" ",e.facturaActual==null||e.facturaActual.Nombre==null?null:e.facturaActual.Nombre.trim()," "),o(7),m(" ",w(49,12,e.facturaActual==null?null:e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),o(2),u("ngIf",e.facturaActual==null?null:e.facturaActual.SRI_LNK),o(24),m(" ",e.facturaActual==null||e.facturaActual.Ciudad==null?null:e.facturaActual.Ciudad.trim()," "),o(6),b(e.facturaActual==null||e.facturaActual.Vendedor==null?null:e.facturaActual.Vendedor.trim()),o(7),m(" ",e.facturaActual==null||e.facturaActual.TipoP==null?null:e.facturaActual.TipoP.trim()," "),o(7),m(" ",e.facturaActual==null||e.facturaActual.FPago==null?null:e.facturaActual.FPago.trim()," "),o(),u("ngIf",e.facturaActual==null?null:e.facturaActual.Ruc)}}function Da(r,t){if(r&1&&(a(0,"tr",79)(1,"td",80)(2,"span",81),n(3),i()(),a(4,"td",82),n(5),i(),a(6,"td",83)(7,"small"),n(8),i()(),a(9,"td",84),n(10),i(),a(11,"td",80)(12,"small",85),n(13),D(14,"number"),i()(),a(15,"td",80)(16,"small",85),n(17),D(18,"number"),i()(),a(19,"td",82)(20,"span",86),n(21),D(22,"number"),i()()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),m(" ",e.bodega_codigo," "),o(2),m(" ",e.producto_codigo," "),o(3),b(e.producto_nombre),o(2),m(" ",e.factura_cantidad," "),o(3),m("$",w(14,8,e.factura_subtoal,"1.2-2"),""),o(4),m("$",w(18,11,e.factura_iva,"1.2-2"),""),o(4),m("$",w(22,14,e.factura_total,"1.2-2"),"")}}function wa(r,t){if(r&1&&(a(0,"div")(1,"small",90),n(2),i(),c(3,"br"),a(4,"small",85),n(5),D(6,"date"),i()()),r&2){let e=p().$implicit;o(2),b(e.fl_preparadapor),o(3),b(w(6,2,e.fl_preparadafecha,"dd/MM/yyyy HH:mm"))}}function Oa(r,t){r&1&&(a(0,"span",85),n(1,"-"),i())}function Pa(r,t){if(r&1&&(a(0,"div")(1,"small",33),n(2),i(),c(3,"br"),a(4,"small",85),n(5),D(6,"date"),i()()),r&2){let e=p().$implicit;o(2),b(e.fl_verificadapor),o(3),b(w(6,2,e.fl_verificadafecha,"dd/MM/yyyy HH:mm"))}}function ka(r,t){r&1&&(a(0,"span",85),n(1,"-"),i())}function Ra(r,t){if(r&1&&(a(0,"div")(1,"small",91),n(2),i(),c(3,"br"),a(4,"small",92),n(5),i(),c(6,"br"),a(7,"small",85),n(8),D(9,"date"),i()()),r&2){let e=p().$implicit;o(2),b(e.fl_guiaconsolidado),o(3),b(e.fl_guiaconsolidadopor),o(3),b(w(9,3,e.fl_guiaconsolidadofecha,"dd/MM/yyyy HH:mm"))}}function Va(r,t){r&1&&(a(0,"span",85),n(1,"-"),i())}function Ba(r,t){if(r&1&&(a(0,"div")(1,"small",93),n(2),i(),c(3,"br"),a(4,"small",90),n(5),i(),c(6,"br"),a(7,"small",85),n(8),D(9,"date"),i()()),r&2){let e=p().$implicit;o(2),b(e.fl_guiadespachofinal),o(3),b(e.fl_guiadespachofinalpor),o(3),b(w(9,3,e.fl_guiadespachofinalfecha,"dd/MM/yyyy HH:mm"))}}function Na(r,t){r&1&&(a(0,"span",85),n(1,"-"),i())}function Ma(r,t){if(r&1&&(a(0,"tr",79)(1,"td",80)(2,"span",81),n(3),i()(),a(4,"td",82),n(5),i(),a(6,"td",80)(7,"span",87),n(8),i()(),a(9,"td",80),g(10,wa,7,5,"div",88)(11,Oa,2,0,"span",89),i(),a(12,"td",80),g(13,Pa,7,5,"div",88)(14,ka,2,0,"span",89),i(),a(15,"td",80),g(16,Ra,10,6,"div",88)(17,Va,2,0,"span",89),i(),a(18,"td",80),g(19,Ba,10,6,"div",88)(20,Na,2,0,"span",89),i()()),r&2){let e=t.$implicit;o(2),u("title",e.bodega_nombre),o(),m(" ",e.bodega_codigo," "),o(2),m(" ",e.productos_count," "),o(2),u("ngClass",Ee(13,Sa,e.fl_estado==="INGRESADAGUIA",e.fl_estado==="PREPARADA",e.fl_estado==="VERIFICADA",e.fl_estado==="-"||!e.fl_estado)),o(),m(" ",e.fl_estado==="-"?"Pendiente":e.fl_estado||"Pendiente"," "),o(2),u("ngIf",e.fl_preparadapor&&e.fl_preparadapor!=="-"),o(),u("ngIf",!e.fl_preparadapor||e.fl_preparadapor==="-"),o(2),u("ngIf",e.fl_verificadapor&&e.fl_verificadapor!=="-"),o(),u("ngIf",!e.fl_verificadapor||e.fl_verificadapor==="-"),o(2),u("ngIf",e.fl_guiaconsolidadopor&&e.fl_guiaconsolidadopor!==""),o(),u("ngIf",!e.fl_guiaconsolidadopor||e.fl_guiaconsolidadopor===""),o(2),u("ngIf",e.fl_guiadespachofinalpor&&e.fl_guiadespachofinalpor!=="-"),o(),u("ngIf",!e.fl_guiadespachofinalpor||e.fl_guiadespachofinalpor==="-")}}function Ua(r,t){if(r&1&&(a(0,"div",57)(1,"div",58)(2,"div",59)(3,"div",60)(4,"h6",61),c(5,"i",62),n(6),i()(),a(7,"div",63)(8,"div",64)(9,"table",65)(10,"thead",66)(11,"tr")(12,"th",67),c(13,"i",68),n(14,"Bodega "),i(),a(15,"th",69),c(16,"i",70),n(17,"C\xF3digo "),i(),a(18,"th",71),c(19,"i",23),n(20,"Descripci\xF3n "),i(),a(21,"th",67),n(22," Cantidad "),i(),a(23,"th",72),n(24," Subtotal "),i(),a(25,"th",72),n(26," IVA "),i(),a(27,"th",72),n(28," Total "),i()()(),a(29,"tbody"),g(30,Da,23,17,"tr",73),i()()()()()(),a(31,"div",2)(32,"div",74)(33,"div",60)(34,"h6",75),c(35,"i",76),n(36,"Estado de Tracking por Bodega "),i()(),a(37,"div",63)(38,"div",64)(39,"table",65)(40,"thead",77)(41,"tr")(42,"th",69),n(43,"Bodega"),i(),a(44,"th",67),n(45,"Productos"),i(),a(46,"th",69),n(47,"Estado"),i(),a(48,"th",78),n(49,"Preparado"),i(),a(50,"th",78),n(51,"Verificado"),i(),a(52,"th",78),n(53,"Gu\xEDa Consolidado"),i(),a(54,"th",78),n(55,"Gu\xEDa Despacho"),i()()(),a(56,"tbody"),g(57,Ma,21,18,"tr",73),i()()()()()()()),r&2){let e=p();o(6),m("Detalle de Productos (",e.detalleFactura.length,") "),o(24),u("ngForOf",e.detalleFactura),o(27),u("ngForOf",e.getDetalleAgrupadoPorBodega())}}function La(r,t){r&1&&(a(0,"div",107)(1,"div",108)(2,"span",109),n(3,"Cargando..."),i()(),a(4,"p",110),n(5,"Cargando series..."),i()())}function $a(r,t){if(r&1&&(a(0,"div",118)(1,"span",119),n(2),i()()),r&2){let e=t.$implicit;o(2),b(e)}}function Ga(r,t){if(r&1&&(a(0,"tr",79)(1,"td",115),n(2),i(),a(3,"td",116)(4,"small"),n(5),i()(),a(6,"td",116),g(7,$a,3,1,"div",117),i()()),r&2){let e=t.$implicit;o(2),m(" ",e.codigo," "),o(3),b(e.producto_nombre),o(2),u("ngForOf",e.series_array)}}function za(r,t){if(r&1&&(a(0,"div",64)(1,"table",111)(2,"thead",77)(3,"tr")(4,"th",112),c(5,"i",70),n(6,"C\xF3digo "),i(),a(7,"th",113),c(8,"i",23),n(9,"Producto "),i(),a(10,"th",113),c(11,"i",114),n(12,"Series "),i()()(),a(13,"tbody"),g(14,Ga,8,3,"tr",73),i()()()),r&2){let e=p(2);o(14),u("ngForOf",e.seriesData)}}function Ja(r,t){r&1&&(a(0,"div",107),c(1,"i",120),a(2,"p",110),n(3,"No se encontraron series para esta factura"),i()())}function Wa(r,t){if(r&1){let e=S();a(0,"div",94)(1,"div",95)(2,"div",96)(3,"div",97)(4,"h5",98),c(5,"i",99),n(6),i(),a(7,"button",100),C("click",function(){h(e);let l=p();return v(l.cerrarModalSeries())}),i()(),a(8,"div",101),g(9,La,6,0,"div",102)(10,za,15,1,"div",103)(11,Ja,4,0,"div",102),i(),a(12,"div",104)(13,"button",105),C("click",function(){h(e);let l=p();return v(l.cerrarModalSeries())}),c(14,"i",106),n(15,"Cerrar "),i()()()()()}if(r&2){let e=p();o(6),m("Series de Productos - Factura ",e.facturaActual==null?null:e.facturaActual.Secuencia," "),o(3),u("ngIf",e.isLoadingSeries),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length>0),o(),u("ngIf",!e.isLoadingSeries&&e.seriesData.length===0)}}var ge=class r{constructor(t,e,d){this.FacturacionService=t;this.cdr=e;this.router=d}sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaActual=null;detalleFactura=[];seriesData=[];isLoadingSeries=!1;showModalSeries=!1;fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];secuenciafactura="";MostrarDetalleFactura=!1;customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Sucursal",field_value:"FACTURA_SUCURSAL",sort:!0},{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):Q.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.FACTURA_SUCURSAL=`<span class="fw-bold badge badge-secondary fs-6">${t.FACTURA_SUCURSAL}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=k(P({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e)}onbuscarFactura(){if(!this.secuenciafactura||this.secuenciafactura.trim()===""){Q.default.fire("Error!","Por favor ingrese una secuencia de factura","warning");return}this.isLoading=!0;let t={secuencia:this.secuenciafactura.trim(),usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasTracking(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data&&e.data.length>0?(this.facturaActual=e.data[0],this.detalleFactura=e.detalle||[],this.MostrarDetalleFactura=!0):(Q.default.fire("Error!","No se encontr\xF3 informaci\xF3n de la factura","error"),this.MostrarDetalleFactura=!1),this.isLoading=!1},error:e=>{console.log("error: ",e),Q.default.fire("Error!","Ocurri\xF3 un error al buscar la factura","error"),this.isLoading=!1,this.MostrarDetalleFactura=!1}})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}getBodegasUnicas(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t=this.detalleFactura.map(e=>e.bodega_codigo);return[...new Set(t)]}isMultibodega(){return this.getBodegasUnicas().length>1}getBodegasString(){return this.getBodegasUnicas().join(", ")}getDetalleAgrupadoPorBodega(){if(!this.detalleFactura||this.detalleFactura.length===0)return[];let t={};return this.detalleFactura.forEach(e=>{let d=e.bodega_codigo;t[d]?(t[d].productos_count++,t[d].total_factura+=parseFloat(e.factura_total)):t[d]={bodega_codigo:e.bodega_codigo,bodega_nombre:e.bodega_nombre,fl_estado:e.fl_estado,fl_preparadapor:e.fl_preparadapor,fl_preparadafecha:e.fl_preparadafecha,fl_verificadapor:e.fl_verificadapor,fl_verificadafecha:e.fl_verificadafecha,fl_guiaconsolidado:e.fl_guiaconsolidado,fl_guiaconsolidadofecha:e.fl_guiaconsolidadofecha,fl_guiaconsolidadopor:e.fl_guiaconsolidadopor,fl_guiadespachofinal:e.fl_guiadespachofinal,fl_guiadespachofinalfecha:e.fl_guiadespachofinalfecha,fl_guiadespachofinalpor:e.fl_guiadespachofinalpor,productos_count:1,total_factura:parseFloat(e.factura_total)}}),Object.values(t)}verSeries(){if(!this.facturaActual||!this.facturaActual.Id){Q.default.fire("Error!","No hay factura seleccionada","warning");return}this.isLoadingSeries=!0,this.seriesData=[],this.showModalSeries=!0;let t={factura_id:this.facturaActual.Id};console.log("param: ",t),this.FacturacionService.GetFacturasSeries(t).subscribe({next:e=>{console.log("response: ",e),this.isLoadingSeries=!1,e.success&&e.data&&e.data.length>0?this.seriesData=e.data.map(d=>k(P({},d),{series_array:d.series?d.series.split("/"):[]})):this.seriesData=[]},error:e=>{console.log("error: ",e),this.isLoadingSeries=!1,this.seriesData=[],Q.default.fire("Error!","Ocurri\xF3 un error al buscar las series","error")}})}cerrarModalSeries(){this.showModalSeries=!1,this.seriesData=[],this.isLoadingSeries=!1}static \u0275fac=function(e){return new(e||r)(A(q),A(M),A(z))};static \u0275cmp=N({type:r,selectors:[["app-tracking-facturas"]],decls:16,vars:6,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"col-xl-4","col-md-6","mb-2"],[1,"form-label","fw-bold"],[1,"input-group","mb-3"],["type","text","placeholder","001-001-000000123","name","secuenciafactura",1,"form-control","form-control-solid",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","row",4,"ngIf"],["class","row mt-3",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.5);",4,"ngIf"],[1,"col-12","mb-1"],["class","mb-2",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"d-flex","align-items-center"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],["class","badge bg-info me-1 fs-6",4,"ngFor","ngForOf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark","fs-6"],["style","height: 28px;",4,"ngIf"],[1,"fa","fa-file-pdf","text-danger","me-1"],[1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-external-link-alt","me-1"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold","fs-6"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"mb-2"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-info","me-1","fs-6"],["target","_blank",1,"btn","btn-sm","btn-outline-danger",3,"href"],[1,"fa","fa-id-card","text-warning","me-1"],[1,"font-monospace"],[1,"row","mt-3"],[1,"col-12","mb-3"],[1,"card","border-success"],[1,"card-header"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","35%"],[1,"text-center","py-2",2,"width","10%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"card","border-info"],[1,"text-info","mb-0"],[1,"fa","fa-route","me-1"],[1,"table-info"],[1,"text-center","py-2",2,"width","17%"],[1,"align-middle"],[1,"text-center","py-2"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-dark","fs-6",3,"title"],[1,"text-center","fw-bold","py-2"],[1,"py-2"],[1,"text-center","fw-bold","text-primary","py-2"],[1,"text-muted"],[1,"text-success"],[1,"badge","fs-6",3,"ngClass"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-success"],[1,"fw-bold","text-warning"],[1,"fw-bold","text-info"],[1,"fw-bold","text-danger"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","modalSeriesLabel",1,"modal-title"],[1,"fa","fa-barcode","me-2"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa","fa-times","me-1"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-info"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"table","table-striped","table-hover","nowrap"],[1,"",2,"width","20%"],[1,"text-center",2,"width","40%"],[1,"fa","fa-list","me-1"],[1,"fw-bold"],[1,"px-3"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"badge","bg-dark","fs-6"],[1,"fa","fa-exclamation-triangle","text-warning",2,"font-size","2rem"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),c(4,"div",4),a(5,"div",4)(6,"div",5)(7,"label",6),n(8,"Secuencia Factura:"),i(),a(9,"div",7)(10,"input",8),T("ngModelChange",function(s){return I(d.secuenciafactura,s)||(d.secuenciafactura=s),s}),i(),a(11,"button",9),C("click",function(){return d.onbuscarFactura()}),n(12,"Buscar"),i()()()(),g(13,Fa,96,15,"div",10)(14,Ua,58,3,"div",11),i()()()(),g(15,Wa,16,4,"div",12)),e&2&&(o(3),u("headerTitle","Buscar Tracking de Facturas")("cardClass","mb-4"),o(7),y("ngModel",d.secuenciafactura),o(3),u("ngIf",d.MostrarDetalleFactura),o(),u("ngIf",d.MostrarDetalleFactura&&d.detalleFactura.length>0),o(),u("ngIf",d.showModalSeries))},dependencies:[G,le,U,L,Se,$,X,J,W,H,j],encapsulation:2})};var ki=[{path:"picking/prepararfacturas",component:de,data:{title:"Preparar Facturas",breadcrumb:"Preparar Facturas"}},{path:"picking/verificarfacturas",component:ue,data:{title:"Verificar Facturas",breadcrumb:"Verificar Facturas"}},{path:"picking/guiaspickup",component:pe,data:{title:"Guias Pickup",breadcrumb:"Guias Pickup"}},{path:"opciones",component:me,data:{title:"Opciones",breadcrumb:"Opciones"}},{path:"picking/despachar",component:fe,data:{title:"Facturas por despachar",breadcrumb:"Facturas por despachar"}},{path:"tracking",component:ge,data:{title:"Tracking Facturas",breadcrumb:"Facturas por rastrear"}}];export{ki as LogisticaRoutes};
