import{a as K}from"./chunk-6L5RVYWQ.js";import{a as Y}from"./chunk-A2EME234.js";import{a as G,b as J}from"./chunk-33ZCX4LM.js";import{a as X}from"./chunk-H54F7UEQ.js";import{A as I,B as P,C as F,F as z,G as j,H,L as q,c as W,d as D,t as L,v as k,w as B,y as A}from"./chunk-2ZSMW7BP.js";import{m as V,t as O}from"./chunk-UWRFFVUF.js";import{$ as M,Ib as r,Jb as a,Kb as T,Nb as E,Tb as h,Ub as s,a as v,ab as m,b as y,bc as l,e as Q,ea as S,gb as x,gc as c,hc as p,ic as g,lb as N,na as u,oa as d,qb as U,wc as R,yb as C}from"./chunk-RTW6XBZX.js";var _=Q(X());var b=class f extends J{endpoint=G.apiUrl+"/mantenimiento/UsuarioAdmin/";constructor(o){super(o)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let o=localStorage.getItem("user")||"",e=null;try{o&&(e=JSON.parse(o))}catch(n){console.warn("Error parsing user data from localStorage:",n),e=o}return e}headers=new W({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});getUserList(o){return this.http.post(this.endpoint+"getAllUsers",o,{headers:this.headers})}getUserDetails(o){return this.http.post(this.endpoint+"getUserDetails",o,{headers:this.headers})}updateUserData(o){return o.sessionData=this.getUserSessionData(),this.http.post(this.endpoint+"updateUserData",o,{headers:this.headers})}deleteUser(o){return o.sessionData=this.getUserSessionData(),this.http.post(this.endpoint+"deleteUser",o,{headers:this.headers})}createUser(o){return o.sessionData=this.getUserSessionData(),this.http.post(this.endpoint+"create",o,{headers:this.headers})}static \u0275fac=function(e){return new(e||f)(S(D))};static \u0275prov=M({token:f,factory:f.\u0275fac,providedIn:"root"})};function ee(f,o){if(f&1){let e=E();r(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),l(5,"Editar usuario"),a(),r(6,"button",14),h("click",function(){u(e);let t=s();return d(t.showEditModal=!1)}),a()(),r(7,"div",15)(8,"form",16)(9,"div",17)(10,"label",18),l(11,"Usuario"),a(),r(12,"input",19),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.usuario,t)||(i.usuarioEditando.usuario=t),d(t)}),a()(),r(13,"div",17)(14,"label",18),l(15,"Nombre"),a(),r(16,"input",20),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.nombre,t)||(i.usuarioEditando.nombre=t),d(t)}),a()(),r(17,"div",17)(18,"label",18),l(19,"Apellido"),a(),r(20,"input",21),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.apellido,t)||(i.usuarioEditando.apellido=t),d(t)}),a()(),r(21,"div",17)(22,"label",18),l(23,"Email"),a(),r(24,"input",22),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.email,t)||(i.usuarioEditando.email=t),d(t)}),a()(),r(25,"div",17)(26,"label",18),l(27,"Estado"),a(),r(28,"select",23),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.estado,t)||(i.usuarioEditando.estado=t),d(t)}),r(29,"option",24),l(30,"Activo"),a(),r(31,"option",25),l(32,"Inactivo"),a()()(),r(33,"div",17)(34,"label",18),l(35,"Empresa"),a(),r(36,"input",26),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.empresa,t)||(i.usuarioEditando.empresa=t),d(t)}),a()(),r(37,"div",17)(38,"label",18),l(39,"Rol"),a(),r(40,"input",27),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioEditando.rol,t)||(i.usuarioEditando.rol=t),d(t)}),a()()()(),r(41,"div",28)(42,"button",29),h("click",function(){u(e);let t=s();return d(t.showEditModal=!1)}),l(43,"Cerrar"),a(),r(44,"button",30),h("click",function(){u(e);let t=s();return d(t.guardarEdicionUsuario())}),l(45,"Guardar"),a()()()()()}if(f&2){let e=s();m(12),c("ngModel",e.usuarioEditando.usuario),m(4),c("ngModel",e.usuarioEditando.nombre),m(4),c("ngModel",e.usuarioEditando.apellido),m(4),c("ngModel",e.usuarioEditando.email),m(4),c("ngModel",e.usuarioEditando.estado),m(8),c("ngModel",e.usuarioEditando.empresa),m(4),c("ngModel",e.usuarioEditando.rol)}}function te(f,o){if(f&1){let e=E();r(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),l(5,"Crear usuario"),a(),r(6,"button",14),h("click",function(){u(e);let t=s();return d(t.showCreateModal=!1)}),a()(),r(7,"div",15)(8,"form",16)(9,"div",17)(10,"label",18),l(11,"Usuario"),a(),r(12,"input",31),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.usuario,t)||(i.usuarioNuevo.usuario=t),d(t)}),a()(),r(13,"div",17)(14,"label",18),l(15,"Nombre"),a(),r(16,"input",32),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.nombre,t)||(i.usuarioNuevo.nombre=t),d(t)}),a()(),r(17,"div",17)(18,"label",18),l(19,"Apellido"),a(),r(20,"input",33),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.apellido,t)||(i.usuarioNuevo.apellido=t),d(t)}),a()(),r(21,"div",17)(22,"label",18),l(23,"Tel\xE9fono"),a(),r(24,"input",34),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.telefono,t)||(i.usuarioNuevo.telefono=t),d(t)}),a()(),r(25,"div",17)(26,"label",18),l(27,"Email"),a(),r(28,"input",35),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.email,t)||(i.usuarioNuevo.email=t),d(t)}),a()(),r(29,"div",17)(30,"label",18),l(31,"Contrase\xF1a"),a(),r(32,"input",36),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.password,t)||(i.usuarioNuevo.password=t),d(t)}),a()(),r(33,"div",17)(34,"label",18),l(35,"Confirmar contrase\xF1a"),a(),r(36,"input",37),g("ngModelChange",function(t){u(e);let i=s();return p(i.usuarioNuevo.password_confirmation,t)||(i.usuarioNuevo.password_confirmation=t),d(t)}),a()()()(),r(37,"div",28)(38,"button",29),h("click",function(){u(e);let t=s();return d(t.showCreateModal=!1)}),l(39,"Cerrar"),a(),r(40,"button",30),h("click",function(){u(e);let t=s();return d(t.guardarNuevoUsuario())}),l(41,"Guardar"),a()()()()()}if(f&2){let e=s();m(12),c("ngModel",e.usuarioNuevo.usuario),m(4),c("ngModel",e.usuarioNuevo.nombre),m(4),c("ngModel",e.usuarioNuevo.apellido),m(4),c("ngModel",e.usuarioNuevo.telefono),m(4),c("ngModel",e.usuarioNuevo.email),m(4),c("ngModel",e.usuarioNuevo.password),m(4),c("ngModel",e.usuarioNuevo.password_confirmation)}}var w=class f{constructor(o,e){this.usuariosService=o;this.cdr=e}showCreateModal=!1;usuarioNuevo={};showEditModal=!1;usuarioEditando=null;Usuarios_Datos=[];isLoading=!1;fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel","pdf"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"},{label:"",action:"create_user",icon:"fa fa-plus",class:"btn btn-info",tooltip:"Crear nuevo usuario"}];tableConfig={columns:[{title:"Usuario",field_value:"usuario",sort:!0},{title:"Nombre",field_value:"nombre",sort:!0},{title:"Apellido",field_value:"apellido",sort:!0},{title:"Email",field_value:"email",sort:!0},{title:"Estado",field_value:"estado",sort:!0}],row_action:[{label:"",action_to_perform:"edit_user",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Editar usuario"},{label:"",action_to_perform:"delete_user",icon:"trash",type:"button",class:"btn btn-danger btn-sm ms-1",tooltip:"Eliminar usuario"}],data:[]};ngOnInit(){let o=new Date,e=new Date(o.getFullYear(),o.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=o.toISOString().slice(0,10),this.loadTableData()}loadTableData(){this.isLoading=!0;let o={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin};console.log("param: ",o),this.usuariosService.getUserList(o).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data&&(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(o){o.estado=`<span class="badge badge-light-${o.estado=="I"?"danger":"success"}">${o.estado=="I"?"Inactivo":"Activo"}</span>`}),this.tableConfig=y(v({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(o){switch(o.action_to_perform){case"edit_user":this.editUser(o.data);break;case"contact_customer":this.contactCustomer(o.data);break;case"delete_user":this.deleteUser(o.data);break;default:}}onCreateUser(){this.usuarioNuevo={usuario:"",nombre:"",apellido:"",telefono:"",email:"",estado:"A",empresa:"",password:"",password_confirmation:""},this.showCreateModal=!0}guardarNuevoUsuario(){this.isLoading=!0;let o={usuario:this.usuarioNuevo.usuario,nombre:this.usuarioNuevo.nombre,apellido:this.usuarioNuevo.apellido,telefono:this.usuarioNuevo.telefono,email:this.usuarioNuevo.email,estado:this.usuarioNuevo.estado,empresa:this.usuarioNuevo.empresa,password:this.usuarioNuevo.password,password_confirmation:this.usuarioNuevo.password_confirmation};if(o.usuario.trim()==""){_.default.fire("Error!","El campo usuario es obligatorio","error"),this.isLoading=!1;return}if(o.email.trim()==""){_.default.fire("Error!","El campo email es obligatorio","error"),this.isLoading=!1;return}this.usuariosService.createUser(o).subscribe({next:e=>{console.log("response: ",e),e.success?(_.default.fire("\xC9xito!",e.message,"success"),this.showCreateModal=!1,this.loadTableData()):_.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{_.default.fire("Error!","No se pudo crear el usuario","error"),this.isLoading=!1}})}editUser(o){let e={id_usuario:o.id_usuario};this.isLoading=!0,this.usuariosService.getUserDetails(e).subscribe({next:n=>{console.log("response: ",n),n.success&&n.data&&(this.usuarioEditando=n.data[0],this.showEditModal=!0,this.isLoading=!1),this.isLoading=!1},error:n=>{this.isLoading=!1}})}guardarEdicionUsuario(){if(!this.usuarioEditando)return;this.isLoading=!0;let o={id_usuario:this.usuarioEditando.id_usuario,usuario:this.usuarioEditando.usuario,nombre:this.usuarioEditando.nombre,apellido:this.usuarioEditando.apellido,email:this.usuarioEditando.email,estado:this.usuarioEditando.estado,empresa:this.usuarioEditando.empresa,rol:this.usuarioEditando.rol};this.usuariosService.updateUserData(o).subscribe({next:e=>{console.log("response: ",e),e.success?(_.default.fire("\xC9xito!",e.message,"success"),this.showEditModal=!1,this.loadTableData()):_.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{_.default.fire("Error!","No se pudo editar el usuario","error"),this.isLoading=!1}})}contactCustomer(o){console.log("\u{1F680} ~ CustomerOrderReportComponent ~ contactCustomer ~ user:",o),o.email?window.open(`mailto:${o.email}?subject=Contacto desde CRM&body=Hola ${o.usuario},`):alert(`No hay email disponible para ${o.usuario}`)}deleteUser(o){_.default.fire({title:"Estas seguro que quieres eliminar este usuario?",text:"No podr\xE1s revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, eliminarlo!"}).then(e=>{if(e.isConfirmed){this.isLoading=!0;let n={id_usuario:o.id_usuario};this.usuariosService.deleteUser(y(v({},n),{estado:"I"})).subscribe({next:t=>{t.success?(_.default.fire("\xC9xito!","Usuario eliminado correctamente","success"),this.loadTableData()):_.default.fire("Error!",t.message,"error"),this.isLoading=!1},error:t=>{_.default.fire("Error!","No se pudo eliminar el usuario","error"),this.isLoading=!1}})}})}onCustomAction(o){switch(o.action){case"refresh":this.onRefreshTableData();break;case"create_user":this.onCreateUser();break;default:}}onRefreshTableData(){console.log("Refrescando datos de la tabla..."),this.loadTableData()}static \u0275fac=function(e){return new(e||f)(x(b),x(R))};static \u0275cmp=N({type:f,selectors:[["app-customer-order-report"]],decls:10,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["autocomplete","off"],[1,"mb-2"],[1,"form-label"],["disabled","","type","text","name","usuarioEditando_usuario",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","usuarioEditando_nombre",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","usuarioEditando_apellido",1,"form-control",3,"ngModelChange","ngModel"],["type","email","name","usuarioEditando_email",1,"form-control",3,"ngModelChange","ngModel"],["name","usuarioEditando_estado",1,"form-select",3,"ngModelChange","ngModel"],["value","A"],["value","I"],["type","number","name","usuarioEditando_empresa",1,"form-control",3,"ngModelChange","ngModel"],["type","number","name","usuarioEditando_rol",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","text","name","usuarioNuevo_usuario",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","usuarioNuevo_nombre",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","usuarioNuevo_apellido",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","usuarioNuevo_telefono",1,"form-control",3,"ngModelChange","ngModel"],["type","email","name","usuarioNuevo_email",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","usuarioNuevo_password",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","usuarioNuevo_password_confirmation",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),T(4,"div",4),r(5,"div",5)(6,"div",6)(7,"app-table",7),h("action",function(i){return n.onTableAction(i)})("customAction",function(i){return n.onCustomAction(i)}),a()()()()()(),U(8,ee,46,7,"div",8)(9,te,42,7,"div",8),a()),e&2&&(m(3),C("headerTitle","Usuarios"),m(4),C("hasCheckbox",!1)("tableConfig",n.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!1)("downloadReports",!0)("exportButtons",n.Buttons_Export)("customButtons",n.customButtons)("initialDateFilter","this_month"),m(),C("ngIf",n.showEditModal),m(),C("ngIf",n.showCreateModal))},dependencies:[O,V,q,P,j,H,L,F,z,k,B,I,A,Y,K],encapsulation:2})};var he=[{path:"usuarios",component:w,data:{title:"Usuarios",breadcrumb:"Usuarios"}}];export{he as mantenimientoRoutes};
