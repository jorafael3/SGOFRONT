import{a as j}from"./chunk-6L5RVYWQ.js";import{a as X}from"./chunk-A2EME234.js";import{a as Q,b as be}from"./chunk-33ZCX4LM.js";import{a as re}from"./chunk-H54F7UEQ.js";import{A as J,C as q,F as _e,G as he,H as ve,I as xe,J as K,L as H,c as me,d as fe,l as L,s as ge,t as z,v as W}from"./chunk-2ZSMW7BP.js";import{k as pe,l as R,m as N,p as $,t as U}from"./chunk-UWRFFVUF.js";import{$ as le,Ab as de,Ib as i,Jb as a,Kb as d,Nb as A,Tb as C,Ub as p,a as D,ab as s,b as V,bc as n,cc as x,dc as m,e as te,ea as ce,ec as ae,gb as I,gc as E,hc as S,ic as y,lb as k,mc as ne,na as h,nc as ue,oa as v,oc as O,qb as g,qc as M,wb as ie,wc as G,yb as u}from"./chunk-RTW6XBZX.js";var F=te(re());var B=class r extends be{endpoint=Q.apiUrl+"/logistica/facturacion/prepararfacturas/";endpointverificar=Q.apiUrl+"/logistica/facturacion/verificarfacturas/";endpointguiaspickup=Q.apiUrl+"/logistica/facturacion/guiaspickup/";constructor(t){super(t)}getUserSessionToken(){return localStorage.getItem("authToken")||localStorage.getItem("token")||""}getUserSessionData(){let t=localStorage.getItem("user")||"",e=null;try{t&&(e=JSON.parse(t))}catch{e=t}return e}headers=new me({"Content-Type":"application/json",Authorization:`Bearer ${this.getUserSessionToken()}`});GetFacturasPorPreparar(t){return this.http.post(this.endpoint+"GetFacturasPorPreparar",t,{headers:this.headers})}GetFacturasDatos(t){return this.http.post(this.endpoint+"GetFacturasDatos",t,{headers:this.headers})}FinalizarPreparacion(t){return this.http.post(this.endpoint+"FinalizarPreparacion",t,{headers:this.headers})}GetFacturasPorVerificar(t){return this.http.post(this.endpointverificar+"GetFacturasPorVerificar",t,{headers:this.headers})}GetFacturasDatosVerificar(t){return this.http.post(this.endpointverificar+"GetFacturasDatos",t,{headers:this.headers})}ValidarSerie(t){return this.http.post(this.endpointverificar+"ValidarSerie",t,{headers:this.headers})}FinalizarVerificacion(t){return this.http.post(this.endpointverificar+"FinalizarVerificacion",t,{headers:this.headers})}GetFacturasPorGuiasPickup(t){return this.http.post(this.endpointguiaspickup+"GetFacturasGuiasPickup",t,{headers:this.headers})}GetTransporteGuiasPickup(t){return this.http.post(this.endpointguiaspickup+"GetTransporteGuiasPickup",t,{headers:this.headers})}FinalizarGuiasPickup(t){return t.userdata=this.getUserSessionData(),this.http.post(this.endpointguiaspickup+"GuardarGuiasPickup",t,{headers:this.headers})}static \u0275fac=function(e){return new(e||r)(ce(fe))};static \u0275prov=le({token:r,factory:r.\u0275fac,providedIn:"root"})};function Ie(r,t){if(r&1&&(i(0,"div",1)(1,"div",22)(2,"h5",23),n(3,"No cerrar esta ventana si esta realizando el proceso de preparaci\xF3n"),a(),i(4,"div",24),d(5,"i",25),i(6,"h6",26),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",27)(9,"div",28)(10,"div",29)(11,"small",30),d(12,"i",31),n(13,"Datos Principales "),a()(),i(14,"div",32)(15,"table",33)(16,"tbody")(17,"tr",34)(18,"td",35),d(19,"i",36),n(20,"Bodega: "),a(),i(21,"td",37)(22,"span",38),n(23),a()()(),i(24,"tr",34)(25,"td",39),d(26,"i",40),n(27,"Secuencia: "),a(),i(28,"td",37)(29,"span",41),n(30),a()()(),i(31,"tr",34)(32,"td",39),d(33,"i",42),n(34,"N\xFAmero: "),a(),i(35,"td",37),n(36),a()(),i(37,"tr",34)(38,"td",39),d(39,"i",43),n(40,"Cliente: "),a(),i(41,"td",37),n(42),a()(),i(43,"tr",34)(44,"td",39),d(45,"i",44),n(46,"Fecha: "),a(),i(47,"td",37)(48,"span",45),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",27)(52,"div",28)(53,"div",29)(54,"small",30),d(55,"i",46),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",32)(58,"table",33)(59,"tbody")(60,"tr",34)(61,"td",39),d(62,"i",47),n(63,"Ciudad: "),a(),i(64,"td",37)(65,"span",48),n(66),a()()(),i(67,"tr",34)(68,"td",39),d(69,"i",49),n(70,"Vendedor: "),a(),i(71,"td",37),n(72),a()(),i(73,"tr",34)(74,"td",39),d(75,"i",50),n(76,"Tipo Pedido: "),a(),i(77,"td",37)(78,"span",51),n(79),a()()(),i(80,"tr",34)(81,"td",39),d(82,"i",52),n(83,"Forma Pago: "),a(),i(84,"td",37)(85,"span",53),n(86),a()()()()()()()()()),r&2){let e=p(2);s(23),m(" ",e.detalleFactura[0].C\u00F3digo," "),s(7),x(e.facturaActual.Secuencia),s(6),x(e.facturaActual.Numero),s(6),x(e.facturaActual.Nombre),s(7),m(" ",M(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),s(17),m(" ",e.facturaActual.Ciudad," "),s(6),x(e.facturaActual.Vendedor),s(7),m(" ",e.facturaActual.TipoP," "),s(7),m(" ",e.facturaActual.FPago," ")}}function Te(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;s(2),x(e.ubi2)}}function Pe(r,t){r&1&&(i(0,"span",90),d(1,"i",91),n(2,"Requerido "),a())}function we(r,t){r&1&&(i(0,"span",92),d(1,"i",93),n(2,"N/A "),a())}function De(r,t){r&1&&(i(0,"span",94),d(1,"i",95),n(2,"Validado "),a())}function Ve(r,t){r&1&&(i(0,"span",96),d(1,"i",97),n(2,"Pendiente "),a())}function Be(r,t){r&1&&(i(0,"span",45),d(1,"i",95),n(2,"OK "),a())}function ke(r,t){if(r&1){let e=A();i(0,"div",98)(1,"span",99),d(2,"i",100),a(),i(3,"input",101),y("ngModelChange",function(o){h(e);let c=p().$implicit,f=p(3);return S(f.inputValues[c.input_field],o)||(f.inputValues[c.input_field]=o),v(o)}),C("keypress",function(o){h(e);let c=p().$implicit,f=p(3);return v(f.onInputKeyPress(o,c,c.input_field))}),a()()}if(r&2){let e=p().$implicit,l=p(3);s(3),E("ngModel",l.inputValues[e.input_field]),u("disabled",e.validado),ie("data-product",e.CopProducto)}}function Oe(r,t){r&1&&(i(0,"div",102),n(1," Sin c\xF3digo de barras "),a())}function Me(r,t){if(r&1&&(i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),g(10,Te,3,1,"div",79),a()(),i(11,"td",80),g(12,Pe,3,0,"span",81)(13,we,3,0,"span",82),a(),i(14,"td",80),g(15,De,3,0,"span",83)(16,Ve,3,0,"span",84)(17,Be,3,0,"span",85),a(),i(18,"td",37),g(19,ke,4,3,"div",86)(20,Oe,2,0,"div",87),a()()),r&2){let e=t.$implicit;s(2),m(" ",e.CopProducto," "),s(2),m(" ",e.Cantidad," "),s(2),x(e.Detalle),s(3),m(" ",e.ubi1," "),s(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),s(2),u("ngIf",e.necesitaValidacion),s(),u("ngIf",!e.necesitaValidacion),s(2),u("ngIf",e.validado),s(),u("ngIf",!e.validado&&e.necesitaValidacion),s(),u("ngIf",!e.validado&&!e.necesitaValidacion),s(2),u("ngIf",e.necesitaValidacion),s(),u("ngIf",!e.necesitaValidacion)}}function Ge(r,t){if(r&1&&(i(0,"div",2)(1,"div",54)(2,"div",55)(3,"h6",56),d(4,"i",57),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",61)(10,"tr")(11,"th",62),d(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),d(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),d(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),d(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),d(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),d(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Me,21,12,"tr",73),a()()()()()()),r&2){let e=p(2);s(5),m("Productos Libres (",e.productosNoJaula.length,") "),s(27),u("ngForOf",e.productosNoJaula)}}function Re(r,t){if(r&1&&(i(0,"div",88)(1,"small",89),n(2),a()()),r&2){let e=p().$implicit;s(2),x(e.ubi2)}}function Ne(r,t){r&1&&(i(0,"span",94),d(1,"i",95),n(2,"Validado "),a())}function $e(r,t){r&1&&(i(0,"span",96),d(1,"i",97),n(2,"Pendiente "),a())}function Ue(r,t){if(r&1){let e=A();i(0,"tr",74)(1,"td",75),n(2),a(),i(3,"td",76),n(4),a(),i(5,"td",77),n(6),a(),i(7,"td",78)(8,"div"),n(9),g(10,Re,3,1,"div",79),a()(),i(11,"td",80)(12,"span",90),d(13,"i",91),n(14,"Requerido "),a()(),i(15,"td",80),g(16,Ne,3,0,"span",83)(17,$e,3,0,"span",84),a(),i(18,"td",37)(19,"div",98)(20,"span",107),d(21,"i",108),a(),i(22,"input",101),y("ngModelChange",function(o){let c=h(e).$implicit,f=p(3);return S(f.inputValues[c.input_field],o)||(f.inputValues[c.input_field]=o),v(o)}),C("keypress",function(o){let c=h(e).$implicit,f=p(3);return v(f.onInputKeyPress(o,c,c.input_field))}),a()()()()}if(r&2){let e=t.$implicit,l=p(3);s(2),m(" ",e.CopProducto," "),s(2),m(" ",e.Cantidad," "),s(2),x(e.Detalle),s(3),m(" ",e.ubi1," "),s(),u("ngIf",e.ubi2&&e.ubi2!=="N/A"),s(6),u("ngIf",e.validado),s(),u("ngIf",!e.validado),s(5),E("ngModel",l.inputValues[e.input_field]),u("disabled",e.validado),ie("data-product",e.CopProducto)}}function Le(r,t){if(r&1&&(i(0,"div",2)(1,"div",103)(2,"div",55)(3,"h6",104),d(4,"i",105),n(5),a()(),i(6,"div",58)(7,"div",59)(8,"table",60)(9,"thead",106)(10,"tr")(11,"th",62),d(12,"i",63),n(13,"C\xF3digo "),a(),i(14,"th",64),n(15," Cant. "),a(),i(16,"th",65),d(17,"i",31),n(18,"Descripci\xF3n "),a(),i(19,"th",66),d(20,"i",67),n(21,"Ubicaci\xF3n "),a(),i(22,"th",68),d(23,"i",69),n(24,"Validar "),a(),i(25,"th",68),d(26,"i",70),n(27,"Estado "),a(),i(28,"th",71),d(29,"i",72),n(30,"C\xF3digo de barras "),a()()(),i(31,"tbody"),g(32,Ue,23,10,"tr",73),a()()()()()()),r&2){let e=p(2);s(5),m("Productos en JAULA (",e.productosJaula.length,") "),s(27),u("ngForOf",e.productosJaula)}}function ze(r,t){r&1&&(i(0,"div",2)(1,"div",109),d(2,"i",110),n(3," No hay productos en el detalle "),a()())}function We(r,t){if(r&1){let e=A();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),a()(),i(7,"div",15),g(8,Ie,87,12,"div",16),i(9,"div",1),g(10,Ge,33,2,"div",17)(11,Le,33,2,"div",17)(12,ze,4,0,"div",17),a()(),i(13,"div",18)(14,"button",19),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),n(15,"Cerrar"),a(),i(16,"button",20),C("click",function(){h(e);let o=p();return v(o.guardarPreparacion())}),d(17,"i",21),n(18,"Guardar Preparaci\xF3n "),a()()()()()}if(r&2){let e=p();s(5),m("Preparar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),s(3),u("ngIf",e.facturaActual),s(2),u("ngIf",e.productosNoJaula.length>0),s(),u("ngIf",e.productosJaula.length>0),s(),u("ngIf",e.productosJaula.length===0&&e.productosNoJaula.length===0)}}var Y=class r{constructor(t,e,l){this.FacturacionService=t;this.cdr=e;this.router=l}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];inputValues={};productosValidados=[];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-light btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData(),console.log("this.sessionData: ",this.sessionData)}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",t),this.FacturacionService.GetFacturasPorPreparar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):F.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.CODIGOS_BODEGA_TEXTO=`<span class="fw-bold">${t.CODIGOS_BODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=V(D({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;case"manage_empresa":t.data&&t.data.id_empresa&&this.ManageEmpresa(t.data);break;case"delete_user":break;default:}}onPrepararFactura(t){let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.ID_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",e),this.FacturacionService.GetFacturasDatos(e).subscribe({next:l=>{console.log("response: ",l),l.success&&l.cabecera?l.cabecera.length>0?(this.facturaSeleccionada=l,this.facturaActual=l.cabecera[0],this.detalleFactura=l.detalle||[],this.detalleFactura=this.detalleFactura.map((o,c)=>{let f=`${o.ProductoId}_${c}`;return this.inputValues[f]="",V(D({},o),{codigoBarras:"",input_field:f,input_value:"",validado:!1,necesitaValidacion:o.Codigo_barras_tiene==="SI"})}),this.productosJaula=this.detalleFactura.filter(o=>o.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(o=>o.EN_JAULA==="0"),console.log("Productos en JAULA:",this.productosJaula.length),console.log("Productos NO JAULA:",this.productosNoJaula.length),this.showPrepararModal=!0):(this.showPrepararModal=!1,F.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):F.default.fire("Error!",l.message,"error"),this.isLoading=!1},error:l=>{console.log("error: ",l),this.isLoading=!1}})}onInputKeyPress(t,e,l){if(t.key==="Enter"){let o=t.target,c=o.value.trim();if(console.log("Input value for row:",e,"Value:",c),e&&c){let f=e.Codigo_barras?e.Codigo_barras.split(",").map(_=>_.trim()):[],T=f.includes(c)||c===e.CopProducto;console.log("C\xF3digos v\xE1lidos:",[...f,e.CopProducto]),console.log("C\xF3digo ingresado:",c),console.log("Es v\xE1lido:",T),T?(e.validado=!0,e.codigoBarras=c,o.classList.remove("is-invalid"),o.classList.add("is-valid"),F.default.fire({title:"\u2705 Validaci\xF3n Correcta",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>C\xF3digo validado:</strong> <code class="bg-success text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"success",timer:2e3,showConfirmButton:!1,background:"#ffffff",color:"#212529"}),console.log(`\u2705 Producto ${e.CopProducto} VALIDADO correctamente con c\xF3digo: ${c}`),setTimeout(()=>{o.value="",this.inputValues[e.input_field]=""},1e3)):(e.validado=!1,o.classList.remove("is-valid"),o.classList.add("is-invalid"),F.default.fire({title:"\u274C C\xF3digo Incorrecto",html:`
              <div class="text-start">
                <p><strong>Producto:</strong> ${e.CopProducto}</p>
                <p><strong>Descripci\xF3n:</strong> ${e.Detalle}</p>
                <hr>
                <p><strong>C\xF3digos v\xE1lidos:</strong></p>
                <ul class="list-unstyled">
                  <li><code class="bg-primary text-white px-2 py-1 rounded me-1">${e.CopProducto}</code> <small class="text-muted">(C\xF3digo producto)</small></li>
                  ${f.map(_=>`<li><code class="bg-success text-white px-2 py-1 rounded me-1">${_}</code> <small class="text-muted">(C\xF3digo de barras)</small></li>`).join("")}
                </ul>
                <hr>
                <p><strong>C\xF3digo ingresado:</strong> <code class="bg-danger text-white px-2 py-1 rounded">${c}</code></p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"}),console.log(`\u274C C\xF3digo incorrecto para ${e.CopProducto}. Esperado: ${e.Codigo_barras}, Ingresado: ${c}`),setTimeout(()=>{o.classList.remove("is-invalid"),o.value="",this.inputValues[e.input_field]=""},2e3))}}}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[],this.productosValidados=[],this.inputValues={}}guardarPreparacion(){let t=this.detalleFactura.filter(o=>o.necesitaValidacion),e=t.filter(o=>!o.validado);if(console.log("Productos que necesitan validaci\xF3n:",t.length),console.log("Productos no validados:",e.length),e.length>0){let o=e.map(c=>`\u2022 ${c.CopProducto} - ${c.Detalle.substring(0,50)}...`).join(`
`);F.default.fire({title:"\u26A0\uFE0F Faltan c\xF3digos por validar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de validaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${e.map(c=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${c.CopProducto}</strong><br>
                  <small class="text-muted">${c.Detalle.substring(0,60)}...</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total: <strong>${e.length}</strong> de <strong>${t.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#6c757d",background:"#ffffff",color:"#212529"});return}let l=this.detalleFactura.filter(o=>o.validado||!o.necesitaValidacion);F.default.fire({title:"\u2705 Validaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido validados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la preparaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos validados:</strong> ${l.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",confirmButtonColor:"#28a745"}).then(()=>{let o={factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios};console.log("param: ",o),this.FacturacionService.FinalizarPreparacion(o).subscribe({next:c=>{if(console.log("response: ",c),c.success)if(c.data&&c.data.length>0){let f=c.data.some(_=>_.data&&_.data.length>0&&_.data.some(P=>P.success==="true"));c.data.some(_=>_.data&&_.data.length>0&&_.data.some(P=>P.menssage==="ya existe registro"))?F.default.fire({title:"\u26A0\uFE0F Preparaci\xF3n ya existe",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-warning">Esta factura ya fue preparada anteriormente.</p>
                    </div>
                  `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"}):f?F.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p><strong>Bodega(s):</strong> ${c.bodegas?c.bodegas.join(", "):"N/A"}</p>
                      <hr>
                      <p class="text-success">${c.message}</p>
                    </div>
                  `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):F.default.fire({title:"\u274C Error en la preparaci\xF3n",html:`
                    <div class="text-start">
                      <p><strong>Factura:</strong> ${c.factura}</p>
                      <p class="text-danger">Ocurri\xF3 un error durante la preparaci\xF3n.</p>
                    </div>
                  `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545",background:"#ffffff",color:"#212529"})}else F.default.fire({title:"\u2705 Preparaci\xF3n Finalizada",html:`
                  <div class="text-start">
                    <p><strong>Factura:</strong> ${c.factura}</p>
                    <p class="text-success">${c.message}</p>
                  </div>
                `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()});else F.default.fire({title:"Error!",text:c.message||"Error al finalizar la preparaci\xF3n",icon:"error",confirmButtonColor:"#dc3545"});this.isLoading=!1},error:c=>{console.log("error: ",c),this.isLoading=!1}})})}ManageEmpresa(t){this.router.navigate(["/empresas/panel_empresa",t.tenant_uid])}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;case"create_user":break;default:}}onRefreshTableData(){this.loadTableData()}static \u0275fac=function(e){return new(e||r)(I(B),I(G),I(L))};static \u0275cmp=k({type:r,selectors:[["app-preparar-facturas"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-save","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-success"],[1,"card-header","bg-opacity-10"],[1,"text-success","mb-0"],[1,"fa","fa-box-open","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-success"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","6%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-map-marker-alt","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"fa","fa-check-circle","me-1"],[1,"fa","fa-shield-alt","me-1"],[1,"text-center","py-2",2,"width","26%"],[1,"fa","fa-qrcode","me-1"],["class","align-middle","style","height: 45px;",4,"ngFor","ngForOf"],[1,"align-middle",2,"height","45px"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1"],[1,"small","text-muted","py-1"],[1,"text-center","small","py-1"],["class","mt-1",4,"ngIf"],[1,"text-center","py-1"],["class","badge bg-warning text-dark",4,"ngIf"],["class","badge bg-secondary",4,"ngIf"],["class","badge bg-success",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],["class","badge bg-light text-dark",4,"ngIf"],["class","input-group input-group-sm",4,"ngIf"],["class","text-center text-muted small",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],[1,"badge","bg-warning","text-dark"],[1,"fa","fa-exclamation-triangle","me-1"],[1,"badge","bg-secondary"],[1,"fa","fa-minus","me-1"],[1,"badge","bg-success"],[1,"fa","fa-check","me-1"],[1,"badge","bg-danger"],[1,"fa","fa-times","me-1"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-success","bg-opacity-25"],[1,"fa","fa-qrcode","text-success"],["type","text","placeholder","Escanear c\xF3digo de barras o c\xF3digo producto...",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"text-center","text-muted","small"],[1,"card","border-warning"],[1,"text-warning","mb-0"],[1,"fa","fa-lock","me-1"],[1,"table-warning"],[1,"input-group-text","bg-warning","bg-opacity-25"],[1,"fa","fa-lock","text-warning"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,l){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),d(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(c){return l.onTableAction(c)})("customAction",function(c){return l.onCustomAction(c)}),a()()()()()(),g(8,We,19,5,"div",8),a()),e&2&&(s(3),u("headerTitle","Lista de Facturas por Preparar")("cardClass","mb-4"),s(4),u("hasCheckbox",!1)("tableConfig",l.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",l.Buttons_Export)("customButtons",l.customButtons)("initialDateFilter","this_month"),s(),u("ngIf",l.showPrepararModal))},dependencies:[U,R,N,$,H,z,W,J,X,j],encapsulation:2})};var b=te(re());var Je=(r,t)=>({"bg-warning":r,"bg-info":t}),He=(r,t,e)=>({"bg-success":r,"bg-warning":t,"bg-secondary":e}),Xe=(r,t)=>({"table-success":r,"table-warning":t});function je(r,t){if(r&1&&(i(0,"div",4)(1,"div",25)(2,"h5",26),n(3,"No cerrar esta ventana si esta realizando el proceso de Verificaci\xF3n"),a(),i(4,"div",27),d(5,"i",28),i(6,"h6",29),n(7,"Informaci\xF3n de la Factura"),a()()(),i(8,"div",30)(9,"div",31)(10,"div",32)(11,"small",33),d(12,"i",34),n(13,"Datos Principales "),a()(),i(14,"div",35)(15,"table",36)(16,"tbody")(17,"tr",37)(18,"td",38),d(19,"i",39),n(20,"Bodega: "),a(),i(21,"td",40)(22,"span",41),n(23),a()()(),i(24,"tr",37)(25,"td",42),d(26,"i",43),n(27,"Secuencia: "),a(),i(28,"td",40)(29,"span",44),n(30),a()()(),i(31,"tr",37)(32,"td",42),d(33,"i",45),n(34,"N\xFAmero: "),a(),i(35,"td",40),n(36),a()(),i(37,"tr",37)(38,"td",42),d(39,"i",46),n(40,"Cliente: "),a(),i(41,"td",40),n(42),a()(),i(43,"tr",37)(44,"td",42),d(45,"i",47),n(46,"Fecha: "),a(),i(47,"td",40)(48,"span",48),n(49),O(50,"date"),a()()()()()()()(),i(51,"div",30)(52,"div",31)(53,"div",32)(54,"small",33),d(55,"i",49),n(56,"Informaci\xF3n de Contacto "),a()(),i(57,"div",35)(58,"table",36)(59,"tbody")(60,"tr",37)(61,"td",42),d(62,"i",50),n(63,"Ciudad: "),a(),i(64,"td",40)(65,"span",51),n(66),a()()(),i(67,"tr",37)(68,"td",42),d(69,"i",52),n(70,"Vendedor: "),a(),i(71,"td",40),n(72),a()(),i(73,"tr",37)(74,"td",42),d(75,"i",53),n(76,"Tipo Pedido: "),a(),i(77,"td",40)(78,"span",54),n(79),a()()(),i(80,"tr",37)(81,"td",42),d(82,"i",55),n(83,"Forma Pago: "),a(),i(84,"td",40)(85,"span",56),n(86),a()()()()()()()()()),r&2){let e=p(2);s(23),m(" ",e.detalleFactura[0].CodigosBodega," "),s(7),x(e.facturaActual.Secuencia),s(6),x(e.facturaActual.Numero),s(6),x(e.facturaActual.Nombre),s(7),m(" ",M(50,9,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),s(17),m(" ",e.facturaActual.Ciudad," "),s(6),x(e.facturaActual.Vendedor),s(7),m(" ",e.facturaActual.TipoP," "),s(7),m(" ",e.facturaActual.FPago," ")}}function qe(r,t){if(r&1&&(i(0,"div",5)(1,"div",4)(2,"div",30)(3,"div",57),d(4,"i",58),i(5,"strong"),n(6),a()()(),i(7,"div",30)(8,"div",57),d(9,"i",59),i(10,"strong"),n(11),a()()()()()),r&2){let e=p(2);s(6),m("Total de productos: ",e.detalleFactura.length,""),s(5),m("Productos verificados: ",e.productosVerificados,"")}}function Ke(r,t){if(r&1&&(i(0,"div",72),n(1),a()),r&2){let e=p(3);s(),m(" Producto: ",e.productoActual.Detalle," ")}}function Qe(r,t){r&1&&(i(0,"div",73),n(1," C\xF3digo no encontrado en la factura "),a())}function Ye(r,t){if(r&1){let e=A();i(0,"div")(1,"label",64),d(2,"i",74),n(3,"Serie: "),i(4,"span",75),n(5),a()(),i(6,"input",76,1),y("ngModelChange",function(o){h(e);let c=p(3);return S(c.serieActual,o)||(c.serieActual=o),v(o)}),C("keypress",function(o){h(e);let c=p(3);return v(c.onSerieEnter(o))}),a()()}if(r&2){let e=p(3);s(4),u("ngClass",ne(4,Je,e.productoActual.registroserieEntrada==="0",e.productoActual.registroserieEntrada==="1")),s(),m(" ",e.productoActual.registroserieEntrada==="1"?"Controlada":"Libre"," "),s(),E("ngModel",e.serieActual),u("disabled",!e.productoActual)}}function Ze(r,t){if(r&1){let e=A();i(0,"div")(1,"label",64),d(2,"i",77),n(3,"Cantidad: "),i(4,"span",78),n(5,"Solo Cantidad"),a()(),i(6,"input",79,2),y("ngModelChange",function(o){h(e);let c=p(3);return S(c.cantidadActual,o)||(c.cantidadActual=o),v(o)}),C("keypress",function(o){h(e);let c=p(3);return v(c.onCantidadEnter(o))}),a()()}if(r&2){let e=p(3);s(6),E("ngModel",e.cantidadActual),u("placeholder","Confirmar cantidad (m\xE1x: "+e.productoActual.Cantidad+")")("disabled",!e.productoActual)("max",e.productoActual.Cantidad)}}function et(r,t){r&1&&(i(0,"div",80),d(1,"i",81),n(2," Primero escanee un c\xF3digo de producto "),a())}function tt(r,t){if(r&1&&(i(0,"div",82)(1,"div",4)(2,"div",83)(3,"strong"),n(4),a(),n(5),a(),i(6,"div",84)(7,"span",85),n(8),a(),i(9,"span",86),n(10),a()()()()),r&2){let e=p(3);s(4),x(e.productoActual.CopProducto),s(),m(" - ",e.productoActual.Detalle," "),s(3),m("Cantidad: ",e.productoActual.Cantidad,""),s(),u("ngClass",ue(6,He,e.productoActual.cantidadVerificada===e.productoActual.Cantidad,e.productoActual.cantidadVerificada>0&&e.productoActual.cantidadVerificada<e.productoActual.Cantidad,e.productoActual.cantidadVerificada===0)),s(),ae(" Verificado: ",e.productoActual.cantidadVerificada||0,"/",e.productoActual.Cantidad," ")}}function it(r,t){if(r&1){let e=A();i(0,"div",5)(1,"div",60)(2,"div",61)(3,"div",62)(4,"div",30)(5,"div",63)(6,"label",64),d(7,"i",65),n(8,"C\xF3digo Producto: "),a(),i(9,"input",66,0),y("ngModelChange",function(o){h(e);let c=p(2);return S(c.codigoProductoActual,o)||(c.codigoProductoActual=o),v(o)}),C("keypress",function(o){h(e);let c=p(2);return v(c.onCodigoProductoEnter(o))}),a(),g(11,Ke,2,1,"div",67)(12,Qe,2,0,"div",68),a()(),i(13,"div",30),g(14,Ye,8,7,"div",69)(15,Ze,8,4,"div",69)(16,et,3,0,"div",70),a()(),g(17,tt,11,10,"div",71),a()()()}if(r&2){let e=p(2);s(9),de("is-valid",e.productoActual)("is-invalid",e.codigoProductoActual&&!e.productoActual),E("ngModel",e.codigoProductoActual),s(2),u("ngIf",e.productoActual),s(),u("ngIf",e.codigoProductoActual&&!e.productoActual),s(2),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="1"),s(),u("ngIf",e.productoActual&&e.productoActual.RegistaSerie==="0"),s(),u("ngIf",!e.productoActual),s(),u("ngIf",e.productoActual)}}function at(r,t){r&1&&(i(0,"span",113),d(1,"i",77),n(2,"Cantidad "),a())}function nt(r,t){r&1&&(i(0,"span",114),d(1,"i",74),n(2,"Serie Libre "),a())}function rt(r,t){r&1&&(i(0,"span",115),d(1,"i",102),n(2,"Serie Obligatoria "),a())}function ot(r,t){if(r&1&&(i(0,"small",122),d(1,"i",74),n(2),a()),r&2){let e=t.$implicit;s(2),m("",e," ")}}function st(r,t){if(r&1&&(i(0,"div",118)(1,"div",119)(2,"span",115),n(3),a()(),i(4,"div",120),g(5,ot,3,1,"small",121),a()()),r&2){let e=p(2).$implicit;s(3),ae(" ",e.seriesIngresadas.length,"/",e.Cantidad," series "),s(2),u("ngForOf",e.seriesIngresadas)}}function lt(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Sin series ingresadas"),a()())}function ct(r,t){if(r&1&&(i(0,"div"),g(1,st,6,3,"div",116)(2,lt,3,0,"div",117),a()),r&2){let e=p().$implicit;s(),u("ngIf",e.seriesIngresadas&&e.seriesIngresadas.length>0),s(),u("ngIf",!e.seriesIngresadas||e.seriesIngresadas.length===0)}}function dt(r,t){if(r&1&&(i(0,"div",63)(1,"span",125),d(2,"i",24),n(3),a()()),r&2){let e=p(2).$implicit;s(3),m("",e.cantidadVerificada," confirmados ")}}function ut(r,t){r&1&&(i(0,"div",123)(1,"small"),n(2,"Cantidad pendiente"),a()())}function pt(r,t){if(r&1&&(i(0,"div"),g(1,dt,4,1,"div",124)(2,ut,3,0,"div",117),a()),r&2){let e=p().$implicit;s(),u("ngIf",e.cantidadVerificada>0),s(),u("ngIf",!e.cantidadVerificada||e.cantidadVerificada===0)}}function mt(r,t){r&1&&(i(0,"span",126),d(1,"i",24),n(2,"Completo "),a())}function ft(r,t){r&1&&(i(0,"span",114),d(1,"i",127),n(2,"Parcial "),a())}function gt(r,t){r&1&&(i(0,"span",113),d(1,"i",128),n(2,"Pendiente "),a())}function _t(r,t){if(r&1&&(i(0,"tr",104)(1,"td",105),g(2,at,3,0,"span",106)(3,nt,3,0,"span",107)(4,rt,3,0,"span",108),a(),i(5,"td",109),n(6),a(),i(7,"td",109),n(8),a(),i(9,"td",110),n(10),a(),i(11,"td",111),n(12),a(),i(13,"td",40),g(14,ct,3,2,"div",69)(15,pt,3,2,"div",69),a(),i(16,"td",105),g(17,mt,3,0,"span",112)(18,ft,3,0,"span",107)(19,gt,3,0,"span",106),a()()),r&2){let e=t.$implicit;u("ngClass",ne(13,Xe,e.seriesCompletas,e.cantidadVerificada>0&&!e.seriesCompletas)),s(2),u("ngIf",e.RegistaSerie==="0"),s(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="0"),s(),u("ngIf",e.RegistaSerie==="1"&&e.registroserieEntrada==="1"),s(2),m(" ",e.CodigosBodega," "),s(2),m(" ",e.CopProducto," "),s(2),m(" ",e.Cantidad," "),s(2),x(e.Detalle),s(2),u("ngIf",e.RegistaSerie==="1"),s(),u("ngIf",e.RegistaSerie==="0"),s(2),u("ngIf",e.seriesCompletas),s(),u("ngIf",!e.seriesCompletas&&e.cantidadVerificada>0),s(),u("ngIf",!e.seriesCompletas&&(!e.cantidadVerificada||e.cantidadVerificada===0))}}function ht(r,t){if(r&1&&(i(0,"div",5)(1,"div",87)(2,"div",88)(3,"h6",29),d(4,"i",89),n(5,"Detalle de Productos "),a()(),i(6,"div",90)(7,"div",91)(8,"table",92)(9,"thead",93)(10,"tr")(11,"th",94),d(12,"i",74),n(13,"Tipo "),a(),i(14,"th",94),d(15,"i",95),n(16,"Bodega "),a(),i(17,"th",96),d(18,"i",97),n(19,"C\xF3digo "),a(),i(20,"th",98),n(21," Cant. "),a(),i(22,"th",99),d(23,"i",34),n(24,"Descripci\xF3n "),a(),i(25,"th",100),d(26,"i",101),n(27,"Series/Cantidad Ingresadas "),a(),i(28,"th",94),d(29,"i",102),n(30,"Estado "),a()()(),i(31,"tbody"),g(32,_t,20,16,"tr",103),a()()()()()()),r&2){let e=p(2);s(32),u("ngForOf",e.detalleFactura)}}function vt(r,t){r&1&&(i(0,"div",5)(1,"div",129),d(2,"i",130),n(3," No hay productos en el detalle "),a()())}function xt(r,t){if(r&1){let e=A();i(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h5",16),n(5),a(),i(6,"button",17),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),a()(),i(7,"div",18),g(8,je,87,12,"div",19),i(9,"div",4),g(10,qe,12,2,"div",20)(11,it,18,11,"div",20)(12,ht,33,1,"div",20)(13,vt,4,0,"div",20),a()(),i(14,"div",21)(15,"button",22),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),n(16,"Cerrar"),a(),i(17,"button",23),C("click",function(){h(e);let o=p();return v(o.guardarVerificacion())}),d(18,"i",24),n(19,"Guardar Verificaci\xF3n "),a()()()()()}if(r&2){let e=p();s(5),m("Verificar Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),s(3),u("ngIf",e.facturaActual),s(2),u("ngIf",e.detalleFactura.length>0),s(),u("ngIf",e.detalleFactura.length>0),s(),u("ngIf",e.detalleFactura.length>0),s(),u("ngIf",e.detalleFactura.length===0)}}var Z=class r{constructor(t,e,l){this.FacturacionService=t;this.cdr=e;this.router=l}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];productosJaula=[];productosNoJaula=[];codigoProductoActual="";serieActual="";cantidadActual=null;productoActual=null;productosVerificados=0;seriesValidasPrueba=[{codigo:"L3250",serie:"SN001234567"},{codigo:"L3250",serie:"SN001234568"},{codigo:"TG-3468",serie:"SN001234569"},{codigo:"ABC-123",serie:"ABC001"},{codigo:"ABC-123",serie:"ABC002"},{codigo:"XYZ-789",serie:"XYZ100"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0}],row_action:[{label:"",action_to_perform:"preparar_factura",icon:"edit",type:"button",class:"btn btn-success btn-sm",tooltip:"Preparar Factura"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorVerificar(t).subscribe({next:e=>{console.log("response: ",e),e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):b.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{console.log("error: ",e),this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){let e=t.IDS_BODEGA.split(","),l=t.IDS_PREPARADAS.split(","),o=t.CODIGOS_BODEGA.split(","),c="";for(let f=0;f<o.length;f++)l.length<e.length&&o[f]==o[l.length]&&(c+=`<span class="text-danger fw-bold">Pendiente: ${o[l.length]}</span><br>`),c+=`<span class="fw-bold">${o[f]}</span><br>`;t.CODIGOS_BODEGA_TEXTO=c,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.ORDEN_TIPO_PEDIDO=`<span class="badge badge-info fs-6 fw-bold">${t.ORDEN_TIPO_PEDIDO}</span>`}),this.tableConfig=V(D({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"preparar_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){console.log("data: ",t);let e=t.IDS_BODEGA.split(",");console.log("IDS_BODEGA: ",e);let l=t.IDS_PREPARADAS.split(",");console.log("ID_PREPARADAS: ",l);let o=t.CODIGOS_BODEGA.split(",");if(l.length<e.length){b.default.fire("Atenci\xF3n!","Hay productos sin preparar en la factura bodega "+o[l.length],"info");return}let c={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",c),this.FacturacionService.GetFacturasDatosVerificar(c).subscribe({next:f=>{console.log("response: ",f),f.success&&f.cabecera?f.cabecera.length>0?(this.facturaSeleccionada=f,this.facturaActual=f.cabecera[0],this.detalleFactura=f.detalle||[],this.detalleFactura=this.detalleFactura.map((T,_)=>V(D({},T),{seriesIngresadas:[],cantidadVerificada:0,seriesCompletas:!1})),this.productosVerificados=0,this.limpiarInputsCaptura(),this.productosJaula=this.detalleFactura.filter(T=>T.EN_JAULA==="1"),this.productosNoJaula=this.detalleFactura.filter(T=>T.EN_JAULA==="0"),this.showPrepararModal=!0,setTimeout(()=>{this.enfocarInputCodigo()},500)):(this.showPrepararModal=!1,b.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):b.default.fire("Error!",f.message,"error"),this.isLoading=!1},error:f=>{this.isLoading=!1}})}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.productosJaula=[],this.productosNoJaula=[]}guardarVerificacion(){let t=this.detalleFactura.filter(l=>!l.seriesCompletas);if(console.log("Productos no verificados:",t),t.length>0){b.default.fire({title:"\u26A0\uFE0F Faltan productos por verificar",html:`
          <div class="text-start">
            <p><strong>Productos pendientes de verificaci\xF3n:</strong></p>
            <div class="alert alert-light border text-start" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa;">
              ${t.map(l=>`<div class="mb-1">
                  <i class="fa fa-exclamation-triangle text-warning me-1"></i>
                  <strong>${l.CopProducto}</strong><br>
                  <small class="text-muted">${l.Detalle.substring(0,60)}...</small><br>
                  <small class="text-info">Verificado: ${l.cantidadVerificada||0}/${l.Cantidad}</small>
                </div>`).join("")}
            </div>
            <p class="text-muted">Total pendientes: <strong>${t.length}</strong> de <strong>${this.detalleFactura.length}</strong> productos</p>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"#f39c12",background:"#ffffff",color:"#212529"});return}let e=this.detalleFactura.filter(l=>l.seriesCompletas);b.default.fire({title:"\u2705 Verificaci\xF3n completada",html:`
        <div class="text-center">
          <p class="text-success"><i class="fa fa-check-circle fa-2x mb-2"></i></p>
          <p>Todos los productos han sido verificados correctamente</p>
          <p class="text-danger">Presione "Continuar" para finalizar la verificaci\xF3n</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura.length}</p>
          <p><strong>Productos verificados:</strong> ${e.length}</p>
        </div>
      `,icon:"success",confirmButtonText:"Continuar",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#28a745"}).then(()=>{let l={cliente:this.facturaActual.Nombre,factura:this.facturaActual.Id,usrid:this.sessionData?this.sessionData.usrid:null,bodegas:this.facturaSeleccionada.BODEGAS,solo_servicios:this.facturaActual.SoloServicios,detalle_verificacion:this.detalleFactura.map(o=>({producto:o.CopProducto,productoId:o.ProductoId,cantidad:o.Cantidad,cantidadVerificada:o.cantidadVerificada,seriesIngresadas:o.seriesIngresadas||[],tipoVerificacion:o.RegistaSerie==="1"?"series":"cantidad"}))};console.log("Par\xE1metros verificaci\xF3n:",l),this.FacturacionService.FinalizarVerificacion(l).subscribe({next:o=>{console.log("Respuesta verificaci\xF3n:",o),o.success?b.default.fire({title:"\u2705 Verificaci\xF3n Finalizada",html:`
                <div class="text-start">
                  <p><strong>Factura:</strong> ${this.facturaActual.Secuencia}</p>
                  <p class="text-success">`+o.message+`</p>
                </div>
              `,icon:"success",confirmButtonText:"Cerrar",confirmButtonColor:"#28a745",background:"#ffffff",color:"#212529"}).then(()=>{this.cerrarModal(),this.onRefreshTableData()}):b.default.fire({title:"\u274C Error en Verificaci\xF3n",html:`
                <div class="text-start">
                  <p><strong>Error:</strong> ${o.message||"Error desconocido"}</p>
                  <p class="text-muted">Por favor, intente nuevamente.</p>
                </div>
              `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})},error:o=>{console.error("Error en verificaci\xF3n:",o),b.default.fire({title:"\u274C Error de Conexi\xF3n",html:`
              <div class="text-start">
                <p>Ocurri\xF3 un error al finalizar la verificaci\xF3n.</p>
                <p class="text-muted">Verifique su conexi\xF3n e intente nuevamente.</p>
              </div>
            `,icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#dc3545"})}})})}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}limpiarInputsCaptura(){this.codigoProductoActual="",this.serieActual="",this.cantidadActual=null,this.productoActual=null}onCodigoProductoEnter(t){t.key==="Enter"&&(t.preventDefault(),this.validarCodigoProducto())}validarCodigoProducto(){let t=this.codigoProductoActual.trim();if(!t)return;console.log("C\xF3digo ingresado:",t),console.log("Detalle factura:",this.detalleFactura),console.log("C\xF3digos disponibles:",this.detalleFactura.map(l=>l.CopProducto));let e=this.detalleFactura.find(l=>l.CopProducto.toLowerCase()===t.toLowerCase());console.log("Producto encontrado:",e),e?(this.productoActual=e,setTimeout(()=>{if(e.RegistaSerie==="1"){let l=document.querySelector("#inputSerie");l&&l.focus()}else{let l=document.querySelector("#inputCantidad");l&&l.focus()}},100)):(this.productoActual=null,b.default.fire({title:"\u274C C\xF3digo No Encontrado",html:`
          <div class="text-start">
            <p>El c\xF3digo <strong>${t}</strong> no existe en esta factura.</p>
            <p class="text-muted">Verifique el c\xF3digo e intente nuevamente.</p>
          </div>
        `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}).then(()=>{this.codigoProductoActual="",setTimeout(()=>{let l=document.querySelector("#inputCodigo");l&&l.focus()},100)}))}onSerieEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarSerie())}procesarSerie(){let t=this.serieActual.trim();if(!(!t||!this.productoActual)){if(this.productoActual.cantidadVerificada>=this.productoActual.Cantidad){b.default.fire({title:"\u26A0\uFE0F Cantidad Completa",text:`El producto ${this.productoActual.CopProducto} ya tiene todas sus series completas.`,icon:"warning",confirmButtonColor:"#f39c12"}),this.limpiarInputsCaptura(),this.enfocarInputCodigo();return}if(this.productoActual.seriesIngresadas.includes(t)){b.default.fire({title:"\u274C Serie Duplicada",html:`
          <div class="text-start">
            <p>La serie <strong>${t}</strong> ya fue ingresada para el producto <strong>${this.productoActual.CopProducto}</strong>.</p>
          </div>
        `,icon:"error",confirmButtonColor:"#dc3545"}),this.serieActual="";return}this.productoActual.registroserieEntrada==="1"?this.validarSerieEnBaseDatos(this.productoActual.ProductoId,t):this.agregarSerie(t)}}onCantidadEnter(t){t.key==="Enter"&&(t.preventDefault(),this.procesarCantidad())}procesarCantidad(){if(!(!this.cantidadActual||!this.productoActual)){if(this.cantidadActual<=0||this.cantidadActual>this.productoActual.Cantidad){b.default.fire({title:"\u274C Cantidad Inv\xE1lida",text:`La cantidad debe ser entre 1 y ${this.productoActual.Cantidad}.`,icon:"error",confirmButtonColor:"#dc3545"});return}this.productoActual.cantidadVerificada=this.cantidadActual,this.productoActual.seriesCompletas=this.cantidadActual===parseInt(this.productoActual.Cantidad),console.log("Cantidad confirmada:",this.cantidadActual),console.log("Cantidad total:",this.productoActual.Cantidad),console.log("Series completas:",this.productoActual.seriesCompletas),this.actualizarContadores(),b.default.fire({title:"\u2705 Cantidad Confirmada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Cantidad confirmada:</strong> ${this.cantidadActual}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.limpiarInputsCaptura(),this.enfocarInputCodigo()}}validarSerieEnBaseDatos(t,e){b.default.fire({title:"Validando serie...",html:`
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Validando...</span>
          </div>
          <p class="mt-2">Verificando serie <strong>${e}</strong> en la base de datos</p>
        </div>
      `,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{b.default.showLoading()}});let l={codigo_producto:t,serie:e,bodega:this.facturaActual.CodigoBodega,usrid:this.sessionData?this.sessionData.usrid:null};console.log("param: ",l),this.FacturacionService.ValidarSerie(l).subscribe({next:o=>{console.log("Respuesta validaci\xF3n serie:",o),b.default.close(),o.success?o.serie_encontrada?o.serie_disponible==!0?this.agregarSerie(e):(b.default.fire({title:"\u274C Serie No Disponible",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> ya ha sido utilizada o no est\xE1 disponible para el producto <strong>${t}</strong>.</p>
                <p class="text-muted  ">${o.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(b.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${o.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""):(b.default.fire({title:"\u274C Serie No V\xE1lida",html:`
              <div class="text-start">
                <p>La serie <strong>${e}</strong> no existe en la base de datos para el producto <strong>${t}</strong>.</p>
                <p class="text-muted">${o.message||"Verifique la serie e intente nuevamente."}</p>
              </div>
            `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual="")},error:o=>{console.error("Error validando serie:",o),b.default.fire({title:"\u274C Error de Validaci\xF3n",html:`
            <div class="text-start">
              <p>Ocurri\xF3 un error al validar la serie <strong>${e}</strong>.</p>
              <p class="text-muted">Por favor, intente nuevamente.</p>
            </div>
          `,icon:"error",confirmButtonText:"Reintentar",confirmButtonColor:"#dc3545"}),this.serieActual=""}})}agregarSerie(t){this.productoActual.seriesIngresadas.push(t),this.productoActual.cantidadVerificada=this.productoActual.seriesIngresadas.length,this.productoActual.ProductoId=this.productoActual.ProductoId,console.log("Serie agregada:",t),console.log("Cantidad verificada:",this.productoActual.cantidadVerificada),console.log("Cantidad total:",this.productoActual.Cantidad),this.productoActual.cantidadVerificada===parseInt(this.productoActual.Cantidad)&&(this.productoActual.seriesCompletas=!0,console.log("Producto marcado como completo:",this.productoActual.CopProducto)),this.actualizarContadores(),b.default.fire({title:"\u2705 Serie Agregada",html:`
        <div class="text-start">
          <p><strong>Producto:</strong> ${this.productoActual.CopProducto}</p>
          <p><strong>Serie:</strong> ${t}</p>
          <p><strong>Progreso:</strong> ${this.productoActual.cantidadVerificada}/${this.productoActual.Cantidad}</p>
        </div>
      `,icon:"success",timer:1500,showConfirmButton:!1}),this.serieActual="",this.productoActual.seriesCompletas&&(this.limpiarInputsCaptura(),this.enfocarInputCodigo())}actualizarContadores(){let t=this.detalleFactura.filter(e=>e.seriesCompletas);this.productosVerificados=t.length,console.log("Actualizando contadores:"),console.log("Productos completos:",t),console.log("Total verificados:",this.productosVerificados),console.log("Detalle factura:",this.detalleFactura.map(e=>({codigo:e.CopProducto,seriesCompletas:e.seriesCompletas,cantidadVerificada:e.cantidadVerificada,cantidad:e.Cantidad}))),this.cdr.detectChanges()}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}puedeGuardar(){return this.detalleFactura.every(t=>t.seriesCompletas)}static \u0275fac=function(e){return new(e||r)(I(B),I(G),I(L))};static \u0275cmp=k({type:r,selectors:[["app-verificar-facturas"]],decls:9,vars:12,consts:[["inputCodigo",""],["inputSerie",""],["inputCantidad",""],[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-check","me-1"],[1,"col-12","mb-1"],[1,"text-danger","fw-bold"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-warehouse","text-info","me-1"],[1,"py-1"],[1,"fw-bold","text-primary","fs-5"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"alert","d-flex","align-items-center"],[1,"fa","fa-info-circle","me-2"],[1,"fa","fa-check-circle","me-2"],[1,"card","border-warning"],[1,"card-body","bg-light"],[1,"row","justify-content-center"],[1,"text-center"],[1,"form-label","mb-1"],[1,"fa","fa-search","me-1"],["id","inputCodigo","type","text","placeholder","Escanear c\xF3digo del producto...",1,"form-control","form-control-lg","text-center",3,"ngModelChange","keypress","ngModel"],["class","valid-feedback",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],["class","alert alert-light",4,"ngIf"],[1,"valid-feedback"],[1,"invalid-feedback"],[1,"fa","fa-tag","me-1"],[1,"badge","ms-1",3,"ngClass"],["id","inputSerie","type","text","placeholder","Escanear serie del producto...",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","disabled"],[1,"fa","fa-calculator","me-1"],[1,"badge","bg-secondary","ms-1"],["id","inputCantidad","type","number","min","1",1,"form-control","form-control-lg",3,"ngModelChange","keypress","ngModel","placeholder","disabled","max"],[1,"text-muted"],[1,"fa","fa-arrow-left","me-1"],[1,"alert","alert-light"],[1,"col-md-8"],[1,"col-md-4","text-end"],[1,"badge","bg-primary","me-1"],[1,"badge",3,"ngClass"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],[1,"text-center","py-2",2,"width","20%"],[1,"fa","fa-list-ol","me-1"],[1,"fa","fa-shield-alt","me-1"],["class","align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"align-middle",3,"ngClass"],[1,"text-center","py-1"],["class","badge bg-secondary fs-6",4,"ngIf"],["class","badge bg-warning text-dark fs-6",4,"ngIf"],["class","badge bg-info fs-6",4,"ngIf"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],["class","badge bg-success fs-6",4,"ngIf"],[1,"badge","bg-secondary","fs-6"],[1,"badge","bg-warning","text-dark","fs-6"],[1,"badge","bg-info","fs-6"],["class","series-container",4,"ngIf"],["class","text-center text-muted",4,"ngIf"],[1,"series-container"],[1,"mb-1"],[1,"series-list",2,"max-height","80px","overflow-y","auto"],["class","d-block text-muted",4,"ngFor","ngForOf"],[1,"d-block","text-muted"],[1,"text-center","text-muted"],["class","text-center",4,"ngIf"],[1,"badge","bg-success"],[1,"badge","bg-success","fs-6"],[1,"fa","fa-clock","me-1"],[1,"fa","fa-minus","me-1"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,l){e&1&&(i(0,"div",3)(1,"div",4)(2,"div",5)(3,"app-card",6),d(4,"div",7),i(5,"div",8)(6,"div",9)(7,"app-table",10),C("action",function(c){return l.onTableAction(c)})("customAction",function(c){return l.onCustomAction(c)}),a()()()()()(),g(8,xt,20,6,"div",11),a()),e&2&&(s(3),u("headerTitle","Lista de Facturas por verificar")("cardClass","mb-4"),s(4),u("hasCheckbox",!1)("tableConfig",l.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",l.Buttons_Export)("customButtons",l.customButtons)("initialDateFilter","this_month"),s(),u("ngIf",l.showPrepararModal))},dependencies:[U,pe,R,N,$,H,z,q,W,K,xe,J,X,j],encapsulation:2})};var w=te(re());function bt(r,t){if(r&1&&(i(0,"div",53)(1,"div",2)(2,"div",54)(3,"div",55),d(4,"i",56),i(5,"div")(6,"strong",57),n(7,"FACTURA MULTIBODEGA"),a(),i(8,"small",58),n(9),a()(),i(10,"div",59)(11,"span",60),n(12),a()()()()()()),r&2){let e=p(2);s(9),m(" Esta factura contiene productos de ",e.bodegas.length," bodegas diferentes "),s(3),m("",e.bodegas.length," Bodegas")}}function Ct(r,t){if(r&1&&(i(0,"div",1)(1,"div",61)(2,"div",62),d(3,"i",63),i(4,"h6",64),n(5,"Informaci\xF3n de la Factura"),a()()(),i(6,"div",21)(7,"div",22)(8,"div",23)(9,"small",24),d(10,"i",25),n(11,"Datos Principales "),a()(),i(12,"div",26)(13,"table",27)(14,"tbody")(15,"tr",28)(16,"td",29),d(17,"i",46),n(18,"Bodega: "),a(),i(19,"td",31)(20,"span",65),n(21),a()()(),i(22,"tr",28)(23,"td",43),d(24,"i",66),n(25,"Secuencia: "),a(),i(26,"td",31)(27,"span",67),n(28),a()()(),i(29,"tr",28)(30,"td",43),d(31,"i",68),n(32,"N\xFAmero: "),a(),i(33,"td",31),n(34),a()(),i(35,"tr",28)(36,"td",43),d(37,"i",69),n(38,"Cliente: "),a(),i(39,"td",31),n(40),a()(),i(41,"tr",28)(42,"td",43),d(43,"i",70),n(44,"Fecha: "),a(),i(45,"td",31)(46,"span",71),n(47),O(48,"date"),a()()()()()()()(),i(49,"div",21)(50,"div",22)(51,"div",23)(52,"small",24),d(53,"i",72),n(54,"Informaci\xF3n de Contacto "),a()(),i(55,"div",26)(56,"table",27)(57,"tbody")(58,"tr",28)(59,"td",29),d(60,"i",73),n(61,"Direcci\xF3n: "),a(),i(62,"td",31),n(63),a()(),i(64,"tr",28)(65,"td",43),d(66,"i",74),n(67,"Ciudad: "),a(),i(68,"td",31)(69,"span",75),n(70),a()()(),i(71,"tr",28)(72,"td",43),d(73,"i",76),n(74,"Tel\xE9fono: "),a(),i(75,"td",31)(76,"span",77),n(77),a()()(),i(78,"tr",28)(79,"td",43),d(80,"i",78),n(81,"Email: "),a(),i(82,"td",31)(83,"small",57),n(84),a()()(),i(85,"tr",28)(86,"td",43),d(87,"i",79),n(88,"Vendedor: "),a(),i(89,"td",31),n(90),a()(),i(91,"tr",28)(92,"td",43),d(93,"i",80),n(94,"Tipo Pedido: "),a(),i(95,"td",31)(96,"span",81),n(97),a()()(),i(98,"tr",28)(99,"td",43),d(100,"i",82),n(101,"Forma Pago: "),a(),i(102,"td",31)(103,"span",83),n(104),a()()()()()()()()()),r&2){let e=p(2);s(21),m(" ",e.detalleFactura[0].CodigosBodega," "),s(7),x(e.facturaActual.Secuencia),s(6),x(e.facturaActual.Numero),s(6),x(e.facturaActual.Nombre),s(7),m(" ",M(48,12,e.facturaActual.Fecha,"dd/MM/yyyy HH:mm")," "),s(16),x(e.facturaActual.Direccion),s(7),m(" ",e.facturaActual.Ciudad," "),s(7),x((e.facturaActual.Telefono==null?null:e.facturaActual.Telefono.trim())||"N/A"),s(7),x(e.facturaActual.Email),s(6),x(e.facturaActual.Vendedor),s(7),m(" ",e.facturaActual.TipoP," "),s(7),m(" ",e.facturaActual.FPago," ")}}function Et(r,t){if(r&1&&(i(0,"tr",98)(1,"td",99),n(2),a(),i(3,"td",99),n(4),a(),i(5,"td",100),n(6),a(),i(7,"td",101),n(8),a()()),r&2){let e=t.$implicit;s(2),m(" ",e.CodigosBodega," "),s(2),m(" ",e.CopProducto," "),s(2),m(" ",e.Cantidad," "),s(2),x(e.Detalle)}}function St(r,t){if(r&1&&(i(0,"div",2)(1,"div",84)(2,"div",85)(3,"h6",64),d(4,"i",86),n(5,"Detalle de Productos "),a()(),i(6,"div",87)(7,"div",88)(8,"table",89)(9,"thead",90)(10,"tr")(11,"th",91),d(12,"i",92),n(13,"Bodega "),a(),i(14,"th",93),d(15,"i",94),n(16,"C\xF3digo "),a(),i(17,"th",95),n(18," Cant. "),a(),i(19,"th",96),d(20,"i",25),n(21,"Descripci\xF3n "),a()()(),i(22,"tbody"),g(23,Et,9,4,"tr",97),a()()()()()()),r&2){let e=p(2);s(23),u("ngForOf",e.detalleFactura)}}function yt(r,t){if(r&1&&(i(0,"div",4)(1,"div",2)(2,"div",102),d(3,"i",25),i(4,"strong"),n(5,"Factura Multibodega:"),a(),n(6),a()()()),r&2){let e=p(2);s(6),m(" Se requiere un n\xFAmero de gu\xEDa para cada bodega (",e.bodegas.length," bodegas) ")}}function At(r,t){r&1&&(i(0,"div",4)(1,"div",2)(2,"div",103),d(3,"i",104),i(4,"strong"),n(5,"Consolidaci\xF3n Activada:"),a(),n(6," Se ha activado la consolidaci\xF3n para este env\xEDo "),a()()())}function Ft(r,t){if(r&1&&(i(0,"option",108),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),s(),m(" ",e.nombre," ")}}function It(r,t){if(r&1){let e=A();i(0,"tr",28)(1,"td",43),d(2,"i",105),n(3,"Tipo: "),i(4,"span",37),n(5,"*"),a()(),i(6,"td",31)(7,"select",106),y("ngModelChange",function(o){h(e);let c=p(2);return S(c.tipoConsolidacion,o)||(c.tipoConsolidacion=o),v(o)}),i(8,"option",107),n(9,"Seleccione tipo de consolidaci\xF3n"),a(),g(10,Ft,2,2,"option",40),a()()()}if(r&2){let e=p(2);s(7),E("ngModel",e.tipoConsolidacion),s(3),u("ngForOf",e.opcionesConsolidacion)}}function Tt(r,t){if(r&1){let e=A();i(0,"tr",28)(1,"td",43),d(2,"i",109),n(3,"Gu\xEDa Consol.: "),i(4,"span",37),n(5,"*"),a()(),i(6,"td",31)(7,"input",110),y("ngModelChange",function(o){h(e);let c=p(2);return S(c.guiaConsolidacion,o)||(c.guiaConsolidacion=o),v(o)}),a()()()}if(r&2){let e=p(2);s(7),E("ngModel",e.guiaConsolidacion)}}function Pt(r,t){r&1&&(i(0,"option",107),n(1,"Seleccione transporte"),a())}function wt(r,t){r&1&&(i(0,"option",107),n(1,"Cargando transportes..."),a())}function Dt(r,t){if(r&1&&(i(0,"option",108),n(1),a()),r&2){let e=t.$implicit;u("value",e.id),s(),m(" ",e.Codigo," ")}}function Vt(r,t){r&1&&(i(0,"small",111),d(1,"i",112),n(2,"Cargando lista de transportes... "),a())}function Bt(r,t){if(r&1){let e=A();i(0,"tr",28)(1,"td",43),d(2,"i",113),n(3),i(4,"span",37),n(5,"*"),a()(),i(6,"td",31)(7,"input",114),C("ngModelChange",function(o){let c=h(e).$implicit,f=p(2);return v(f.setGuiaPorBodega(c.codigo,o))}),a(),i(8,"small",111),n(9),a()()()}if(r&2){let e=t.$implicit,l=p(2);s(3),m(" Gu\xEDa ",e.codigo,": "),s(4),u("ngModel",l.getGuiaPorBodega(e.codigo))("name","guia-"+e.codigo)("placeholder","Gu\xEDa para bodega "+e.codigo+" ("+e.nombre+")"),s(2),x(e.nombre)}}function kt(r,t){r&1&&(i(0,"div",2)(1,"div",115),d(2,"i",116),n(3," No hay productos en el detalle "),a()())}function Ot(r,t){if(r&1){let e=A();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"h5",13),n(5),a(),i(6,"button",14),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),a()(),i(7,"div",15),g(8,bt,13,2,"div",16)(9,Ct,105,15,"div",17),i(10,"div",1),g(11,St,24,1,"div",18),i(12,"div",19),g(13,yt,7,1,"div",20)(14,At,7,0,"div",20),i(15,"div",1)(16,"div",21)(17,"div",22)(18,"div",23)(19,"small",24),d(20,"i",25),n(21,"Datos de envio "),a()(),i(22,"div",26)(23,"table",27)(24,"tbody")(25,"tr",28)(26,"td",29),d(27,"i",30),n(28,"Consolidar: "),a(),i(29,"td",31)(30,"div",32)(31,"input",33),y("ngModelChange",function(o){h(e);let c=p();return S(c.consolidar,o)||(c.consolidar=o),v(o)}),a(),i(32,"label",34),n(33," Activar consolidaci\xF3n "),a()()()(),g(34,It,11,2,"tr",35)(35,Tt,8,1,"tr",35),i(36,"tr",28)(37,"td",29),d(38,"i",36),n(39,"Transporte: "),i(40,"span",37),n(41,"*"),a()(),i(42,"td",31)(43,"select",38),y("ngModelChange",function(o){h(e);let c=p();return S(c.transporteSeleccionado,o)||(c.transporteSeleccionado=o),v(o)}),g(44,Pt,2,0,"option",39)(45,wt,2,0,"option",39)(46,Dt,2,2,"option",40),a(),g(47,Vt,3,0,"small",41),a()(),g(48,Bt,10,5,"tr",42),i(49,"tr",28)(50,"td",43),d(51,"i",44),n(52,"Bultos: "),i(53,"span",37),n(54,"*"),a()(),i(55,"td",31)(56,"input",45),y("ngModelChange",function(o){h(e);let c=p();return S(c.numeroBultos,o)||(c.numeroBultos=o),v(o)}),a()()()()()()()(),i(57,"div",21)(58,"div",22)(59,"div",23)(60,"small",24),d(61,"i",25),a()(),i(62,"div",26)(63,"table",27)(64,"tbody")(65,"tr",28)(66,"td",29),d(67,"i",46),n(68,"Peso: "),a(),i(69,"td",31)(70,"input",47),y("ngModelChange",function(o){h(e);let c=p();return S(c.pesoEnvio,o)||(c.pesoEnvio=o),v(o)}),a()()(),i(71,"tr",28)(72,"td",43),d(73,"i",48),n(74,"Comentarios: "),a(),i(75,"td",31)(76,"textarea",49),y("ngModelChange",function(o){h(e);let c=p();return S(c.comentariosEnvio,o)||(c.comentariosEnvio=o),v(o)}),a()()()()()()()()()(),g(77,kt,4,0,"div",18),a()(),i(78,"div",50)(79,"button",51),C("click",function(){h(e);let o=p();return v(o.cerrarModal())}),n(80,"Cerrar"),a(),i(81,"button",52),C("click",function(){h(e);let o=p();return v(o.guardarCambios())}),n(82,"Guardar cambios"),a()()()()()}if(r&2){let e=p();s(5),m("Detalles Factura - ",e.facturaActual==null?null:e.facturaActual.Secuencia,""),s(3),u("ngIf",e.bodegas.length>1),s(),u("ngIf",e.facturaActual),s(2),u("ngIf",e.detalleFactura.length>0),s(2),u("ngIf",e.bodegas.length>1),s(),u("ngIf",e.consolidar),s(17),E("ngModel",e.consolidar),s(3),u("ngIf",e.consolidar),s(),u("ngIf",e.consolidar),s(8),E("ngModel",e.transporteSeleccionado),u("disabled",e.cargandoTransportes),s(),u("ngIf",!e.cargandoTransportes),s(),u("ngIf",e.cargandoTransportes),s(),u("ngForOf",e.listaTransportes),s(),u("ngIf",e.cargandoTransportes),s(),u("ngForOf",e.bodegas),s(8),E("ngModel",e.numeroBultos),s(14),E("ngModel",e.pesoEnvio),s(6),E("ngModel",e.comentariosEnvio),s(),u("ngIf",e.detalleFactura.length===0)}}var ee=class r{constructor(t,e,l){this.FacturacionService=t;this.cdr=e;this.router=l}showPrepararModal=!1;sessionData=null;Usuarios_Datos=[];isLoading=!1;facturaSeleccionada=null;facturaActual=null;detalleFactura=[];transporteSeleccionado="";numeroGuia="";numeroBultos=null;pesoEnvio="";comentariosEnvio="";consolidar=!1;tipoConsolidacion="";guiaConsolidacion="";bodegas=[];guiasPorBodega=[];listaTransportes=[];cargandoTransportes=!1;opcionesConsolidacion=[{id:"consolidacion_1",nombre:"Consolidaci\xF3n Centro"},{id:"consolidacion_2",nombre:"Consolidaci\xF3n Norte"},{id:"consolidacion_3",nombre:"Consolidaci\xF3n Sur"},{id:"consolidacion_4",nombre:"Consolidaci\xF3n Express"},{id:"consolidacion_5",nombre:"Consolidaci\xF3n Econ\xF3mica"}];fechaPersonalizadaInicio="";fechaPersonalizadaFin="";Buttons_Export=["excel"];customButtons=[{label:"",action:"refresh",icon:"fa fa-refresh",class:"btn btn-success",tooltip:"Actualizar datos de la tabla"}];tableConfig={columns:[{title:"Bodega",field_value:"CODIGOS_BODEGA_TEXTO",sort:!0},{title:"Cliente",field_value:"CLIENTE_NOMBRE_TEXTO",sort:!0},{title:"Factura",field_value:"FACTURA_SECUENCIA_TEXTO",sort:!0},{title:"Fecha",field_value:"FACTURA_FECHA",sort:!0},{title:"Tipo Pedido",field_value:"ORDEN_TIPO_PEDIDO",sort:!0},{title:"Multibodega",field_value:"MULTIBODEGA",sort:!0},{title:"Estado",field_value:"FACTURA_BLOQUEADA_TEXTO",sort:!0}],row_action:[{label:"",action_to_perform:"detalle_factura",icon:"eye",type:"button",class:"btn btn-light btn-sm",tooltip:"Ingresar Guia"}],data:[]};ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.fechaPersonalizadaInicio=e.toISOString().slice(0,10),this.fechaPersonalizadaFin=t.toISOString().slice(0,10),this.loadSessionData(),this.loadTableData()}loadSessionData(){this.sessionData=this.FacturacionService.getUserSessionData()}loadTableData(){this.isLoading=!0;let t={fecha_inicial:this.fechaPersonalizadaInicio,fecha_final:this.fechaPersonalizadaFin,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasPorGuiasPickup(t).subscribe({next:e=>{e.success&&e.data?(this.Usuarios_Datos=e.data,this.OnFillTableAction(),setTimeout(()=>{this.cdr.detectChanges()},0)):w.default.fire("Error!",e.message,"error"),this.isLoading=!1},error:e=>{this.isLoading=!1}})}OnFillTableAction(){this.Usuarios_Datos.map(function(t){let e=t.IDS_BODEGA.split(","),l=t.IDS_PREPARADAS.split(","),o=t.CODIGOS_BODEGA.split(","),c="";for(let f=0;f<o.length;f++)c+=`<span class="fw-bold">${o[f]}</span><br>`;t.CODIGOS_BODEGA_TEXTO=c,t.FACTURA_SECUENCIA_TEXTO=`<span class="badge bg-dark fs-6 fw-bold">${t.FACTURA_SECUENCIA}</span>`,t.MULTIBODEGA=`<span class="fs-6 badge bg-${t.MULTIBODEGA==="SI"?"primary":"secondary"} fw-bold">${t.MULTIBODEGA}</span>`,t.CLIENTE_NOMBRE_TEXTO=`<span class="fw-bold">${t.CLIENTE_NOMBRE}</span>`,t.FACTURA_FECHA=`<span class="fw-bold">${t.FACTURA_FECHA}</span>`,t.FACTURA_BLOQUEADA_TEXTO=`<span class="fs-6 badge bg-${t.FACTURA_BLOQUEADA=="0"?"success":"danger"} fw-bold">${t.FACTURA_BLOQUEADA==1?"Bloqueada":"Desbloqueada"}</span>`}),this.tableConfig=V(D({},this.tableConfig),{data:this.Usuarios_Datos})}onTableAction(t){switch(t.action_to_perform){case"detalle_factura":this.onPrepararFactura(t.data);break;default:}}onPrepararFactura(t){if(console.log("data: ",t),t.FACTURA_BLOQUEADA==1){w.default.fire("Atenci\xF3n!","La factura "+t.FACTURA_SECUENCIA+" est\xE1 bloqueada y no se pueden ingresar gu\xEDas.","warning");return}let e={secuencia:t.FACTURA_SECUENCIA,bodega:t.IDS_BODEGA,usrid:this.sessionData?this.sessionData.usrid:null};this.FacturacionService.GetFacturasDatosVerificar(e).subscribe({next:l=>{l.success&&l.cabecera?l.cabecera.length>0?(this.facturaSeleccionada=l,this.facturaActual=l.cabecera[0],this.detalleFactura=l.detalle||[],this.procesarBodegas(t),this.showPrepararModal=!0):(this.showPrepararModal=!1,w.default.fire("Error!","No se encontraron datos para la factura "+t.FACTURA_SECUENCIA,"error")):w.default.fire("Error!",l.message,"error"),this.isLoading=!1},error:l=>{this.isLoading=!1}}),this.cargandoTransportes=!0,this.FacturacionService.GetTransporteGuiasPickup({}).subscribe({next:l=>{l.success&&l.data?this.listaTransportes=l.data:w.default.fire("Error!","No se pudieron cargar los transportes disponibles","warning"),this.cargandoTransportes=!1},error:l=>{w.default.fire("Error!","Error al conectar con el servicio de transportes","error"),this.cargandoTransportes=!1}})}procesarBodegas(t){if(t.CODIGOS_BODEGA&&t.BODEGAS){let e=t.CODIGOS_BODEGA.split(",").map(o=>o.trim()),l=t.BODEGAS.split(",").map(o=>o.trim());this.bodegas=e.map((o,c)=>({codigo:o,nombre:l[c]||o})),this.guiasPorBodega=[],this.bodegas.forEach(o=>{this.guiasPorBodega.push({bodega:o.codigo,guia:""})}),console.log("Bodegas procesadas:",this.bodegas),console.log("Gu\xEDas por bodega inicializadas:",this.guiasPorBodega)}}getGuiaPorBodega(t){let e=this.guiasPorBodega.find(l=>l.bodega===t);return e?e.guia:""}setGuiaPorBodega(t,e){let l=this.guiasPorBodega.find(o=>o.bodega===t);l&&(l.guia=e)}cerrarModal(){this.showPrepararModal=!1,this.facturaActual=null,this.facturaSeleccionada=null,this.detalleFactura=[],this.transporteSeleccionado="",this.numeroGuia="",this.numeroBultos=null,this.pesoEnvio="",this.comentariosEnvio="",this.consolidar=!1,this.tipoConsolidacion="",this.guiaConsolidacion="",this.bodegas=[],this.guiasPorBodega=[],this.listaTransportes=[],this.cargandoTransportes=!1}onCustomAction(t){switch(t.action){case"refresh":this.onRefreshTableData();break;default:}}onRefreshTableData(){this.loadTableData()}guardarCambios(){let t=this.listaTransportes.find(_=>_.id===this.transporteSeleccionado),e=t?t.C\u00F3digo:"N/A",l={transporteId:this.transporteSeleccionado,transporteNombre:e,numeroGuia:this.numeroGuia,numeroBultos:this.numeroBultos,peso:this.pesoEnvio,comentarios:this.comentariosEnvio,consolidacion:{activada:this.consolidar,tipo:this.tipoConsolidacion,guia:this.guiaConsolidacion},guiasPorBodega:[...this.guiasPorBodega],factura:this.facturaActual.Id,bodegas:this.facturaSeleccionada.BODEGAS};console.log("Datos de env\xEDo capturados:",this.facturaSeleccionada),console.log("Datos de env\xEDo capturados:",l);let o=this.guiasPorBodega.filter(_=>!_.guia?.trim()),c=!1;if(this.consolidar&&(!this.tipoConsolidacion||!this.guiaConsolidacion.trim())&&(c=!0),!this.transporteSeleccionado||!this.numeroBultos||o.length>0||c){let _=[];this.transporteSeleccionado||_.push("Transporte"),this.numeroBultos||_.push("N\xFAmero de bultos"),this.consolidar&&!this.tipoConsolidacion&&_.push("Tipo de consolidaci\xF3n"),this.consolidar&&!this.guiaConsolidacion.trim()&&_.push("Gu\xEDa de consolidaci\xF3n"),o.forEach(P=>{_.push(`Gu\xEDa para bodega ${P.bodega}`)}),w.default.fire({title:"\u26A0\uFE0F Campos Incompletos",html:`
          <div class="text-start">
            <p>Por favor complete los siguientes campos obligatorios:</p>
            <ul class="text-muted">
              ${_.map(P=>`<li>${P}</li>`).join("")}
            </ul>
          </div>
        `,icon:"warning",confirmButtonText:"Entendido"});return}let f=this.guiasPorBodega.map(_=>{let P=this.bodegas.find(Fe=>Fe.codigo===_.bodega),Ae=P?P.nombre:_.bodega;return`<p><strong>Bodega ${_.bodega} (${Ae}):</strong> ${_.guia}</p>`}).join(""),T=this.consolidar?`
      <hr class="my-2">
      <h6 class="text-warning mb-2"><i class="fa fa-boxes me-1"></i>Consolidaci\xF3n</h6>
      <p><strong>Tipo:</strong> ${this.opcionesConsolidacion.find(_=>_.id===this.tipoConsolidacion)?.nombre||"N/A"}</p>
      <p><strong>Gu\xEDa de consolidaci\xF3n:</strong> ${this.guiaConsolidacion}</p>
    `:"";w.default.fire({title:"\u2705 Datos Guardados",html:`
        <div class="text-start">
          <h6 class="text-primary mb-2"><i class="fa fa-file-invoice me-1"></i>Datos de Factura</h6>
          <p><strong>Factura:</strong> ${this.facturaActual?.Secuencia||"N/A"}</p>
          <p><strong>Cliente:</strong> ${this.facturaActual?.Nombre||"N/A"}</p>
          <p><strong>Total productos:</strong> ${this.detalleFactura?.length||0}</p>
          
          <hr class="my-2">
          
          <h6 class="text-success mb-2"><i class="fa fa-shipping-fast me-1"></i>Datos de Env\xEDo</h6>
          <p><strong>Transporte:</strong> ${e} (${this.transporteSeleccionado})</p>
          <p><strong>Bultos:</strong> ${this.numeroBultos}</p>
          <p><strong>Peso:</strong> ${this.pesoEnvio||"No especificado"}</p>
          ${this.comentariosEnvio?`<p><strong>Comentarios:</strong> ${this.comentariosEnvio}</p>`:""}
          
          ${T}
          
          <hr class="my-2">
          
          <h6 class="text-info mb-2"><i class="fa fa-warehouse me-1"></i>Gu\xEDas por Bodega</h6>
          ${f}
        </div>
      `,icon:"success",confirmButtonText:"OK"}),this.FacturacionService.FinalizarGuiasPickup(l).subscribe({next:_=>{console.log("response: ",_),_.success&&_.data||w.default.fire("Error!",_.message,"error"),this.isLoading=!1},error:_=>{this.isLoading=!1}})}enfocarInputCodigo(){setTimeout(()=>{let t=document.querySelector("#inputCodigo");t&&t.focus()},100)}static \u0275fac=function(e){return new(e||r)(I(B),I(G),I(L))};static \u0275cmp=k({type:r,selectors:[["app-guias-pickup"]],decls:9,vars:12,consts:[[1,"container-fluid","customer-order-wrapper"],[1,"row"],[1,"col-12"],[3,"headerTitle","cardClass"],[1,"row","mb-2"],[1,"customer-order-report","table-responsive","custom-scrollbar"],[1,"recent-table"],[3,"action","customAction","hasCheckbox","tableConfig","pageSize","paginateDetails","selectedRows","downloadReports","exportButtons","customButtons","initialDateFilter"],["class","modal fade show d-block","tabindex","-1","style","background:rgba(0,0,0,0.3);",4,"ngIf"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background","rgba(0,0,0,0.3)"],[1,"modal-dialog","modal-xl",2,"max-width","80vw"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","row mb-3",4,"ngIf"],["class","row",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","my-3"],["class","row mb-2",4,"ngIf"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-header","bg-light","py-2"],[1,"fw-bold","text-muted"],[1,"fa","fa-info-circle","me-1"],[1,"card-body","py-2"],[1,"table","table-sm","table-borderless","mb-0",2,"line-height","1.2"],[2,"height","28px"],[1,"fw-bold","text-muted","py-1",2,"width","35%"],[1,"fa","fa-boxes","text-warning","me-1"],[1,"py-1"],[1,"form-check"],["type","checkbox","name","consolidar","id","checkConsolidar",1,"form-check-input",3,"ngModelChange","ngModel"],["for","checkConsolidar",1,"form-check-label"],["style","height: 28px;",4,"ngIf"],[1,"fa","fa-shopping-cart","text-info","me-1"],[1,"text-danger"],["name","transporte",1,"form-select","form-select-solid","form-select-sm",3,"ngModelChange","ngModel","disabled"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],["style","height: 28px;",4,"ngFor","ngForOf"],[1,"fw-bold","text-muted","py-1"],[1,"fa","fa-box-open","text-secondary","me-1"],["type","number","name","numeroBultos","placeholder","N\xFAmero de bultos","min","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-warehouse","text-info","me-1"],["type","text","name","pesoEnvio","placeholder","Peso del paquete (kg)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"fa","fa-address-book","text-primary","me-1"],["name","comentarios","rows","2","placeholder","Comentarios sobre el env\xEDo",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","mb-3"],[1,"alert","alert-success","border-success","py-2","mb-0"],[1,"d-flex","align-items-center"],[1,"fa","fa-warehouse","text-primary","me-2","fs-5"],[1,"text-primary"],[1,"d-block","text-dark","fw-bold"],[1,"ms-auto"],[1,"badge","bg-primary","fs-6"],[1,"col-12","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"fa","fa-file-invoice","text-primary","me-2"],[1,"text-primary","mb-0"],[1,"fw-bold","text-primary","fs-5"],[1,"fa","fa-hashtag","text-primary","me-1"],[1,"fw-bold","text-primary"],[1,"fa","fa-file-alt","text-secondary","me-1"],[1,"fa","fa-user","text-success","me-1"],[1,"fa","fa-calendar","text-danger","me-1"],[1,"badge","bg-light","text-dark"],[1,"fa","fa-address-book","me-1"],[1,"fa","fa-map-marker-alt","text-danger","me-1"],[1,"fa","fa-city","text-info","me-1"],[1,"badge","bg-info","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-phone","text-success","me-1"],[1,"font-monospace"],[1,"fa","fa-envelope","text-primary","me-1"],[1,"fa","fa-user-tie","text-secondary","me-1"],[1,"fa","fa-shopping-cart","text-warning","me-1"],[1,"badge","bg-primary","bg-opacity-10","text-light","fw-bold"],[1,"fa","fa-credit-card","text-success","me-1"],[1,"badge","bg-success","bg-opacity-10","text-light","fw-bold"],[1,"card","border-primary"],[1,"card-header","bg-opacity-10"],[1,"fa","fa-list","me-1"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","mb-0"],[1,"table-primary"],[1,"text-center","py-2",2,"width","10%"],[1,"fa","fa-warehouse","me-1"],[1,"text-center","py-2",2,"width","12%"],[1,"fa","fa-barcode","me-1"],[1,"text-center","py-2",2,"width","8%"],[1,"text-center","py-2",2,"width","30%"],["class","align-middle",4,"ngFor","ngForOf"],[1,"align-middle"],[1,"text-center","fw-bold","py-1"],[1,"text-center","fw-bold","text-primary","py-1","fs-6"],[1,"small","text-muted","py-1"],[1,"alert","alert-primary","py-2"],[1,"alert","alert-warning","py-2"],[1,"fa","fa-boxes","me-1"],[1,"fa","fa-list","text-warning","me-1"],["name","tipoConsolidacion",1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"fa","fa-barcode","text-warning","me-1"],["type","text","name","guiaConsolidacion","placeholder","N\xFAmero de gu\xEDa de consolidaci\xF3n",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-muted"],[1,"fa","fa-spinner","fa-spin","me-1"],[1,"fa","fa-file","text-primary","me-1"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel","name","placeholder"],[1,"text-center","text-muted","py-4"],[1,"fa","fa-inbox","fa-2x","mb-2","d-block"]],template:function(e,l){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),d(4,"div",4),i(5,"div",5)(6,"div",6)(7,"app-table",7),C("action",function(c){return l.onTableAction(c)})("customAction",function(c){return l.onCustomAction(c)}),a()()()()()(),g(8,Ot,83,20,"div",8),a()),e&2&&(s(3),u("headerTitle","Lista de Facturas por ingresar guias")("cardClass","mb-4"),s(4),u("hasCheckbox",!1)("tableConfig",l.tableConfig)("pageSize",10)("paginateDetails",!0)("selectedRows",!0)("downloadReports",!0)("exportButtons",l.Buttons_Export)("customButtons",l.customButtons)("initialDateFilter","this_month"),s(),u("ngIf",l.showPrepararModal))},dependencies:[U,R,N,$,H,he,ve,z,q,ge,_e,W,K,J,X,j],encapsulation:2})};var li=[{path:"picking/prepararfacturas",component:Y,data:{title:"Preparar Facturas",breadcrumb:"Preparar Facturas"}},{path:"picking/verificarfacturas",component:Z,data:{title:"Verificar Facturas",breadcrumb:"Verificar Facturas"}},{path:"picking/guiaspickup",component:ee,data:{title:"Guias Pickup",breadcrumb:"Guias Pickup"}}];export{li as LogisticaRoutes};
