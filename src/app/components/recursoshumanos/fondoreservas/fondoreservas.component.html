<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <app-card [headerTitle]="'Fondo de Reservas'" [cardClass]="'mb-4'">

                <!-- Botones de Sección -->
                <div class="row mb-4">
                    <div class="col-12">
                        <label class="form-label fw-bold mb-3">Seleccione la Empresa:</label>
                        <div class="d-flex gap-3">
                            <button type="button" class="btn btn-lg"
                                [class.btn-primary]="selectedEmpresa === 'Cartimex'"
                                [class.btn-outline-primary]="selectedEmpresa !== 'Cartimex'"
                                (click)="selectEmpresa('Cartimex')">
                                <i class="fa fa-building me-2"></i>CARTIMEX
                            </button>
                            <button type="button" class="btn btn-lg"
                                [class.btn-success]="selectedEmpresa === 'Computron'"
                                [class.btn-outline-success]="selectedEmpresa !== 'Computron'"
                                (click)="selectEmpresa('Computron')">
                                <i class="fa fa-building me-2"></i>COMPUTRON
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Input para leer archivos -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="fileInput" class="form-label fw-bold">Cargar Archivo:</label>
                        <input type="file" class="form-control" id="fileInput" (change)="onFileSelected($event)"
                            accept=".xlsx,.xls,.csv">
                        <small class="text-muted">Formatos permitidos: Excel (.xlsx, .xls) o CSV</small>
                    </div>
                </div>

                <!-- Información del archivo seleccionado -->
                <div class="row" *ngIf="selectedFile">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fa fa-file me-2"></i>
                            <strong>Archivo seleccionado:</strong> {{ selectedFile.name }}
                            <br>
                            <small>Tamaño: {{ formatFileSize(selectedFile.size) }}</small>
                        </div>
                    </div>
                </div>

                <!-- Loading spinner -->
                <div class="row" *ngIf="isLoadingFile">
                    <div class="col-12 text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2 text-muted">Procesando archivo...</p>
                    </div>
                </div>

                <!-- Tabla de datos -->
                <div class="row" *ngIf="tableData.length > 0 && !isLoadingFile">
                    <div class="col-12">
                        <hr>

                        <!-- Botón Guardar y Filtros -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="d-flex gap-2 align-items-center">
                                <!-- Botón Guardar -->
                                <button type="button" class="btn btn-success btn-lg" (click)="guardarDatos()">
                                    <i class="fa fa-save me-2"></i>Guardar Todo
                                </button>

                                <!-- Separador -->
                                <div class="vr" style="height: 40px;"></div>

                                <!-- Filtros por VISTO -->
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm"
                                        [class.btn-primary]="vistoFilter === 'todos'"
                                        [class.btn-outline-primary]="vistoFilter !== 'todos'"
                                        (click)="setVistoFilter('todos')">
                                        <i class="fa fa-list me-1"></i>Todos
                                    </button>
                                    <button type="button" class="btn btn-sm" [class.btn-success]="vistoFilter === 'si'"
                                        [class.btn-outline-success]="vistoFilter !== 'si'"
                                        (click)="setVistoFilter('si')">
                                        <i class="fa fa-check me-1"></i>Marca SI
                                    </button>
                                    <button type="button" class="btn btn-sm" [class.btn-danger]="vistoFilter === 'no'"
                                        [class.btn-outline-danger]="vistoFilter !== 'no'"
                                        (click)="setVistoFilter('no')">
                                        <i class="fa fa-times me-1"></i>Marca NO
                                    </button>
                                </div>
                            </div>

                            <div class="d-flex gap-2 align-items-center">
                                <!-- Info de registros -->
                                <h6 class="mb-0">
                                    <i class="fa fa-table me-2"></i>
                                    {{ selectedEmpresa }}
                                    <span class="badge bg-primary ms-2">{{ filteredTableData.length }} / {{
                                        tableData.length }} registros</span>
                                </h6>

                                <!-- Campo de búsqueda -->
                                <div class="input-group" style="max-width: 300px;">
                                    <span class="input-group-text">
                                        <i class="fa fa-search"></i>
                                    </span>
                                    <input type="text" class="form-control" placeholder="Buscar en la tabla..."
                                        [(ngModel)]="searchText" (ngModelChange)="filterTable()">
                                    <button class="btn btn-outline-secondary" type="button" *ngIf="searchText"
                                        (click)="searchText = ''; filterTable()">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                            <table class="table table-striped table-bordered table-hover">
                                <thead class="table-dark sticky-top">
                                    <tr>
                                        <th>#</th>
                                        <th *ngFor="let header of tableHeaders"
                                            [ngClass]="{'dobra-column': header === 'Se marca en Dobra'}">{{ header }}
                                        </th>
                                        <th class="text-center" style="width: 100px;">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let row of filteredTableData; let i = index">
                                        <td class="fw-bold">{{ i + 1 }}</td>
                                        <td *ngFor="let header of tableHeaders"
                                            [ngClass]="{'dobra-column': header === 'Se marca en Dobra'}">
                                            {{ row[header] }}
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-sm btn-outline-primary"
                                                (click)="guardarRegistroIndividual(row)" title="Enviar Individual">
                                                <i class="fa fa-paper-plane"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Mensaje cuando no hay resultados -->
                        <div class="alert alert-warning mt-3"
                            *ngIf="filteredTableData.length === 0 && (searchText || vistoFilter !== 'todos')">
                            <i class="fa fa-exclamation-triangle me-2"></i>
                            No se encontraron resultados con los filtros aplicados
                        </div>
                    </div>
                </div>

            </app-card>
        </div>
    </div>
</div>