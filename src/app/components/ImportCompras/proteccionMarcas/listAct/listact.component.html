<div class="container-fluid customer-order-wrapper">
    <div class="row">
        <div class="col-12">
            <app-card [headerTitle]="'Listado de Actividades'" [cardClass]="'mb-4'">
                <div class="col-md-7">
                    <div class="card shadow-bg border-0">
                        <div class="card-body">

                            <div class="row align-items-end">

                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="fechaInicio"
                                            [(ngModel)]="form.FECHAINI" [max]="maxDate" required>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Fecha Fin</label>
                                        <input type="date" class="form-control" id="fechaFin"
                                            [(ngModel)]="form.FECHAFIN" [max]="maxDate" required>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="mb-3 d-grid">
                                        <button class="btn btn-primary"
                                            (click)=Cargar_Datos_Actividades()>Cargar</button>
                                    </div>
                                </div>

                            </div>


                            <div class="col-md-4">
                                <div class="d-flex gap-3">
                                    <div class="mb-3">
                                        <button class="btn btn-success w-100"
                                            [ngClass]="activeTab === 'actividades' ? 'btn-success' : 'btn-light'"
                                            (click)="activeTab = 'actividades'">Actividades</button>
                                    </div>
                                    <div class="mb-3">
                                        <button class="btn btn-success w-100"
                                            [ngClass]="activeTab === 'consolidados' ? 'btn-success' : 'btn-light'"
                                            (click)="activeTab = 'consolidados'">Consolidados</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="activeTab === 'actividades'">
                    <div id="SECC_INVIDIDUALES" class="mt-3">
                        <label class="text-gray-100">Actividades Individuales</label>
                        <div class="table-responsive">
                            <label id="text_cant_inv">Cantidad: ...</label>
                            <div class="customer-order-report table-responsive custom-scrollbar">
                                <app-table [tableConfig]="ActividadesTableConfig" [pageSize]="10"
                                    [paginateDetails]="true" [selectedRows]="false" [downloadReports]="true"
                                    [exportButtons]="Buttons_Export" (action)="onActAction($event)">
                                    <!-- (action)="onListaAction($event)" (customAction)="onAmortizacionAction($event)""> -->
                                </app-table>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="activeTab === 'consolidados'">
                    <div id="SECC_INVIDIDUALES" class="mt-3">
                        <label class="text-gray-100">Actividades Consolidadas</label>
                        <div class="table-responsive">
                            <label id="text_cant_inv">Cantidad: ...</label>

                            <div *ngIf="showPayConsolidado">
                                HOLA
                            </div>

                            <div class="customer-order-report table-responsive custom-scrollbar">
                                <app-table [tableConfig]="ConsolidadosTableConfig" [pageSize]="10"
                                    [paginateDetails]="true" [selectedRows]="true"
                                    (action)="onListAction($event)" [customButtons]="consolidadosButtons"
                                    (customAction)="onListConsAction($event)" (selectedRowsChange)="onRowsSelected($event)">
                                </app-table>
                            </div>
                        </div>
                    </div>
                </div>




                <!-- Modal Actividades EDIT -->
                <div *ngIf="showModalEdit">
                    <!-- Fondo oscuro -->
                    <div class="modal-backdrop fade show" (click)="cerrarModalEditAct()"></div>

                    <!-- Modal -->
                    <div class="modal fade show d-block" tabindex="-1">
                        <div class="modal-dialog modal-md modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Editar Actividad</h5>
                                    <button type="button" class="btn-close" (click)="cerrarModalEditAct()"></button>
                                </div>

                                <div class="modal-body">

                                    <!-- ================== FORM DE EDIT ACTIVIDAD ================== -->
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label class="form-label">Fecha de Actividad</label>
                                            <input type="date" class="form-control" id="Fecha_actividad"
                                                [(ngModel)]="formEdit.fechaActividad" [max]="maxDate" required>
                                            <!-- onchange="mostrarMensaje()" max=''-->

                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Tipo <span class="text-danger">*</span></label>
                                            <select class="form-select" id="Tipo" [(ngModel)]="formEdit.tipo" required>
                                                <option value="">Seleccione</option>
                                                <option *ngFor="let item of tipos" [ngValue]="item.id"> {{ item.nombre
                                                    }}
                                                </option>
                                            </select>
                                        </div>

                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" id="check_Marca"
                                                [value]="'marca'" [(ngModel)]="modoCheck"
                                                (ngModelChange)="onCheckMarcaChange()">
                                            <label class="fst-italic">Marca</label>
                                        </div>

                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" [value]="'proveedor'"
                                                [(ngModel)]="modoCheck" (ngModelChange)="onCheckMarcaChange()">
                                            <label class="fst-italic">Proveedor</label>
                                        </div>



                                        <div class="card shadow-bg border-0">
                                            <div class="card-body">

                                                <div class="row">
                                                    <!-- Left -->
                                                    <div class="col-md-6">

                                                        <div class="mb-3">
                                                            <label class="form-label">Marca</label>
                                                            <select class="form-select" id="Marca"
                                                                [(ngModel)]="formEdit.marca" required>
                                                                <option value="" selected>Seleccione</option>
                                                                <option *ngFor="let item of marcas" [ngValue]="item"> {{
                                                                    item.Nombre }}
                                                                </option>
                                                            </select>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label">Valor</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text">$</span>
                                                                <input type="number" class="form-control" id="Valor"
                                                                    placeholder="0.00" required min="0"
                                                                    [(ngModel)]="formEdit.valor">
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <!-- Right -->

                                                    <div class="col-md-6">

                                                        <div class="mb-3">
                                                            <label class="form-label">Referencia</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text">#</span>
                                                                <input type="text" class="form-control"
                                                                    placeholder="xxxxxxxxxx" id="Referencia"
                                                                    [(ngModel)]="formEdit.referencia" required>
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label">Periodo</label>
                                                            <select class="form-select" id="Periodo"
                                                                [(ngModel)]="formEdit.periodo" required>
                                                                <option value="" selected>Seleccione</option>
                                                                <option value="1">1 Q </option>
                                                                <option value="2">2 Q</option>
                                                                <option value="3">3 Q</option>
                                                                <option value="4">4 Q</option>
                                                                <!-- <option *ngFor="let item of tiposObligaciones" [ngValue]="item.id"> {{ item.nombre }} -->
                                                                <!-- </option> -->
                                                            </select>
                                                        </div>

                                                    </div>

                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label">Concepto</label>
                                                    <div class="input-group">
                                                        <textarea type="text" class="form-control"
                                                            placeholder="Concepto" id="Concepto"
                                                            [(ngModel)]="formEdit.concepto" required
                                                            rows="3"></textarea>
                                                    </div>
                                                </div>

                                                <div class="mt-3">
                                                    <!-- onclick="grabar_datos()" -->
                                                    <button class="btn btn-primary" id="Ingresar"
                                                        (click)="Actualizar_actividad()">
                                                        Editar Actividad
                                                    </button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" (click)="cerrarModalEditAct()">
                                        Cerrar
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>



                <!-- Modal Actividades AsignGasto -->
                <div *ngIf="showModalAsignGasto">
                    <!-- Fondo oscuro -->
                    <div class="modal-backdrop fade show" (click)="cerrarModalAsignGastoAct()"></div>

                    <!-- Modal -->
                    <div class="modal fade show d-block" tabindex="-1">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Asignar Gastos</h5>
                                    <button type="button" class="btn-close"
                                        (click)="cerrarModalAsignGastoAct()"></button>
                                </div>

                                <div class="modal-body">

                                    <!-- ================== FORM Asign Gasto ================== -->
                                    <div class="col-md-12">

                                        <div class="card shadow-sm border-0">
                                            <div class="card-body">

                                                <h5 class="mb-3">
                                                    Actividad #{{ actividadSeleccionada?.ACTIVIDAD_ID }}
                                                </h5>
                                                <h6 class="mb-4">
                                                    Consolidado #{{ actividadSeleccionada?.consolidado_id || 'N/A' }}
                                                </h6>

                                                <div class="row">

                                                    <!-- =================== COLUMNA 1 =================== -->
                                                    <div class="col-md-3">

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Fecha de Creaci√≥n:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_FECHA_CREADA }}
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Referencia:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_REFERENCIA }}
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Valor:</label>
                                                            <div class="form-control-plaintext">
                                                                $ {{ actividadSeleccionada?.ACTIVIDAD_PRESUPUESTO }}
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Concepto:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_CONCEPTO }}
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <!-- =================== COLUMNA 2 =================== -->
                                                    <div class="col-md-3 border-start">

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Marca / Proveedor:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_MARCA_NOMBRE }}
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Tipo:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_TIPO }}
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">Periodo:</label>
                                                            <div class="form-control-plaintext">
                                                                {{ actividadSeleccionada?.ACTIVIDAD_PERIODO }} Q
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <!-- =================== COLUMNA 3 (FORMULARIO GASTOS) =================== -->
                                                    <div class="bg-primary p-3 rounded col-md-4 border-start">

                                                        <h1 class="text-white mb-3">Asignar Gasto
                                                        </h1>

                                                        <div class="mb-3">
                                                            <label class="form-label">Tipo de Documento</label>
                                                            <select class="form-select"
                                                                [(ngModel)]="formAsignGasto.tipoDocumento"
                                                                data-live-search="true" aria-label="Default"
                                                                id="Tipo_PRE">
                                                                <option value="" selected>Seleccione</option>
                                                                <!-- <option value="ACR-CR">ACR-CR</option> -->
                                                                <option value="PRV-FA">PRV-FA</option>
                                                                <!-- <option value="BAN-EG">BAN-EG</option> -->
                                                            </select>
                                                            <!-- <input type="number" class="form-control" > -->
                                                        </div>

                                                        <div class="mb-3">
                                                            <label class="form-label">Detalle</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text"><i
                                                                        class="fa-solid fa-magnifying-glass"></i></span>
                                                                <input type="text" class="form-control" min="0"
                                                                    [(ngModel)]="formAsignGasto.detalle_documento">
                                                            </div>
                                                        </div>

                                                        <button class="btn btn-success w-100"
                                                            (click)="Buscar_Documentos()">
                                                            Buscar Documentos
                                                        </button>
                                                    </div>
                                                </div>

                                                <div class="card border-info p-3" *ngIf="asignGastosDocs">
                                                    <div class="card-body p-3">

                                                        <div class="d-flex justify-content-between">
                                                            <div class="text-muted">PROVEEDOR</div>
                                                            <div class="fw-semibold text-end">{{
                                                                asignGastosDocs?.PROVEEDOR }}</div>
                                                        </div>

                                                        <div class="d-flex justify-content-between mt-2">
                                                            <div class="text-muted">DETALLE</div>
                                                            <div class="fw-semibold text-end">{{
                                                                asignGastosDocs?.ACR_DETALLE }}</div>
                                                        </div>

                                                        <div class="d-flex justify-content-between mt-2">
                                                            <div class="text-muted">VALOR</div>
                                                            <div class="fw-semibold text-end">${{
                                                                asignGastosDocs?.ACR_VALOR_DOCUMENTO }}</div>
                                                        </div>

                                                        <div class="d-flex justify-content-between mt-2">
                                                            <div class="text-muted">SALDO</div>
                                                            <div class="fw-semibold text-end">${{ asignGastosDocs?.SALDO
                                                                }}</div>
                                                        </div>

                                                        <div class="mt-3 d-flex gap-2 align-items-center">
                                                            <input class="form-control" style="max-width:140px;" type="number" step="0.01" [(ngModel)]="documentoPago">
                                                            <button class="btn btn-info text-white"
                                                                (click)="Aplicar_Documento()">
                                                                Aplicar
                                                            </button>
                                                        </div>

                                                    </div>
                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        (click)="cerrarModalAsignGastoAct()">
                                        Cerrar
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>



                <!-- Modal Add Consolidado -->
                <div *ngIf="showModalAddConsolidado">
                    <!-- Fondo oscuro -->
                    <div class="modal-backdrop fade show" (click)="cerrarModalAddConsolidado()"></div>

                    <!-- Modal -->
                    <div class="modal fade show d-block" tabindex="-1">
                        <div class="modal-dialog modal-lg modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Consolidado</h5>
                                    <button type="button" class="btn-close"
                                        (click)="cerrarModalAddConsolidado()"></button>
                                </div>

                                <div class="modal-body">

                                    <!-- ================== FORM DE ADD/EDIT CONSOLIDADOS ================== -->
                                    <div class="col-md-12">

                                        <div class="mb-3">
                                            <label class="form-label">Referencia</label>
                                            <div class="input-group">
                                                <span class="input-group-text">#</span>
                                                <input type="text" class="form-control" placeholder="xxxxxxxxxx"
                                                    id="Referencia" [(ngModel)]="formAddCons.referencia" required>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Descripcion</label>
                                            <div class="input-group">
                                                <textarea type="text" class="form-control" placeholder="Descripcion"
                                                    id="Concepto" [(ngModel)]="formAddCons.descripcion" required
                                                    rows="3"></textarea>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <button class="btn btn-success" id="Ingresar"
                                                (click)="crearConsolidado(consolidadoSeleccionada)">
                                                {{ nuevoConsolidado === 1 ? 'Crear Consolidado' : 'Actualizar
                                                Consolidado' }}
                                            </button>

                                        </div>

                                        <div class="customer-order-report table-responsive custom-scrollbar">
                                            <app-table [tableConfig]="ActividadesxConsolidarTableConfig" [pageSize]="10"
                                                    [paginateDetails]="true" [selectedRows]="true"
                                                    (action)="onActAction($event)" (selectedRowsChange)="onRowsSelected($event)">
                                            </app-table>
                                        </div>

                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        (click)="cerrarModalAddConsolidado()">
                                        Cerrar
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>



                <div *ngIf="showModalVerActConsolidado">
                    <!-- Fondo oscuro -->
                    <div class="modal-backdrop fade show" (click)="cerrarModalVerActConsolidado()"></div>

                    <!-- Modal -->
                    <div class="modal fade show d-block" tabindex="-1">
                        <div class="modal-dialog modal-lg modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Consolidado</h5>
                                    <button type="button" class="btn-close"
                                        (click)="cerrarModalVerActConsolidado()"></button>
                                </div>

                                <div class="modal-body">

                                    <!-- ================== Ver CONSOLIDADOS ================== -->
                                    <div class="col-md-12">

                                        <div class="customer-order-report table-responsive custom-scrollbar">
                                            <app-table [tableConfig]="ConsolidadosActTableConfig" [pageSize]="10"
                                                [paginateDetails]="true" [selectedRows]="false"
                                                (action)="onActAction($event)">
                                            </app-table>
                                        </div>

                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        (click)="cerrarModalVerActConsolidado()">
                                        Cerrar
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>



            </app-card>
        </div>
    </div>
</div>